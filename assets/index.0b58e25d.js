var _e=Object.defineProperty,Re=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var Ee=Object.getOwnPropertySymbols;var qe=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var oe=(t,e,a)=>e in t?_e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,E=(t,e)=>{for(var a in e||(e={}))qe.call(e,a)&&oe(t,a,e[a]);if(Ee)for(var a of Ee(e))$e.call(e,a)&&oe(t,a,e[a]);return t},C=(t,e)=>Re(t,Pe(e));var D=(t,e,a)=>(oe(t,typeof e!="symbol"?e+"":e,a),a);import{j as ce,r as l,R as X,a as Qe}from"./vendor.e8256409.js";const Ue=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}};Ue();const n=ce.exports.jsx,c=ce.exports.jsxs,T=ce.exports.Fragment,Ce=t=>{const{children:e,store:a,context:s}=t,[r,o]=l.exports.useState(a.getState());return l.exports.useEffect(()=>{const i=a.subscribe(p=>{o(p)});return()=>{i()}},[]),n(s.Provider,{value:r,children:e})};function He(t){const e=Object.keys(t),a={};for(const s of e)typeof t[s]=="function"&&(a[s]=t[s]);return(s={},r)=>{let o=!1;const i={};for(const p of e){const m=s[p],y=a[p](m,r);i[p]=y,o=o||y!==m}return o?i:s}}function Ge(t,e){const a=[];let s=t;return{dispatch:p=>{const m=e(s,p),y=s;s=m;for(const N of a)N(s,y)},getState:()=>s,subscribe:p=>{let m=!0;return a.push(p),()=>{if(!m)return;const y=a.indexOf(p);a.splice(y,1),m=!1}}}}function Ye(t,e){switch(e.type){case"SET_MARK_MEMO_ID":return e.payload.markMemoId===t.markMemoId?t:C(E({},t),{markMemoId:e.payload.markMemoId});case"SET_EDIT_MEMO_ID":return e.payload.editMemoId===t.editMemoId?t:C(E({},t),{editMemoId:e.payload.editMemoId});case"SET_MOBILE_VIEW":return e.payload.isMobileView===t.isMobileView?t:C(E({},t),{isMobileView:e.payload.isMobileView});case"SET_APP_SETTING":return E(E({},t),e.payload);default:return t}}const Ve={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,isMobileView:!1};function je(t,e){switch(e.type){case"SET_LOCATION":return e.payload;case"SET_PATHNAME":return e.payload.pathname===t.pathname?t:C(E({},t),{pathname:e.payload.pathname});case"SET_HASH":return e.payload.hash===t.hash?t:C(E({},t),{hash:e.payload.hash});case"SET_QUERY":return C(E({},t),{query:E({},e.payload)});case"SET_TAG_QUERY":return e.payload.tag===t.query.tag?t:C(E({},t),{query:C(E({},t.query),{tag:e.payload.tag})});case"SET_DURATION_QUERY":return e.payload.duration===t.query.duration?t:C(E({},t),{query:C(E({},t.query),{duration:E(E({},t.query.duration),e.payload.duration)})});case"SET_TYPE":return e.payload.type===t.query.type?t:C(E({},t),{query:C(E({},t.query),{type:e.payload.type})});case"SET_TEXT":return e.payload.text===t.query.text?t:C(E({},t),{query:C(E({},t.query),{text:e.payload.text})});case"SET_QUERY_FILTER":return e.payload===t.query.filter?t:C(E({},t),{query:C(E({},t.query),{filter:e.payload})});default:return t}}const We={pathname:"/",hash:"",query:{tag:"",duration:null,type:"",text:"",filter:""}};function xe(){const t=navigator.appVersion;let e="Unknown";return t.indexOf("Win")!=-1?e="Windows":t.indexOf("Mac")!=-1?e="MacOS":t.indexOf("Linux")!=-1&&(e="Linux"),e}function F(t){return typeof t=="string"&&(t=t.replaceAll("-","/")),new Date(t).getTime()}function ie(t){const e=new Date(F(t));return new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()}function V(t){const e=new Date(F(t)),a=e.getFullYear(),s=e.getMonth()+1,r=e.getDate();return`${a}/${s}/${r}`}function Ke(t){const e=new Date(F(t)),a=e.getHours(),s=e.getMinutes(),r=a<10?"0"+a:a,o=s<10?"0"+s:s;return`${r}:${o}`}function R(t){const e=new Date(F(t)),a=e.getFullYear(),s=e.getMonth()+1,r=e.getDate(),o=e.getHours(),i=e.getMinutes(),p=e.getSeconds(),m=s<10?"0"+s:s,y=r<10?"0"+r:r,N=o<10?"0"+o:o,f=i<10?"0"+i:i,h=p<10?"0"+p:p;return`${a}/${m}/${y} ${N}:${f}:${h}`}function ze(t){return Array.from(new Set(t))}function ne(t){const e=new Set,a=[];for(const s of t)e.has(s.id)||(e.add(s.id),a.push(s));return a}function ve(t){const e=[],a=Object.keys(t).sort();for(const s of a){const r=t[s];r&&(typeof r=="object"?e.push(...ve(r).split("&")):e.push(`${s}=${r}`))}return e.join("&")}async function Xe(t){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(t)}catch(e){console.warn("Copy to clipboard failed.",e)}else console.warn("Copy to clipboard failed, methods not supports.")}function Je(t){return new Promise(e=>{const a=new Image;a.onload=()=>{const{width:s,height:r}=a;s>0&&r>0?e({width:s,height:r}):e({width:0,height:0})},a.onerror=()=>{e({width:0,height:0})},a.className="hidden",a.src=t,document.body.appendChild(a),a.remove()})}function Se(t){var e;for(const a of t.children){if(a.tagName==="SCRIPT"){a.insertAdjacentText("beforebegin",a.outerHTML),a.remove();continue}else if(a.tagName==="P"&&a.textContent===""&&((e=a.firstElementChild)==null?void 0:e.tagName)!=="BR"){a.remove();continue}a.childElementCount>0&&Se(a)}}function Ze(t,e){switch(e.type){case"SET_MEMOS":{const a=ne(e.payload.memos.sort((s,r)=>F(r.createdAt)-F(s.createdAt)));return C(E({},t),{memos:[...a]})}case"SET_TAGS":return C(E({},t),{tags:e.payload.tags});case"INSERT_MEMO":{const a=ne([e.payload.memo,...t.memos].sort((s,r)=>F(r.createdAt)-F(s.createdAt)));return C(E({},t),{memos:a})}case"DELETE_MEMO_BY_ID":return C(E({},t),{memos:[...t.memos].filter(a=>a.id!==e.payload.id)});case"EDIT_MEMO":{const a=t.memos.map(s=>s.id===e.payload.id?E(E({},s),e.payload):s);return C(E({},t),{memos:a})}default:return t}}const et={memos:[],tags:[]};function tt(t,e){switch(e.type){case"SIGN_IN":return{user:e.payload.user};case"SIGN_OUT":return{user:null};default:return t}}const nt={user:null};function at(t,e){switch(e.type){case"SET_QUERIES":{const a=ne(e.payload.queries.sort((s,r)=>F(r.createdAt)-F(s.createdAt)).sort((s,r)=>{var o,i;return F((o=r.pinnedAt)!=null?o:0)-F((i=s.pinnedAt)!=null?i:0)}));return C(E({},t),{queries:a})}case"INSERT_QUERY":{const a=ne([e.payload.query,...t.queries].sort((s,r)=>F(r.createdAt)-F(s.createdAt)));return C(E({},t),{queries:a})}case"DELETE_QUERY_BY_ID":return C(E({},t),{queries:[...t.queries].filter(a=>a.id!==e.payload.id)});case"UPDATE_QUERY":{const a=t.queries.map(s=>s.id===e.payload.id?E(E({},s),e.payload):s);return C(E({},t),{queries:a})}default:return t}}const st={queries:[]},S=Ge({globalState:Ve,locationState:We,memoState:et,userState:nt,queryState:st},He({globalState:Ye,locationState:je,memoState:Ze,userState:tt,queryState:at})),B=l.exports.createContext(S.getState());var j;(function(t){function e(r){const o={};for(const i of r)try{const p=localStorage.getItem(i);if(p!==null){const m=JSON.parse(p);o[i]=m}}catch(p){console.error("Get storage failed in ",i,p)}return o}t.get=e;function a(r){for(const o in r)try{const i=JSON.stringify(r[o]);localStorage.setItem(o,i)}catch(i){console.error("Save storage failed in ",o,i)}}t.set=a;function s(){var o;const r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r),(o=r.contentWindow)==null||o.localStorage.setItem("t",Date.now().toString()),r.remove()}t.emitStorageChangedEvent=s})(j||(j={}));class rt{constructor(){D(this,"getState",()=>S.getState().globalState);D(this,"setEditMemoId",e=>{S.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:e}})});D(this,"setMarkMemoId",e=>{S.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:e}})});D(this,"setIsMobileView",e=>{S.dispatch({type:"SET_MOBILE_VIEW",payload:{isMobileView:e}})});D(this,"setAppSetting",e=>{S.dispatch({type:"SET_APP_SETTING",payload:e}),j.set(e)});var s,r,o;const e=j.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser"]),a={shouldSplitMemoWord:(s=e.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(r=e.shouldHideImageUrl)!=null?r:!0,shouldUseMarkdownParser:(o=e.shouldUseMarkdownParser)!=null?o:!0};this.setAppSetting(a)}}const L=new rt,P=(t="replace")=>{const{query:e,pathname:a,hash:s}=S.getState().locationState;let r=ve(e);r?r="?"+r:r="",t==="replace"?window.history.replaceState(null,"",a+s+r):window.history.pushState(null,"",a+s+r)};class ot{constructor(){D(this,"updateStateWithLocation",()=>{var m,y,N,f,h,u;const{pathname:e,search:a,hash:s}=window.location,r=new URLSearchParams(a),o={pathname:"/",hash:"",query:{tag:"",duration:null,text:"",type:"",filter:""}};o.query.tag=(m=r.get("tag"))!=null?m:"",o.query.type=(y=r.get("type"))!=null?y:"",o.query.text=(N=r.get("text"))!=null?N:"",o.query.filter=(f=r.get("filter"))!=null?f:"";const i=parseInt((h=r.get("from"))!=null?h:"0"),p=parseInt((u=r.get("to"))!=null?u:"0");p>i&&p!==0&&(o.query.duration={from:i,to:p}),o.hash=s,o.pathname=this.getValidPathname(e),S.dispatch({type:"SET_LOCATION",payload:o})});D(this,"getState",()=>S.getState().locationState);D(this,"clearQuery",()=>{S.dispatch({type:"SET_QUERY",payload:{tag:"",duration:null,text:"",type:"",filter:""}}),P()});D(this,"setQuery",e=>{S.dispatch({type:"SET_QUERY",payload:e}),P()});D(this,"setHash",e=>{S.dispatch({type:"SET_HASH",payload:{hash:e}}),P()});D(this,"setPathname",e=>{S.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),P()});D(this,"pushHistory",e=>{S.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),P("push")});D(this,"replaceHistory",e=>{S.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),P("replace")});D(this,"setMemoTypeQuery",(e="")=>{S.dispatch({type:"SET_TYPE",payload:{type:e}}),P()});D(this,"setMemoFilter",e=>{S.dispatch({type:"SET_QUERY_FILTER",payload:e}),P()});D(this,"setTextQuery",e=>{S.dispatch({type:"SET_TEXT",payload:{text:e}}),P()});D(this,"setTagQuery",e=>{S.dispatch({type:"SET_TAG_QUERY",payload:{tag:e}}),P()});D(this,"setFromAndToQuery",(e,a)=>{S.dispatch({type:"SET_DURATION_QUERY",payload:{duration:{from:e,to:a}}}),P()});D(this,"getValidPathname",e=>["/","/signin","/recycle","/setting"].includes(e)?e:"/");this.updateStateWithLocation(),window.onpopstate=()=>{this.updateStateWithLocation()}}}const M=new ot;async function W(t){const a=await(await fetch(t,{method:"GET"})).json();if(!a.succeed)throw a;return a}async function _(t,e){const s=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(!s.succeed)throw s;return s}function ct(){return W("/api/user/me")}function it(t,e){return _("/api/user/signin",{username:t,password:e})}function lt(){return _("/api/user/signout")}function ut(t){return W("/api/user/checkusername?username="+t)}function dt(t){return _("/api/user/checkpassword",{password:t})}function le(t,e,a){return _("/api/user/update",{username:t,password:e,githubName:a})}function mt(){return W("/api/memo/all")}function pt(){return W("/api/memo/deleted")}function ht(t){return _("/api/memo/new",{content:t})}function gt(t){return _("/api/memo/hide",{memoId:t})}function ft(t){return _("/api/memo/restore",{memoId:t})}function yt(t){return _("/api/memo/delete",{memoId:t})}function Nt(t,e){return _("/api/memo/update",{memoId:t,content:e})}function Et(t){return W("/api/memo/linked?memoId="+t)}function Ct(){return W("/api/query/all")}function xt(t,e){return _("/api/query/new",{title:t,querystring:e})}function vt(t,e,a){return _("/api/query/update",{queryId:t,title:e,querystring:a})}function St(t){return _("/api/query/delete",{queryId:t})}function bt(t){return _("/api/query/pin",{queryId:t})}function wt(t){return _("/api/query/unpin",{queryId:t})}const J="#page-container",Z="mobile-show-sidebar",be=200,Ft=400,Q=3600*24*1e3,H=/#\s(.+?)\s/g,ae=/(https?:\/\/[^\s<\\*>']+)/g,U=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,ee=/\[@(.+?)\]\((.+?)\)/g;class Mt{getState(){return S.getState().userState}async doSignIn(){const{data:e}=await ct();return e?S.dispatch({type:"SIGN_IN",payload:{user:e}}):I.doSignOut(),e}async doSignOut(){lt().catch(()=>{}).finally(()=>{S.dispatch({type:"SIGN_OUT",payload:{user:null}})})}async checkUsernameUsable(e){const{data:a}=await ut(e);return a}async updateUsername(e){await le(e)}async removeGithubName(){await le(void 0,void 0,"")}async checkPasswordValid(e){const{data:a}=await dt(e);return a}async updatePassword(e){await le(void 0,e)}}const I=new Mt;class At{getState(){return S.getState().memoState}async fetchAllMemos(){if(!I.getState().user)return!1;const{data:e}=await mt(),a=[];for(const s of e)a.push(s);return S.dispatch({type:"SET_MEMOS",payload:{memos:a}}),a}async fetchDeletedMemos(){if(!I.getState().user)return!1;const{data:e}=await pt();return e}pushMemo(e){S.dispatch({type:"INSERT_MEMO",payload:{memo:E({},e)}})}getMemoById(e){for(const a of this.getState().memos)if(a.id===e)return a;return null}async hideMemoById(e){await gt(e),S.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:e}})}async restoreMemoById(e){await ft(e),k.clearMemos(),k.fetchAllMemos()}async deleteMemoById(e){await yt(e)}editMemo(e){S.dispatch({type:"EDIT_MEMO",payload:e})}updateTagsState(){var s;const{memos:e}=this.getState(),a=new Set;for(const r of e)for(const o of Array.from((s=r.content.match(H))!=null?s:[]))a.add(o.replace(H,"$1").trim());S.dispatch({type:"SET_TAGS",payload:{tags:Array.from(a)}})}clearMemos(){S.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(e){const{data:a}=await ht(e);return a}async updateMemo(e,a){const{data:s}=await Nt(e,a);return s}async getLinkedMemos(e){const{data:a}=await Et(e);return a}}const k=new At;class Dt{getState(){return S.getState().queryState}async getMyAllQueries(){if(!I.getState().user)return!1;const{data:e}=await Ct();return S.dispatch({type:"SET_QUERIES",payload:{queries:e}}),e}getQueryById(e){for(const a of this.getState().queries)if(a.id===e)return a}pushQuery(e){S.dispatch({type:"INSERT_QUERY",payload:{query:E({},e)}})}editQuery(e){S.dispatch({type:"UPDATE_QUERY",payload:e})}async deleteQuery(e){await St(e),S.dispatch({type:"DELETE_QUERY_BY_ID",payload:{id:e}})}async createQuery(e,a){const{data:s}=await xt(e,a);return s}async updateQuery(e,a,s){const{data:r}=await vt(e,a,s);return r}async pinQuery(e){await bt(e)}async unpinQuery(e){await wt(e)}}const O=new Dt;function K(t=!1){const[e,a]=l.exports.useState(t),s=l.exports.useCallback(r=>{a(r!==void 0?r:o=>!o)},[]);return[e,s]}const kt=t=>{const{children:e,className:a,clickSpaceDestroy:s,destroy:r}=t,o=()=>{s&&r()};return n("div",{className:`dialog-wrapper ${a}`,onClick:o,children:n("div",{className:"dialog-container",onClick:i=>i.stopPropagation(),children:e})})};function Y(t,e,a){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var p;(p=s.firstElementChild)==null||p.classList.add("showup")},0);const r={destroy:()=>{var p,m;(p=s.firstElementChild)==null||p.classList.remove("showup"),(m=s.firstElementChild)==null||m.classList.add("showoff"),setTimeout(()=>{s.remove(),X.unmountComponentAtNode(s)},be)}},o=C(E({},a),{destroy:r.destroy});let i=n(kt,C(E({destroy:r.destroy,clickSpaceDestroy:!0},t),{children:n(e,E({},o))}));return t.useAppContext&&(i=n(Ce,{store:S,context:B,children:i})),X.render(i,s),r}const Tt=({destroy:t})=>c(T,{children:[c("div",{className:"dialog-header-container",children:[c("p",{className:"title-text",children:[n("span",{className:"icon-text",children:"\u{1F920}"}),"\u5173\u4E8E ",n("b",{children:"Memos"})]}),n("button",{className:"text-btn close-btn",onClick:()=>{t()},children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]}),c("div",{className:"dialog-content-container",children:[n("p",{children:"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"}),n("br",{}),n("i",{children:"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"}),c("ul",{children:[c("li",{children:["\u5B9E\u8DF5 ",n("strong",{children:"\u5362\u66FC\u5361\u7247\u76D2\u7B14\u8BB0\u6CD5"}),"\uFF1B"]}),n("li",{children:"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5} \u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1} \u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5} \u8BFB\u540E\u611F..."}),n("li",{children:"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"}),n("li",{children:"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B"})]}),n("br",{}),n("i",{children:"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"}),c("ul",{children:[c("li",{children:["\u2728"," ",n("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer",children:"\u5F00\u6E90\u9879\u76EE"})]}),n("li",{children:"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"}),n("li",{children:"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B"})]}),n("br",{}),n("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web/discussions",rel:"noreferrer",children:"\u{1F914} \u95EE\u9898\u53CD\u9988"}),n("br",{}),n("p",{children:"Enjoy it and have fun~ "}),n("hr",{}),c("p",{className:"normal-text",children:["Last updated on ",n("span",{className:"pre-text",children:"2021/11/3 8:15:39"})," \u{1F389}"]})]})]});function we(){Y({className:"about-site-dialog"},Tt)}const Bt=t=>{const{shownStatus:e,toggleShownStatus:a}=t;l.exports.useEffect(()=>{const m=()=>{a(!1)};return window.addEventListener("click",m),()=>{window.removeEventListener("click",m)}},[]);const s=m=>{m.stopPropagation(),a(!1)},r=()=>{M.pushHistory("/setting")},o=()=>{M.pushHistory("/recycle")},i=()=>{we()},p=async()=>{await I.doSignOut(),M.replaceHistory("/signin")};return c("div",{className:`menu-btns-popup ${e?"":"hidden"}`,onClick:s,children:[c("button",{className:"text-btn action-btn",onClick:r,children:[n("span",{className:"icon",children:"\u{1F464}"})," \u8D26\u53F7\u4E0E\u8BBE\u7F6E"]}),c("button",{className:"text-btn action-btn",onClick:o,children:[n("span",{className:"icon",children:"\u{1F5D1}\uFE0F"})," \u56DE\u6536\u7AD9"]}),c("button",{className:"text-btn action-btn",onClick:i,children:[n("span",{className:"icon",children:"\u{1F920}"})," \u5173\u4E8E"]}),c("button",{className:"text-btn action-btn",onClick:p,children:[n("span",{className:"icon",children:"\u{1F44B}"})," \u9000\u51FA"]})]})};function z(t=!0){const[e,a]=l.exports.useState({isLoading:t,isFailed:!1,isSucceed:!1});return C(E({},e),{setLoading:()=>{a(C(E({},e),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{a(C(E({},e),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{a(C(E({},e),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const It=({destroy:t,imgUrl:e})=>{const a=l.exports.useRef(null),[s,r]=l.exports.useState(-1);l.exports.useEffect(()=>{Je(e).then(({width:m})=>{r(m!==0?80:0)})},[]);const o=()=>{t()},i=()=>{s>30&&r(s-10)},p=()=>{r(s+10)};return c(T,{children:[n("button",{className:"text-btn close-btn",onClick:o,children:n("img",{className:"icon-img",src:"/icons/close.svg"})}),c("div",{className:"img-container",children:[n("img",{className:s<=0?"hidden":"",ref:a,width:s+"%",src:e}),n("span",{className:"loading-text "+(s===-1?"":"hidden"),children:"\u56FE\u7247\u52A0\u8F7D\u4E2D..."}),n("span",{className:"loading-text "+(s===0?"":"hidden"),children:"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5"})]}),c("div",{className:"action-btns-container",children:[n("button",{className:"text-btn",onClick:i,children:"\u2796"}),n("button",{className:"text-btn",onClick:p,children:"\u2795"}),n("button",{className:"text-btn",onClick:()=>r(80),children:"\u2B55"})]})]})};function Fe(t){Y({className:"preview-image-dialog"},It,{imgUrl:t})}const Lt=/```([\s\S]*?)```/g,Ot=/\*\*(.+?)\*\*/g,_t=/\*(.+?)\*/g,Rt=/\[ \] /g,Pt=/\[x\] /g,qt=/[*] /g,$t=/(\d+)\. /g,Qt=t=>t.replace(Lt,"<pre lang=''>$1</pre>").replace(qt,"<span class='counter-block'>\u2022</span>").replace($t,"<span class='counter-block'>$1.</span>").replace(Rt,"<span class='todo-block' data-type='todo'>\u2B1C</span>").replace(Pt,"<span class='todo-block' data-type='done'>\u2705</span>").replace(Ot,"<strong>$1</strong>").replace(_t,"<em>$1</em>"),ue=t=>{const e=document.createElement("div");e.className="memo-content-text",e.innerHTML=t,document.body.appendChild(e);const a=e.innerText;return e.remove(),a},Ut=t=>t.replace(/\n/g,"<br>"),Ht=t=>{const{children:e,when:a}=t;return a?n(T,{children:e}):null},q=Ht;const de=t=>{const{className:e,imgUrl:a}=t,s=()=>{Fe(a)};return n("div",{className:"image-container "+e,onClick:s,children:n("img",{src:a,decoding:"async",loading:"lazy"})})};const Gt=t=>{const{destory:e,duration:a}=t;return l.exports.useEffect(()=>{a>0&&setTimeout(()=>{e()},a)},[]),n("div",{className:"toast-container",onClick:e,children:n("p",{className:"content-text",children:t.content})})};class Yt{constructor(){D(this,"shownToastAmount",0);D(this,"toastWrapper");D(this,"shownToastContainers",[]);D(this,"info",(e,a=3e3)=>this.showToast({type:"normal",content:e,duration:a}));D(this,"success",(e,a=3e3)=>this.showToast({type:"success",content:e,duration:a}));D(this,"error",(e,a=3e3)=>this.showToast({type:"error",content:e,duration:a}));D(this,"showToast",e=>{const a=document.createElement("div");a.className=`toast-wrapper ${e.type}`,this.toastWrapper.appendChild(a),this.shownToastAmount++,this.shownToastContainers.push(a),setTimeout(()=>{a.classList.add("showup")},0);const s={destory:()=>{a.classList.add("destory"),setTimeout(()=>{if(!!a.parentElement&&(this.shownToastAmount--,this.shownToastAmount===0)){for(const r of this.shownToastContainers)X.unmountComponentAtNode(r),r.remove();this.shownToastContainers.splice(0,this.shownToastContainers.length)}},Ft)}};return X.render(n(Gt,C(E({},e),{destory:s.destory})),a),s});const e="toast-list-container",a=document.createElement("div");a.className=e,document.body.appendChild(a),this.toastWrapper=a}}var w=new Yt;const Vt=t=>{var h;const[e,a]=l.exports.useState(C(E({},t.memo),{createdAtStr:R(t.memo.createdAt)})),[s,r]=l.exports.useState([]),[o,i]=l.exports.useState([]),p=Array.from((h=e.content.match(U))!=null?h:[]),m=l.exports.useRef(null);l.exports.useEffect(()=>{if(m.current){const u=G(e.content);m.current.innerHTML="",m.current.append(...u.children)}},[]),l.exports.useEffect(()=>{(async()=>{try{const d=[],g=[...e.content.matchAll(ee)];for(const x of g)if(x&&x.length===3){const A=x[2],b=k.getMemoById(A);b&&d.push(C(E({},b),{createdAtStr:R(b.createdAt),dateStr:V(b.createdAt)}))}r([...d]);const v=await k.getLinkedMemos(e.id);i(v.sort((x,A)=>F(A.createdAt)-F(x.createdAt)).map(x=>C(E({},x),{createdAtStr:R(x.createdAt),dateStr:V(x.createdAt)})))}catch(d){}})()},[e.id]);const y=l.exports.useCallback(async u=>{var g;const d=u.target;if(d.className==="memo-link-text"){const v=(g=d.dataset)==null?void 0:g.value,x=k.getMemoById(v!=null?v:"");if(x){const A=C(E({},x),{createdAtStr:R(x.createdAt)});r([]),i([]),a(A)}else w.error("MEMO Not Found"),d.classList.remove("memo-link-text")}},[]),N=l.exports.useCallback(u=>{r([]),i([]),a(u)},[]),f=l.exports.useCallback(()=>{t.destroy(),L.setEditMemoId(e.id)},[e.id]);return c(T,{children:[c("div",{className:"memo-card-container",children:[c("div",{className:"header-container",children:[n("p",{className:"time-text",children:e.createdAtStr}),c("div",{className:"btns-container",children:[n("button",{className:"text-btn edit-btn",onClick:f,children:n("img",{className:"icon-img",src:"/icons/edit.svg"})}),n("button",{className:"text-btn close-btn",onClick:t.destroy,children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]})]}),c("div",{className:"memo-container",children:[n("div",{className:"memo-content-text",ref:m,onClick:y}),n(q,{when:p.length>0,children:n("div",{className:"images-wrapper",children:p.map((u,d)=>n(de,{className:"memo-img",imgUrl:u},d))})})]}),n("div",{className:"layer-container"}),s.map((u,d)=>d<4?n("div",{className:"background-layer-container",style:{bottom:(d+1)*-3+"px",left:(d+1)*5+"px",width:`calc(100% - ${(d+1)*10}px)`,zIndex:-d-1}},d):null)]}),s.length>0?c("div",{className:"linked-memos-wrapper",children:[c("p",{className:"normal-text",children:["\u5173\u8054\u4E86 ",s.length," \u4E2A MEMO"]}),s.map(u=>{const d=ue(G(u.content).innerHTML).replaceAll(`
`," ");return c("div",{className:"linked-memo-container",onClick:()=>N(u),children:[c("span",{className:"time-text",children:[u.dateStr," "]}),d]},u.id)})]}):null,o.length>0?c("div",{className:"linked-memos-wrapper",children:[c("p",{className:"normal-text",children:[o.length," \u4E2A\u94FE\u63A5\u81F3\u6B64\u7684 MEMO"]}),o.map(u=>{const d=ue(G(u.content).innerHTML).replaceAll(`
`," ");return c("div",{className:"linked-memo-container",onClick:()=>N(u),children:[c("span",{className:"time-text",children:[u.dateStr," "]}),d]},u.id)})]}):null]})};function Me(t){Y({className:"memo-card-dialog"},Vt,{memo:t})}const jt=t=>{var d;const{memo:e,destroy:a}=t,[s,r]=l.exports.useState(""),o=l.exports.useRef(null),{user:i}=I.getState(),p=C(E({},e),{createdAtStr:R(e.createdAt)}),m=Array.from((d=p.content.match(U))!=null?d:[]),[y,N]=l.exports.useState(m.length),f=l.exports.useRef(null);l.exports.useEffect(()=>{if(f.current){const g=G(p.content);f.current.innerHTML="",f.current.append(...g.children)}},[]),l.exports.useEffect(()=>{setTimeout(()=>{if(!!o.current&&y===0){const g=xe();(g==="MacOS"||g==="Unknown")&&window.scrollTo(0,0),html2canvas(o.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(v=>{r(v.toDataURL())})}},be+100)},[y]);const h=()=>{a()},u=g=>{g.type==="error"&&(w.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),g.target.remove()),N(y-1)};return c(T,{children:[c("div",{className:"dialog-header-container",children:[c("p",{className:"title-text",children:[n("span",{className:"icon-text",children:"\u{1F970}"}),"\u5206\u4EAB Memo \u56FE\u7247"]}),n("button",{className:"text-btn close-btn",onClick:h,children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]}),c("div",{className:"dialog-content-container",children:[n("div",{className:`tip-words-container ${s?"finished":"genarating"}`,children:n("p",{className:"tip-text",children:s?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D..."})}),n("img",{className:"memo-img",src:s}),c("div",{className:"memo-container",ref:o,children:[n("span",{className:"time-text",children:p.createdAtStr}),n("div",{className:"memo-content-text",ref:f}),n(q,{when:m.length>0,children:n("div",{className:"images-container",children:m.map((g,v)=>n("img",{crossOrigin:"anonymous",src:g,onLoad:u,onError:u,decoding:"async"},v))})}),n("div",{className:"watermark-container",children:c("span",{className:"normal-text",children:["by ",n("span",{className:"name-text",children:i==null?void 0:i.username})]})})]})]})]})};function Wt(t){Y({className:"share-memo-image-dialog"},jt,{memo:t})}const Kt=t=>{var d;const{memo:e}=t,a=C(E({},e),{createdAtStr:R(e.createdAt)}),[s,r]=K(!1),o=Array.from((d=a.content.match(U))!=null?d:[]),i=l.exports.useRef(null);l.exports.useEffect(()=>{if(i.current){const g=G(a.content);i.current.innerHTML="",i.current.append(...g.children)}},[]);const p=()=>{Me(a)},m=()=>{L.setMarkMemoId(a.id)},y=()=>{L.setEditMemoId(a.id)},N=async()=>{if(s){try{await k.hideMemoById(a.id)}catch(g){w.error(g.message)}L.getState().editMemoId===a.id&&L.setEditMemoId("")}else r()},f=()=>{s&&r(!1)},h=()=>{Wt(a)},u=async g=>{var x;const v=g.target;if(v.className==="memo-link-text"){const A=(x=v.dataset)==null?void 0:x.value,b=k.getMemoById(A!=null?A:"");b?Me(b):(w.error("MEMO Not Found"),v.classList.remove("memo-link-text"))}else v.className==="todo-block"};return c("div",{className:`memo-wrapper ${"memos-"+a.id}`,onMouseLeave:f,children:[c("div",{className:"memo-top-wrapper",children:[n("span",{className:"time-text",onClick:p,children:a.createdAtStr}),c("div",{className:"btns-container",children:[n("span",{className:"text-btn more-action-btn",children:n("img",{className:"icon-img",src:"/icons/more.svg"})}),n("div",{className:"more-action-btns-wrapper",children:c("div",{className:"more-action-btns-container",children:[n("span",{className:"text-btn",onClick:p,children:"\u67E5\u770B\u8BE6\u60C5"}),n("span",{className:"text-btn",onClick:m,children:"Mark"}),n("span",{className:"text-btn",onClick:h,children:"\u5206\u4EAB"}),n("span",{className:"text-btn",onClick:y,children:"\u7F16\u8F91"}),n("span",{className:`text-btn delete-btn ${s?"final-confirm":""}`,onClick:N,children:s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]}),n("div",{className:"memo-content-text",ref:i,onClick:u}),n(q,{when:o.length>0,children:n("div",{className:"images-wrapper",children:o.map((g,v)=>n(de,{className:"memo-img",imgUrl:g},v))})})]})};function G(t){t=Ut(t).split("<br>").map(o=>o!==""?`<p>${o}</p>`:"<br>").join("");const{shouldUseMarkdownParser:e,shouldSplitMemoWord:a,shouldHideImageUrl:s}=L.getState();e&&(t=Qt(t)),s&&(t=t.replace(U,"")),a&&(t=t.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)/g,"$1 $2").replace(/([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5])/g,"$1 $2")),t=t.replace(H,"<span class='tag-span'>#$1</span>").replace(ae,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(ee,"<span class='memo-link-text' data-value='$2'>$1</span>");const r=document.createElement("div");return r.innerHTML=t,Se(r),r}var zt=l.exports.memo(Kt);const Xt=t=>{var o;const{memo:e}=t,a=C(E({},e),{createdAtStr:R(e.createdAt),timeStr:Ke(e.createdAt)}),s=Array.from((o=a.content.match(U))!=null?o:[]),r=l.exports.useRef(null);return l.exports.useEffect(()=>{if(r.current){const i=G(a.content);r.current.innerHTML="",r.current.append(...i.children)}},[]),c("div",{className:"daily-memo-wrapper",children:[n("div",{className:"time-wrapper",children:n("span",{className:"normal-text",children:a.timeStr})}),c("div",{className:"memo-content-container",children:[n("div",{className:"memo-content-text",ref:r}),n(q,{when:s.length>0,children:n("div",{className:"images-container",children:s.map((i,p)=>n("img",{crossOrigin:"anonymous",src:i,decoding:"async"},p))})})]})]})};const Jt=t=>{const{className:e,datestamp:a,handleDateStampChange:s}=t,[r,o]=l.exports.useState(me(a));l.exports.useEffect(()=>{o(me(a))},[a]);const i=new Date(r),p=i.getDay()===0?7:i.getDay(),m=[];for(let h=1;h<p;h++)m.push({date:0,datestamp:i.getTime()-Q*(7-h)});const y=Zt(r);for(let h=1;h<=y;h++)m.push({date:h,datestamp:i.getTime()+Q*(h-1)});const N=h=>{s(h)},f=h=>{const u=i.getFullYear(),d=i.getMonth()+1;let g=0;d===1&&h===-1?g=new Date(`${u-1}/12/1`).getTime():d===12&&h===1?g=new Date(`${u+1}/1/1`).getTime():g=new Date(`${u}/${d+h}/1`).getTime(),o(me(g))};return c("div",{className:`date-picker-wrapper ${e}`,children:[c("div",{className:"date-picker-header",children:[n("span",{className:"btn-text",onClick:()=>f(-1),children:n("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),c("span",{className:"normal-text",children:[i.getFullYear()," \u5E74 ",i.getMonth()+1," \u6708"]}),n("span",{className:"btn-text",onClick:()=>f(1),children:n("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),c("div",{className:"date-picker-day-container",children:[c("div",{className:"date-picker-day-header",children:[n("span",{className:"day-item",children:"\u5468\u4E00"}),n("span",{className:"day-item",children:"\u5468\u4E8C"}),n("span",{className:"day-item",children:"\u5468\u4E09"}),n("span",{className:"day-item",children:"\u5468\u56DB"}),n("span",{className:"day-item",children:"\u5468\u4E94"}),n("span",{className:"day-item",children:"\u5468\u516D"}),n("span",{className:"day-item",children:"\u5468\u65E5"})]}),m.map(h=>h.date===0?n("span",{className:"day-item null",children:""},h.datestamp):n("span",{className:`day-item ${h.datestamp===a?"current":""}`,onClick:()=>N(h.datestamp),children:h.date},h.datestamp))]})]})};function Zt(t){const e=new Date(t),a=new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`);return((a.getMonth()===11?new Date(`${a.getFullYear()+1}/1`):new Date(`${a.getFullYear()}/${a.getMonth()+2}/1`)).getTime()-a.getTime())/Q}function me(t){const e=new Date(t);return new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`).getTime()}const en=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],tn=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],nn=t=>{const e=z(),[a,s]=l.exports.useState([]),[r,o]=l.exports.useState(ie(V(t.currentDateStamp))),[i,p]=K(!1),m=l.exports.useRef(null),y=new Date(r);l.exports.useEffect(()=>{(()=>{const u=k.getState().memos.filter(d=>F(d.createdAt)>=r&&F(d.createdAt)<r+Q).sort((d,g)=>F(d.createdAt)-F(g.createdAt));s(u),e.setFinish()})()},[r]);const N=()=>{p(!1),setTimeout(()=>{if(!m.current)return;const h=xe();(h==="MacOS"||h==="Unknown")&&window.scrollTo(0,0),html2canvas(m.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(u=>{Fe(u.toDataURL())})},0)},f=h=>{o(h),p(!1)};return c(T,{children:[n("div",{className:"dialog-header-container",children:c("div",{className:"btns-wrapper",children:[c("div",{className:"btns-container",children:[n("span",{className:"btn-text",onClick:()=>o(r-Q),children:n("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),n("span",{className:"btn-text",onClick:()=>o(r+Q),children:n("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),c("div",{className:"btns-container",children:[n("span",{className:"btn-text",onClick:N,children:n("img",{className:"icon-img",src:"/icons/share.svg"})}),n("span",{className:"btn-text",onClick:()=>t.destroy(),children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]})]})}),c("div",{className:"dialog-content-container",ref:m,children:[c("div",{className:"date-card-container",onClick:()=>p(),children:[n("div",{className:"year-text",children:y.getFullYear()}),c("div",{className:"date-container",children:[n("div",{className:"month-text",children:en[y.getMonth()]}),n("div",{className:"date-text",children:y.getDate()}),n("div",{className:"day-text",children:tn[y.getDay()]})]})]}),n(Jt,{className:`date-picker ${i?"":"hide"}`,datestamp:r,handleDateStampChange:f}),e.isLoading?n("div",{className:"tip-container",children:n("p",{className:"tip-text",children:"\u52AA\u529B\u52A0\u8F7D\u4E2D..."})}):a.length===0?n("div",{className:"tip-container",children:n("p",{className:"tip-text",children:"\u7A7A\u7A7A\u5982\u4E5F"})}):n("div",{className:"dailymemos-wrapper",children:a.map(h=>n(Xt,{memo:h},`${h.id}-${h.updatedAt}`))})]})]})};function an(t=Date.now()){Y({className:"daily-memo-diary-dialog"},nn,{currentDateStamp:t})}const sn=()=>{const{userState:{user:t},memoState:{memos:e,tags:a}}=l.exports.useContext(B),s=t?t.username:"Memos",r=t?Math.ceil((Date.now()-F(t.createdAt))/1e3/3600/24):0,[o,i]=K(!1),p=l.exports.useCallback(()=>{M.pushHistory("/"),M.clearQuery()},[]);return c("div",{className:"user-banner-container",children:[c("div",{className:"userinfo-header-container",children:[n("p",{className:"username-text",onClick:p,children:s}),n("span",{className:"action-btn menu-popup-btn",onClick:()=>{const y=document.querySelector(".sidebar-wrapper"),N=document.querySelector(".menu-btns-popup");N.style.top=54-y.scrollTop+"px",i()},children:n("img",{src:"/icons/more.svg",className:"icon-img"})}),n(Bt,{shownStatus:o,toggleShownStatus:i})]}),c("div",{className:"status-text-container",children:[c("div",{className:"status-text memos-text",children:[n("span",{className:"amount-text",children:e.length}),n("span",{className:"type-text",children:"MEMO"})]}),c("div",{className:"status-text tags-text",children:[n("span",{className:"amount-text",children:a.length}),n("span",{className:"type-text",children:"TAG"})]}),c("div",{className:"status-text duration-text",onClick:()=>an(),children:[n("span",{className:"amount-text",children:r}),n("span",{className:"type-text",children:"DAY"})]})]})]})},te={TAG:{value:"TAG",text:"\u6807\u7B7E",operators:[{text:"\u5305\u62EC",value:"CONTAIN"},{text:"\u6392\u9664",value:"NOT_CONTAIN"}]},TYPE:{value:"TYPE",text:"\u7C7B\u578B",operators:[{value:"IS",text:"\u662F"},{value:"IS_NOT",text:"\u4E0D\u662F"}],values:[{value:"CONNECTED",text:"\u6709\u5173\u8054"},{value:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{value:"LINKED",text:"\u6709\u8D85\u94FE\u63A5"},{value:"IMAGED",text:"\u6709\u56FE\u7247"}]},TEXT:{value:"TEXT",text:"\u6587\u672C",operators:[{value:"CONTAIN",text:"\u5305\u62EC"},{value:"NOT_CONTAIN",text:"\u6392\u9664"}]}},pe=te.TYPE.values,rn=t=>{for(const e of pe)if(e.value===t)return e.text;return""},on=()=>({type:"TAG",value:{operator:"CONTAIN",value:""},relation:"AND"}),Ae=(t,e)=>{let a=!0;for(const s of e){const{relation:r}=s,o=cn(t,s);r==="OR"?a=a||o:a=a&&o}return a},cn=(t,e)=>{const{type:a,value:{operator:s,value:r}}=e;if(r==="")return!0;let o=!0;if(a==="TAG"){let i=t.content.includes(`# ${r}`);s==="NOT_CONTAIN"&&(i=!i),o=i}else if(a==="TYPE"){let i=!1;(r==="NOT_TAGGED"&&t.content.match(H)===null||r==="LINKED"&&t.content.match(ae)!==null||r==="IMAGED"&&t.content.match(U)!==null||r==="CONNECTED"&&t.content.match(ee)!==null)&&(i=!0),s==="IS_NOT"&&(i=!i),o=i}else if(a==="TEXT"){let i=t.content.includes(r);s==="NOT_CONTAIN"&&(i=!i),o=i}return o};const ln=t=>{const{destroy:e,queryId:a}=t,[s,r]=l.exports.useState(""),[o,i]=l.exports.useState([]),p=z(!1);l.exports.useEffect(()=>{const u=O.getQueryById(a!=null?a:"");if(u){r(u.title);const d=JSON.parse(u.querystring);Array.isArray(d)&&i(d)}},[a]);const m=u=>{const d=u.target.value;r(d)},y=async()=>{if(!s){w.error("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01");return}try{if(a){const u=await O.updateQuery(a,s,JSON.stringify(o));O.editQuery(u)}else{const u=await O.createQuery(s,JSON.stringify(o));O.pushQuery(u)}}catch(u){w.error(u.message)}e()},N=()=>{if(o.length>0&&o[o.length-1].value.value===""){w.info("\u5148\u5B8C\u5584\u4E0A\u4E00\u4E2A\u8FC7\u6EE4\u5668\u5427");return}i([...o,on()])},f=(u,d)=>{const g=[...o];g[u]=d,i(g)},h=u=>{const d=o.filter((g,v)=>v!==u);i(d)};return c(T,{children:[c("div",{className:"dialog-header-container",children:[c("p",{className:"title-text",children:[n("span",{className:"icon-text",children:"\u{1F516}"}),a?"\u7F16\u8F91\u68C0\u7D22":"\u521B\u5EFA\u68C0\u7D22"]}),n("button",{className:"text-btn close-btn",onClick:e,children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]}),c("div",{className:"dialog-content-container",children:[c("div",{className:"form-item-container input-form-container",children:[n("span",{className:"normal-text",children:"\u6807\u9898"}),n("input",{className:"title-input",type:"text",value:s,onChange:m})]}),c("div",{className:"form-item-container filter-form-container",children:[n("span",{className:"normal-text",children:"\u8FC7\u6EE4\u5668"}),c("div",{className:"filters-wrapper",children:[o.map((u,d)=>n(un,{index:d,filter:u,handleFilterChange:f,handleFilterRemove:h},`${d}-${Date.now()}`)),n("div",{className:"create-filter-btn",onClick:N,children:"\u6DFB\u52A0\u7B5B\u9009\u6761\u4EF6"})]})]})]}),c("div",{className:"dialog-footer-container",children:[n("div",{}),n("div",{className:"btns-container",children:n("button",{className:`text-btn save-btn ${p.isLoading?"requesting":""}`,onClick:y,children:"\u4FDD\u5B58"})})]})]})},un=t=>{const{index:e,filter:a,handleFilterChange:s,handleFilterRemove:r}=t,{type:o}=a,[i,p]=l.exports.useState(n(T,{}));l.exports.useEffect(()=>{let u=n(T,{});Object.keys(te).includes(o)&&(u=n("select",{className:"operator-selector",value:a.value.operator,onChange:N,children:te[o].operators.map(g=>n("option",{value:g.value,children:g.text},g.value))}));let d=n(T,{});switch(o){case"TYPE":{d=c("select",{className:"value-selector",value:a.value.value,onChange:f,children:[n("option",{value:""}),te.TYPE.values.map(g=>n("option",{value:g.value,children:g.text},g.value))]});break}case"TAG":{d=c("select",{className:"value-selector",value:a.value.value,onChange:f,children:[n("option",{value:""}),k.getState().tags.map(g=>n("option",{value:g,children:g},g))]});break}case"TEXT":{d=n("input",{className:"value-inputer",value:a.value.value,onChange:f,type:"text",name:"",id:""});break}}p(c(T,{children:[u,d]}))},[o,a]);const m=u=>{const d=u.target.value;["AND","OR"].includes(d)&&s(e,C(E({},a),{relation:d}))},y=u=>{const d=u.target.value;s(e,C(E({},a),{type:d}))},N=u=>{const d=u.target.value;s(e,C(E({},a),{value:C(E({},a.value),{operator:d})}))},f=u=>{const d=u.target.value;s(e,C(E({},a),{value:C(E({},a.value),{value:d})}))},h=()=>{r(e)};return c("div",{className:"memo-filter-input-wrapper",children:[e>0?c("select",{className:"relation-selector",onChange:m,value:t.filter.relation,children:[n("option",{value:"AND",children:"\u4E14"}),n("option",{value:"OR",children:"\u6216"})]}):null,n("select",{className:"type-selector",onChange:y,value:o,children:Object.values(te).map(u=>n("option",{value:u.value,children:u.text},u.value))}),i,n("img",{className:"remove-btn",src:"/icons/close.svg",onClick:h})]})};function he(t){Y({className:"create-query-dialog"},ln,{queryId:t})}const dn=()=>{const{queryState:{queries:t},locationState:{query:{filter:e}}}=l.exports.useContext(B),a=z(),s=t.sort((r,o)=>F(o.createdAt)-F(r.createdAt)).sort((r,o)=>{var i,p;return F((i=o.pinnedAt)!=null?i:0)-F((p=r.pinnedAt)!=null?p:0)});return l.exports.useEffect(()=>{O.getMyAllQueries().catch(()=>{}).finally(()=>{a.setFinish()})},[]),c("div",{className:"queries-wrapper",children:[c("p",{className:"title-text",children:[n("span",{className:"normal-text",children:"\u5FEB\u901F\u68C0\u7D22"}),n("span",{className:"text-btn",onClick:()=>he(),children:"+"})]}),n(q,{when:a.isSucceed&&s.length===0,children:n("div",{className:"create-query-btn-container",children:n("span",{className:"text-btn",onClick:()=>he(),children:"\u521B\u5EFA\u68C0\u7D22"})})}),n("div",{className:"queries-container",children:s.map(r=>n(mn,{query:r,isActive:r.id===e},r.id))})]})},mn=t=>{const{query:e,isActive:a}=t,[s,r]=K(!1),o=()=>{a?M.setMemoFilter(""):M.setMemoFilter(e.id)},i=async N=>{if(N.stopPropagation(),s)try{await O.deleteQuery(e.id)}catch(f){w.error(f.message)}else r()},p=N=>{N.stopPropagation(),he(e.id)},m=async N=>{N.stopPropagation();try{e.pinnedAt?(await O.unpinQuery(e.id),O.editQuery(C(E({},e),{pinnedAt:void 0}))):(await O.pinQuery(e.id),O.editQuery(C(E({},e),{pinnedAt:R(Date.now())})))}catch(f){}},y=N=>{N.stopPropagation(),r(!1)};return n(T,{children:c("div",{className:`query-item-container ${a?"active":""}`,onClick:o,children:[c("div",{className:"query-text-container",children:[n("span",{className:"icon-text",children:"#"}),n("span",{className:"query-text",children:e.title})]}),c("div",{className:"btns-container",children:[n("span",{className:"action-btn toggle-btn",children:n("img",{className:"icon-img",src:`/icons/more${a?"-white":""}.svg`})}),n("div",{className:"action-btns-wrapper",children:c("div",{className:"action-btns-container",children:[n("span",{className:"text-btn",onClick:m,children:e.pinnedAt?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876"}),n("span",{className:"text-btn",onClick:p,children:"\u7F16\u8F91"}),n("span",{className:`text-btn delete-btn ${s?"final-confirm":""}`,onClick:i,onMouseLeave:y,children:s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]})})};const pn=()=>{const{locationState:{query:{tag:t}},memoState:{tags:e,memos:a}}=l.exports.useContext(B),[s,r]=l.exports.useState([]);return l.exports.useEffect(()=>{k.updateTagsState()},[a]),l.exports.useEffect(()=>{const o=Array.from(e).sort(),i={subTags:[]};for(const p of o){const m=p.split("/");let y=i,N="";for(let f=0;f<m.length;f++){const h=m[f];f===0?N+=h:N+="/"+h;let u=null;for(const d of y.subTags)if(d.text===N){u=d;break}u||(u={key:h,text:N,subTags:[]},y.subTags.push(u)),y=u}}r(i.subTags)},[e]),c("div",{className:"tags-wrapper",children:[n("p",{className:"title-text",children:"\u5E38\u7528\u6807\u7B7E"}),c("div",{className:"tags-container",children:[s.map((o,i)=>n(De,{tag:o,tagQuery:t},o.text+"-"+i)),n(q,{when:s.length<5,children:c("p",{className:"tag-tip-container",children:["\u8F93\u5165",n("span",{className:"code-text",children:"# Tag "}),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~"]})})]})]})},De=t=>{const{tag:e,tagQuery:a}=t,s=a===e.text,r=e.subTags.length>0,[o,i]=K(!1),p=()=>{s?M.setTagQuery(""):(Xe(`# ${e.text} `),M.setTagQuery(e.text))},m=y=>{y.stopPropagation(),i()};return c(T,{children:[c("div",{className:`tag-item-container ${s?"active":""}`,onClick:p,children:[c("div",{className:"tag-text-container",children:[n("span",{className:"icon-text",children:"#"}),n("span",{className:"tag-text",children:e.key})]}),n("div",{className:"btns-container",children:r?n("span",{className:`action-btn toggle-btn ${o?"shown":""}`,onClick:m,children:n("img",{className:"icon-img",src:"/icons/arrow-right.svg"})}):null})]}),r?n("div",{className:`subtags-container ${o?"":"hidden"}`,children:e.subTags.map((y,N)=>n(De,{tag:y,tagQuery:a},y.text+"-"+N))}):null]})};const ke={width:12,height:7},Te=(t,e)=>{const a=[];for(let s=1;s<=t;s++)a.push({timestamp:e+Q*s,count:0});return a},hn=()=>{const t=ie(Date.now()),e=new Date(t).getDay()||7,a=new Array(7-e).fill(0),s=(ke.width-1)*ke.height+e,r=t-s*Q,{memoState:{memos:o}}=l.exports.useContext(B),[i,p]=l.exports.useState(Te(s,r)),[m,y]=l.exports.useState(null),[N,f]=l.exports.useState(null),h=l.exports.useRef(null),u=l.exports.useRef(null);l.exports.useEffect(()=>{const x=Te(s,r);for(const A of o){const b=(ie(A.createdAt)-r)/(1e3*3600*24)-1;b>=0&&(x[b].count+=1)}p([...x])},[o]);const d=l.exports.useCallback((x,A)=>{var ye,Ne;if(y(A),!u.current)return;const{isMobileView:b}=L.getState(),$=x.target,re=document.querySelector(".sidebar-wrapper");u.current.style.left=$.offsetLeft-((Ne=(ye=h.current)==null?void 0:ye.offsetLeft)!=null?Ne:0)+"px";let fe=$.offsetTop;b||(fe-=re.scrollTop),u.current.style.top=fe+"px"},[]),g=l.exports.useCallback(()=>{y(null)},[]),v=l.exports.useCallback(x=>{var A;((A=M.getState().query.duration)==null?void 0:A.from)===x.timestamp?(M.setFromAndToQuery(0,0),f(null)):x.count>0&&(M.setFromAndToQuery(x.timestamp,x.timestamp+Q),f(x))},[]);return c("div",{className:"usage-heat-map-wrapper",ref:h,children:[c("div",{className:"day-tip-text-container",children:[n("span",{className:"tip-text",children:"Mon"}),n("span",{className:"tip-text"}),n("span",{className:"tip-text",children:"Wed"}),n("span",{className:"tip-text"}),n("span",{className:"tip-text",children:"Fri"}),n("span",{className:"tip-text"}),n("span",{className:"tip-text",children:"Sun"})]}),c("div",{ref:u,className:"usage-detail-container pop-up "+(m?"":"hidden"),children:[m==null?void 0:m.count," memos on ",n("span",{className:"date-text",children:new Date(m==null?void 0:m.timestamp).toDateString()})]}),c("div",{className:"usage-heat-map",children:[i.map((x,A)=>{const b=x.count,$=b<=0?"":b<=1?"stat-day-L1-bg":b<=2?"stat-day-L2-bg":b<=4?"stat-day-L3-bg":"stat-day-L4-bg";return n("span",{className:`stat-container ${$} ${N===x?"current":""} ${t===x.timestamp?"today":""}`,onMouseEnter:re=>d(re,x),onMouseLeave:g,onClick:()=>v(x)},A)}),a.map((x,A)=>n("span",{className:"stat-container null"},A))]})]})};const gn=()=>{const{locationState:t}=l.exports.useContext(B);l.exports.useEffect(()=>{const a=document.querySelector(J);a==null||a.classList.remove(Z)},[t]);const e=l.exports.useCallback(a=>{if(a.stopPropagation(),a.target.className==="sidebar-wrapper"){const r=document.querySelector(J);r==null||r.classList.remove(Z)}},[]);return c("aside",{className:"sidebar-wrapper",onClick:e,children:[n(sn,{}),n(hn,{}),n(dn,{}),n(pn,{})]})};function fn(){const{locationState:{pathname:t}}=l.exports.useContext(B),e=z();return l.exports.useEffect(()=>{const{user:a}=I.getState();a?e.setFinish():I.doSignIn().catch(()=>{}).finally(()=>{I.getState().user?e.setFinish():M.replaceHistory("/signin")})},[]),n(T,{children:e.isLoading?null:c("section",{id:"page-container",children:[n(gn,{}),n("main",{className:"content-wrapper",children:Rn(t)})]})})}const yn=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function se(t,e){return e.minLength!==void 0&&t.length<e.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:e.maxLength!==void 0&&t.length>e.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:e.noSpace&&t.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:e.noChinese&&yn.test(t)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const Be={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},Nn=()=>{const[t,e]=l.exports.useState(""),[a,s]=l.exports.useState(""),r=l.exports.useRef(null),o=z(!1);l.exports.useEffect(()=>{const N=f=>{var h;f.key==="Enter"&&((h=r.current)==null||h.click())};return document.body.addEventListener("keypress",N),()=>{document.body.removeEventListener("keypress",N)}},[]);const i=N=>{const f=N.target.value;e(f)},p=N=>{const f=N.target.value;s(f)},m=()=>{we()},y=async()=>{if(o.isLoading)return;const N=se(t,Be);if(!N.result){w.error("\u7528\u6237\u540D "+N.reason);return}const f=se(a,Be);if(!f.result){w.error("\u5BC6\u7801 "+f.reason);return}try{o.setLoading();const h=it,{succeed:u,message:d}=await h(t,a);if(!u&&d){w.error("\u{1F61F} "+d);return}await I.doSignIn()?M.replaceHistory("/"):w.error("\u{1F61F} \u767B\u5F55\u5931\u8D25"),o.setFinish()}catch(h){console.error(h),w.error("\u{1F61F} "+h.message)}};return n("div",{className:"page-wrapper signin",children:c("div",{className:"page-container",children:[n("div",{className:"page-header-container",children:c("p",{className:"title-text",children:[n("span",{className:"icon-text",children:"\u{1F44B}"})," \u8D26\u53F7\u6CE8\u518C / \u767B\u5F55"]})}),c("div",{className:"page-content-container",children:[c("div",{className:"form-item-container input-form-container",children:[n("span",{className:"normal-text "+(t===""?"":"not-null"),children:"\u8D26\u53F7"}),n("input",{type:"text",value:t,onChange:i})]}),c("div",{className:"form-item-container input-form-container",children:[n("span",{className:"normal-text "+(a===""?"":"not-null"),children:"\u5BC6\u7801"}),n("input",{type:"password",value:a,onChange:p})]})]}),c("div",{className:"page-footer-container",children:[n("div",{className:"btns-container",children:window.location.origin.includes("justsven.top")?n("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"Sign In with GitHub"}):null}),c("div",{className:"btns-container",children:[n("button",{className:"text-btn signup-btn disabled",onClick:()=>w.info("\u6CE8\u518C\u5DF2\u5173\u95ED"),children:"\u6CE8\u518C"}),n("span",{className:"split-text",children:"/"}),n("button",{className:`text-btn signin-btn ${o.isLoading?"requesting":""}`,ref:r,onClick:y,children:"\u767B\u5F55"})]})]}),c("p",{className:"tip-text",children:["\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\uFF0C\u53EF\u8F93\u5165 ",n("code",{children:"guest, 123456"})," \u8FDB\u884C\u4F53\u9A8C\u3002",n("br",{}),c("span",{className:"text-btn",onClick:m,children:[n("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E\u672C\u7AD9"]})]})]})})},En={"/signin":n(Nn,{}),"*":n(fn,{})};function Cn(){const[t,e]=l.exports.useState(!1);return l.exports.useCallback(()=>{e(s=>!s)},[])}const xn=l.exports.forwardRef((t,e)=>{var x,A;const{className:a,initialContent:s,placeholder:r,showConfirmBtn:o,showCancelBtn:i,showTools:p,onConfirmBtnClick:m,onCancelBtnClick:y,onContentChange:N}=t,f=l.exports.useRef(null),h=Cn();l.exports.useEffect(()=>{s&&(f.current.value=s,h())},[]),l.exports.useEffect(()=>{var b;f.current&&(f.current.style.height="auto",f.current.style.height=((b=f.current.scrollHeight)!=null?b:0)+"px")},[(x=f.current)==null?void 0:x.value]),l.exports.useImperativeHandle(e,()=>({focus:()=>{f.current.focus()},insertText:b=>{const $=f.current.value;f.current.value=$+b,N(f.current.value),h()},setContent:b=>{f.current.value=ue(b),h()},getContent:()=>{var b,$;return($=(b=f.current)==null?void 0:b.value)!=null?$:""}}),[]);const u=l.exports.useCallback(()=>{N(f.current.value),h()},[]),d=l.exports.useCallback(b=>{b.stopPropagation(),b.code==="Enter"&&(b.metaKey||b.ctrlKey)&&g(),h()},[]),g=l.exports.useCallback(()=>{m(f.current.value),f.current.value="",h()},[]),v=l.exports.useCallback(()=>{y()},[]);return c("div",{className:"common-editor-wrapper "+a,children:[n("textarea",{className:"common-editor-inputer",rows:1,placeholder:r,ref:f,onInput:u,onKeyDown:d}),c("div",{className:"common-tools-wrapper",children:[n(q,{when:p,children:n("div",{className:"common-tools-container"})}),c("div",{className:"btns-right-container",children:[n(q,{when:i,children:n("button",{className:"action-btn cancel-btn",onClick:v,children:"\u64A4\u9500\u4FEE\u6539"})}),n(q,{when:o,children:c("button",{className:"action-btn confirm-btn",disabled:!((A=f.current)==null?void 0:A.value),onClick:g,children:["\u8BB0\u4E0B",n("span",{className:"icon-text",children:"\u270D\uFE0F"})]})})]})]})]})});const vn=()=>{const{globalState:t}=l.exports.useContext(B),e=l.exports.useRef(null),a=l.exports.useRef(t);l.exports.useEffect(()=>{var m,y,N,f,h;if(t.markMemoId){const d=`${((m=e.current)==null?void 0:m.getContent())?`
`:""}Mark: [@MEMO](${t.markMemoId})`;(y=e.current)==null||y.insertText(d),L.setMarkMemoId("")}if(t.editMemoId&&t.editMemoId!==a.current.editMemoId){const u=k.getMemoById(t.editMemoId);u&&((f=e.current)==null||f.setContent((N=u.content)!=null?N:""),(h=e.current)==null||h.focus())}a.current=t},[t.markMemoId,t.editMemoId]);const s=l.exports.useCallback(async m=>{var f;if(m===""){w.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}const{editMemoId:y}=L.getState(),{query:N}=M.getState();m=m.replaceAll("&nbsp;"," ");try{if(y){const d=k.getMemoById(y);if(d&&d.content!==m){const g=await k.updateMemo(d.id,m);g.updatedAt=R(Date.now()),k.editMemo(g)}L.setEditMemoId("")}else{const d=await k.createMemo(m);k.pushMemo(d)}const h=ze(Array.from((f=m.match(H))!=null?f:[])).map(d=>d.replace(H,"$1").trim()),u=N.tag;u!==""&&!h.includes(u)&&M.setTagQuery("")}catch(h){w.error(h.message)}ge("")},[]),r=l.exports.useCallback(()=>{var m;L.setEditMemoId(""),(m=e.current)==null||m.setContent(""),ge("")},[]),o=l.exports.useCallback(m=>{const y=document.createElement("div");y.innerHTML=m,y.innerText.trim()===""&&(m=""),ge(m)},[]),{editMemoId:i}=t,p=l.exports.useMemo(()=>({className:"memo-editor",initialContent:Sn(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,showCancelBtn:i!=="",showTools:!0,onConfirmBtnClick:s,onCancelBtnClick:r,onContentChange:o}),[i]);return c("div",{className:"memo-editor-wrapper "+(i?"edit-ing":""),children:[n("p",{className:"tip-text "+(i?"":"hidden"),children:"\u6B63\u5728\u4FEE\u6539\u4E2D..."}),n(xn,E({ref:e},p))]})};function Sn(){var t;return(t=j.get(["editorContentCache"]).editorContentCache)!=null?t:""}function ge(t){j.set({editorContentCache:t})}const bn=()=>{const{locationState:{query:{type:t}}}=l.exports.useContext(B),e=s=>{const{type:r}=M.getState().query;s===r&&(s=""),M.setMemoTypeQuery(s)};return c("div",{className:"search-bar-container",children:[c("div",{className:"search-bar-inputer",children:[n("img",{className:"icon-img",src:"/icons/search.svg"}),n("input",{className:"text-input",type:"text",placeholder:"",onChange:s=>{const r=s.currentTarget.value;M.setTextQuery(r)}})]}),n("div",{className:"quickly-action-wrapper",children:c("div",{className:"quickly-action-container",children:[n("p",{className:"title-text",children:"QUICKLY FILTER"}),c("div",{className:"section-container types-container",children:[n("span",{className:"section-text",children:"\u7C7B\u578B:"}),n("div",{className:"values-container",children:pe.map((s,r)=>c("div",{children:[n("span",{className:`type-item ${t===s.value?"selected":""}`,onClick:()=>{e(s.value)},children:s.text}),r+1<pe.length?n("span",{className:"split-text",children:"/"}):null]},s.value))})]})]})})]})};const wn=()=>{const{locationState:{query:{filter:t}},queryState:{queries:e}}=l.exports.useContext(B),[a,s]=l.exports.useState("MEMOS");l.exports.useEffect(()=>{const i=O.getQueryById(t);s(i?i.title:"MEMOS")},[t,e]);const r=l.exports.useCallback(()=>{M.clearQuery()},[]),o=l.exports.useCallback(i=>{i.stopPropagation();const p=document.querySelector(J);p&&p.classList.add(Z)},[]);return c("div",{className:"section-header-container memos-header-container",children:[c("div",{className:"title-text",onClick:r,children:[n("button",{className:"action-btn",onClick:o,children:n("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})}),n("span",{className:"normal-text",children:a})]}),n(bn,{})]})};const Ie=()=>{const{locationState:{query:t}}=l.exports.useContext(B),{tag:e,duration:a,type:s,text:r,filter:o}=t,i=O.getQueryById(o),p=Boolean(e||a&&a.from<a.to||s||r||i);return c("div",{className:`filter-query-container ${p?"":"hidden"}`,children:[n("span",{className:"tip-text",children:"\u7B5B\u9009\uFF1A"}),c("div",{className:"filter-item-container "+(i?"":"hidden"),onClick:()=>{M.setMemoFilter("")},children:[n("span",{className:"icon-text",children:"\u{1F516}"})," ",i==null?void 0:i.title]}),c("div",{className:"filter-item-container "+(e?"":"hidden"),onClick:()=>{M.setTagQuery("")},children:[n("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"})," ",e]}),c("div",{className:"filter-item-container "+(s?"":"hidden"),onClick:()=>{M.setMemoTypeQuery("")},children:[n("span",{className:"icon-text",children:"\u{1F4E6}"})," ",rn(s)]}),a&&a.from<a.to?c("div",{className:"filter-item-container",onClick:()=>{M.setFromAndToQuery(0,0)},children:[n("span",{className:"icon-text",children:"\u{1F5D3}\uFE0F"})," ",V(a.from)," \u81F3 ",V(a.to)]}):null,c("div",{className:"filter-item-container "+(r?"":"hidden"),onClick:()=>{M.setTextQuery("")},children:[n("span",{className:"icon-text",children:"\u{1F50D}"})," ",r]})]})};const Fn=()=>{const{locationState:{query:t},memoState:{memos:e}}=l.exports.useContext(B),[a,s]=l.exports.useState(!0),[r,o]=l.exports.useState(!1),i=l.exports.useRef(null),{tag:p,duration:m,type:y,text:N,filter:f}=t,h=Boolean(p||m&&m.from<m.to||y||N),u=h||f?e.filter(g=>{let v=!0;const x=O.getQueryById(f);if(x){const A=JSON.parse(x.querystring);Array.isArray(A)&&(v=Ae(g,A))}return p&&!g.content.includes(`# ${p}`)&&(v=!1),m&&m.from<m.to&&(F(g.createdAt)<m.from||F(g.createdAt)>m.to)&&(v=!1),y&&(y==="NOT_TAGGED"&&g.content.match(H)!==null||y==="LINKED"&&g.content.match(ae)===null||y==="IMAGED"&&g.content.match(U)===null||y==="CONNECTED"&&g.content.match(ee)===null)&&(v=!1),N&&!g.content.includes(N)&&(v=!1),v}):e;l.exports.useEffect(()=>{var g;(g=i.current)==null||g.scrollTo({top:0}),k.fetchAllMemos().then(v=>{v!==!1&&(o(!0),s(!1))})},[]);const d=l.exports.useCallback(g=>{const v=g.target;if(v.tagName==="SPAN"&&v.className==="tag-span"){const x=v.innerText.slice(1);M.getState().query.tag===x?M.setTagQuery(""):M.setTagQuery(x)}},[]);return c("div",{className:`memolist-wrapper ${r?"completed":""}`,onClick:d,ref:i,children:[u.map(g=>n(zt,{memo:g},`${g.id}-${g.updatedAt}`)),h?n("div",{className:"status-text-container",children:n("p",{className:"status-text",children:a?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":r&&u.length===0?"\u7A7A\u7A7A\u5982\u4E5F":""})}):n("div",{className:`status-text-container ${r?"completed":""} ${a||r?"":"invisible"}`,children:n("p",{className:"status-text",children:r?"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}":"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})})]})};function Mn(){return c(T,{children:[n(wn,{}),n(vn,{}),n(Ie,{}),n(Fn,{})]})}const An=t=>{var f,h;const{memo:e,handleDeletedMemoAction:a}=t,s=C(E({},e),{createdAtStr:R(e.createdAt),deletedAtStr:R((f=e.deletedAt)!=null?f:Date.now())}),[r,o]=K(!1),i=Array.from((h=s.content.match(U))!=null?h:[]),p=l.exports.useRef(null);l.exports.useEffect(()=>{if(p.current){const u=G(s.content);p.current.innerHTML="",p.current.append(...u.children)}},[]);const m=async()=>{if(r)try{await k.deleteMemoById(s.id),a(s.id)}catch(u){w.error(u.message)}else o()},y=async()=>{try{await k.restoreMemoById(s.id),a(s.id),w.info("\u6062\u590D\u6210\u529F")}catch(u){w.error(u.message)}},N=()=>{r&&o(!1)};return c("div",{className:`memo-wrapper ${"memos-"+s.id}`,onMouseLeave:N,children:[c("div",{className:"memo-top-wrapper",children:[c("span",{className:"time-text",children:["\u5220\u9664\u4E8E ",s.deletedAtStr]}),c("div",{className:"btns-container",children:[n("span",{className:"text-btn more-action-btn",children:n("img",{className:"icon-img",src:"/icons/more.svg"})}),n("div",{className:"more-action-btns-wrapper",children:c("div",{className:"more-action-btns-container",children:[n("span",{className:"text-btn restore-btn",onClick:y,children:"\u6062\u590D"}),n("span",{className:`text-btn delete-btn ${r?"final-confirm":""}`,onClick:m,children:r?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5B8C\u5168\u5220\u9664"})]})})]})]}),n("div",{className:"memo-content-text",ref:p}),n(q,{when:i.length>0,children:n("div",{className:"images-wrapper",children:i.map((u,d)=>n(de,{className:"memo-img",imgUrl:u},d))})})]})};const Dn=()=>{const{locationState:{query:t}}=l.exports.useContext(B),e=z(),[a,s]=l.exports.useState([]),{tag:r,duration:o,type:i,text:p,filter:m}=t,y=O.getQueryById(m),f=Boolean(r||o&&o.from<o.to||i||p||y)||y?a.filter(d=>{let g=!0;if(y){const v=JSON.parse(y.querystring);Array.isArray(v)&&(g=Ae(d,v))}return r&&!d.content.includes(`# ${r}`)&&(g=!1),o&&o.from<o.to&&(F(d.createdAt)<o.from||F(d.createdAt)>o.to)&&(g=!1),i&&(i==="NOT_TAGGED"&&d.content.match(H)!==null||i==="LINKED"&&d.content.match(ae)===null||i==="IMAGED"&&d.content.match(U)===null||i==="CONNECTED"&&d.content.match(ee)===null)&&(g=!1),p&&!d.content.includes(p)&&(g=!1),g}):a;l.exports.useEffect(()=>{k.fetchAllMemos(),k.fetchDeletedMemos().then(d=>{d!==!1&&s(d),e.setFinish()}),M.clearQuery()},[]);const h=l.exports.useCallback(d=>{s(a.filter(g=>g.id!==d))},[a]),u=l.exports.useCallback(d=>{d.stopPropagation();const g=document.querySelector(J);g&&g.classList.add(Z)},[]);return c("div",{className:"memo-trash-wrapper",children:[n("div",{className:"section-header-container",children:c("div",{className:"title-text",children:[n("button",{className:"action-btn",onClick:u,children:n("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})}),n("span",{className:"normal-text",children:"\u56DE\u6536\u7AD9"})]})}),n(Ie,{}),e.isLoading?n("div",{className:"tip-text-container",children:n("p",{className:"tip-text",children:"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})}):a.length===0?n("div",{className:"tip-text-container",children:n("p",{className:"tip-text",children:"Here is No Zettels."})}):n("div",{className:"deleted-memos-container",children:f.map(d=>n(An,{memo:d,handleDeletedMemoAction:h},`${d.id}-${d.updatedAt}`))})]})};const Le={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},kn=()=>{const{userState:t}=l.exports.useContext(B),e=t.user,[a,s]=l.exports.useState(e.username),[r,o]=l.exports.useState(!1),[i,p]=l.exports.useState(!1),m=u=>{const d=u.target.value;s(d)},y=async()=>{if(e.username==="guest"){w.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(a===e.username){o(!1);return}const u=se(a,Le);if(!u.result){w.error("\u7528\u6237\u540D "+u.reason);return}try{if(!await I.checkUsernameUsable(a)){w.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await I.updateUsername(a),await I.doSignIn(),o(!1),w.info("\u4FEE\u6539\u6210\u529F~")}catch(d){w.error(d.message)}},N=()=>{if(e.username==="guest"){w.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}Bn()},f=async()=>{if(i){try{await I.removeGithubName(),await I.doSignIn()}catch(u){w.error(u.message)}p(!1)}else p(!0)},h=u=>{u.preventDefault()};return c(T,{children:[c("div",{className:"section-container account-section-container",children:[n("p",{className:"title-text",children:"\u57FA\u672C\u4FE1\u606F"}),c("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text",children:"ID\uFF1A"}),n("span",{className:"normal-text",children:e.id})]}),c("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text",children:"\u521B\u5EFA\u65F6\u95F4\uFF1A"}),n("span",{className:"normal-text",children:V(e.createdAt)})]}),c("label",{className:"form-label input-form-label username-label",children:[n("span",{className:"normal-text",children:"\u8D26\u53F7\uFF1A"}),n("input",{type:"text",readOnly:!r,value:a,onClick:()=>{o(!0)},onChange:m}),c("div",{className:"btns-container",onClick:h,children:[n("span",{className:"text-btn confirm-btn "+(r?"":"hidden"),onClick:y,children:"\u4FDD\u5B58"}),n("span",{className:"text-btn cancel-btn "+(r?"":"hidden"),onClick:()=>{s(e.username),o(!1)},children:"\u64A4\u9500"})]})]}),c("label",{className:"form-label password-label",children:[n("span",{className:"normal-text",children:"\u5BC6\u7801\uFF1A"}),n("span",{className:"text-btn",onClick:N,children:"\u4FEE\u6539\u5BC6\u7801"})]})]}),window.location.origin.includes("justsven.top")&&c("div",{className:"section-container connect-section-container",children:[n("p",{className:"title-text",children:"\u5173\u8054\u8D26\u53F7"}),c("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text",children:"GitHub\uFF1A"}),e.githubName?c(T,{children:[n("a",{className:"value-text",href:"https://github.com/"+e.githubName,children:e.githubName}),n("span",{className:`btn-text unbind-btn ${i?"final-confirm":""}`,onMouseLeave:()=>p(!1),onClick:f,children:i?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A"})]}):c(T,{children:[n("span",{className:"value-text",children:"\u65E0"}),n("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"\u524D\u5F80\u7ED1\u5B9A"})]})]})]})]})},Tn=({destroy:t})=>{const[e,a]=l.exports.useState(""),[s,r]=l.exports.useState(""),[o,i]=l.exports.useState("");l.exports.useEffect(()=>{},[]);const p=()=>{t()},m=h=>{const u=h.target.value;a(u)},y=h=>{const u=h.target.value;r(u)},N=h=>{const u=h.target.value;i(u)},f=async()=>{if(e===""||s===""||o===""){w.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==o){w.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),i("");return}const h=se(s,Le);if(!h.result){w.error("\u5BC6\u7801 "+h.reason);return}try{if(!await I.checkPasswordValid(e)){w.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),a("");return}await I.updatePassword(s),w.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),p()}catch(u){w.error(u)}};return c(T,{children:[c("div",{className:"dialog-header-container",children:[n("p",{className:"title-text",children:"\u4FEE\u6539\u5BC6\u7801"}),n("button",{className:"text-btn close-btn",onClick:p,children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]}),c("div",{className:"dialog-content-container",children:[c("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text "+(e===""?"":"not-null"),children:"\u65E7\u5BC6\u7801"}),n("input",{type:"password",value:e,onChange:m})]}),c("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text "+(s===""?"":"not-null"),children:"\u65B0\u5BC6\u7801"}),n("input",{type:"password",value:s,onChange:y})]}),c("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text "+(o===""?"":"not-null"),children:"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801"}),n("input",{type:"password",value:o,onChange:N})]}),c("div",{className:"btns-container",children:[n("span",{className:"text-btn cancel-btn",onClick:p,children:"\u53D6\u6D88"}),n("span",{className:"text-btn confirm-btn",onClick:f,children:"\u4FDD\u5B58"})]})]})]})};function Bn(){Y({className:"change-password-dialog"},Tn)}const In=()=>{const{globalState:t}=l.exports.useContext(B),{shouldHideImageUrl:e,shouldSplitMemoWord:a,shouldUseMarkdownParser:s}=t,r=l.exports.useRef(null);return l.exports.useEffect(()=>{if(r.current){const y=G(`\u{1F44B} \u4F60\u597D\u5440\uFF5E
\u6211\u662F\u4E00\u4E2Ademo\uFF1A
* \u{1F44F} \u6B22\u8FCE\u4F7F\u7528memos\uFF1B`);r.current.innerHTML="",r.current.append(...y.children)}},[t]),c(T,{children:[c("div",{className:"section-container preferences-section-container",children:[n("p",{className:"title-text",children:"Memo \u663E\u793A\u76F8\u5173"}),n("div",{className:"demo-content-container memo-content-text",ref:r}),c("label",{className:"form-label checkbox-form-label",onClick:()=>{L.setAppSetting({shouldSplitMemoWord:!a})},children:[n("span",{className:"normal-text",children:"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"}),n("img",{className:"icon-img",src:a?"/icons/checkbox-active.svg":"/icons/checkbox.svg"})]}),c("label",{className:"form-label checkbox-form-label",onClick:()=>{L.setAppSetting({shouldUseMarkdownParser:!s})},children:[n("span",{className:"normal-text",children:"\u90E8\u5206 markdown \u683C\u5F0F\u89E3\u6790"}),n("img",{className:"icon-img",src:s?"/icons/checkbox-active.svg":"/icons/checkbox.svg"})]}),c("label",{className:"form-label checkbox-form-label",onClick:()=>{L.setAppSetting({shouldHideImageUrl:!e})},children:[n("span",{className:"normal-text",children:"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"}),n("img",{className:"icon-img",src:e?"/icons/checkbox-active.svg":"/icons/checkbox.svg"})]})]}),c("div",{className:"section-container hidden",children:[n("p",{className:"title-text",children:"\u5176\u4ED6"}),n("div",{className:"btn-container",children:n("button",{className:"btn export-btn",onClick:async()=>{const y=k.getState().memos.map(h=>E({},h)),N=JSON.stringify(y),f=document.createElement("a");f.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(N)),f.setAttribute("download","data.json"),f.style.display="none",document.body.appendChild(f),f.click(),document.body.removeChild(f)},children:"\u5BFC\u51FA\u6570\u636E(JSON)"})})]})]})};const Ln=()=>{l.exports.useContext(B),l.exports.useEffect(()=>{k.fetchAllMemos()},[]);const t=l.exports.useCallback(e=>{e.stopPropagation();const a=document.querySelector(J);a&&a.classList.add(Z)},[]);return c("div",{className:"preference-wrapper",children:[n("div",{className:"section-header-container",children:c("div",{className:"title-text",children:[n("button",{className:"action-btn",onClick:t,children:n("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})}),n("span",{className:"normal-text",children:"\u8D26\u53F7\u4E0E\u8BBE\u7F6E"})]})}),c("div",{className:"sections-wrapper",children:[n(kn,{}),n(In,{})]})]})},On={"/recycle":n(Dn,{}),"/setting":n(Ln,{}),"*":n(Mn,{})},Oe=t=>e=>{for(const a of Object.keys(t))if(a===e)return t[a];return t["*"]},_n=Oe(En),Rn=Oe(On);function Pn(){const{locationState:{pathname:t}}=l.exports.useContext(B);return l.exports.useEffect(()=>{const e=()=>{L.setIsMobileView(document.body.clientWidth<=875)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),n(T,{children:_n(t)})}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(t,e){return Object.prototype.toString.call(t).toLowerCase()==="[object regexp]"?this.replace(t,e):this.replace(new RegExp(t,"g"),e)})})();X.render(n(Qe.StrictMode,{children:n(Ce,{store:S,context:B,children:n(Pn,{})})}),document.getElementById("root"));
