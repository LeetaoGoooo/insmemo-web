var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,c=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,o=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&c(e,a,t[a]);if(n)for(var a of n(t))r.call(t,a)&&c(e,a,t[a]);return e},l=(e,n)=>t(e,a(n));import{r as m,R as i,a as d,b as u}from"./vendor.4c46fcb0.js";const p=e=>{const{children:t,store:a,context:n}=e,[s,r]=m.exports.useState(a.getState());return m.exports.useEffect((()=>{const e=a.subscribe((e=>{r(e)}));return()=>{e()}}),[]),i.createElement(n.Provider,{value:s},t)};const g=function(e,t){const a=[];let n=e;return{dispatch:e=>{const s=t(n,e),r=n;n=s;for(const t of a)t(n,r)},getState:()=>n,subscribe:e=>{let t=!0;return a.push(e),()=>{if(!t)return;const n=a.indexOf(e);a.splice(n,1),t=!1}}}}({globalState:{markMemoId:"",editMemoId:""},locationState:{hash:"",query:{tag:"",from:0,to:0}},memoState:{memos:[]},userState:{user:null}},function(e){const t=Object.keys(e),a={};for(const n of t)"function"==typeof e[n]&&(a[n]=e[n]);return(e={},n)=>{let s=!1;const r={};for(const c of t){const t=e[c],o=a[c](t,n);r[c]=o,s=s||o!==t}return s?r:e}}({globalState:function(e,t){switch(t.type){case"SET_MARK_MEMO_ID":return l(o({},e),{markMemoId:t.payload.markMemoId});case"SET_EDIT_MEMO_ID":return l(o({},e),{editMemoId:t.payload.editMemoId});default:return e}},locationState:function(e,t){switch(t.type){case"SET_TAG_QUERY":return l(o({},e),{query:l(o({},e.query),{tag:t.payload.tag})});case"SET_FROM_TO_QUERY":return l(o({},e),{query:l(o({},e.query),{from:t.payload.from,to:t.payload.to})});case"SET_HASH":return l(o({},e),{hash:t.payload.hash});default:return e}},memoState:function(e,t){switch(t.type){case"PUSH":return{memos:[t.payload.memo,...e.memos].sort(((e,t)=>t.createdAt-e.createdAt))};case"PUSH_MEMOS":return{memos:[...t.payload.memos,...e.memos].sort(((e,t)=>t.createdAt-e.createdAt))};case"DELETE_BY_ID":return{memos:[...e.memos].filter((e=>e.id!==t.payload.id))};case"EDIT_MEMO":return{memos:e.memos.map((e=>e.id===t.payload.id?o(o({},e),t.payload):o({},e)))};default:return e}},userState:function(e,t){switch(t.type){case"SIGN_IN":return{user:t.payload.user};case"SIGN_OUT":return{user:null};default:return e}}})),E=m.exports.createContext(g.getState());var h,f;(f=h||(h={})).get=function(e){const t={};for(const n of e)try{const e=localStorage.getItem(n);if(null!==e){const a=JSON.parse(e);t[n]=a}}catch(a){console.error("Get storage failed in ",n,a)}return t},f.set=function(e){for(const a in e)try{const t=JSON.stringify(e[a]);localStorage.setItem(a,t)}catch(t){console.error("Save storage failed in ",a,t)}},f.emitStorageChangedEvent=function(){var e;const t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t),null==(e=t.contentWindow)||e.localStorage.setItem("t",Date.now().toString()),t.remove()},f.preferences=(()=>{var e,t,a,n,s;const r=f.get(["shouldSplitMemoWord","shouldHideImageUrl","tagTextClickedAction","shouldUseMarkdownParser","showDarkMode"]),c={shouldSplitMemoWord:null==(e=r.shouldSplitMemoWord)||e,shouldHideImageUrl:null==(t=r.shouldHideImageUrl)||t,shouldUseMarkdownParser:null==(a=r.shouldUseMarkdownParser)||a,tagTextClickedAction:null!=(n=r.tagTextClickedAction)?n:"copy",showDarkMode:null!=(s=r.showDarkMode)&&s};return f.set(o({},c)),c})();const N=new class{constructor(){this.getState=()=>g.getState().globalState,this.setEditMemoId=e=>{g.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:e}})},this.setMarkMemoId=e=>{g.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:e}})}}};var x,y;(y=x||(x={})).getNowTimeStamp=function(){return Date.now()},y.getOSVersion=function(){const e=navigator.appVersion;let t="Unknown";return-1!=e.indexOf("Win")?t="Windows":-1!=e.indexOf("Mac")?t="MacOS":-1!=e.indexOf("Linux")&&(t="Linux"),t},y.getTimeStampByDate=function(e){const t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()},y.getDateString=function(e){const t=new Date(e);return`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`},y.getTimeString=function(e){const t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,s=t.getDate(),r=t.getHours(),c=t.getMinutes(),o=t.getSeconds();return`${a}-${n<10?"0"+n:n}-${s<10?"0"+s:s} ${r<10?"0"+r:r}:${c<10?"0"+c:c}:${o<10?"0"+o:o}`},y.getTimeStampString=function(e){const t=new Date(e),a=t.getHours(),n=t.getMinutes();return`${a<10?"0"+a:a}:${n<10?"0"+n:n}`},y.dedupe=function(e){return Array.from(new Set(e))},y.dedupeObjectWithId=function(e){const t=new Set,a=[];for(const n of e)t.has(n.id)||(t.add(n.id),a.push(n));return a},y.debounce=function(e,t){let a=null;return()=>{a?(clearTimeout(a),a=setTimeout(e,t)):a=setTimeout(e,t)}},y.throttle=function(e,t){let a=!0;return()=>{if(!a)return!1;a=!1,setTimeout((()=>{e(),a=!0}),t)}},y.iterObjectToParamsString=function(e){const t=[],a=Object.keys(e),n=Object.values(e);for(let s=0;s<a.length;++s)n[s]&&t.push(`${a[s]}=${n[s]}`);return t.join("&")},y.copyTextToClipboard=async function(e){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(e)}catch(t){console.warn("Copy to clipboard failed.",t)}else if(document.queryCommandSupported&&document.queryCommandSupported("copy")){const a=document.createElement("textarea");a.textContent=e,a.style.position="fixed",a.style.zIndex="-1",document.body.appendChild(a),a.select();try{return document.execCommand("copy")}catch(t){return console.warn("Copy to clipboard failed.",t),!1}finally{document.body.removeChild(a)}}else console.warn("Copy to clipboard failed, methods not supports.")},y.parseHTMLToRawString=function(e){const t=document.createElement("div");return t.innerHTML=e,t.innerText},y.getImageSize=function(e){return new Promise(((t,a)=>{const n=new Image;n.onload=()=>{const{width:e,height:a}=n;t(e>0&&a>0?{width:e,height:a}:{width:0,height:0})},n.onerror=()=>{t({width:0,height:0})},n.className="hidden",n.src=e,document.body.appendChild(n),n.remove()}))};const v=()=>{const e=x.iterObjectToParamsString(g.getState().locationState.query),t=e?"?"+e:"";history.replaceState(null,"","/"+t)};const b=new class{constructor(){this.initLocation=()=>{var e,t,a,n,s;const r=new URLSearchParams(window.location.search);this.setTagQuery(null!=(e=r.get("tag"))?e:""),this.setFromAndToQuery(null!=(a=parseInt(null!=(t=r.get("from"))?t:""))?a:0,null!=(s=parseInt(null!=(n=r.get("to"))?n:""))?s:0)},this.getState=()=>g.getState().locationState,this.clearQuery=()=>{g.dispatch({type:"SET_TAG_QUERY",payload:{tag:""}}),g.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:0,to:0}}),v()},this.setHash=e=>{g.dispatch({type:"SET_HASH",payload:{hash:e}}),v()},this.setTagQuery=e=>{g.dispatch({type:"SET_TAG_QUERY",payload:{tag:e}}),v()},this.setFromAndToQuery=(e,t)=>{g.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:e,to:t}}),v()},this.initLocation()}},w={},S=d.create(w);var k;!function(e){async function t(e){const t=await S.get(e,w);if(!t.data.succeed)throw t.data;return t.data}async function a(e,t){const a=await S.post(e,t,w);if(!a.data.succeed)throw a.data;return a.data}e.get=t,e.post=a,e.getUserInfo=function(){return t("/api/user/me")},e.signin=function(e,t){return a("/api/user/signin",{username:e,password:t})},e.signup=function(e,t){return a("/api/user/signup",{username:e,password:t})},e.signout=function(){return a("/api/user/signout")},e.checkUsernameUsable=function(e){return t("/api/user/checkusername?username="+e)},e.checkPasswordValid=function(e){return a("/api/user/checkpassword",{password:e})},e.updateUserinfo=function(e="",t=""){return a("/api/user/update",{username:e,password:t})},e.getMyMemos=function(e=0,a=20){return t(`/api/memo/all?offset=${e}&amount=${a}`)},e.createMemo=function(e){return a("/api/memo/new",{content:e})},e.getMemoById=function(e){return t("/api/memo/?id="+e)},e.deleteMemo=function(e){return a("/api/memo/delete",{memoId:e})},e.updateMemo=function(e,t){return a("/api/memo/update",{memoId:e,content:t})},e.getMemosCount=function(){return t("/api/memo/count")},e.createTag=function(e){return a("/api/tag/new",{text:e})},e.createMemoTag=function(e,t){return a("/api/tag/link",{memoId:e,tagId:t})},e.removeMemoTag=function(e,t){return a("/api/tag/rmlink",{memoId:e,tagId:t})},e.getTagsByMemoId=function(e){return t("/api/tag/memo?id="+e)},e.getMyTags=function(){return t("/api/tag/all")},e.deleteTagById=function(e){return a("/api/tag/delete",{tagId:e})},e.polishTag=function(e){return a("/api/tag/polish",{tagId:e})},e.getMyDataAmount=function(){return t("/api/user/amount")},e.getUrlContentType=function(e){return t("/api/base/srctype?url="+e)},e.getMemosStat=function(){return t("/api/memo/stat")},e.removeGithubName=function(){return a("/api/user/updategh",{githubName:""})}}(k||(k={}));const M=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,C=/#([^\n</p>]+?)#/g,T=/(https?:\/\/[^\s<\\*>']+)/g,A=/\[@(.+?)\]\((.+?)\)/g;const I=new class{getState(){return g.getState().userState}async doSignIn(){const{data:e}=await k.getUserInfo();return e?g.dispatch({type:"SIGN_IN",payload:{user:e}}):I.doSignOut(),e}async doSignOut(){k.signout().catch((()=>{})),g.dispatch({type:"SIGN_OUT",payload:{user:null}})}async checkUsernameUsable(e){const{data:t}=await k.checkUsernameUsable(e);return t}async updateUsername(e){await k.updateUserinfo(e)}async removeGithubName(){await k.removeGithubName()}async checkPasswordValid(e){const{data:t}=await k.checkPasswordValid(e);return t}async updatePassword(e){await k.updateUserinfo("",e)}};const D=new class{constructor(){this.isFetching=!1}getState(){return g.getState().memoState}async fetchMoreMemos(){if(!I.getState()||this.isFetching)return!1;this.isFetching=!0;const{data:e}=await k.getMyMemos(this.getState().memos.length,20),t=e.map((e=>({id:e.id,content:e.content,tags:e.tags,createdAt:new Date(e.createdAt).getTime(),updatedAt:new Date(e.updatedAt).getTime()})));return t.length>0&&g.dispatch({type:"PUSH_MEMOS",payload:{memos:t}}),this.isFetching=!1,t}async fetchAllMemos(){if(!I.getState()||this.isFetching)return!1;this.isFetching=!0;const{data:{memosAmount:e}}=await k.getMyDataAmount(),{data:t}=await k.getMyMemos(this.getState().memos.length,e),a=t.map((e=>({id:e.id,content:e.content,tags:e.tags,createdAt:new Date(e.createdAt).getTime(),updatedAt:new Date(e.updatedAt).getTime()})));a.length>0&&g.dispatch({type:"PUSH_MEMOS",payload:{memos:a}}),this.isFetching=!1}pushMemo(e){g.dispatch({type:"PUSH",payload:{memo:{id:e.id,content:e.content,tags:e.tags,createdAt:new Date(e.createdAt).getTime(),updatedAt:new Date(e.updatedAt).getTime()}}})}async getMemoById(e){for(const a of this.getState().memos)if(a.id===e)return a;const{data:t}=await k.getMemoById(e);return t}async deleteMemoById(e){await k.deleteMemo(e),g.dispatch({type:"DELETE_BY_ID",payload:{id:e}})}editMemo(e){g.dispatch({type:"EDIT_MEMO",payload:e})}async createMemo(e){const{data:t}=await k.createMemo(e);return t}async updateMemo(e,t){const{data:a}=await k.updateMemo(e,t);return a}async createTag(e){const{data:t}=await k.createTag(e);return t}async removeMemoTag(e,t){await k.removeMemoTag(e,t)}async createMemoTag(e,t){await k.createMemoTag(e,t)}async getMyDataAmount(){const{data:e}=await k.getMyDataAmount();return e}async getMemosStat(){const{data:e}=await k.getMemosStat();return e}async getMyTags(){const{data:e}=await k.getMyTags();return e}async polishTag(e){await k.polishTag(e)}};const L=e=>{const{destory:t,duration:a}=e;return m.exports.useEffect((()=>{a>0&&setTimeout((()=>{t()}),a)}),[]),i.createElement("div",{className:"toast-container",onClick:t},i.createElement("p",{className:"content-text"},e.content))},_=(()=>{const e=document.createElement("div");e.className="toast-list-container",document.body.appendChild(e);let t=0;const a=[],n=n=>{const s=document.createElement("div");s.className=`toast-wrapper ${n.type}`,e.appendChild(s),t++,a.push(s),setTimeout((()=>{s.classList.add("showup")}),0);const r={destory:()=>{s.classList.add("destory"),setTimeout((()=>{if(s.parentElement&&(t--,0===t)){for(const e of a)u.unmountComponentAtNode(e),e.remove();a.splice(0,a.length)}}),400)}};return u.render(i.createElement(L,l(o({},n),{destory:r.destory})),s),r};return{info:(e,t=3e3)=>n({type:"normal",content:e,duration:t}),error:(e,t=3e3)=>n({type:"error",content:e,duration:t})}})();const O=e=>{const{children:t,className:a,clickSpaceDestroy:n,destroy:s}=e;return i.createElement("div",{className:`dialog-wrapper ${a}`,onClick:()=>{n&&s()}},i.createElement("div",{className:"dialog-container",onClick:e=>e.stopPropagation()},t))};function U(e,t,a){const n=document.createElement("div");document.body.append(n),setTimeout((()=>{var e;null==(e=n.firstElementChild)||e.classList.add("showup")}),0);const s=()=>{var e;null==(e=n.firstElementChild)||e.classList.add("showoff"),setTimeout((()=>{u.unmountComponentAtNode(n),n.remove()}),300)};u.render(i.createElement(p,{store:g,context:E},i.createElement(O,o({destroy:s,clickSpaceDestroy:!0},e),i.createElement(t,o({destroy:s},a)))),n)}const F=({destroy:e})=>{var t;const{userState:{user:a}}=m.exports.useContext(E),[n,s]=m.exports.useState(null!=(t=null==a?void 0:a.username)?t:""),[r,c]=m.exports.useState(!1),[o,l]=m.exports.useState(!1);return i.createElement(i.Fragment,null,i.createElement("div",{className:"dialog-header-container"},i.createElement("p",{className:"title-text"},i.createElement("span",{className:"icon-text"},"🤠"),"我的账号"),i.createElement("button",{className:"text-btn close-btn",onClick:()=>{e()}},i.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),i.createElement("div",{className:"dialog-content-container"},i.createElement("div",{className:"section-container account-section-container"},i.createElement("p",{className:"title-text"},"基本信息"),i.createElement("label",{className:"form-label input-form-label"},i.createElement("span",{className:"normal-text"},"ID："),i.createElement("span",{className:"normal-text"},null==a?void 0:a.id)),i.createElement("label",{className:"form-label input-form-label"},i.createElement("span",{className:"normal-text"},"创建时间："),i.createElement("span",{className:"normal-text"},x.getDateString(null==a?void 0:a.createdAt))),i.createElement("label",{className:"form-label input-form-label username-label"},i.createElement("span",{className:"normal-text"},"账号："),i.createElement("input",{type:"text",readOnly:!r,value:n,onClick:()=>{c(!0)},onChange:e=>{const t=e.target.value;s(t)}}),i.createElement("div",{className:"btns-container",onClick:e=>{e.preventDefault()}},i.createElement("span",{className:"text-btn confirm-btn "+(r?"":"hidden"),onClick:async()=>{if("guest"!==(null==a?void 0:a.username))if(n!==(null==a?void 0:a.username))try{if(!(await I.checkUsernameUsable(n)))return void _.error("用户名无法使用");await I.updateUsername(n),await I.doSignIn(),c(!1),_.info("修改成功~")}catch(e){_.error(e.message)}else c(!1);else _.info("🈲 不要修改我的用户名")}},"保存"),i.createElement("span",{className:"text-btn cancel-btn "+(r?"":"hidden"),onClick:()=>{var e;s(null!=(e=null==a?void 0:a.username)?e:""),c(!1)}},"撤销"))),i.createElement("label",{className:"form-label password-label"},i.createElement("span",{className:"normal-text"},"密码："),i.createElement("span",{className:"text-btn",onClick:()=>{"guest"!==(null==a?void 0:a.username)?U({className:"change-password-dialog"},$,{}):_.info("🈲 不要修改我的密码")}},"修改密码"))),i.createElement("div",{className:"section-container account-section-container"},i.createElement("p",{className:"title-text"},"关联账号"),i.createElement("label",{className:"form-label input-form-label"},i.createElement("span",{className:"normal-text"},"GitHub："),(null==a?void 0:a.githubName)?i.createElement(i.Fragment,null,i.createElement("a",{className:"value-text",href:"https://github.com/"+(null==a?void 0:a.githubName)},null==a?void 0:a.githubName),i.createElement("span",{className:"btn-text",onMouseLeave:()=>l(!1),onClick:async()=>{if(o){try{await I.removeGithubName(),await I.doSignIn()}catch(e){_.error(e.message)}l(!1)}else l(!0)}},o?"确定取消绑定！":"取消绑定")):i.createElement(i.Fragment,null,i.createElement("span",{className:"value-text"},"无"),i.createElement("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist"},"前往绑定"))))))},$=({destroy:e})=>{const[t,a]=m.exports.useState(""),[n,s]=m.exports.useState(""),[r,c]=m.exports.useState("");m.exports.useEffect((()=>{}),[]);const o=()=>{e()};return i.createElement(i.Fragment,null,i.createElement("div",{className:"dialog-header-container"},i.createElement("p",{className:"title-text"},"修改密码"),i.createElement("button",{className:"text-btn close-btn",onClick:o},i.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),i.createElement("div",{className:"dialog-content-container"},i.createElement("p",{className:"tip-text"},"如果是 GitHub 登录，则初始密码为用户名"),i.createElement("label",{className:"form-label input-form-label"},i.createElement("input",{type:"password",value:t,onChange:e=>{const t=e.target.value;a(t)}}),i.createElement("span",{className:"normal-text "+(""===t?"":"not-null")},"旧密码")),i.createElement("label",{className:"form-label input-form-label"},i.createElement("input",{type:"password",value:n,onChange:e=>{const t=e.target.value;s(t)}}),i.createElement("span",{className:"normal-text "+(""===n?"":"not-null")},"新密码")),i.createElement("label",{className:"form-label input-form-label"},i.createElement("input",{type:"password",value:r,onChange:e=>{const t=e.target.value;c(t)}}),i.createElement("span",{className:"normal-text "+(""===r?"":"not-null")},"再次输入新密码")),i.createElement("div",{className:"btns-container"},i.createElement("span",{className:"text-btn cancel-btn",onClick:o},"取消"),i.createElement("span",{className:"text-btn confirm-btn",onClick:async()=>{if(""!==t&&""!==n&&""!==r){if(n!==r)return _.error("新密码两次输入不一致"),void c("");try{if(!(await I.checkPasswordValid(t)))return _.error("旧密码不匹配"),void a("");await I.updatePassword(n),_.info("密码修改成功！"),o()}catch(e){_.error(e)}}else _.error("密码不能为空")}},"保存"))))};function H(){U({className:"my-account-dialog"},F,{})}const P=({destroy:e})=>i.createElement(i.Fragment,null,i.createElement("div",{className:"dialog-header-container"},i.createElement("p",{className:"title-text"},i.createElement("span",{className:"icon-text"},"😀"),"关于本站"),i.createElement("button",{className:"text-btn close-btn",onClick:()=>{e()}},i.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),i.createElement("div",{className:"dialog-content-container"},i.createElement("p",null,i.createElement("b",null,"Memos"),"，有感于"," ",i.createElement("a",{target:"_blank",href:"https://www.zsxq.com/"},"知识星球")," ","和"," ",i.createElement("a",{target:"_blank",href:"https://flomoapp.com/"},"flomo")," "),i.createElement("br",null),i.createElement("i",null,"为何做这个？"),i.createElement("ul",null,i.createElement("li",null,"我用于记录：📅 每日/周计划、💡 突发奇想、📕 读后感..."),i.createElement("li",null,"代替了我在微信上经常使用的“文件传输助手”；"),i.createElement("li",null,"打造一个属于自己的轻量化“卡片”笔记簿；")),i.createElement("br",null),i.createElement("i",null,"有何特点呢？"),i.createElement("ul",null,i.createElement("li",null,"✨"," ",i.createElement("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web"},"开源项目"),"，用于学习；"),i.createElement("li",null,"😋 更可观的视觉样式；"),i.createElement("li",null,"📑 更好的交互逻辑；")),i.createElement("br",null),i.createElement("p",null,"Enjoy it and have fun~ "),i.createElement("hr",null),i.createElement("p",{className:"normal-text"},"BTW, my personal site:"," ",i.createElement("a",{target:"_blank",href:"https://justsven.top"},"https://justsven.top")," ","👀"),i.createElement("p",{className:"normal-text"},"Last update at 2021/9/18 22:16:00, v2.1.2(unknown)")));function R(){U({className:"about-site-dialog"},P,{})}const B=({destroy:e})=>{const t=h.preferences,[a,n]=m.exports.useState(t.shouldSplitMemoWord),[s,r]=m.exports.useState(t.shouldHideImageUrl),[c,d]=m.exports.useState(t.tagTextClickedAction),[u,p]=m.exports.useState(t.shouldUseMarkdownParser),[g,E]=m.exports.useState(t.showDarkMode);m.exports.useEffect((()=>{}),[]);const f=e=>{const a=e.target.value;d(a),t.tagTextClickedAction=a,h.set({tagTextClickedAction:a})};return i.createElement(i.Fragment,null,i.createElement("div",{className:"dialog-header-container"},i.createElement("p",{className:"title-text"},i.createElement("span",{className:"icon-text"},"🤟"),"偏好设置"),i.createElement("button",{className:"text-btn close-btn",onClick:()=>{e()}},i.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),i.createElement("div",{className:"dialog-content-container"},i.createElement("div",{className:"section-container preferences-section-container"},i.createElement("p",{className:"title-text"},"常规"),i.createElement("label",{className:"form-label checkbox-form-label"},i.createElement("span",{className:"normal-text"},"深色模式"),i.createElement("img",{className:"icon-img",src:g?"/icons/check-active.svg":"/icons/check.svg"}),i.createElement("input",{className:"hidden",type:"checkbox",checked:g,onChange:e=>{const a=e.target.checked;E(a),t.showDarkMode=a,h.set({showDarkMode:a}),h.emitStorageChangedEvent()}}),i.createElement("span",{className:"tip-text"},"😜先用着吧"))),i.createElement("div",{className:"section-container preferences-section-container"},i.createElement("p",{className:"title-text"},"Memo 显示相关 ",i.createElement("span",{className:"tip-text"},"需要主动刷新网页")),i.createElement("label",{className:"form-label checkbox-form-label"},i.createElement("span",{className:"normal-text"},"中英文内容自动间隔"),i.createElement("img",{className:"icon-img",src:a?"/icons/check-active.svg":"/icons/check.svg"}),i.createElement("input",{className:"hidden",type:"checkbox",checked:a,onChange:e=>{const a=e.target.checked;n(a),t.shouldSplitMemoWord=a,h.set({shouldSplitMemoWord:a}),h.emitStorageChangedEvent()}})),i.createElement("label",{className:"form-label checkbox-form-label"},i.createElement("span",{className:"normal-text"},"隐藏图片链接地址"),i.createElement("img",{className:"icon-img",src:s?"/icons/check-active.svg":"/icons/check.svg"}),i.createElement("input",{className:"hidden",type:"checkbox",checked:s,onChange:e=>{const a=e.target.checked;r(a),t.shouldHideImageUrl=a,h.set({shouldHideImageUrl:a}),h.emitStorageChangedEvent()}})),i.createElement("label",{className:"form-label checkbox-form-label"},i.createElement("span",{className:"normal-text"},"使用 markdown 解析"),i.createElement("img",{className:"icon-img",src:u?"/icons/check-active.svg":"/icons/check.svg"}),i.createElement("input",{className:"hidden",type:"checkbox",checked:u,onChange:e=>{const a=e.target.checked;p(a),t.shouldUseMarkdownParser=a,h.set({shouldUseMarkdownParser:a}),h.emitStorageChangedEvent()}}),i.createElement("span",{className:"tip-text"},"目前支持列表、代码块"))),i.createElement("div",{className:"section-container"},i.createElement("p",{className:"title-text"},"动作相关"),i.createElement("label",{className:"form-label checkbox-form-label"},i.createElement("span",{className:"normal-text"},"标签点击处理:"),i.createElement("label",{className:"form-label"},i.createElement("input",{className:"hidden",type:"radio",value:"copy",checked:"copy"===c,onChange:f}),i.createElement("img",{className:"icon-img",src:"copy"===c?"/icons/radio-active.svg":"/icons/radio.svg"}),i.createElement("span",null,"复制文字")),i.createElement("label",{className:"form-label"},i.createElement("input",{className:"hidden",type:"radio",value:"insert",checked:"insert"===c,onChange:f}),i.createElement("img",{className:"icon-img",src:"insert"===c?"/icons/radio-active.svg":"/icons/radio.svg"}),i.createElement("span",null,"加入编辑器")))),i.createElement("div",{className:"section-container"},i.createElement("p",{className:"title-text"},"其他"),i.createElement("div",{className:"btn-container"},i.createElement("button",{className:"btn export-btn",onClick:async()=>{await D.fetchAllMemos();const e=D.getState().memos.map((e=>l(o({},e),{tags:e.tags.map((e=>e.text))}))),t=JSON.stringify(e),a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download","data.json"),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}},"导出数据")))))};const j=({visibility:e})=>i.createElement("div",{className:"menu-btns-popup "+(e?"":"hidden")},i.createElement("button",{className:"text-btn action-btn",onClick:H},i.createElement("span",{className:"icon"},"🤠")," 我的账号"),i.createElement("button",{className:"text-btn action-btn",onClick:()=>{U({className:"preferences-dialog"},B,{})}},i.createElement("span",{className:"icon"},"🤟")," 偏好设置"),i.createElement("button",{className:"text-btn action-btn",onClick:()=>{R()}},i.createElement("span",{className:"icon"},"😀")," 关于"),i.createElement("button",{className:"text-btn action-btn",onClick:()=>{I.doSignOut(),location.reload()}},i.createElement("span",{className:"icon"},"👋")," 退出"));function Y(e=!1){const[t,a]=m.exports.useState(e);return[t,m.exports.useCallback((e=>{a(void 0!==e?e:e=>!e)}),[])]}function Q(){const[e,t]=m.exports.useState({isLoading:!0,isFailed:!1,isSucceed:!1});return l(o({},e),{setLoading:()=>{t(l(o({},e),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{t(l(o({},e),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{t(l(o({},e),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const q=({destroy:e,imgUrl:t})=>{const a=m.exports.useRef(null),[n,s]=m.exports.useState(-1);m.exports.useEffect((()=>{x.getImageSize(t).then((({width:e})=>{s(0!==e?80:0)}))}),[]);return i.createElement(i.Fragment,null,i.createElement("button",{className:"text-btn close-btn",onClick:()=>{e()}},i.createElement("img",{className:"icon-img",src:"/icons/close.svg"})),i.createElement("div",{className:"img-container"},i.createElement("img",{className:n<=0?"hidden":"",ref:a,width:n+"%",src:t}),i.createElement("span",{className:"loading-text "+(-1===n?"":"hidden")},"图片加载中..."),i.createElement("span",{className:"loading-text "+(0===n?"":"hidden")},"😟 图片加载失败，可能是无效的链接")),i.createElement("div",{className:"action-btns-container"},i.createElement("button",{className:"text-btn",onClick:()=>{n>30&&s(n-10)}},"➖"),i.createElement("button",{className:"text-btn",onClick:()=>{s(n+10)}},"➕"),i.createElement("button",{className:"text-btn",onClick:()=>s(80)},"⭕")))};function G(e){U({className:"preview-image-dialog"},q,{imgUrl:e})}const W=/```([\s\S]*?)```/g,V=/[\*] /g,z=/(\d+)\. /g,X=e=>{const{children:t,when:a}=e;return a?i.createElement(i.Fragment,null,t):null};const J=e=>{const{className:t,imgUrl:a}=e;return i.createElement("div",{className:"image-container "+t,onClick:()=>{G(a)}},i.createElement("img",{src:a,decoding:"async",loading:"lazy"}))};const K=e=>{var t;const{memo:a,destroy:n}=e,[s,r]=m.exports.useState(""),c=m.exports.useRef(null),{user:d}=I.getState(),u=l(o({},a),{formattedContent:ne(a.content),createdAtStr:x.getTimeString(a.createdAt)}),p=Array.from(null!=(t=u.content.match(M))?t:[]),[g,E]=m.exports.useState(p.length);m.exports.useEffect((()=>{const e=c.current;setTimeout((()=>{if(0===g){const t=x.getOSVersion();"MacOS"!==t&&"Unknown"!==t||window.scrollTo(0,0),html2canvas(e,{scale:2*window.devicePixelRatio,allowTaint:!0,useCORS:!0,backgroundColor:h.preferences.showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then((e=>{r(e.toDataURL())}))}}),400)}),[g]);const f=e=>{"error"===e.type&&(_.error("有个图片加载失败了😟"),e.target.remove()),E(g-1)};return i.createElement(i.Fragment,null,i.createElement("div",{className:"dialog-header-container"},i.createElement("p",{className:"title-text"},i.createElement("span",{className:"icon-text"},"🥰"),"分享 Memo 图片"),i.createElement("button",{className:"text-btn close-btn",onClick:()=>{n()}},i.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),i.createElement("div",{className:"dialog-content-container"},i.createElement("div",{className:"tip-words-container "+(s?"finished":"genarating")},i.createElement("p",{className:"tip-text"},s?"右键或长按即可保存图片 👇":"图片生成中...")),i.createElement("img",{className:"memo-img",src:s}),i.createElement("div",{className:"memo-container",ref:c},i.createElement("span",{className:"time-text"},u.createdAtStr),i.createElement("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:u.formattedContent}}),i.createElement(X,{when:p.length>0},i.createElement("div",{className:"images-container"},p.map(((e,t)=>i.createElement("img",{key:t,crossOrigin:"anonymous",src:e,onLoad:f,onError:f,decoding:"async"}))))),i.createElement("div",{className:"watermark-container"},i.createElement("span",{className:"normal-text"},"by ",i.createElement("span",{className:"name-text"},null==d?void 0:d.username))))))};function Z(e){U({className:"gen-memo-image-dialog"},K,{memo:e})}const ee=e=>{var t;const{memoId:a,destroy:n}=e,[s,r]=m.exports.useState(),[c,d]=m.exports.useState([]),[u,p]=m.exports.useState([]);m.exports.useEffect((()=>{(async()=>{var e;const t=await D.getMemoById(a);t&&(p(Array.from(null!=(e=t.content.match(M))?e:[])),r(l(o({},t),{formattedContent:ne(t.content),createdAtStr:x.getTimeString(t.createdAt)})))})()}),[]),m.exports.useEffect((()=>{(async()=>{if(!s)return;const e=[],t=[...s.content.matchAll(A)];for(const a of t)if(a&&3===a.length){const t=a[2],n=await D.getMemoById(t);n&&(e.push(l(o({},n),{formattedContent:ne(n.content),createdAtStr:x.getTimeString(n.createdAt)})),d([...e]))}})()}),[s]);const g=async e=>{var t;const a=e.target;if("memo-link-text"===a.className){const e=null==(t=a.dataset)?void 0:t.value;if(e){await D.getMemoById(e)&&(n(),te(e))}}};return i.createElement(i.Fragment,null,i.createElement("div",{className:"dialog-header-container"},i.createElement("p",{className:"title-text"},i.createElement("span",{className:"icon-text"},"📕"),"Memo Story"),i.createElement("button",{className:"text-btn close-btn",onClick:n},i.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),i.createElement("div",{className:"dialog-content-container"},i.createElement("div",{className:"memo-container current"},i.createElement("div",{className:"memo-header-container"},i.createElement("p",{className:"time-text"},null==s?void 0:s.createdAtStr),i.createElement("span",{className:"action-btn",onClick:()=>{s&&Z(s)}},"Share")),i.createElement("div",{className:"memo-content-text",onClick:g,dangerouslySetInnerHTML:{__html:null!=(t=null==s?void 0:s.formattedContent)?t:""}}),i.createElement(X,{when:u.length>0},i.createElement("div",{className:"images-wrapper"},u.map(((e,t)=>i.createElement(J,{className:"memo-img",key:t,imgUrl:e})))))),i.createElement("p",{className:"normal-text "+(0===c.length?"hidden":"")},"链接了 ",c.length," 个 Memo"),i.createElement("div",{className:"down-memos-wrapper "+(0!==c.length?"":"hidden")},c.map((e=>i.createElement("div",{className:"memo-container",key:e.id},i.createElement("div",{className:"memo-header-container"},i.createElement("p",{className:"time-text"},e.createdAtStr)),i.createElement("div",{className:"memo-content-text",onClick:g,dangerouslySetInnerHTML:{__html:e.formattedContent}})))))))};function te(e){U({className:"memo-story-dialog"},ee,{memoId:e})}const ae=e=>{var t,a;const{memo:n}=e,s=l(o({},n),{formattedContent:ne(n.content),createdAtStr:x.getTimeString(n.createdAt)}),[r,c]=Y(!1),m=Array.from(null!=(t=s.content.match(M))?t:[]);return i.createElement("div",{className:`memo-wrapper ${null!=(a=e.className)?a:""}`,onMouseLeave:()=>{r&&c(!1)}},i.createElement("div",{className:"memo-top-wrapper"},i.createElement("span",{className:"time-text",onClick:()=>{ie(s.createdAt)}},s.createdAtStr),i.createElement("div",{className:"btns-container"},i.createElement("span",{className:"text-btn more-action-btn"}),i.createElement("div",{className:"more-action-btns-wrapper"},i.createElement("div",{className:"more-action-btns-container"},i.createElement("span",{className:"text-btn",onClick:()=>{N.setMarkMemoId(s.id)}},"Mark"),i.createElement("span",{className:"text-btn",onClick:()=>{Z(s)}},"分享"),i.createElement("span",{className:"text-btn",onClick:()=>{N.setEditMemoId(s.id)}},"编辑"),i.createElement("span",{className:"text-btn delete-btn",onClick:async()=>{if(r){try{await D.deleteMemoById(s.id),e.index+5>D.getState().memos.length&&await D.fetchMoreMemos()}catch(t){_.error(t.message)}N.getState().editMemoId===s.id&&N.setEditMemoId("")}else c()}},r?"确定删除！":"删除"))))),i.createElement("div",{className:"memo-content-text",onClick:async e=>{var t;const a=e.target;if("memo-link-text"===a.className){const e=null==(t=a.dataset)?void 0:t.value;if(e){await D.getMemoById(e)&&te(e)}}},dangerouslySetInnerHTML:{__html:s.formattedContent}}),i.createElement(X,{when:m.length>0},i.createElement("div",{className:"images-wrapper"},m.map(((e,t)=>i.createElement(J,{className:"memo-img",key:t,imgUrl:e}))))))};function ne(e){var t;const a=document.createElement("div");a.innerHTML=e;const n=document.createElement("p");for(;a.firstChild&&"P"!==a.firstChild.nodeName;){const e=a.firstChild;"#text"===e.nodeName?n.innerHTML+=e.nodeValue:n.innerHTML+=e.outerHTML,e.remove()}""!==n.innerHTML&&(a.prepend(n),e=a.innerHTML);const{shouldUseMarkdownParser:s,shouldSplitMemoWord:r,shouldHideImageUrl:c}=h.preferences;s&&(e=e.replace(W,"<pre lang=''>$1</pre>").replace(V,"<span class='counter-text'>•</span>").replace(z,"<span class='counter-text'>$1.</span>")),r&&(e=e.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;\[\]\(\)]+)([\u4e00-\u9fa5]?)/g,"$1 $2 $3")),c&&(e=e.replace(M,"")),a.innerHTML=e;for(const o of a.querySelectorAll("p"))""===o.textContent&&"BR"!==(null==(t=o.firstElementChild)?void 0:t.tagName)&&o.remove();return e=(e=a.innerHTML).replace(C,"<span class='tag-span'>#$1#</span>").replace(T,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(A,"<span class='memo-link-text' data-value='$2'>$1</span>")}const se=e=>{var t;const{memo:a}=e,n=l(o({},a),{formattedContent:ne(a.content),createdAtStr:x.getTimeString(a.createdAt),timeStr:x.getTimeStampString(a.createdAt)}),s=Array.from(null!=(t=n.content.match(M))?t:[]);return i.createElement("div",{className:"daily-memo-wrapper"},i.createElement("div",{className:"time-wrapper"},i.createElement("span",{className:"normal-text"},n.timeStr)),i.createElement("div",{className:"memo-content-container"},i.createElement("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:n.formattedContent}}),i.createElement(X,{when:s.length>0},i.createElement("div",{className:"images-container"},s.map(((e,t)=>i.createElement("img",{key:t,crossOrigin:"anonymous",src:e,decoding:"async"})))))))};const re=e=>{const{className:t,datestamp:a,handleDateStampChange:n}=e,[s,r]=m.exports.useState(ce(a));m.exports.useEffect((()=>{r(ce(a))}),[a]);const c=new Date(s),o=0===c.getDay()?7:c.getDay(),l=[];for(let m=1;m<o;m++)l.push({date:0,datestamp:c.getTime()-864e5*(7-m)});const d=function(e){const t=new Date(e),a=new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`);return((11===a.getMonth()?new Date(`${a.getFullYear()+1}/1`):new Date(`${a.getFullYear()}/${a.getMonth()+2}/1`)).getTime()-a.getTime())/864e5}(s);for(let m=1;m<=d;m++)l.push({date:m,datestamp:c.getTime()+864e5*(m-1)});const u=e=>{const t=c.getFullYear(),a=c.getMonth()+1;let n=0;n=1===a&&-1===e?new Date(t-1+"/12/1").getTime():12===a&&1===e?new Date(`${t+1}/1/1`).getTime():new Date(`${t}/${a+e}/1`).getTime(),r(ce(n))};return i.createElement("div",{className:`date-picker-wrapper ${t}`},i.createElement("div",{className:"date-picker-header"},i.createElement("span",{className:"btn-text",onClick:()=>u(-1)},i.createElement("img",{className:"icon-img",src:"/icons/arrow-left.svg"})),i.createElement("span",{className:"normal-text"},c.getFullYear()," 年 ",c.getMonth()+1," 月"),i.createElement("span",{className:"btn-text",onClick:()=>u(1)},i.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"}))),i.createElement("div",{className:"date-picker-day-container"},i.createElement("div",{className:"date-picker-day-header"},i.createElement("span",{className:"day-item"},"周一"),i.createElement("span",{className:"day-item"},"周二"),i.createElement("span",{className:"day-item"},"周三"),i.createElement("span",{className:"day-item"},"周四"),i.createElement("span",{className:"day-item"},"周五"),i.createElement("span",{className:"day-item"},"周六"),i.createElement("span",{className:"day-item"},"周日")),l.map((e=>0===e.date?i.createElement("span",{key:e.datestamp,className:"day-item null"},""):i.createElement("span",{key:e.datestamp,className:"day-item "+(e.datestamp===a?"current":""),onClick:()=>{return t=e.datestamp,void n(t);var t}},e.date)))))};function ce(e){const t=new Date(e);return new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`).getTime()}const oe=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],le=["周日","周一","周二","周三","周四","周五","周六"],me=e=>{const t=Q(),[a,n]=m.exports.useState([]),[s,r]=m.exports.useState(x.getTimeStampByDate(x.getDateString(e.currentDateStamp))),[c,o]=Y(!1),l=m.exports.useRef(null),d=new Date(s);m.exports.useEffect((()=>{const e=()=>{const e=D.getState().memos.filter((e=>e.createdAt>=s&&e.createdAt<s+864e5)).sort(((e,t)=>e.createdAt-t.createdAt));n(e),t.setFinish()},{memos:a}=D.getState(),r=a.slice(-1).pop();r&&r.createdAt>=s?(t.setLoading(),D.fetchAllMemos().then((()=>{e()})).catch((e=>{_.error(e.message)}))):e()}),[s]);return i.createElement(i.Fragment,null,i.createElement("div",{className:"dialog-header-container"},i.createElement("div",{className:"btns-wrapper"},i.createElement("div",{className:"btns-container"},i.createElement("span",{className:"btn-text",onClick:()=>r(s-864e5)},i.createElement("img",{className:"icon-img",src:"/icons/arrow-left.svg"})),i.createElement("span",{className:"btn-text",onClick:()=>r(s+864e5)},i.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"}))),i.createElement("div",{className:"btns-container"},i.createElement("span",{className:"btn-text",onClick:()=>{o(!1),setTimeout((()=>{const e=x.getOSVersion();"MacOS"!==e&&"Unknown"!==e||window.scrollTo(0,0),html2canvas(l.current,{scale:2*window.devicePixelRatio,allowTaint:!0,useCORS:!0,backgroundColor:h.preferences.showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then((e=>{G(e.toDataURL())}))}),0)}},i.createElement("img",{className:"icon-img",src:"/icons/share.svg"})),i.createElement("span",{className:"btn-text",onClick:()=>e.destroy()},i.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))))),i.createElement("div",{className:"dialog-content-container",ref:l},i.createElement("div",{className:"date-card-container",onClick:()=>o()},i.createElement("div",{className:"year-text"},d.getFullYear()),i.createElement("div",{className:"date-container"},i.createElement("div",{className:"month-text"},oe[d.getMonth()]),i.createElement("div",{className:"date-text"},d.getDate()),i.createElement("div",{className:"day-text"},le[d.getDay()]))),i.createElement(re,{className:"date-picker "+(c?"":"hide"),datestamp:s,handleDateStampChange:e=>{r(e),o(!1)}}),t.isLoading?i.createElement("div",{className:"tip-container"},i.createElement("p",{className:"tip-text"},"努力加载中...")):0===a.length?i.createElement("div",{className:"tip-container"},i.createElement("p",{className:"tip-text"},"空空如也")):i.createElement("div",{className:"dailymemos-wrapper"},a.map(((e,t)=>{const a=e.id+" "+e.updatedAt;return i.createElement(se,{key:a,index:t,memo:e})})))))};function ie(e=Date.now()){U({className:"daily-memo-diary-dialog"},me,{currentDateStamp:e})}const de=()=>{const{userState:{user:e},memoState:{memos:t}}=m.exports.useContext(E),[a,n]=m.exports.useState({memosAmount:0,tagsAmount:0}),[s,r]=m.exports.useState(!1),c=e?e.username:"Memos",o=e?Math.ceil((Date.now()-new Date(e.createdAt).getTime())/1e3/3600/24):0;m.exports.useEffect((()=>{I.getState().user&&D.getMyDataAmount().then((e=>{n(e)})).catch((e=>{_.error(e.message)}))}),[t]);const l=m.exports.useCallback((e=>{e.stopPropagation();const t=!s;if(t){const e=()=>{r(!1),document.body.removeEventListener("click",e)};document.body.addEventListener("click",e)}r(t)}),[s]),d=m.exports.useCallback((()=>{b.clearQuery()}),[]);return i.createElement("div",{className:"user-banner-container"},i.createElement("div",{className:"userinfo-header-container"},i.createElement("p",{className:"username-text",onClick:d},c),i.createElement("button",{className:"action-btn menu-popup-btn",onClick:l}),i.createElement(j,{visibility:s})),i.createElement("div",{className:"status-text-container"},i.createElement("div",{className:"status-text memos-text"},i.createElement("span",{className:"amount-text"},a.memosAmount),i.createElement("span",{className:"type-text"},"MEMO")),i.createElement("div",{className:"status-text tags-text"},i.createElement("span",{className:"amount-text"},a.tagsAmount),i.createElement("span",{className:"type-text"},"TAG")),i.createElement("div",{className:"status-text duration-text",onClick:()=>ie()},i.createElement("span",{className:"amount-text"},o),i.createElement("span",{className:"type-text"},"DAY"))))};const ue=()=>{const{locationState:{query:e},memoState:{memos:t}}=m.exports.useContext(E),[a,n]=m.exports.useState([]),[s,r]=m.exports.useState(e.tag),c=Q();m.exports.useEffect((()=>{I.getState().user&&D.getMyTags().then((e=>{e&&(n([...e.sort(((e,t)=>t.createdAt-e.createdAt)).sort(((e,t)=>t.level-e.level))]),c.setFinish())})).catch((e=>{c.setError(),_.error(e)}))}),[t]),m.exports.useEffect((()=>{r(e.tag);const t=document.querySelector("div#page-container");null==t||t.classList.remove("show-user-banner-dialog")}),[e]);return i.createElement("div",{className:"tags-wrapper"},i.createElement("p",{className:"title-text"},"常用标签"),i.createElement("div",{className:"tags-container"},c.isLoading?i.createElement(i.Fragment,null):i.createElement(i.Fragment,null,a.map((e=>i.createElement("div",{key:e.id,className:"tag-item-container used-tag-container "+(s===e.text?"active":""),onClick:()=>{(e=>{const t=e.text===s?"":e.text;t&&D.polishTag(e.id).catch((()=>{})),b.setTagQuery(t)})(e)}},i.createElement("span",{className:"tag-text"},"# ",e.text)))),i.createElement(X,{when:a.length<=3},i.createElement("p",{className:"tag-tip-container"},"输入",i.createElement("span",null,"#Tag#"),"来创建标签吧~")))))};const pe=12,ge=7,Ee=()=>{const e=x.getTimeStampByDate(Date.now()),t=new Date(e).getDay()||7,a=(pe-1)*ge+t,n=e-864e5*a,s=new Array(7-t).fill(0),r=()=>{const e=[];for(let t=1;t<=a;t++)e.push({timestamp:n+864e5*t,count:0});return e},{memoState:{memos:c}}=m.exports.useContext(E),[o,l]=m.exports.useState(r()),[d,u]=m.exports.useState(null),[p,g]=m.exports.useState(null),h=m.exports.useRef(null);m.exports.useEffect((()=>{if(!I.getState().user)return;const e=r();D.getMemosStat().then((t=>{for(const a of t){const t=(x.getTimeStampByDate(a.timestamp)-n)/864e5-1;t>=0&&(e[t].count=a.amount)}l([...e])})).catch((e=>{_.error(e.message)}))}),[c]);const f=m.exports.useCallback(((e,t)=>{if(u(t),h.current){const t=e.target;h.current.style.left=t.offsetLeft+"px",h.current.style.top=t.offsetTop+"px"}}),[]),N=m.exports.useCallback(((e,t)=>{u(null)}),[]);return i.createElement("div",{className:"usage-stat-table-wrapper"},i.createElement("div",{className:"day-tip-text-container"},i.createElement("span",{className:"tip-text"},"Mon"),i.createElement("span",{className:"tip-text"}),i.createElement("span",{className:"tip-text"},"Wed"),i.createElement("span",{className:"tip-text"}),i.createElement("span",{className:"tip-text"},"Fri"),i.createElement("span",{className:"tip-text"}),i.createElement("span",{className:"tip-text"},"Sun")),i.createElement("div",{ref:h,className:"usage-detail-container pop-up "+(d?"":"hidden")},null==d?void 0:d.count," memos on ",i.createElement("span",{className:"date-text"},new Date(null==d?void 0:d.timestamp).toDateString())),i.createElement("div",{className:"usage-stat-table"},o.map(((e,t)=>{const a=e.count,n=a<=0?"":a<=2?"stat-day-L1-bg":a<=4?"stat-day-L2-bg":a<=8?"stat-day-L3-bg":"stat-day-L4-bg";return i.createElement("span",{className:"stat-container "+n+(p===e?" current":" "),key:t,onMouseEnter:t=>f(t,e),onMouseLeave:t=>N(t,e),onClick:()=>{return t=e,void((null==p?void 0:p.timestamp)===t.timestamp?(b.setFromAndToQuery(0,0),g(null)):t.count>0&&(b.setFromAndToQuery(t.timestamp,t.timestamp+864e5),g(t)));var t}})})),s.map(((e,t)=>i.createElement("span",{className:"stat-container null",key:t})))))};const he=()=>{m.exports.useEffect((()=>{}),[]);const e=m.exports.useCallback((e=>{if("sidebar-wrapper"===e.target.className){const e=document.querySelector("div#page-container");null==e||e.classList.remove("show-user-banner-dialog")}}),[]);return i.createElement("div",{className:"sidebar-wrapper",onClick:e},i.createElement(de,null),i.createElement(Ee,null),i.createElement(ue,null))},fe=()=>{const{userState:{user:e}}=m.exports.useContext(E),t=e?e.username:"Memos",a=m.exports.useCallback((()=>{b.clearQuery()}),[]),n=m.exports.useCallback((()=>{const e=document.querySelector("div#page-container");e&&e.classList.add("show-user-banner-dialog")}),[]);return i.createElement("div",{className:"mobile-header-container"},i.createElement("p",{className:"username-text",onClick:a},t),i.createElement("button",{className:"action-btn show-sidebar",onClick:n},i.createElement("img",{className:"icon-img",src:"/icons/fold.svg",alt:"fold"})))};const Ne={className:"",content:"",placeholder:"",showConfirmBtn:!0,showCancelBtn:!1,showTools:!1},xe=m.exports.forwardRef(((e=Ne)=>{const{className:t,content:a,placeholder:n,showConfirmBtn:s,showCancelBtn:r,showTools:c,handleConfirmBtnClick:o,handleCancelBtnClick:l,handleContentChange:d}=e,[u,p]=m.exports.useState(a),g=m.exports.useRef(null);m.exports.useEffect((()=>{document.execCommand("defaultParagraphSeparator",!1,"p"),u&&g.current&&(g.current.innerHTML=u)}),[]),m.exports.useImperativeHandle(e.editorRef,(()=>({focus:()=>{var e;null==(e=g.current)||e.focus()},insertText:e=>{const t=u+e;p(t),g.current&&(g.current.innerHTML=t),d&&d(t)},setContent:e=>{const t=e;p(t),g.current&&(g.current.innerHTML=t)},getContent:()=>u})));return i.createElement("div",{className:"common-editor-wrapper "+t},i.createElement("div",{className:"common-editor-inputer",contentEditable:!0,ref:g,onPaste:e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain"),a=document.createElement("div");a.innerHTML=t,document.execCommand("insertText",!1,a.innerText),a.remove()},onInput:e=>{const t=e.currentTarget.innerHTML;p(t),d&&d(t)},onKeyDown:e=>{var t;"Tab"===e.key?(e.preventDefault(),document.execCommand("insertText",!1,"  ")):"Backspace"===e.key&&"<br>"===(null==(t=g.current)?void 0:t.innerHTML)&&p("")}}),i.createElement("p",{className:""===u?"common-editor-placeholder":"hidden"},n),i.createElement("div",{className:"common-tools-wrapper"},i.createElement(X,{when:c},i.createElement("div",{className:"common-tools-container"})),i.createElement("div",{className:"btns-right-container"},i.createElement(X,{when:r},i.createElement("button",{className:"action-btn cancel-btn",disabled:0===u.length,onClick:()=>{l&&l()}},"撤销修改")),i.createElement(X,{when:s},i.createElement("button",{className:"action-btn confirm-btn",disabled:0===u.length,onClick:()=>{o&&(o(u),g.current&&(g.current.innerHTML=""),p(""))}},"记下",i.createElement("span",{className:"icon-text"},"✍️"))))))}));const ye=()=>{const{globalState:e,locationState:{query:t}}=m.exports.useContext(E),a=i.useRef(null),[n,s]=m.exports.useState(e.editMemoId);m.exports.useEffect((()=>{var t;if(e.markMemoId){const n=`Mark: [@MEMO](${e.markMemoId})`;null==(t=a.current)||t.insertText(`<p>${n}</p>`)}e.editMemoId!==n&&(s(e.editMemoId),e.editMemoId&&D.getMemoById(e.editMemoId).then((e=>{var t,n,s;e&&(null==(n=a.current)||n.setContent(null!=(t=e.content)?t:""),null==(s=a.current)||s.focus())})))}),[e]),m.exports.useEffect((()=>{var e,n,s;const r=t.tag;if(r)if("insert"===h.preferences.tagTextClickedAction){const t=`#${r}#`;(null!=(n=null==(e=a.current)?void 0:e.getContent())?n:"").includes(t)||null==(s=a.current)||s.insertText(`#${r}#`)}else x.copyTextToClipboard(`#${r}#`)}),[t]);const r=async e=>{var a,s;if(""===e)return void _.error("内容不能为空呀");const r=x.dedupe(Array.from(null!=(a=e.match(C))?a:[])).map((e=>e.replace(C,"$1").trim())),c=[];try{for(const e of r){const t=await D.createTag(e);c.push(t)}if(n){const t=await D.getMemoById(n);if(t&&t.content!==e){const a=null!=(s=t.tags)?s:[],n=a.map((e=>e.text));c.push(...a);for(let e=0;e<c.length;){const a=c[e],s=a.text;r.includes(s)?(e++,n.includes(s)||await D.createMemoTag(t.id,a.id)):(c.splice(e,1),await D.removeMemoTag(t.id,a.id))}const o=await D.updateMemo(t.id,e);t.content=o.content,t.tags=c,t.updatedAt=Date.now(),D.editMemo(t)}N.setEditMemoId("")}else{const a=await D.createMemo(e);a.tags=c;for(const e of c)await D.createMemoTag(a.id,e.id);const n=t.tag;""===n||r.includes(n)||b.setTagQuery(""),D.pushMemo(a)}}catch(o){_.error(o.message)}ve("")},c=m.exports.useCallback((()=>{var e;N.setEditMemoId(""),null==(e=a.current)||e.setContent(""),ve("")}),[]),l=m.exports.useCallback((async e=>{const t=document.createElement("div");t.innerHTML=e,""===t.innerText.trim()&&(e=""),ve(e)}),[n]),d=m.exports.useMemo((()=>{return{className:"main-editor",content:null!=(e=h.get(["editorContentCache"]).editorContentCache)?e:"",placeholder:"现在的想法是...",showConfirmBtn:!0,handleConfirmBtnClick:r,showCancelBtn:""!==n,handleCancelBtnClick:c,showTools:!0,handleContentChange:l,editorRef:a};var e}),[n]);return i.createElement("div",{className:"main-editor-wrapper "+(n?"edit-ing":"")},i.createElement("p",{className:"tip-text "+(n?"":"hidden")},"正在修改中..."),i.createElement(xe,o({},d)))};function ve(e){h.set({editorContentCache:e})}const be=()=>{const{locationState:{query:e},memoState:{memos:t}}=m.exports.useContext(E),[a,n]=m.exports.useState(!1),[s,r]=m.exports.useState(!1),c=m.exports.useRef(null),o=e.tag,l={from:e.from,to:e.to};m.exports.useEffect((()=>{var e;null==(e=c.current)||e.scrollTo({top:0}),!s&&(""!==o||l.from<l.to)&&(D.fetchAllMemos(),r(!0))}),[location.search,s]);const d=function(e,t,a=[]){const n=m.exports.useRef(),s=m.exports.useCallback((()=>{n.current&&clearTimeout(n.current)}),[]);return m.exports.useCallback(((...a)=>{s(),n.current=window.setTimeout((()=>{e(...a)}),t)}),a)}((()=>{const{offsetHeight:e,scrollTop:t,scrollHeight:o}=c.current;e+t+10>o&&(async()=>{if(!a&&!s){n(!0);try{const e=await D.fetchMoreMemos();e&&0===e.length&&r(!0)}catch(e){_.error(e.message)}n(!1)}})()}),200,[a,s]);return i.createElement("div",{className:"memolist-wrapper",ref:c,onScroll:d},i.createElement("div",{className:"filter-query-container"},i.createElement("span",{className:"tip-text "+(o||0!==l.from&&l.from<l.to?"":"hidden")},"筛选："),i.createElement("div",{className:"filter-item-container "+(o?"":"hidden"),onClick:()=>{b.setTagQuery("")}},i.createElement("span",{className:"icon-text"},"🏷️")," ",o),i.createElement("div",{className:"filter-item-container "+(0!==l.from&&l.from<l.to?"":"hidden"),onClick:()=>{b.setFromAndToQuery(0,0)}},i.createElement("span",{className:"icon-text"},"🗓️")," ",x.getDateString(l.from)," 至 ",x.getDateString(l.to))),t.map(((e,t)=>{var a;const n=`${e.id} ${e.updatedAt}`;let s=!0;return""===o||(null==(a=e.tags)?void 0:a.map((e=>e.text)).includes(o))||(s=!1),0!==l.from&&l.from<l.to&&(e.createdAt<l.from||e.createdAt>l.to)&&(s=!1),s?i.createElement(ae,{key:n,index:t,memo:e}):null})),i.createElement("div",{className:`status-text-container ${s?"completed":""} ${a||s?"":"invisible"} ${o||l.from<l.to?"invisible":""}`},i.createElement("p",{className:"status-text"},s?"所有数据加载完啦 🎉":"努力请求数据中...")))},we=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function Se(e,t){return void 0!==t.minLength&&e.length<t.minLength?{result:!1,reason:"长度过短"}:void 0!==t.maxLength&&e.length>t.maxLength?{result:!1,reason:"长度超出"}:t.noSpace&&e.includes(" ")?{result:!1,reason:"不应含有空格"}:t.noChinese&&we.test(e)?{result:!1,reason:"不应含有中文字符"}:{result:!0}}const ke={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},Me=({destroy:e})=>{const[t,a]=m.exports.useState(""),[n,s]=m.exports.useState(""),r=m.exports.useRef(null);m.exports.useEffect((()=>{const e=e=>{var t;"Enter"===e.key&&(null==(t=r.current)||t.click())};return document.body.addEventListener("keypress",e),()=>{document.body.removeEventListener("keypress",e)}}),[]);return i.createElement(i.Fragment,null,i.createElement("div",{className:"dialog-header-container"},i.createElement("p",{className:"title-text"},i.createElement("span",{className:"icon-text"},"👋")," 账号注册 / 登录")),i.createElement("div",{className:"dialog-content-container"},i.createElement("label",{className:"form-label input-form-label"},i.createElement("input",{type:"text",value:t,onChange:e=>{const t=e.target.value;a(t)}}),i.createElement("span",{className:"normal-text "+(""===t?"":"not-null")},"账号")),i.createElement("label",{className:"form-label input-form-label"},i.createElement("input",{type:"password",value:n,onChange:e=>{const t=e.target.value;s(t)}}),i.createElement("span",{className:"normal-text "+(""===n?"":"not-null")},"密码"))),i.createElement("div",{className:"dialog-footer-container"},i.createElement("div",{className:"btns-container"},i.createElement("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist"},"Login with GitHub")),i.createElement("div",{className:"btns-container"},i.createElement("button",{className:"text-btn signup-btn disabled",onClick:()=>_.info("注册已关闭")},"注册"),i.createElement("span",{className:"split-text"},"/"),i.createElement("button",{className:"text-btn signin-btn",ref:r,onClick:async()=>{const a=Se(t,ke);if(!a.result)return void _.error("用户名 "+a.reason);const s=Se(n,ke);if(s.result)try{const a=k.signin,{succeed:s,message:r}=await a(t,n);if(!s&&r)return void _.error("😟 "+r);await I.doSignIn()?(D.fetchMoreMemos().catch((()=>{})),e()):_.error("😟 不知道发生了什么错误")}catch(r){console.error(r),_.error("😟 "+r.message)}else _.error("密码 "+s.reason)}},"登录"))),i.createElement("p",{className:"tip-text"},"仅用于作品展示，注册暂时关闭；",i.createElement("br",null),"可输入 ",i.createElement("code",null,"guest, 123456")," 进行体验。",i.createElement("br",null),i.createElement("span",{className:"text-btn",onClick:()=>{R()}},i.createElement("span",{className:"icon-text"},"😀"),"关于本站")))};String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return"[object regexp]"===Object.prototype.toString.call(e).toLowerCase()?this.replace(e,t):this.replace(new RegExp(e,"g"),t)});function Ce(){return m.exports.useEffect((()=>{I.doSignIn().catch((()=>{})).finally((()=>{I.getState().user?D.fetchMoreMemos():U({className:"signin-dialog",clickSpaceDestroy:!1},Me,{})}));const e=()=>{var e;null!=(e=h.preferences.showDarkMode)&&e?document.body.classList.add("dark"):document.body.classList.remove("dark")};return e(),window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}),[]),i.createElement("div",{id:"page-container"},i.createElement(he,null),i.createElement("div",{className:"content-wrapper"},i.createElement(fe,null),i.createElement(ye,null),i.createElement(be,null)))}u.render(i.createElement(p,{store:g,context:E},i.createElement(Ce,null)),document.getElementById("root"));
