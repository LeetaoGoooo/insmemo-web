var we=Object.defineProperty,Te=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var ge=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var se=(n,e,a)=>e in n?we(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a,M=(n,e)=>{for(var a in e||(e={}))ke.call(e,a)&&se(n,a,e[a]);if(ge)for(var a of ge(e))Ae.call(e,a)&&se(n,a,e[a]);return n},k=(n,e)=>Te(n,Fe(e));var O=(n,e,a)=>(se(n,typeof e!="symbol"?e+"":e,a),a);import{j as oe,r as d,R as j}from"./vendor.a5555f7d.js";const Be=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function a(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=a(o);fetch(o.href,i)}};Be();const t=oe.exports.jsx,r=oe.exports.jsxs,_=oe.exports.Fragment,fe=n=>{const{children:e,store:a,context:s}=n,[o,i]=d.exports.useState(a.getState());return d.exports.useEffect(()=>{const u=a.subscribe(c=>{i(c)});return()=>{u()}},[]),t(s.Provider,{value:o,children:e})};function Ie(n){const e=Object.keys(n),a={};for(const s of e)typeof n[s]=="function"&&(a[s]=n[s]);return(s={},o)=>{let i=!1;const u={};for(const c of e){const g=s[c],C=a[c](g,o);u[c]=C,i=i||C!==g}return i?u:s}}function _e(n,e){const a=[];let s=n;return{dispatch:c=>{const g=e(s,c),C=s;s=g;for(const N of a)N(s,C)},getState:()=>s,subscribe:c=>{let g=!0;return a.push(c),()=>{if(!g)return;const C=a.indexOf(c);a.splice(C,1),g=!1}}}}function Le(n,e){switch(e.type){case"SET_MARK_MEMO_ID":return k(M({},n),{markMemoId:e.payload.markMemoId});case"SET_EDIT_MEMO_ID":return k(M({},n),{editMemoId:e.payload.editMemoId});case"SET_APP_SETTING":return M(M({},n),e.payload);default:return n}}const Oe={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,showDarkMode:!1};function Ue(n,e){switch(e.type){case"SET_TAG_QUERY":return k(M({},n),{query:k(M({},n.query),{tag:e.payload.tag})});case"SET_FROM_TO_QUERY":return k(M({},n),{query:k(M({},n.query),{from:e.payload.from,to:e.payload.to})});case"SET_TYPE":return k(M({},n),{query:k(M({},n.query),{type:e.payload.type})});case"SET_TEXT":return k(M({},n),{query:k(M({},n.query),{text:e.payload.text})});case"SET_HASH":return k(M({},n),{hash:e.payload.hash});default:return n}}const Pe={hash:"",query:{tag:"",from:0,to:0,type:"",text:""}};var v;(function(n){function e(){return Date.now()}n.getNowTimeStamp=e;function a(){const h=navigator.appVersion;let m="Unknown";return h.indexOf("Win")!=-1?m="Windows":h.indexOf("Mac")!=-1?m="MacOS":h.indexOf("Linux")!=-1&&(m="Linux"),m}n.getOSVersion=a;function s(h){return typeof h=="string"&&(h=h.replaceAll("-","/")),new Date(h).getTime()}n.getTimeStampByDate=s;function o(h){const m=new Date(s(h));return new Date(m.getFullYear(),m.getMonth(),m.getDate()).getTime()}n.getDateStampByDate=o;function i(h){const m=new Date(s(h)),f=m.getFullYear(),S=m.getMonth()+1,E=m.getDate();return`${f}/${S}/${E}`}n.getDateString=i;function u(h){const m=new Date(s(h)),f=m.getHours(),S=m.getMinutes(),E=f<10?"0"+f:f,F=S<10?"0"+S:S;return`${E}:${F}`}n.getTimeString=u;function c(h){const m=new Date(s(h)),f=m.getFullYear(),S=m.getMonth()+1,E=m.getDate(),F=m.getHours(),R=m.getMinutes(),$=m.getSeconds(),J=S<10?"0"+S:S,Z=E<10?"0"+E:E,ee=F<10?"0"+F:F,te=R<10?"0"+R:R,ne=$<10?"0"+$:$;return`${f}/${J}/${Z} ${ee}:${te}:${ne}`}n.getDateTimeString=c;function g(h){return Array.from(new Set(h))}n.dedupe=g;function C(h){const m=new Set,f=[];for(const S of h)m.has(S.id)||(m.add(S.id),f.push(S));return f}n.dedupeObjectWithId=C;function N(h,m){let f=null;return()=>{f&&clearTimeout(f),f=setTimeout(h,m)}}n.debounce=N;function p(h,m){let f=!0;return()=>{if(!f)return!1;f=!1,setTimeout(()=>{h(),f=!0},m)}}n.throttle=p;function l(h){const m=[],f=Object.keys(h),S=Object.values(h);for(let E=0;E<f.length;++E)S[E]&&m.push(`${f[E]}=${S[E]}`);return m.join("&")}n.iterObjectToParamsString=l;async function x(h){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(h)}catch(m){console.warn("Copy to clipboard failed.",m)}else console.warn("Copy to clipboard failed, methods not supports.")}n.copyTextToClipboard=x;function y(h){return new Promise((m,f)=>{const S=new Image;S.onload=()=>{const{width:E,height:F}=S;E>0&&F>0?m({width:E,height:F}):m({width:0,height:0})},S.onerror=()=>{m({width:0,height:0})},S.className="hidden",S.src=h,document.body.appendChild(S),S.remove()})}n.getImageSize=y})(v||(v={}));function Re(n,e){switch(e.type){case"SET_MEMOS":return{memos:[...e.payload.memos]};case"PUSH_MEMO":return{memos:[e.payload.memo,...n.memos].sort((s,o)=>v.getTimeStampByDate(o.createdAt)-v.getTimeStampByDate(s.createdAt))};case"PUSH_MEMOS":return{memos:[...e.payload.memos,...n.memos].sort((s,o)=>v.getTimeStampByDate(o.createdAt)-v.getTimeStampByDate(s.createdAt))};case"DELETE_MEMO_BY_ID":return{memos:[...n.memos].filter(a=>a.id!==e.payload.id)};case"EDIT_MEMO":return{memos:n.memos.map(s=>s.id===e.payload.id?M(M({},s),e.payload):s)};default:return n}}const $e={memos:[]};function He(n,e){switch(e.type){case"SIGN_IN":return{user:e.payload.user};case"SIGN_OUT":return{user:null};default:return n}}const Qe={user:null},w=_e({globalState:Oe,locationState:Pe,memoState:$e,userState:Qe},Ie({globalState:Le,locationState:Ue,memoState:Re,userState:He})),P=d.exports.createContext(w.getState());var Y;(function(n){function e(o){const i={};for(const u of o)try{const c=localStorage.getItem(u);if(c!==null){const g=JSON.parse(c);i[u]=g}}catch(c){console.error("Get storage failed in ",u,c)}return i}n.get=e;function a(o){for(const i in o)try{const u=JSON.stringify(o[i]);localStorage.setItem(i,u)}catch(u){console.error("Save storage failed in ",i,u)}}n.set=a;function s(){var i;const o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o),(i=o.contentWindow)==null||i.localStorage.setItem("t",Date.now().toString()),o.remove()}n.emitStorageChangedEvent=s})(Y||(Y={}));class Ge{constructor(){O(this,"getState",()=>w.getState().globalState);O(this,"setEditMemoId",e=>{w.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:e}})});O(this,"setMarkMemoId",e=>{w.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:e}})});O(this,"setAppSetting",e=>{w.dispatch({type:"SET_APP_SETTING",payload:e}),Y.set(e)});var s,o,i,u;const e=Y.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser","showDarkMode"]),a={shouldSplitMemoWord:(s=e.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(o=e.shouldHideImageUrl)!=null?o:!0,shouldUseMarkdownParser:(i=e.shouldUseMarkdownParser)!=null?i:!0,showDarkMode:(u=e.showDarkMode)!=null?u:!1};this.setAppSetting(a)}}const U=new Ge,V=()=>{let n=v.iterObjectToParamsString(w.getState().locationState.query);n?n="?"+n:n="",history.replaceState(null,"","/"+n)};class je{constructor(){O(this,"initLocation",()=>{var a,s,o,i,u;const e=new URLSearchParams(window.location.search);this.setTagQuery((a=e.get("tag"))!=null?a:""),this.setFromAndToQuery(parseInt((s=e.get("from"))!=null?s:"0"),parseInt((o=e.get("to"))!=null?o:"0")),this.setMemoTypeQuery((i=e.get("type"))!=null?i:""),this.setTextQuery((u=e.get("text"))!=null?u:"")});O(this,"getState",()=>w.getState().locationState);O(this,"clearQuery",()=>{w.dispatch({type:"SET_TAG_QUERY",payload:{tag:""}}),w.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:0,to:0}}),V()});O(this,"setHash",e=>{w.dispatch({type:"SET_HASH",payload:{hash:e}}),V()});O(this,"setMemoTypeQuery",(e="")=>{w.dispatch({type:"SET_TYPE",payload:{type:e}}),V()});O(this,"setTextQuery",e=>{w.dispatch({type:"SET_TEXT",payload:{text:e}}),V()});O(this,"setTagQuery",e=>{w.dispatch({type:"SET_TAG_QUERY",payload:{tag:e}}),V()});O(this,"setFromAndToQuery",(e,a)=>{w.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:e,to:a}}),V()});this.initLocation()}}const L=new je;var A;(function(n){async function e(b){const W=await(await fetch(b,{method:"GET"})).json();if(!W.succeed)throw W;return W}n.get=e;async function a(b,I){const ae=await(await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)})).json();if(!ae.succeed)throw ae;return ae}n.post=a;function s(){return e("/api/user/me")}n.getUserInfo=s;function o(b,I){return a("/api/user/signin",{username:b,password:I})}n.signin=o;function i(b,I){return a("/api/user/signup",{username:b,password:I})}n.signup=i;function u(){return a("/api/user/signout")}n.signout=u;function c(b){return e("/api/user/checkusername?username="+b)}n.checkUsernameUsable=c;function g(b){return a("/api/user/checkpassword",{password:b})}n.checkPasswordValid=g;function C(b="",I=""){return a("/api/user/update",{username:b,password:I})}n.updateUserinfo=C;function N(b=0,I=20){return e(`/api/memo/all?offset=${b}&amount=${I}`)}n.getMyMemos=N;function p(b){return a("/api/memo/new",{content:b})}n.createMemo=p;function l(b){return e("/api/memo/?id="+b)}n.getMemoById=l;function x(b){return a("/api/memo/delete",{memoId:b})}n.deleteMemo=x;function y(b,I){return a("/api/memo/update",{memoId:b,content:I})}n.updateMemo=y;function h(){return e("/api/memo/count")}n.getMemosCount=h;function m(b){return a("/api/tag/new",{text:b})}n.createTag=m;function f(b,I){return a("/api/tag/link",{memoId:b,tagId:I})}n.createMemoTag=f;function S(b,I){return a("/api/tag/rmlink",{memoId:b,tagId:I})}n.removeMemoTag=S;function E(b){return e("/api/tag/memo?id="+b)}n.getTagsByMemoId=E;function F(){return e("/api/tag/all")}n.getMyTags=F;function R(b){return a("/api/tag/delete",{tagId:b})}n.deleteTagById=R;function $(b){return a("/api/tag/polish",{tagId:b})}n.polishTag=$;function J(b,I){return a("/api/tag/update",{id:b,text:I})}n.updateTagText=J;function Z(){return e("/api/user/amount")}n.getMyDataAmount=Z;function ee(b){return e("/api/base/srctype?url="+b)}n.getUrlContentType=ee;function te(){return e("/api/memo/stat")}n.getMemosStat=te;function ne(){return a("/api/user/updategh",{githubName:""})}n.removeGithubName=ne})(A||(A={}));const re="div#page-container",ce="mobile-show-sidebar",Ye=20,ie=200,Ve=400,Q=3600*24*1e3,z=/#\s(.+?)\s/g,ye=/(https?:\/\/[^\s<\\*>']+)/g,q=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,Ne=/\[\@(.+?)\]\((.+?)\)/g,le=[{type:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{type:"LINKED",text:"\u6709\u94FE\u63A5"},{type:"IMAGED",text:"\u6709\u56FE\u7247"}];class qe{getState(){return w.getState().userState}async doSignIn(){const{data:e}=await A.getUserInfo();return e?w.dispatch({type:"SIGN_IN",payload:{user:e}}):B.doSignOut(),e}async doSignOut(){A.signout().catch(()=>{}),w.dispatch({type:"SIGN_OUT",payload:{user:null}})}async checkUsernameUsable(e){const{data:a}=await A.checkUsernameUsable(e);return a}async updateUsername(e){await A.updateUserinfo(e)}async removeGithubName(){await A.removeGithubName()}async checkPasswordValid(e){const{data:a}=await A.checkPasswordValid(e);return a}async updatePassword(e){await A.updateUserinfo("",e)}}const B=new qe;class Ke{constructor(){O(this,"isFetching",!1)}getState(){return w.getState().memoState}async fetchMoreMemos(){if(!B.getState().user||this.isFetching)return!1;this.isFetching=!0;const{data:e}=await A.getMyMemos(this.getState().memos.length,Ye),a=e.map(s=>M({},s));return w.dispatch({type:"PUSH_MEMOS",payload:{memos:a}}),this.isFetching=!1,a}async fetchAllMemos(){if(!B.getState().user)return!1;this.isFetching=!0;const{data:{memosAmount:e}}=await A.getMyDataAmount(),{data:a}=await A.getMyMemos(0,e),s=a.map(o=>M({},o));return s.length>0&&w.dispatch({type:"SET_MEMOS",payload:{memos:s}}),this.isFetching=!1,a}pushMemo(e){w.dispatch({type:"PUSH_MEMO",payload:{memo:M({},e)}})}async getMemoById(e){for(const s of this.getState().memos)if(s.id===e)return s;const{data:a}=await A.getMemoById(e);return a}async deleteMemoById(e){await A.deleteMemo(e),w.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:e}})}editMemo(e){w.dispatch({type:"EDIT_MEMO",payload:e})}clearMemos(){w.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(e){const{data:a}=await A.createMemo(e);return a}async updateMemo(e,a){const{data:s}=await A.updateMemo(e,a);return s}async createTag(e){const{data:a}=await A.createTag(e);return a}async removeMemoTag(e,a){await A.removeMemoTag(e,a)}async createMemoTag(e,a){await A.createMemoTag(e,a)}async getMyDataAmount(){const{data:e}=await A.getMyDataAmount();return e}async getMemosStat(){const{data:e}=await A.getMemosStat();return e}async getMyTags(){if(!B.getState().user)return[];const{data:e}=await A.getMyTags();return e}async polishTag(e){await A.polishTag(e)}async updateTagText(e,a){await A.updateTagText(e,a)}}const D=new Ke,We=()=>{const{userState:{user:n}}=d.exports.useContext(P),e=n?n.username:"Memos",a=d.exports.useCallback(()=>{L.clearQuery()},[]),s=d.exports.useCallback(()=>{const o=document.querySelector(re);o&&o.classList.add(ce)},[]);return r("div",{className:"mobile-header-container",children:[t("p",{className:"username-text",onClick:a,children:e}),t("div",{className:"btns-container",children:t("button",{className:"action-btn show-sidebar",onClick:s,children:t("img",{className:"icon-img",src:"/icons/fold.svg",alt:"fold"})})})]})},ze=/```([\s\S]*?)```/g,Xe=/\*\*(.+?)\*\*/g,Je=/\[ \] /g,Ze=/\[x\] /g,et=/[*] /g,tt=/(\d+)\. /g,nt=n=>n.replace(ze,"<pre lang=''>$1</pre>").replace(Xe,"<b>$1</b>").replace(et,"<span class='counter-block'>\u2022</span>").replace(tt,"<span class='counter-block'>$1.</span>").replace(Je,"<span class='todo-block' data-type='todo'>\u2B1C\uFE0F</span>").replace(Ze,"<span class='todo-block' data-type='done'>\u2714\uFE0F</span>"),ue=n=>{const e=document.createElement("div");e.className="memo-content-text",e.innerHTML=n,document.body.appendChild(e);const a=e.innerText;return e.remove(),a},at=n=>n.replace(/\n/g,"<br>");const st=n=>{const{destory:e,duration:a}=n;return d.exports.useEffect(()=>{a>0&&setTimeout(()=>{e()},a)},[]),t("div",{className:"toast-container",onClick:e,children:t("p",{className:"content-text",children:n.content})})},T=(()=>{const n=document.createElement("div");n.className="toast-list-container",document.body.appendChild(n);let e=0;const a=[],s=u=>{const c=document.createElement("div");c.className=`toast-wrapper ${u.type}`,n.appendChild(c),e++,a.push(c),setTimeout(()=>{c.classList.add("showup")},0);const g={destory:()=>{c.classList.add("destory"),setTimeout(()=>{if(!!c.parentElement&&(e--,e===0)){for(const C of a)j.unmountComponentAtNode(C),C.remove();a.splice(0,a.length)}},Ve)}};return j.render(t(st,k(M({},u),{destory:g.destory})),c),g};return{info:(u,c=3e3)=>s({type:"normal",content:u,duration:c}),error:(u,c=3e3)=>s({type:"error",content:u,duration:c})}})(),ot=n=>{const{children:e,when:a}=n;return a?t(_,{children:e}):null},G=ot;function rt(){const[n,e]=d.exports.useState(!1);return d.exports.useCallback(()=>{e(s=>!s)},[])}const ct=d.exports.forwardRef((n,e)=>{var f,S;const{className:a,initialContent:s,placeholder:o,showConfirmBtn:i,showCancelBtn:u,showTools:c,onConfirmBtnClick:g,onCancelBtnClick:C,onContentChange:N}=n,p=d.exports.useRef(null),l=rt();d.exports.useEffect(()=>{s&&(p.current.value=s)},[]),d.exports.useEffect(()=>{var E;p.current&&(p.current.style.height="auto",p.current.style.height=((E=p.current.scrollHeight)!=null?E:0)+"px")},[(f=p.current)==null?void 0:f.value]),d.exports.useImperativeHandle(e,()=>({focus:()=>{p.current.focus()},insertText:E=>{p.current.value&&(E=`
`+E),p.current.value+=E,N(p.current.value),l()},setContent:E=>{p.current.value=ue(E),l()},getContent:()=>{var E,F;return(F=(E=p.current)==null?void 0:E.value)!=null?F:""}}),[]);const x=d.exports.useCallback(()=>{N(p.current.value),l()},[]),y=d.exports.useCallback(E=>{E.stopPropagation(),l()},[]),h=d.exports.useCallback(()=>{g(p.current.value),p.current.value="",l()},[]),m=d.exports.useCallback(()=>{C()},[]);return r("div",{className:"common-editor-wrapper "+a,children:[t("textarea",{className:"common-editor-inputer",rows:1,placeholder:o,ref:p,onInput:x,onKeyDown:y}),r("div",{className:"common-tools-wrapper",children:[t(G,{when:c,children:t("div",{className:"common-tools-container"})}),r("div",{className:"btns-right-container",children:[t(G,{when:u,children:t("button",{className:"action-btn cancel-btn",onClick:m,children:"\u64A4\u9500\u4FEE\u6539"})}),t(G,{when:i,children:r("button",{className:"action-btn confirm-btn",disabled:((S=p.current)==null?void 0:S.value)==="",onClick:h,children:["\u8BB0\u4E0B",t("span",{className:"icon-text",children:"\u270D\uFE0F"})]})})]})]})]})});const it=()=>{const{globalState:n}=d.exports.useContext(P),e=d.exports.useRef(null);d.exports.useEffect(()=>{var c;if(n.markMemoId){const g=`Mark: [@MEMO](${n.markMemoId})`;(c=e.current)==null||c.insertText(g)}n.editMemoId&&D.getMemoById(n.editMemoId).then(g=>{var C,N,p;g&&((N=e.current)==null||N.setContent((C=g.content)!=null?C:""),(p=e.current)==null||p.focus())})},[n]);const a=d.exports.useCallback(async c=>{var l,x;if(c===""){T.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}const{editMemoId:g}=U.getState(),{query:C}=L.getState();c=ue(c.replaceAll("&nbsp;"," "));const N=v.dedupe(Array.from((l=c.match(z))!=null?l:[])).map(y=>y.replace(z,"$1").trim()),p=[];try{for(const y of N){const h=await D.createTag(y);p.push(h)}if(g){const y=await D.getMemoById(g);if(y&&y.content!==c){const h=(x=y.tags)!=null?x:[],m=h.map(S=>S.text);p.push(...h);for(let S=0;S<p.length;){const E=p[S],F=E.text;N.includes(F)?(S++,m.includes(F)||await D.createMemoTag(y.id,E.id)):(p.splice(S,1),await D.removeMemoTag(y.id,E.id))}const f=await D.updateMemo(y.id,c);f.tags=p,f.updatedAt=v.getDateTimeString(Date.now()),D.editMemo(f)}U.setEditMemoId("")}else{const y=await D.createMemo(c);y.tags=p;for(const m of p)await D.createMemoTag(y.id,m.id);const h=C.tag;h!==""&&!N.includes(h)&&L.setTagQuery(""),D.pushMemo(y)}}catch(y){T.error(y.message)}de("")},[]),s=d.exports.useCallback(()=>{var c;U.setEditMemoId(""),(c=e.current)==null||c.setContent(""),de("")},[]),o=d.exports.useCallback(c=>{const g=document.createElement("div");g.innerHTML=c,g.innerText.trim()===""&&(c=""),de(c)},[]),{editMemoId:i}=n,u=d.exports.useMemo(()=>({className:"memo-editor",initialContent:lt(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,showCancelBtn:i!=="",showTools:!0,onConfirmBtnClick:a,onCancelBtnClick:s,onContentChange:o}),[i]);return r("div",{className:"memo-editor-wrapper "+(i?"edit-ing":""),children:[t("p",{className:"tip-text "+(i?"":"hidden"),children:"\u6B63\u5728\u4FEE\u6539\u4E2D..."}),t(ct,M({ref:e},u))]})};function lt(){var n;return(n=Y.get(["editorContentCache"]).editorContentCache)!=null?n:""}function de(n){Y.set({editorContentCache:n})}function ut(n,e,a=[]){const s=d.exports.useRef(),o=d.exports.useCallback(()=>{s.current&&clearTimeout(s.current)},[]);return d.exports.useCallback((...u)=>{o(),s.current=window.setTimeout(()=>{n(...u)},e)},a)}function me(n=!1){const[e,a]=d.exports.useState(n),s=d.exports.useCallback(o=>{a(o!==void 0?o:i=>!i)},[]);return[e,s]}const dt=n=>{const{children:e,className:a,clickSpaceDestroy:s,destroy:o}=n,i=()=>{s&&o()};return t("div",{className:`dialog-wrapper ${a}`,onClick:i,children:t("div",{className:"dialog-container",onClick:u=>u.stopPropagation(),children:e})})};function H(n,e,a){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var c;(c=s.firstElementChild)==null||c.classList.add("showup")},0);const o={destroy:()=>{var c,g;(c=s.firstElementChild)==null||c.classList.remove("showup"),(g=s.firstElementChild)==null||g.classList.add("showoff"),setTimeout(()=>{s.remove(),j.unmountComponentAtNode(s)},ie)}},i=k(M({},a),{destroy:o.destroy});let u=t(dt,k(M({destroy:o.destroy,clickSpaceDestroy:!0},n),{children:t(e,M({},i))}));return n.useAppContext&&(u=t(fe,{store:w,context:P,children:u})),j.render(u,s),o}const mt=({destroy:n,imgUrl:e})=>{const a=d.exports.useRef(null),[s,o]=d.exports.useState(-1);d.exports.useEffect(()=>{v.getImageSize(e).then(({width:g})=>{o(g!==0?80:0)})},[]);const i=()=>{n()},u=()=>{s>30&&o(s-10)},c=()=>{o(s+10)};return r(_,{children:[t("button",{className:"text-btn close-btn",onClick:i,children:t("img",{className:"icon-img",src:"/icons/close.svg"})}),r("div",{className:"img-container",children:[t("img",{className:s<=0?"hidden":"",ref:a,width:s+"%",src:e}),t("span",{className:"loading-text "+(s===-1?"":"hidden"),children:"\u56FE\u7247\u52A0\u8F7D\u4E2D..."}),t("span",{className:"loading-text "+(s===0?"":"hidden"),children:"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5"})]}),r("div",{className:"action-btns-container",children:[t("button",{className:"text-btn",onClick:u,children:"\u2796"}),t("button",{className:"text-btn",onClick:c,children:"\u2795"}),t("button",{className:"text-btn",onClick:()=>o(80),children:"\u2B55"})]})]})};function xe(n){H({className:"preview-image-dialog"},mt,{imgUrl:n})}const Ce=n=>{const{className:e,imgUrl:a}=n,s=()=>{xe(a)};return t("div",{className:"image-container "+e,onClick:s,children:t("img",{src:a,decoding:"async",loading:"lazy"})})};const ht=n=>{var p;const{memoId:e,destroy:a}=n,[s,o]=d.exports.useState(),[i,u]=d.exports.useState([]),[c,g]=d.exports.useState([]);d.exports.useEffect(()=>{(async()=>{var y;const x=await D.getMemoById(e);x&&(g(Array.from((y=x.content.match(q))!=null?y:[])),o(k(M({},x),{formattedContent:K(x.content),createdAtStr:v.getDateTimeString(x.createdAt)})))})()},[]),d.exports.useEffect(()=>{(async()=>{if(!s)return;const x=[],y=[...s.content.matchAll(Ne)];for(const h of y)if(h&&h.length===3){const m=h[2],f=await D.getMemoById(m);f&&(x.push(k(M({},f),{formattedContent:K(f.content),createdAtStr:v.getDateTimeString(f.createdAt)})),u([...x]))}})()},[s]);const C=async l=>{var y;const x=l.target;if(x.className==="memo-link-text"){const h=(y=x.dataset)==null?void 0:y.value;h&&await D.getMemoById(h)&&(a(),X(h))}},N=l=>{a(),X(l)};return r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F4E6}"}),"Memo Story"]}),t("button",{className:"text-btn close-btn",onClick:a,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("div",{className:"memo-container current",children:[t("div",{className:"memo-header-container",children:t("p",{className:"time-text",children:s==null?void 0:s.createdAtStr})}),t("div",{className:"memo-content-text",onClick:C,dangerouslySetInnerHTML:{__html:(p=s==null?void 0:s.formattedContent)!=null?p:""}}),t(G,{when:c.length>0,children:t("div",{className:"images-wrapper",children:c.map((l,x)=>t(Ce,{className:"memo-img",imgUrl:l},x))})})]}),r("p",{className:"normal-text "+(i.length===0?"hidden":""),children:["\u94FE\u63A5\u4E86 ",i.length," \u4E2A Memo"]}),t("div",{className:"down-memos-wrapper "+(i.length!==0?"":"hidden"),children:i.map(l=>r("div",{className:"memo-container",children:[t("div",{className:"memo-header-container",children:t("p",{className:"time-text",onClick:()=>{N(l.id)},children:l.createdAtStr})}),t("div",{className:"memo-content-text",onClick:C,dangerouslySetInnerHTML:{__html:l.formattedContent}})]},l.id))})]})]})};function X(n){H({className:"memo-story-dialog"},ht,{memoId:n})}const pt=n=>{var x;const{memo:e,destroy:a}=n,[s,o]=d.exports.useState(""),i=d.exports.useRef(null),{user:u}=B.getState(),c=k(M({},e),{formattedContent:K(e.content),createdAtStr:v.getDateTimeString(e.createdAt)}),g=Array.from((x=c.content.match(q))!=null?x:[]),[C,N]=d.exports.useState(g.length);d.exports.useEffect(()=>{setTimeout(()=>{if(C===0){const y=v.getOSVersion();(y==="MacOS"||y==="Unknown")&&window.scrollTo(0,0),html2canvas(i.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:U.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(h=>{o(h.toDataURL())})}},ie+100)},[C]);const p=()=>{a()},l=y=>{y.type==="error"&&(T.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),y.target.remove()),N(C-1)};return r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F970}"}),"\u5206\u4EAB Memo \u56FE\u7247"]}),t("button",{className:"text-btn close-btn",onClick:p,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[t("div",{className:`tip-words-container ${s?"finished":"genarating"}`,children:t("p",{className:"tip-text",children:s?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D..."})}),t("img",{className:"memo-img",src:s}),r("div",{className:"memo-container",ref:i,children:[t("span",{className:"time-text",children:c.createdAtStr}),t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:c.formattedContent}}),t(G,{when:g.length>0,children:t("div",{className:"images-container",children:g.map((y,h)=>t("img",{crossOrigin:"anonymous",src:y,onLoad:l,onError:l,decoding:"async"},h))})}),t("div",{className:"watermark-container",children:r("span",{className:"normal-text",children:["by ",t("span",{className:"name-text",children:u==null?void 0:u.username})]})})]})]})]})};function gt(n){H({className:"share-memo-image-dialog"},pt,{memo:n})}const ft=n=>{var x;const{memo:e}=n,a=k(M({},e),{formattedContent:K(e.content),createdAtStr:v.getDateTimeString(e.createdAt)}),[s,o]=me(!1),i=Array.from((x=a.content.match(q))!=null?x:[]),u=()=>{X(a.id)},c=()=>{U.setMarkMemoId(a.id)},g=()=>{U.setEditMemoId(a.id)},C=async()=>{if(s){try{await D.deleteMemoById(a.id),await D.fetchMoreMemos()}catch(y){T.error(y.message)}U.getState().editMemoId===a.id&&U.setEditMemoId("")}else o()},N=()=>{s&&o(!1)},p=()=>{gt(a)},l=async y=>{var m;const h=y.target;if(h.className==="memo-link-text"){const f=(m=h.dataset)==null?void 0:m.value;f&&await D.getMemoById(f)&&X(f)}else h.className==="todo-block"};return r("div",{className:`memo-wrapper ${"memos-"+a.id}`,onMouseLeave:N,children:[r("div",{className:"memo-top-wrapper",children:[t("span",{className:"time-text",onClick:u,children:a.createdAtStr}),r("div",{className:"btns-container",children:[t("span",{className:"text-btn more-action-btn",children:t("img",{className:"icon-img",src:"/icons/more.svg"})}),t("div",{className:"more-action-btns-wrapper",children:r("div",{className:"more-action-btns-container",children:[t("span",{className:"text-btn",onClick:c,children:"Mark"}),t("span",{className:"text-btn",onClick:p,children:"\u5206\u4EAB"}),t("span",{className:"text-btn",onClick:g,children:"\u7F16\u8F91"}),t("span",{className:`text-btn delete-btn ${s?"final-confirm":""}`,onClick:C,children:s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]}),t("div",{className:"memo-content-text",onClick:l,dangerouslySetInnerHTML:{__html:a.formattedContent}}),t(G,{when:i.length>0,children:t("div",{className:"images-wrapper",children:i.map((y,h)=>t(Ce,{className:"memo-img",imgUrl:y},h))})})]})};function K(n){var i;const e=document.createElement("div");e.innerHTML=at(n).split("<br>").map(u=>u!==""?`<p>${u}</p>`:"<br>").join(""),n=e.innerHTML;const{shouldUseMarkdownParser:a,shouldSplitMemoWord:s,shouldHideImageUrl:o}=U.getState();a&&(n=nt(n)),o&&(n=n.replace(q,"")),e.innerHTML=n;for(const u of e.querySelectorAll("p"))u.textContent===""&&((i=u.firstElementChild)==null?void 0:i.tagName)!=="BR"&&u.remove();return n=e.innerHTML,n=n.replace(z,"<span class='tag-span'>#$1</span>").replace(ye,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(Ne,"<span class='memo-link-text' data-value='$2'>$1</span>"),s&&(n=n.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5]?)/g,"$1 $2 $3")),n}var yt=d.exports.memo(ft);const Nt=n=>{for(const e of le)if(e.type===n)return e.text;return""},xt=()=>{const{locationState:{query:n},memoState:{memos:e}}=d.exports.useContext(P),[a,s]=d.exports.useState(!1),[o,i]=d.exports.useState(!1),u=d.exports.useRef(null),c=n.tag,g={from:n.from,to:n.to},C=n.type,N=n.text,p=Boolean(c||g.from!==0&&g.from<g.to||C||N),l=e.filter(m=>{let f=!0;const S=[];for(const E of m.tags){const F=E.text.split("/");let R="";for(let $=0;$<F.length;$++)$===0?R+=F[$]:R+="/"+F[$],S.push(R)}return c!==""&&!S.includes(c)&&(f=!1),g.from!==0&&g.from<g.to&&(v.getTimeStampByDate(m.createdAt)<g.from||v.getTimeStampByDate(m.createdAt)>g.to)&&(f=!1),C!==""&&(C==="NOT_TAGGED"?m.content.match(z)!==null&&(f=!1):C==="LINKED"?m.content.match(ye)===null&&(f=!1):C==="IMAGED"&&m.content.match(q)===null&&(f=!1)),N!==""&&!m.content.includes(N)&&(f=!1),f});d.exports.useEffect(()=>{var m;(m=u.current)==null||m.scrollTo({top:0}),!o&&p&&(s(!0),D.fetchAllMemos().then(f=>{f!==!1&&(i(!0),s(!1))}))},[o,p]);const x=async()=>{if(!(a||o)){s(!0);try{const m=await D.fetchMoreMemos();Array.isArray(m)&&m.length===0&&i(!0)}catch(m){T.error(m.message)}s(!1)}},y=d.exports.useCallback(m=>{const f=m.target;if(f.tagName==="SPAN"&&f.className==="tag-span"){const S=f.innerText.slice(1);L.getState().query.tag===S?L.setTagQuery(""):L.setTagQuery(S)}},[]),h=ut(()=>{if(a||o)return;const{offsetHeight:m,scrollTop:f,scrollHeight:S}=u.current;m+f+10>S&&x()},100,[a,o]);return r("div",{className:`memolist-wrapper ${o?"completed":""}`,onClick:y,onScroll:h,ref:u,children:[t(Ct,{showFilter:p,tagQuery:c,duration:g,memoType:C,textQuery:N}),l.map(m=>t(yt,{memo:m},`${m.id}-${m.updatedAt}`)),p?t("div",{className:"status-text-container",children:t("p",{className:"status-text",children:a?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":o&&l.length===0?"\u7A7A\u7A7A\u5982\u4E5F":""})}):t("div",{className:`status-text-container ${o?"completed":""} ${a||o?"":"invisible"}`,children:t("p",{className:"status-text",children:o?"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}":"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})})]})},Ct=n=>{const{showFilter:e,tagQuery:a,duration:s,memoType:o,textQuery:i}=n;return r("div",{className:`filter-query-container ${e?"":"hidden"}`,children:[t("span",{className:"tip-text",children:"\u7B5B\u9009\uFF1A"}),r("div",{className:"filter-item-container "+(s.from!==0&&s.from<s.to?"":"hidden"),onClick:()=>{L.setFromAndToQuery(0,0)},children:[t("span",{className:"icon-text",children:"\u{1F5D3}\uFE0F"})," ",v.getDateString(s.from)," \u81F3 ",v.getDateString(s.to)]}),r("div",{className:"filter-item-container "+(a?"":"hidden"),onClick:()=>{L.setTagQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"})," ",a]}),r("div",{className:"filter-item-container "+(o?"":"hidden"),onClick:()=>{L.setMemoTypeQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F4E6}"})," ",Nt(o)]}),r("div",{className:"filter-item-container "+(i?"":"hidden"),onClick:()=>{L.setTextQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F50D}"})," ",i]})]})};const St=({destroy:n})=>{const{userState:e}=d.exports.useContext(P),a=e.user,[s,o]=d.exports.useState(a.username),[i,u]=d.exports.useState(!1),[c,g]=d.exports.useState(!1),C=()=>{n()},N=h=>{const m=h.target.value;o(m)},p=async()=>{if(a.username==="guest"){T.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(s===a.username){u(!1);return}try{if(!await B.checkUsernameUsable(s)){T.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await B.updateUsername(s),await B.doSignIn(),u(!1),T.info("\u4FEE\u6539\u6210\u529F~")}catch(h){T.error(h.message)}},l=()=>{if(a.username==="guest"){T.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}bt()},x=async()=>{if(c){try{await B.removeGithubName(),await B.doSignIn()}catch(h){T.error(h.message)}g(!1)}else g(!0)},y=h=>{h.preventDefault()};return r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F920}"}),"\u6211\u7684\u8D26\u53F7"]}),t("button",{className:"text-btn close-btn",onClick:C,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("div",{className:"section-container account-section-container",children:[t("p",{className:"title-text",children:"\u57FA\u672C\u4FE1\u606F"}),r("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"ID\uFF1A"}),t("span",{className:"normal-text",children:a.id})]}),r("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"\u521B\u5EFA\u65F6\u95F4\uFF1A"}),t("span",{className:"normal-text",children:v.getDateString(a.createdAt)})]}),r("label",{className:"form-label input-form-label username-label",children:[t("span",{className:"normal-text",children:"\u8D26\u53F7\uFF1A"}),t("input",{type:"text",readOnly:!i,value:s,onClick:()=>{u(!0)},onChange:N}),r("div",{className:"btns-container",onClick:y,children:[t("span",{className:"text-btn confirm-btn "+(i?"":"hidden"),onClick:p,children:"\u4FDD\u5B58"}),t("span",{className:"text-btn cancel-btn "+(i?"":"hidden"),onClick:()=>{o(a.username),u(!1)},children:"\u64A4\u9500"})]})]}),r("label",{className:"form-label password-label",children:[t("span",{className:"normal-text",children:"\u5BC6\u7801\uFF1A"}),t("span",{className:"text-btn",onClick:l,children:"\u4FEE\u6539\u5BC6\u7801"})]})]}),r("div",{className:"section-container account-section-container",children:[t("p",{className:"title-text",children:"\u5173\u8054\u8D26\u53F7"}),r("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"GitHub\uFF1A"}),a.githubName?r(_,{children:[t("a",{className:"value-text",href:"https://github.com/"+a.githubName,children:a.githubName}),t("span",{className:`btn-text unbind-btn ${c?"final-confirm":""}`,onMouseLeave:()=>g(!1),onClick:x,children:c?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A"})]}):r(_,{children:[t("span",{className:"value-text",children:"\u65E0"}),t("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"\u524D\u5F80\u7ED1\u5B9A"})]})]})]})]})]})},Et=({destroy:n})=>{const[e,a]=d.exports.useState(""),[s,o]=d.exports.useState(""),[i,u]=d.exports.useState("");d.exports.useEffect(()=>{},[]);const c=()=>{n()},g=l=>{const x=l.target.value;a(x)},C=l=>{const x=l.target.value;o(x)},N=l=>{const x=l.target.value;u(x)},p=async()=>{if(e===""||s===""||i===""){T.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==i){T.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),u("");return}try{if(!await B.checkPasswordValid(e)){T.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),a("");return}await B.updatePassword(s),T.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),c()}catch(l){T.error(l)}};return r(_,{children:[r("div",{className:"dialog-header-container",children:[t("p",{className:"title-text",children:"\u4FEE\u6539\u5BC6\u7801"}),t("button",{className:"text-btn close-btn",onClick:c,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[t("p",{className:"tip-text",children:"\u5982\u679C\u662F GitHub \u767B\u5F55\uFF0C\u5219\u521D\u59CB\u5BC6\u7801\u4E3A\u7528\u6237\u540D"}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:e,onChange:g}),t("span",{className:"normal-text "+(e===""?"":"not-null"),children:"\u65E7\u5BC6\u7801"})]}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:s,onChange:C}),t("span",{className:"normal-text "+(s===""?"":"not-null"),children:"\u65B0\u5BC6\u7801"})]}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:i,onChange:N}),t("span",{className:"normal-text "+(i===""?"":"not-null"),children:"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801"})]}),r("div",{className:"btns-container",children:[t("span",{className:"text-btn cancel-btn",onClick:c,children:"\u53D6\u6D88"}),t("span",{className:"text-btn confirm-btn",onClick:p,children:"\u4FDD\u5B58"})]})]})]})};function bt(){H({className:"change-password-dialog"},Et)}function vt(){H({className:"my-account-dialog",useAppContext:!0},St)}const Dt=({destroy:n})=>r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E ",t("b",{children:"Memos"})]}),t("button",{className:"text-btn close-btn",onClick:()=>{n()},children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[t("p",{children:"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"}),t("br",{}),t("i",{children:"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"}),r("ul",{children:[t("li",{children:"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5}\u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1}\u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5}\u8BFB\u540E\u611F..."}),t("li",{children:"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"}),t("li",{children:"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B"})]}),t("br",{}),t("i",{children:"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"}),r("ul",{children:[r("li",{children:["\u2728"," ",t("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer",children:"\u5F00\u6E90\u9879\u76EE"})]}),t("li",{children:"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"}),t("li",{children:"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B"})]}),t("br",{}),t("p",{children:"Enjoy it and have fun~ "}),t("hr",{}),r("p",{className:"normal-text",children:["Last update at ",t("span",{className:"pre-text",children:"2021/10/08 21:34:39"})," \u{1F389}"]})]})]});function Se(){H({className:"about-site-dialog"},Dt)}const Mt=({destroy:n})=>{const{globalState:{shouldHideImageUrl:e,shouldSplitMemoWord:a,shouldUseMarkdownParser:s,showDarkMode:o}}=d.exports.useContext(P);return d.exports.useEffect(()=>{},[]),r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u2699\uFE0F"}),"\u504F\u597D\u8BBE\u7F6E"]}),t("button",{className:"text-btn close-btn",onClick:()=>{n()},children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("div",{className:"section-container preferences-section-container",children:[t("p",{className:"title-text",children:"\u5E38\u89C4"}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"\u6DF1\u8272\u6A21\u5F0F"}),t("img",{className:"icon-img",src:o?"/icons/check-active.svg":"/icons/check.svg"}),t("input",{className:"hidden",type:"checkbox",checked:o,onChange:l=>{const x=l.target.checked;U.setAppSetting({showDarkMode:x})}})]})]}),r("div",{className:"section-container preferences-section-container",children:[t("p",{className:"title-text",children:"Memo \u663E\u793A\u76F8\u5173"}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"}),t("img",{className:"icon-img",src:a?"/icons/check-active.svg":"/icons/check.svg"}),t("input",{className:"hidden",type:"checkbox",checked:a,onChange:l=>{const x=l.target.checked;U.setAppSetting({shouldSplitMemoWord:x})}})]}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"}),t("img",{className:"icon-img",src:e?"/icons/check-active.svg":"/icons/check.svg"}),t("input",{className:"hidden",type:"checkbox",checked:e,onChange:l=>{const x=l.target.checked;U.setAppSetting({shouldHideImageUrl:x})}})]}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"markdown \u683C\u5F0F\u89E3\u6790"}),t("img",{className:"icon-img",src:s?"/icons/check-active.svg":"/icons/check.svg"}),t("input",{className:"hidden",type:"checkbox",checked:s,onChange:l=>{const x=l.target.checked;U.setAppSetting({shouldUseMarkdownParser:x})}}),t("span",{className:"tip-text",children:"\u652F\u6301\u5217\u8868\u3001\u52A0\u7C97\u3001\u4EE3\u7801\u5757"})]})]}),r("div",{className:"section-container hidden",children:[t("p",{className:"title-text",children:"\u5176\u4ED6"}),r("div",{className:"btn-container",children:[t("button",{className:"btn export-btn",onClick:async()=>{await D.fetchAllMemos();const l=D.getState().memos.map(h=>k(M({},h),{tags:h.tags.map(m=>m.text)})),x=JSON.stringify(l),y=document.createElement("a");y.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(x)),y.setAttribute("download","data.json"),y.style.display="none",document.body.appendChild(y),y.click(),document.body.removeChild(y)},children:"\u5BFC\u51FA\u6570\u636E(JSON)"}),t("button",{className:"btn clean-btn",onClick:async()=>{await D.fetchAllMemos();for(const l of D.getState().memos)await D.updateMemo(l.id,ue(l.content))},children:"Memo Clean"})]})]})]})]})};function wt(){H({className:"preferences-dialog",useAppContext:!0},Mt)}const Tt=({destroy:n})=>{const{locationState:{query:{text:e,type:a}}}=d.exports.useContext(P),s=d.exports.useRef(null);d.exports.useEffect(()=>{var c;(c=s.current)==null||c.focus()},[]);const o=c=>{const{type:g}=L.getState().query;c===g&&(c=""),L.setMemoTypeQuery(c)};return r(_,{children:[r("div",{className:"search-bar-inputer",children:[t("img",{className:"icon-img",src:"/icons/search.svg"}),t("input",{className:"text-input",type:"text",placeholder:"Search for memos",ref:s,value:e,onChange:c=>{const g=c.currentTarget.value;L.setTextQuery(g)},onKeyPress:c=>{c.code==="Enter"&&n()}})]}),r("div",{className:"special-type-selector",children:[t("p",{className:"title-text",children:"QUICKLY FILTER"}),r("div",{className:"section-container types-container",children:[t("span",{className:"section-text",children:"Type:"}),le.map((c,g)=>r("div",{children:[t("span",{className:`type-item ${a===c.type?"selected":""}`,onClick:()=>{o(c.type)},children:c.text}),g+1<le.length?t("span",{className:"split-text",children:"/"}):null]},c.type))]})]})]})},Ee=()=>{const n="search-bar-dialog-wrapper",e=document.querySelector(`.${n}`);e&&e.parentElement?(e.classList.remove("showup"),e.classList.add("showoff"),setTimeout(()=>{e&&e.parentElement&&(e.parentElement.remove(),j.unmountComponentAtNode(e.parentElement))},ie)):H({className:n,useAppContext:!0},Tt)};const Ft=({visibility:n})=>{const e=()=>{wt()},a=()=>{Se()},s=()=>{B.doSignOut(),location.reload()},o=()=>{Ee()};return r("div",{className:"menu-btns-popup "+(n?"":"hidden"),children:[r("button",{className:"text-btn action-btn",onClick:vt,children:[t("span",{className:"icon",children:"\u{1F920}"})," \u6211\u7684\u8D26\u53F7"]}),r("button",{className:"text-btn action-btn",onClick:e,children:[t("span",{className:"icon",children:"\u2699\uFE0F"})," \u504F\u597D\u8BBE\u7F6E"]}),r("button",{className:"text-btn action-btn",onClick:o,children:[t("span",{className:"icon",children:"\u{1F50D}"})," \u641C\u7D22"]}),r("button",{className:"text-btn action-btn",onClick:a,children:[t("span",{className:"icon",children:"\u{1F600}"})," \u5173\u4E8E"]}),r("button",{className:"text-btn action-btn",onClick:s,children:[t("span",{className:"icon",children:"\u{1F44B}"})," \u9000\u51FA"]})]})};function he(){const[n,e]=d.exports.useState({isLoading:!0,isFailed:!1,isSucceed:!1});return k(M({},n),{setLoading:()=>{e(k(M({},n),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{e(k(M({},n),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{e(k(M({},n),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const kt=n=>{var o;const{memo:e}=n,a=k(M({},e),{formattedContent:K(e.content),createdAtStr:v.getDateTimeString(e.createdAt),timeStr:v.getTimeString(e.createdAt)}),s=Array.from((o=a.content.match(q))!=null?o:[]);return r("div",{className:"daily-memo-wrapper",children:[t("div",{className:"time-wrapper",children:t("span",{className:"normal-text",children:a.timeStr})}),r("div",{className:"memo-content-container",children:[t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:a.formattedContent}}),t(G,{when:s.length>0,children:t("div",{className:"images-container",children:s.map((i,u)=>t("img",{crossOrigin:"anonymous",src:i,decoding:"async"},u))})})]})]})};const At=n=>{const{className:e,datestamp:a,handleDateStampChange:s}=n,[o,i]=d.exports.useState(pe(a));d.exports.useEffect(()=>{i(pe(a))},[a]);const u=new Date(o),c=u.getDay()===0?7:u.getDay(),g=[];for(let l=1;l<c;l++)g.push({date:0,datestamp:u.getTime()-Q*(7-l)});const C=Bt(o);for(let l=1;l<=C;l++)g.push({date:l,datestamp:u.getTime()+Q*(l-1)});const N=l=>{s(l)},p=l=>{const x=u.getFullYear(),y=u.getMonth()+1;let h=0;y===1&&l===-1?h=new Date(`${x-1}/12/1`).getTime():y===12&&l===1?h=new Date(`${x+1}/1/1`).getTime():h=new Date(`${x}/${y+l}/1`).getTime(),i(pe(h))};return r("div",{className:`date-picker-wrapper ${e}`,children:[r("div",{className:"date-picker-header",children:[t("span",{className:"btn-text",onClick:()=>p(-1),children:t("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),r("span",{className:"normal-text",children:[u.getFullYear()," \u5E74 ",u.getMonth()+1," \u6708"]}),t("span",{className:"btn-text",onClick:()=>p(1),children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),r("div",{className:"date-picker-day-container",children:[r("div",{className:"date-picker-day-header",children:[t("span",{className:"day-item",children:"\u5468\u4E00"}),t("span",{className:"day-item",children:"\u5468\u4E8C"}),t("span",{className:"day-item",children:"\u5468\u4E09"}),t("span",{className:"day-item",children:"\u5468\u56DB"}),t("span",{className:"day-item",children:"\u5468\u4E94"}),t("span",{className:"day-item",children:"\u5468\u516D"}),t("span",{className:"day-item",children:"\u5468\u65E5"})]}),g.map(l=>l.date===0?t("span",{className:"day-item null",children:""},l.datestamp):t("span",{className:`day-item ${l.datestamp===a?"current":""}`,onClick:()=>N(l.datestamp),children:l.date},l.datestamp))]})]})};function Bt(n){const e=new Date(n),a=new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`);return((a.getMonth()===11?new Date(`${a.getFullYear()+1}/1`):new Date(`${a.getFullYear()}/${a.getMonth()+2}/1`)).getTime()-a.getTime())/Q}function pe(n){const e=new Date(n);return new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`).getTime()}const It=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],_t=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],Lt=n=>{const e=he(),[a,s]=d.exports.useState([]),[o,i]=d.exports.useState(v.getDateStampByDate(v.getDateString(n.currentDateStamp))),[u,c]=me(!1),g=d.exports.useRef(null),C=new Date(o);d.exports.useEffect(()=>{const l=()=>{const h=D.getState().memos.filter(m=>v.getTimeStampByDate(m.createdAt)>=o&&v.getTimeStampByDate(m.createdAt)<o+Q).sort((m,f)=>v.getTimeStampByDate(m.createdAt)-v.getTimeStampByDate(f.createdAt));s(h),e.setFinish()},{memos:x}=D.getState(),y=x.slice(-1).pop();y&&v.getTimeStampByDate(y.createdAt)>=o?(e.setLoading(),D.fetchAllMemos().then(()=>{l()}).catch(h=>{T.error(h.message)})):l()},[o]);const N=()=>{c(!1),setTimeout(()=>{const l=v.getOSVersion();(l==="MacOS"||l==="Unknown")&&window.scrollTo(0,0),html2canvas(g.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:U.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(x=>{xe(x.toDataURL())})},0)},p=l=>{i(l),c(!1)};return r(_,{children:[t("div",{className:"dialog-header-container",children:r("div",{className:"btns-wrapper",children:[r("div",{className:"btns-container",children:[t("span",{className:"btn-text",onClick:()=>i(o-Q),children:t("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),t("span",{className:"btn-text",onClick:()=>i(o+Q),children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),r("div",{className:"btns-container",children:[t("span",{className:"btn-text",onClick:N,children:t("img",{className:"icon-img",src:"/icons/share.svg"})}),t("span",{className:"btn-text",onClick:()=>n.destroy(),children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]})]})}),r("div",{className:"dialog-content-container",ref:g,children:[r("div",{className:"date-card-container",onClick:()=>c(),children:[t("div",{className:"year-text",children:C.getFullYear()}),r("div",{className:"date-container",children:[t("div",{className:"month-text",children:It[C.getMonth()]}),t("div",{className:"date-text",children:C.getDate()}),t("div",{className:"day-text",children:_t[C.getDay()]})]})]}),t(At,{className:`date-picker ${u?"":"hide"}`,datestamp:o,handleDateStampChange:p}),e.isLoading?t("div",{className:"tip-container",children:t("p",{className:"tip-text",children:"\u52AA\u529B\u52A0\u8F7D\u4E2D..."})}):a.length===0?t("div",{className:"tip-container",children:t("p",{className:"tip-text",children:"\u7A7A\u7A7A\u5982\u4E5F"})}):t("div",{className:"dailymemos-wrapper",children:a.map(l=>t(kt,{memo:l},`${l.id}-${l.updatedAt}`))})]})]})};function Ot(n=Date.now()){H({className:"daily-memo-diary-dialog"},Lt,{currentDateStamp:n})}const Ut=()=>{const{userState:{user:n},memoState:{memos:e}}=d.exports.useContext(P),[a,s]=d.exports.useState({memosAmount:0,tagsAmount:0}),[o,i]=d.exports.useState(!1),u=n?n.username:"Memos",c=n?Math.ceil((Date.now()-v.getTimeStampByDate(n.createdAt))/1e3/3600/24):0;d.exports.useEffect(()=>{!B.getState().user||D.getMyDataAmount().then(N=>{s(N)}).catch(N=>{T.error(N.message)})},[e]);const g=d.exports.useCallback(N=>{N.stopPropagation();const p=!o;if(p){const l=()=>{i(!1),document.body.removeEventListener("click",l)};document.body.addEventListener("click",l)}i(p)},[o]),C=d.exports.useCallback(()=>{L.clearQuery()},[]);return r("div",{className:"user-banner-container",children:[r("div",{className:"userinfo-header-container",children:[t("p",{className:"username-text",onClick:C,children:u}),t("button",{className:"action-btn menu-popup-btn",onClick:g}),t(Ft,{visibility:o})]}),r("div",{className:"status-text-container",children:[r("div",{className:"status-text memos-text",children:[t("span",{className:"amount-text",children:a.memosAmount}),t("span",{className:"type-text",children:"MEMO"})]}),r("div",{className:"status-text tags-text",children:[t("span",{className:"amount-text",children:a.tagsAmount}),t("span",{className:"type-text",children:"TAG"})]}),r("div",{className:"status-text duration-text",onClick:()=>Ot(),children:[t("span",{className:"amount-text",children:c}),t("span",{className:"type-text",children:"DAY"})]})]})]})};const Pt=()=>{const{locationState:{query:n},memoState:{memos:e}}=d.exports.useContext(P),[a,s]=d.exports.useState([]),[o,i]=d.exports.useState(n.tag),u=he();return d.exports.useEffect(()=>{!B.getState().user||D.getMyTags().then(c=>{const g=c.sort((N,p)=>v.getTimeStampByDate(p.createdAt)-v.getTimeStampByDate(N.createdAt)).sort((N,p)=>p.level-N.level),C={subTags:[]};for(const N of g){const p=N.text.split("/");let l=C,x="";for(let y=0;y<p.length;y++){const h=p[y];y===0?x+=h:x+="/"+h;let m=null;for(const f of l.subTags)if(f.text===x){m=f;break}m?m.level+=N.level:(m={id:"",key:h,text:x,level:N.level,subTags:[],deep:y},l.subTags.push(m)),l.subTags.sort((f,S)=>S.level-f.level),x===N.text&&(m.id=N.id),l=m}}C.subTags.sort((N,p)=>p.level-N.level),s(C.subTags),u.setFinish()}).catch(c=>{u.setError(),T.error(c)})},[e]),d.exports.useEffect(()=>{i(n.tag);const c=document.querySelector(re);c==null||c.classList.remove(ce)},[n]),r("div",{className:"tags-wrapper",children:[t("p",{className:"title-text",children:"\u5E38\u7528\u6807\u7B7E"}),t("div",{className:"tags-container",children:u.isLoading?t(_,{}):r(_,{children:[a.map((c,g)=>t(be,{tag:c,tagQuery:o},c.id+"-"+g)),t(G,{when:a.length<5,children:r("p",{className:"tag-tip-container",children:["\u8F93\u5165",t("span",{className:"code-text",children:"# Tag "}),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~"]})})]})})]})},be=n=>{const{tag:e,tagQuery:a}=n,s=a===e.text,o=e.subTags.length>0,[i,u]=me(a.includes(e.text)&&!s),c=e.id!=="";d.exports.useEffect(()=>{i||u(a.includes(e.text)&&!s)},[a,e]);const g=()=>{const p=s?"":e.text;p&&(v.copyTextToClipboard(`# ${p} `),D.polishTag(e.id).catch(()=>{})),L.setTagQuery(p)},C=p=>{c&&(p.stopPropagation(),$t(e))},N=p=>{p.stopPropagation(),u()};return r(_,{children:[r("div",{className:`tag-item-container ${s?"active":""}`,onClick:g,children:[r("div",{className:"tag-text-container",children:[r("div",{className:`icon-container ${c?"rename-able":""}`,onClick:C,children:[t("span",{className:"icon-text",children:"#"}),c?t("span",{className:"rename-btn",children:s?t("img",{className:"icon-img",src:"/icons/edit-white.svg"}):t("img",{className:"icon-img",src:"/icons/edit.svg"})}):null]}),t("span",{className:"tag-text",children:e.key})]}),t("div",{className:"btns-container",children:o?t("span",{className:`action-btn toggle-btn ${i?"shown":""}`,onClick:N,children:s?t("img",{className:"icon-img",src:"/icons/arrow-right-white.svg"}):t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})}):null})]}),o?t("div",{className:`subtags-container ${i?"":"hidden"}`,children:e.subTags.map((p,l)=>t(be,{tag:p,tagQuery:a},p.id+"-"+l))}):null]})},Rt=n=>{const{destroy:e,tag:a}=n,s=d.exports.useRef(null),o=()=>{e()},i=()=>{var c;const u=(c=s.current)==null?void 0:c.value;if(!u||u===a.text){e();return}D.updateTagText(a.id,u).then(()=>{D.clearMemos(),D.fetchAllMemos(),e()}).catch(()=>{})};return r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"}),"\u6807\u7B7E\u91CD\u547D\u540D"]}),t("button",{className:"text-btn close-btn",onClick:o,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("p",{className:"tag-text",children:["\u65E7\uFF1A",a.text]}),t("input",{className:"text-input",type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E",ref:s}),r("div",{className:"btns-container",children:[t("span",{className:"btn-text cancel-btn",onClick:o,children:"\u53D6\u6D88"}),t("span",{className:"btn-text confirm-btn",onClick:i,children:"\u786E\u5B9A"})]})]})]})};function $t(n){H({className:"rename-tag-dialog"},Rt,{tag:n})}const ve={width:12,height:7},Ht=()=>{const n=v.getDateStampByDate(Date.now()),e=new Date(n).getDay()||7,a=(ve.width-1)*ve.height+e,s=n-a*Q,o=new Array(7-e).fill(0),i=()=>{const f=[];for(let S=1;S<=a;S++)f.push({timestamp:s+Q*S,count:0});return f},{memoState:{memos:u}}=d.exports.useContext(P),[c,g]=d.exports.useState(i()),[C,N]=d.exports.useState(null),[p,l]=d.exports.useState(null),x=d.exports.useRef(null);d.exports.useEffect(()=>{if(!B.getState().user)return;const f=i();D.getMemosStat().then(S=>{for(const E of S){const F=(v.getDateStampByDate(E.timestamp)-s)/(1e3*3600*24)-1;F>=0&&(f[F].count+=1)}g([...f])}).catch(S=>{T.error(S.message)})},[u.length]);const y=d.exports.useCallback((f,S)=>{N(S);const E=f.target;x.current.style.left=E.offsetLeft+"px",x.current.style.top=E.offsetTop+"px"},[]),h=d.exports.useCallback(()=>{N(null)},[]),m=d.exports.useCallback(f=>{L.getState().query.from===f.timestamp?(L.setFromAndToQuery(0,0),l(null)):f.count>0&&(L.setFromAndToQuery(f.timestamp,f.timestamp+Q),l(f))},[]);return r("div",{className:"usage-heat-map-wrapper",children:[r("div",{className:"day-tip-text-container",children:[t("span",{className:"tip-text",children:"Mon"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Wed"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Fri"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Sun"})]}),r("div",{ref:x,className:"usage-detail-container pop-up "+(C?"":"hidden"),children:[C==null?void 0:C.count," memos on ",t("span",{className:"date-text",children:new Date(C==null?void 0:C.timestamp).toDateString()})]}),r("div",{className:"usage-heat-map",children:[c.map((f,S)=>{const E=f.count,F=E<=0?"":E<=1?"stat-day-L1-bg":E<=2?"stat-day-L2-bg":E<=4?"stat-day-L3-bg":"stat-day-L4-bg";return t("span",{className:"stat-container "+F+(p===f?" current":" "),onMouseEnter:R=>y(R,f),onMouseLeave:h,onClick:()=>m(f)},S)}),o.map((f,S)=>t("span",{className:"stat-container null"},S))]})]})};const Qt=()=>{d.exports.useEffect(()=>{},[]);const n=d.exports.useCallback(e=>{if(e.target.className==="sidebar-wrapper"){const s=document.querySelector(re);s==null||s.classList.remove(ce)}},[]);return r("div",{className:"sidebar-wrapper",onClick:n,children:[t(Ut,{}),t(Ht,{}),t(Pt,{})]})},Gt=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function De(n,e){return e.minLength!==void 0&&n.length<e.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:e.maxLength!==void 0&&n.length>e.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:e.noSpace&&n.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:e.noChinese&&Gt.test(n)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const Me={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},jt=({destroy:n})=>{const[e,a]=d.exports.useState(""),[s,o]=d.exports.useState(""),i=d.exports.useRef(null);d.exports.useEffect(()=>{const N=p=>{var l;p.key==="Enter"&&((l=i.current)==null||l.click())};return document.body.addEventListener("keypress",N),()=>{document.body.removeEventListener("keypress",N)}},[]);const u=N=>{const p=N.target.value;a(p)},c=N=>{const p=N.target.value;o(p)},g=()=>{Se()},C=async()=>{const N=De(e,Me);if(!N.result){T.error("\u7528\u6237\u540D "+N.reason);return}const p=De(s,Me);if(!p.result){T.error("\u5BC6\u7801 "+p.reason);return}try{const l=A.signin,{succeed:x,message:y}=await l(e,s);if(!x&&y){T.error("\u{1F61F} "+y);return}await B.doSignIn()?(D.fetchMoreMemos().catch(()=>{}),n()):T.error("\u{1F61F} \u4E0D\u77E5\u9053\u53D1\u751F\u4E86\u4EC0\u4E48\u9519\u8BEF")}catch(l){console.error(l),T.error("\u{1F61F} "+l.message)}};return r(_,{children:[t("div",{className:"dialog-header-container",children:r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F44B}"})," \u8D26\u53F7\u6CE8\u518C / \u767B\u5F55"]})}),r("div",{className:"dialog-content-container",children:[r("label",{className:"form-label input-form-label",children:[t("input",{type:"text",value:e,onChange:u}),t("span",{className:"normal-text "+(e===""?"":"not-null"),children:"\u8D26\u53F7"})]}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:s,onChange:c}),t("span",{className:"normal-text "+(s===""?"":"not-null"),children:"\u5BC6\u7801"})]})]}),r("div",{className:"dialog-footer-container",children:[t("div",{className:"btns-container",children:t("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"Sign In with GitHub"})}),r("div",{className:"btns-container",children:[t("button",{className:"text-btn signup-btn disabled",onClick:()=>T.info("\u6CE8\u518C\u5DF2\u5173\u95ED"),children:"\u6CE8\u518C"}),t("span",{className:"split-text",children:"/"}),t("button",{className:"text-btn signin-btn",ref:i,onClick:C,children:"\u767B\u5F55"})]})]}),r("p",{className:"tip-text",children:["\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\uFF0C\u53EF\u8F93\u5165 ",t("code",{children:"guest, 123456"})," \u8FDB\u884C\u4F53\u9A8C\u3002",t("br",{}),r("span",{className:"text-btn",onClick:g,children:[t("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E\u672C\u7AD9"]})]})]})};function Yt(){H({className:"signin-dialog",clickSpaceDestroy:!1},jt)}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(n,e){return Object.prototype.toString.call(n).toLowerCase()==="[object regexp]"?this.replace(n,e):this.replace(new RegExp(n,"g"),e)})})();function Vt(){const{globalState:{showDarkMode:n}}=d.exports.useContext(P),e=he();return d.exports.useEffect(()=>{B.doSignIn().catch(()=>{}).finally(()=>{B.getState().user?D.fetchMoreMemos():Yt(),e.setFinish()});const a=s=>{if(!B.getState().user)return;const{ctrlKey:o,metaKey:i,code:u}=s;(o||i)&&u==="KeyP"&&(s.preventDefault(),Ee())};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[]),d.exports.useEffect(()=>{n?document.body.classList.add("dark"):document.body.classList.remove("dark")},[n]),t(_,{children:r("div",{id:"page-container",children:[t(Qt,{}),r("div",{className:"content-wrapper",children:[t(We,{}),t(it,{}),e.isLoading?null:t(xt,{})]})]})})}j.render(t(fe,{store:w,context:P,children:t(Vt,{})}),document.getElementById("root"));
