var Ie=Object.defineProperty,Oe=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var ie=(a,e,n)=>e in a?Ie(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n,T=(a,e)=>{for(var n in e||(e={}))_e.call(e,n)&&ie(a,n,e[n]);if(fe)for(var n of fe(e))Pe.call(e,n)&&ie(a,n,e[n]);return a},v=(a,e)=>Oe(a,Le(e));var B=(a,e,n)=>(ie(a,typeof e!="symbol"?e+"":e,n),n);import{j as le,r as d,R as K,a as Ue}from"./vendor.11819a74.js";const Re=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerpolicy&&(c.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?c.credentials="include":o.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}};Re();const t=le.exports.jsx,r=le.exports.jsxs,_=le.exports.Fragment,ye=a=>{const{children:e,store:n,context:s}=a,[o,c]=d.exports.useState(n.getState());return d.exports.useEffect(()=>{const l=n.subscribe(y=>{c(y)});return()=>{l()}},[]),t(s.Provider,{value:o,children:e})};function $e(a){const e=Object.keys(a),n={};for(const s of e)typeof a[s]=="function"&&(n[s]=a[s]);return(s={},o)=>{let c=!1;const l={};for(const y of e){const h=s[y],f=n[y](h,o);l[y]=f,c=c||f!==h}return c?l:s}}function He(a,e){const n=[];let s=a;return{dispatch:y=>{const h=e(s,y),f=s;s=h;for(const x of n)x(s,f)},getState:()=>s,subscribe:y=>{let h=!0;return n.push(y),()=>{if(!h)return;const f=n.indexOf(y);n.splice(f,1),h=!1}}}}function Ge(a,e){switch(e.type){case"SET_MARK_MEMO_ID":return e.payload.markMemoId===a.markMemoId?a:v(T({},a),{markMemoId:e.payload.markMemoId});case"SET_EDIT_MEMO_ID":return e.payload.editMemoId===a.editMemoId?a:v(T({},a),{editMemoId:e.payload.editMemoId});case"SET_MOBILE_VIEW":return e.payload.isMobileView===a.isMobileView?a:v(T({},a),{isMobileView:e.payload.isMobileView});case"SET_APP_SETTING":return T(T({},a),e.payload);default:return a}}const Qe={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,isMobileView:!1};function Ve(a,e){switch(e.type){case"SET_LOCATION":return e.payload;case"SET_PATHNAME":return e.payload.pathname===a.pathname?a:v(T({},a),{pathname:e.payload.pathname});case"SET_TAG_QUERY":return e.payload.tag===a.query.tag?a:v(T({},a),{query:v(T({},a.query),{tag:e.payload.tag})});case"SET_FROM_TO_QUERY":return e.payload.from===a.query.from&&e.payload.to===a.query.to?a:v(T({},a),{query:v(T({},a.query),{from:e.payload.from,to:e.payload.to})});case"SET_TYPE":return e.payload.type===a.query.type?a:v(T({},a),{query:v(T({},a.query),{type:e.payload.type})});case"SET_TEXT":return e.payload.text===a.query.text?a:v(T({},a),{query:v(T({},a.query),{text:e.payload.text})});case"SET_HASH":return e.payload.hash===a.hash?a:v(T({},a),{hash:e.payload.hash});default:return a}}const qe={pathname:"/",hash:"",query:{tag:"",from:0,to:0,type:"",text:""}};var b;(function(a){function e(){return Date.now()}a.getNowTimeStamp=e;function n(){const i=navigator.appVersion;let u="Unknown";return i.indexOf("Win")!=-1?u="Windows":i.indexOf("Mac")!=-1?u="MacOS":i.indexOf("Linux")!=-1&&(u="Linux"),u}a.getOSVersion=n;function s(i){return typeof i=="string"&&(i=i.replaceAll("-","/")),new Date(i).getTime()}a.getTimeStampByDate=s;function o(i){const u=new Date(s(i));return new Date(u.getFullYear(),u.getMonth(),u.getDate()).getTime()}a.getDateStampByDate=o;function c(i){const u=new Date(s(i)),g=u.getFullYear(),N=u.getMonth()+1,S=u.getDate();return`${g}/${N}/${S}`}a.getDateString=c;function l(i){const u=new Date(s(i)),g=u.getHours(),N=u.getMinutes(),S=g<10?"0"+g:g,w=N<10?"0"+N:N;return`${S}:${w}`}a.getTimeString=l;function y(i){const u=new Date(s(i)),g=u.getFullYear(),N=u.getMonth()+1,S=u.getDate(),w=u.getHours(),I=u.getMinutes(),L=u.getSeconds(),Y=N<10?"0"+N:N,ne=S<10?"0"+S:S,se=w<10?"0"+w:w,oe=I<10?"0"+I:I,re=L<10?"0"+L:L;return`${g}/${Y}/${ne} ${se}:${oe}:${re}`}a.getDateTimeString=y;function h(i){return Array.from(new Set(i))}a.dedupe=h;function f(i){const u=new Set,g=[];for(const N of i)u.has(N.id)||(u.add(N.id),g.push(N));return g}a.dedupeObjectWithId=f;function x(i,u){let g=null;return()=>{g&&clearTimeout(g),g=setTimeout(i,u)}}a.debounce=x;function p(i,u){let g=!0;return()=>{if(!g)return!1;g=!1,setTimeout(()=>{i(),g=!0},u)}}a.throttle=p;function m(i){const u=[],g=Object.keys(i),N=Object.values(i);for(let S=0;S<g.length;++S)N[S]&&u.push(`${g[S]}=${N[S]}`);return u.join("&")}a.iterObjectToParamsString=m;async function C(i){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(i)}catch(u){console.warn("Copy to clipboard failed.",u)}else console.warn("Copy to clipboard failed, methods not supports.")}a.copyTextToClipboard=C;function E(i){return new Promise((u,g)=>{const N=new Image;N.onload=()=>{const{width:S,height:w}=N;S>0&&w>0?u({width:S,height:w}):u({width:0,height:0})},N.onerror=()=>{u({width:0,height:0})},N.className="hidden",N.src=i,document.body.appendChild(N),N.remove()})}a.getImageSize=E})(b||(b={}));function je(a,e){switch(e.type){case"SET_MEMOS":return{memos:[...b.dedupeObjectWithId(e.payload.memos.sort((s,o)=>b.getTimeStampByDate(o.createdAt)-b.getTimeStampByDate(s.createdAt)))]};case"PUSH_MEMO":return{memos:b.dedupeObjectWithId([e.payload.memo,...a.memos].sort((s,o)=>b.getTimeStampByDate(o.createdAt)-b.getTimeStampByDate(s.createdAt)))};case"PUSH_MEMOS":return{memos:b.dedupeObjectWithId([...e.payload.memos,...a.memos].sort((s,o)=>b.getTimeStampByDate(o.createdAt)-b.getTimeStampByDate(s.createdAt)))};case"DELETE_MEMO_BY_ID":return{memos:[...a.memos].filter(n=>n.id!==e.payload.id)};case"EDIT_MEMO":return{memos:a.memos.map(s=>s.id===e.payload.id?T(T({},s),e.payload):s)};default:return a}}const We={memos:[]};function Ye(a,e){switch(e.type){case"SIGN_IN":return{user:e.payload.user};case"SIGN_OUT":return{user:null};default:return a}}const Ke={user:null},F=He({globalState:Qe,locationState:qe,memoState:We,userState:Ke},$e({globalState:Ge,locationState:Ve,memoState:je,userState:Ye})),$=d.exports.createContext(F.getState());var W;(function(a){function e(o){const c={};for(const l of o)try{const y=localStorage.getItem(l);if(y!==null){const h=JSON.parse(y);c[l]=h}}catch(y){console.error("Get storage failed in ",l,y)}return c}a.get=e;function n(o){for(const c in o)try{const l=JSON.stringify(o[c]);localStorage.setItem(c,l)}catch(l){console.error("Save storage failed in ",c,l)}}a.set=n;function s(){var c;const o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o),(c=o.contentWindow)==null||c.localStorage.setItem("t",Date.now().toString()),o.remove()}a.emitStorageChangedEvent=s})(W||(W={}));class ze{constructor(){B(this,"getState",()=>F.getState().globalState);B(this,"setEditMemoId",e=>{F.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:e}})});B(this,"setMarkMemoId",e=>{F.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:e}})});B(this,"setIsMobileView",e=>{F.dispatch({type:"SET_MOBILE_VIEW",payload:{isMobileView:e}})});B(this,"setAppSetting",e=>{F.dispatch({type:"SET_APP_SETTING",payload:e}),W.set(e)});var s,o,c;const e=W.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser"]),n={shouldSplitMemoWord:(s=e.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(o=e.shouldHideImageUrl)!=null?o:!0,shouldUseMarkdownParser:(c=e.shouldUseMarkdownParser)!=null?c:!0};this.setAppSetting(n)}}const R=new ze,H=(a="replace")=>{const{query:e,pathname:n,hash:s}=F.getState().locationState;let o=b.iterObjectToParamsString(e);o?o="?"+o:o="",a==="replace"?window.history.replaceState(null,"",n+s+o):window.history.pushState(null,"",n+s+o)};class Xe{constructor(){B(this,"updateStateWithLocation",()=>{var l,y,h,f,x;const{pathname:e,search:n,hash:s}=window.location,o=new URLSearchParams(n),c={pathname:"/",hash:"",query:{tag:"",from:0,to:0,text:"",type:""}};c.query={tag:(l=o.get("tag"))!=null?l:"",from:parseInt((y=o.get("from"))!=null?y:"0"),to:parseInt((h=o.get("to"))!=null?h:"0"),type:(f=o.get("type"))!=null?f:"",text:(x=o.get("text"))!=null?x:""},c.hash=s,c.pathname=this.getValidPathname(e),F.dispatch({type:"SET_LOCATION",payload:c})});B(this,"getState",()=>F.getState().locationState);B(this,"clearQuery",()=>{F.dispatch({type:"SET_TAG_QUERY",payload:{tag:""}}),F.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:0,to:0}}),H()});B(this,"setHash",e=>{F.dispatch({type:"SET_HASH",payload:{hash:e}}),H()});B(this,"setPathname",e=>{F.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H()});B(this,"pushHistory",e=>{F.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H("push")});B(this,"replaceHistory",e=>{F.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H("replace")});B(this,"setMemoTypeQuery",(e="")=>{F.dispatch({type:"SET_TYPE",payload:{type:e}}),H()});B(this,"setTextQuery",e=>{F.dispatch({type:"SET_TEXT",payload:{text:e}}),H()});B(this,"setTagQuery",e=>{F.dispatch({type:"SET_TAG_QUERY",payload:{tag:e}}),H()});B(this,"setFromAndToQuery",(e,n)=>{F.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:e,to:n}}),H()});B(this,"getValidPathname",e=>["/","/signin","/trash"].includes(e)?e:"/");this.updateStateWithLocation(),window.onpopstate=()=>{this.updateStateWithLocation()}}}const O=new Xe;var A;(function(a){async function e(M){const X=await(await fetch(M,{method:"GET"})).json();if(!X.succeed)throw X;return X}a.get=e;async function n(M,P){const ce=await(await fetch(M,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)})).json();if(!ce.succeed)throw ce;return ce}a.post=n;function s(){return e("/api/user/me")}a.getUserInfo=s;function o(M,P){return n("/api/user/signin",{username:M,password:P})}a.signin=o;function c(M,P){return n("/api/user/signup",{username:M,password:P})}a.signup=c;function l(){return n("/api/user/signout")}a.signout=l;function y(M){return e("/api/user/checkusername?username="+M)}a.checkUsernameUsable=y;function h(M){return n("/api/user/checkpassword",{password:M})}a.checkPasswordValid=h;function f(M="",P=""){return n("/api/user/update",{username:M,password:P})}a.updateUserinfo=f;function x(M=0,P=20){return e(`/api/memo/all?offset=${M}&amount=${P}`)}a.getMyMemos=x;function p(){return e("/api/memo/trash")}a.getMyDeletedMemos=p;function m(M){return n("/api/memo/new",{content:M})}a.createMemo=m;function C(M){return e("/api/memo/?id="+M)}a.getMemoById=C;function E(M){return n("/api/memo/hide",{memoId:M})}a.hideMemo=E;function i(M){return n("/api/memo/restore",{memoId:M})}a.restoreMemo=i;function u(M){return n("/api/memo/delete",{memoId:M})}a.deleteMemo=u;function g(M,P){return n("/api/memo/update",{memoId:M,content:P})}a.updateMemo=g;function N(){return e("/api/memo/count")}a.getMemosCount=N;function S(M){return e("/api/memo/linkeds?memoId="+M)}a.getLinkedMemos=S;function w(M){return n("/api/tag/new",{text:M})}a.createTag=w;function I(M,P){return n("/api/tag/link",{memoId:M,tagId:P})}a.createMemoTag=I;function L(M,P){return n("/api/tag/rmlink",{memoId:M,tagId:P})}a.removeMemoTag=L;function Y(M){return e("/api/tag/memo?id="+M)}a.getTagsByMemoId=Y;function ne(){return e("/api/tag/all")}a.getMyTags=ne;function se(M){return n("/api/tag/delete",{tagId:M})}a.deleteTagById=se;function oe(M){return n("/api/tag/polish",{tagId:M})}a.polishTag=oe;function re(M){return n("/api/tag/pin",{tagId:M})}a.pinTag=re;function we(M){return n("/api/tag/unpin",{tagId:M})}a.unpinTag=we;function ve(M,P){return n("/api/tag/update",{id:M,text:P})}a.updateTagText=ve;function ke(){return e("/api/user/amount")}a.getMyDataAmount=ke;function Fe(M){return e("/api/base/srctype?url="+M)}a.getUrlContentType=Fe;function Ae(){return e("/api/memo/stat")}a.getMemosStat=Ae;function Be(){return n("/api/user/updategh",{githubName:""})}a.removeGithubName=Be})(A||(A={}));const J="#page-container",Z="mobile-show-sidebar",Je=20,Ce=200,Ze=400,G=3600*24*1e3,ee=/#\s(.+?)\s/g,Ne=/(https?:\/\/[^\s<\\*>']+)/g,j=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,ue=/\[@(.+?)\]\((.+?)\)/g,de=[{type:"CONNECTED",text:"\u6709\u5173\u8054"},{type:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{type:"LINKED",text:"\u6709\u8D85\u94FE\u63A5"},{type:"IMAGED",text:"\u6709\u56FE\u7247"}];class et{getState(){return F.getState().userState}async doSignIn(){const{data:e}=await A.getUserInfo();return e?F.dispatch({type:"SIGN_IN",payload:{user:e}}):U.doSignOut(),e}async doSignOut(){A.signout().catch(()=>{}).finally(()=>{F.dispatch({type:"SIGN_OUT",payload:{user:null}})})}async checkUsernameUsable(e){const{data:n}=await A.checkUsernameUsable(e);return n}async updateUsername(e){await A.updateUserinfo(e)}async removeGithubName(){await A.removeGithubName()}async checkPasswordValid(e){const{data:n}=await A.checkPasswordValid(e);return n}async updatePassword(e){await A.updateUserinfo("",e)}}const U=new et;class tt{constructor(){B(this,"isFetching",!1)}getState(){return F.getState().memoState}async fetchMoreMemos(){if(!U.getState().user||this.isFetching)return!1;this.isFetching=!0;const{data:e}=await A.getMyMemos(this.getState().memos.length,Je),n=e.map(s=>T({},s));return F.dispatch({type:"PUSH_MEMOS",payload:{memos:n}}),this.isFetching=!1,n}async fetchAllMemos(){if(!U.getState().user)return!1;this.isFetching=!0;const{data:{memosAmount:e}}=await A.getMyDataAmount(),{data:n}=await A.getMyMemos(0,e),s=n.map(o=>T({},o));return s.length>0&&F.dispatch({type:"SET_MEMOS",payload:{memos:s}}),this.isFetching=!1,n}async fetchDeletedMemos(){if(!U.getState().user)return!1;const{data:e}=await A.getMyDeletedMemos();return e}pushMemo(e){F.dispatch({type:"PUSH_MEMO",payload:{memo:T({},e)}})}async getMemoById(e){for(const s of this.getState().memos)if(s.id===e)return s;const{data:n}=await A.getMemoById(e);return n}async hideMemoById(e){await A.hideMemo(e),F.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:e}})}async restoreMemoById(e){await A.restoreMemo(e),D.clearMemos(),D.fetchMoreMemos()}async deleteMemoById(e){await A.deleteMemo(e)}editMemo(e){F.dispatch({type:"EDIT_MEMO",payload:e})}clearMemos(){F.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(e){const{data:n}=await A.createMemo(e);return n}async updateMemo(e,n){const{data:s}=await A.updateMemo(e,n);return s}async createTag(e){const{data:n}=await A.createTag(e);return n}async removeMemoTag(e,n){await A.removeMemoTag(e,n)}async createMemoTag(e,n){await A.createMemoTag(e,n)}async getMyDataAmount(){const{data:e}=await A.getMyDataAmount();return e}async getMemosStat(){const{data:e}=await A.getMemosStat();return e}async getLinkedMemos(e){const{data:n}=await A.getLinkedMemos(e);return n}async getMyTags(){if(!U.getState().user)return[];const{data:e}=await A.getMyTags();return e}async polishTag(e){await A.polishTag(e)}async pinTag(e){await A.pinTag(e)}async unpinTag(e){await A.unpinTag(e)}async updateTagText(e,n){await A.updateTagText(e,n)}}const D=new tt;const at=a=>{const{destory:e,duration:n}=a;return d.exports.useEffect(()=>{n>0&&setTimeout(()=>{e()},n)},[]),t("div",{className:"toast-container",onClick:e,children:t("p",{className:"content-text",children:a.content})})};class nt{constructor(){B(this,"shownToastAmount",0);B(this,"toastWrapper");B(this,"shownToastContainers",[]);B(this,"info",(e,n=3e3)=>this.showToast({type:"normal",content:e,duration:n}));B(this,"success",(e,n=3e3)=>this.showToast({type:"success",content:e,duration:n}));B(this,"error",(e,n=3e3)=>this.showToast({type:"error",content:e,duration:n}));B(this,"showToast",e=>{const n=document.createElement("div");n.className=`toast-wrapper ${e.type}`,this.toastWrapper.appendChild(n),this.shownToastAmount++,this.shownToastContainers.push(n),setTimeout(()=>{n.classList.add("showup")},0);const s={destory:()=>{n.classList.add("destory"),setTimeout(()=>{if(!!n.parentElement&&(this.shownToastAmount--,this.shownToastAmount===0)){for(const o of this.shownToastContainers)K.unmountComponentAtNode(o),o.remove();this.shownToastContainers.splice(0,this.shownToastContainers.length)}},Ze)}};return K.render(t(at,v(T({},e),{destory:s.destory})),n),s});const e="toast-list-container",n=document.createElement("div");n.className=e,document.body.appendChild(n),this.toastWrapper=n}}var k=new nt;const st=a=>{const{children:e,className:n,clickSpaceDestroy:s,destroy:o}=a,c=()=>{s&&o()};return t("div",{className:`dialog-wrapper ${n}`,onClick:c,children:t("div",{className:"dialog-container",onClick:l=>l.stopPropagation(),children:e})})};function Q(a,e,n){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var y;(y=s.firstElementChild)==null||y.classList.add("showup")},0);const o={destroy:()=>{var y,h;(y=s.firstElementChild)==null||y.classList.remove("showup"),(h=s.firstElementChild)==null||h.classList.add("showoff"),setTimeout(()=>{s.remove(),K.unmountComponentAtNode(s)},Ce)}},c=v(T({},n),{destroy:o.destroy});let l=t(st,v(T({destroy:o.destroy,clickSpaceDestroy:!0},a),{children:t(e,T({},c))}));return a.useAppContext&&(l=t(ye,{store:F,context:$,children:l})),K.render(l,s),o}const ot=({destroy:a})=>{const{userState:e}=d.exports.useContext($),n=e.user,[s,o]=d.exports.useState(n.username),[c,l]=d.exports.useState(!1),[y,h]=d.exports.useState(!1),f=()=>{a()},x=i=>{const u=i.target.value;o(u)},p=async()=>{if(n.username==="guest"){k.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(s===n.username){l(!1);return}try{if(!await U.checkUsernameUsable(s)){k.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await U.updateUsername(s),await U.doSignIn(),l(!1),k.info("\u4FEE\u6539\u6210\u529F~")}catch(i){k.error(i.message)}},m=()=>{if(n.username==="guest"){k.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}ct()},C=async()=>{if(y){try{await U.removeGithubName(),await U.doSignIn()}catch(i){k.error(i.message)}h(!1)}else h(!0)},E=i=>{i.preventDefault()};return r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F920}"}),"\u6211\u7684\u8D26\u53F7"]}),t("button",{className:"text-btn close-btn",onClick:f,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("div",{className:"section-container account-section-container",children:[t("p",{className:"title-text",children:"\u57FA\u672C\u4FE1\u606F"}),r("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"ID\uFF1A"}),t("span",{className:"normal-text",children:n.id})]}),r("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"\u521B\u5EFA\u65F6\u95F4\uFF1A"}),t("span",{className:"normal-text",children:b.getDateString(n.createdAt)})]}),r("label",{className:"form-label input-form-label username-label",children:[t("span",{className:"normal-text",children:"\u8D26\u53F7\uFF1A"}),t("input",{type:"text",readOnly:!c,value:s,onClick:()=>{l(!0)},onChange:x}),r("div",{className:"btns-container",onClick:E,children:[t("span",{className:"text-btn confirm-btn "+(c?"":"hidden"),onClick:p,children:"\u4FDD\u5B58"}),t("span",{className:"text-btn cancel-btn "+(c?"":"hidden"),onClick:()=>{o(n.username),l(!1)},children:"\u64A4\u9500"})]})]}),r("label",{className:"form-label password-label",children:[t("span",{className:"normal-text",children:"\u5BC6\u7801\uFF1A"}),t("span",{className:"text-btn",onClick:m,children:"\u4FEE\u6539\u5BC6\u7801"})]})]}),r("div",{className:"section-container account-section-container",children:[t("p",{className:"title-text",children:"\u5173\u8054\u8D26\u53F7"}),r("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"GitHub\uFF1A"}),n.githubName?r(_,{children:[t("a",{className:"value-text",href:"https://github.com/"+n.githubName,children:n.githubName}),t("span",{className:`btn-text unbind-btn ${y?"final-confirm":""}`,onMouseLeave:()=>h(!1),onClick:C,children:y?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A"})]}):r(_,{children:[t("span",{className:"value-text",children:"\u65E0"}),t("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"\u524D\u5F80\u7ED1\u5B9A"})]})]})]})]})]})},rt=({destroy:a})=>{const[e,n]=d.exports.useState(""),[s,o]=d.exports.useState(""),[c,l]=d.exports.useState("");d.exports.useEffect(()=>{},[]);const y=()=>{a()},h=m=>{const C=m.target.value;n(C)},f=m=>{const C=m.target.value;o(C)},x=m=>{const C=m.target.value;l(C)},p=async()=>{if(e===""||s===""||c===""){k.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==c){k.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),l("");return}try{if(!await U.checkPasswordValid(e)){k.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),n("");return}await U.updatePassword(s),k.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),y()}catch(m){k.error(m)}};return r(_,{children:[r("div",{className:"dialog-header-container",children:[t("p",{className:"title-text",children:"\u4FEE\u6539\u5BC6\u7801"}),t("button",{className:"text-btn close-btn",onClick:y,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[t("p",{className:"tip-text",children:"\u5982\u679C\u662F GitHub \u767B\u5F55\uFF0C\u5219\u521D\u59CB\u5BC6\u7801\u4E3A\u7528\u6237\u540D"}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:e,onChange:h}),t("span",{className:"normal-text "+(e===""?"":"not-null"),children:"\u65E7\u5BC6\u7801"})]}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:s,onChange:f}),t("span",{className:"normal-text "+(s===""?"":"not-null"),children:"\u65B0\u5BC6\u7801"})]}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:c,onChange:x}),t("span",{className:"normal-text "+(c===""?"":"not-null"),children:"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801"})]}),r("div",{className:"btns-container",children:[t("span",{className:"text-btn cancel-btn",onClick:y,children:"\u53D6\u6D88"}),t("span",{className:"text-btn confirm-btn",onClick:p,children:"\u4FDD\u5B58"})]})]})]})};function ct(){Q({className:"change-password-dialog"},rt)}function it(){Q({className:"my-account-dialog",useAppContext:!0},ot)}const lt=({destroy:a})=>r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E ",t("b",{children:"Memos"})]}),t("button",{className:"text-btn close-btn",onClick:()=>{a()},children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[t("p",{children:"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"}),t("br",{}),t("i",{children:"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"}),r("ul",{children:[r("li",{children:["\u5B9E\u8DF5 ",t("strong",{children:"\u5362\u66FC\u5361\u7247\u76D2\u7B14\u8BB0\u6CD5"}),"\uFF1B"]}),t("li",{children:"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5} \u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1} \u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5} \u8BFB\u540E\u611F..."}),t("li",{children:"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"}),t("li",{children:"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B"})]}),t("br",{}),t("i",{children:"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"}),r("ul",{children:[r("li",{children:["\u2728"," ",t("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer",children:"\u5F00\u6E90\u9879\u76EE"})]}),t("li",{children:"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"}),t("li",{children:"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B"})]}),t("br",{}),t("p",{children:"Enjoy it and have fun~ "}),t("hr",{}),r("p",{className:"normal-text",children:["Last updated on ",t("span",{className:"pre-text",children:"2021/10/20 14:43:00"})," \u{1F389}"]})]})]});function xe(){Q({className:"about-site-dialog"},lt)}const ut=({destroy:a})=>{const{globalState:{shouldHideImageUrl:e,shouldSplitMemoWord:n,shouldUseMarkdownParser:s}}=d.exports.useContext($);return d.exports.useEffect(()=>{},[]),r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u2699\uFE0F"}),"\u504F\u597D\u8BBE\u7F6E"]}),t("button",{className:"text-btn close-btn",onClick:()=>{a()},children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("div",{className:"section-container preferences-section-container",children:[t("p",{className:"title-text",children:"Memo \u663E\u793A\u76F8\u5173"}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"}),t("img",{className:"icon-img",src:n?"/icons/checkbox-active.svg":"/icons/checkbox.svg"}),t("input",{className:"hidden",type:"checkbox",checked:n,onChange:f=>{const x=f.target.checked;R.setAppSetting({shouldSplitMemoWord:x})}})]}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"}),t("img",{className:"icon-img",src:e?"/icons/checkbox-active.svg":"/icons/checkbox.svg"}),t("input",{className:"hidden",type:"checkbox",checked:e,onChange:f=>{const x=f.target.checked;R.setAppSetting({shouldHideImageUrl:x})}})]}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"markdown \u683C\u5F0F\u89E3\u6790"}),t("img",{className:"icon-img",src:s?"/icons/checkbox-active.svg":"/icons/checkbox.svg"}),t("input",{className:"hidden",type:"checkbox",checked:s,onChange:f=>{const x=f.target.checked;R.setAppSetting({shouldUseMarkdownParser:x})}}),t("span",{className:"tip-text",children:"\u652F\u6301\u5217\u8868\u3001\u52A0\u7C97/\u659C\u4F53\u3001\u4EE3\u7801\u5757"})]})]}),r("div",{className:"section-container hidden",children:[t("p",{className:"title-text",children:"\u5176\u4ED6"}),t("div",{className:"btn-container",children:t("button",{className:"btn export-btn",onClick:async()=>{await D.fetchAllMemos();const f=D.getState().memos.map(m=>v(T({},m),{tags:m.tags.map(C=>C.text)})),x=JSON.stringify(f),p=document.createElement("a");p.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(x)),p.setAttribute("download","data.json"),p.style.display="none",document.body.appendChild(p),p.click(),document.body.removeChild(p)},children:"\u5BFC\u51FA\u6570\u636E(JSON)"})})]})]})]})};function dt(){Q({className:"preferences-dialog",useAppContext:!0},ut)}const mt=()=>r("div",{className:"menu-btns-popup",onClick:l=>{l.stopPropagation()},children:[r("button",{className:"text-btn action-btn",onClick:()=>{it()},children:[t("span",{className:"icon",children:"\u{1F920}"})," \u6211\u7684\u8D26\u53F7"]}),r("button",{className:"text-btn action-btn",onClick:()=>{dt()},children:[t("span",{className:"icon",children:"\u2699\uFE0F"})," \u504F\u597D\u8BBE\u7F6E"]}),r("button",{className:"text-btn action-btn",onClick:()=>{O.pushHistory("/trash")},children:[t("span",{className:"icon",children:"\u{1F5D1}\uFE0F"})," \u56DE\u6536\u7AD9"]}),r("button",{className:"text-btn action-btn",onClick:()=>{xe()},children:[t("span",{className:"icon",children:"\u{1F600}"})," \u5173\u4E8E"]}),r("button",{className:"text-btn action-btn",onClick:async()=>{await U.doSignOut(),O.replaceHistory("/signin")},children:[t("span",{className:"icon",children:"\u{1F44B}"})," \u9000\u51FA"]})]});function z(a=!1){const[e,n]=d.exports.useState(a),s=d.exports.useCallback(o=>{n(o!==void 0?o:c=>!c)},[]);return[e,s]}function te(){const[a,e]=d.exports.useState({isLoading:!0,isFailed:!1,isSucceed:!1});return v(T({},a),{setLoading:()=>{e(v(T({},a),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{e(v(T({},a),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{e(v(T({},a),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const ht=({destroy:a,imgUrl:e})=>{const n=d.exports.useRef(null),[s,o]=d.exports.useState(-1);d.exports.useEffect(()=>{b.getImageSize(e).then(({width:h})=>{o(h!==0?80:0)})},[]);const c=()=>{a()},l=()=>{s>30&&o(s-10)},y=()=>{o(s+10)};return r(_,{children:[t("button",{className:"text-btn close-btn",onClick:c,children:t("img",{className:"icon-img",src:"/icons/close.svg"})}),r("div",{className:"img-container",children:[t("img",{className:s<=0?"hidden":"",ref:n,width:s+"%",src:e}),t("span",{className:"loading-text "+(s===-1?"":"hidden"),children:"\u56FE\u7247\u52A0\u8F7D\u4E2D..."}),t("span",{className:"loading-text "+(s===0?"":"hidden"),children:"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5"})]}),r("div",{className:"action-btns-container",children:[t("button",{className:"text-btn",onClick:l,children:"\u2796"}),t("button",{className:"text-btn",onClick:y,children:"\u2795"}),t("button",{className:"text-btn",onClick:()=>o(80),children:"\u2B55"})]})]})};function Ee(a){Q({className:"preview-image-dialog"},ht,{imgUrl:a})}const pt=/```([\s\S]*?)```/g,gt=/\*\*(.+?)\*\*/g,ft=/\*(.+?)\*/g,yt=/\[ \] /g,Ct=/\[x\] /g,Nt=/[*] /g,xt=/(\d+)\. /g,Et=a=>a.replace(pt,"<pre lang=''>$1</pre>").replace(Nt,"<span class='counter-block'>-</span>").replace(xt,"<span class='counter-block'>$1.</span>").replace(yt,"<span class='todo-block' data-type='todo'>\u2B1C</span>").replace(Ct,"<span class='todo-block' data-type='done'>\u2705</span>").replace(gt,"<strong>$1</strong>").replace(ft,"<em>$1</em>"),ae=a=>{const e=document.createElement("div");e.className="memo-content-text",e.innerHTML=a,document.body.appendChild(e);const n=e.innerText;return e.remove(),n},St=a=>a.replace(/\n/g,"<br>"),bt=a=>{const{children:e,when:n}=a;return n?t(_,{children:e}):null},V=bt;const me=a=>{const{className:e,imgUrl:n}=a,s=()=>{Ee(n)};return t("div",{className:"image-container "+e,onClick:s,children:t("img",{src:n,decoding:"async",loading:"lazy"})})};const Mt=a=>{var p,m;const[e,n]=d.exports.useState(v(T({},a.memo),{formattedContent:q(a.memo.content),createdAtStr:b.getDateTimeString(a.memo.createdAt)})),[s,o]=d.exports.useState([]),[c,l]=d.exports.useState([]),y=Array.from((p=e.content.match(j))!=null?p:[]);d.exports.useEffect(()=>{(async()=>{try{const E=[],i=[...e.content.matchAll(ue)];for(const g of i)if(g&&g.length===3){const N=g[2],S=await D.getMemoById(N);S&&E.push(v(T({},S),{formattedContent:q(S.content),createdAtStr:b.getDateTimeString(S.createdAt),dateStr:b.getDateString(S.createdAt)}))}o([...E]);const u=await D.getLinkedMemos(e.id);l(u.sort((g,N)=>b.getTimeStampByDate(N.createdAt)-b.getTimeStampByDate(g.createdAt)).map(g=>v(T({},g),{formattedContent:q(g.content),createdAtStr:b.getDateTimeString(g.createdAt),dateStr:b.getDateString(g.createdAt)})))}catch(E){}})()},[e.id]);const h=d.exports.useCallback(async C=>{var i;const E=C.target;if(E.className==="memo-link-text"){const u=(i=E.dataset)==null?void 0:i.value,g=await D.getMemoById(u!=null?u:"");if(g){const N=v(T({},g),{formattedContent:q(g.content),createdAtStr:b.getDateTimeString(g.createdAt)});o([]),l([]),n(N)}else k.error("MEMO Not Found"),E.classList.remove("memo-link-text")}},[]),f=d.exports.useCallback(C=>{o([]),l([]),n(C)},[]),x=d.exports.useCallback(()=>{a.destroy(),R.setEditMemoId(e.id)},[e.id]);return r(_,{children:[r("div",{className:"memo-card-container",children:[r("div",{className:"header-container",children:[t("p",{className:"time-text",children:e.createdAtStr}),r("div",{className:"btns-container",children:[t("button",{className:"text-btn edit-btn",onClick:x,children:t("img",{className:"icon-img",src:"/icons/edit.svg"})}),t("button",{className:"text-btn close-btn",onClick:a.destroy,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]})]}),r("div",{className:"memo-container",children:[t("div",{className:"memo-content-text",onClick:h,dangerouslySetInnerHTML:{__html:(m=e.formattedContent)!=null?m:""}}),t(V,{when:y.length>0,children:t("div",{className:"images-wrapper",children:y.map((C,E)=>t(me,{className:"memo-img",imgUrl:C},E))})})]}),t("div",{className:"layer-container"}),s.map((C,E)=>E<4?t("div",{className:"background-layer-container",style:{bottom:(E+1)*-3+"px",left:(E+1)*5+"px",width:`calc(100% - ${(E+1)*10}px)`,zIndex:-E-1}},E):null)]}),s.length>0?r("div",{className:"linked-memos-wrapper",children:[r("p",{className:"normal-text",children:["\u5173\u8054\u4E86 ",s.length," \u4E2A MEMO"]}),s.map(C=>{const E=ae(C.formattedContent).replaceAll(`
`," ");return r("div",{className:"linked-memo-container",onClick:()=>f(C),children:[r("span",{className:"time-text",children:[C.dateStr," "]}),E]},C.id)})]}):null,c.length>0?r("div",{className:"linked-memos-wrapper",children:[r("p",{className:"normal-text",children:[c.length," \u6761\u94FE\u63A5\u81F3\u6B64\u7684 MEMO"]}),c.map(C=>{const E=ae(C.formattedContent).replaceAll(`
`," ");return r("div",{className:"linked-memo-container",onClick:()=>f(C),children:[r("span",{className:"time-text",children:[C.dateStr," "]}),E]},C.id)})]}):null]})};function Se(a){Q({className:"memo-card-dialog"},Mt,{memo:a})}const Tt=a=>{var C;const{memo:e,destroy:n}=a,[s,o]=d.exports.useState(""),c=d.exports.useRef(null),{user:l}=U.getState(),y=v(T({},e),{formattedContent:q(e.content),createdAtStr:b.getDateTimeString(e.createdAt)}),h=Array.from((C=y.content.match(j))!=null?C:[]),[f,x]=d.exports.useState(h.length);d.exports.useEffect(()=>{setTimeout(()=>{if(f===0){const E=b.getOSVersion();(E==="MacOS"||E==="Unknown")&&window.scrollTo(0,0),html2canvas(c.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(i=>{o(i.toDataURL())})}},Ce+100)},[f]);const p=()=>{n()},m=E=>{E.type==="error"&&(k.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),E.target.remove()),x(f-1)};return r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F970}"}),"\u5206\u4EAB Memo \u56FE\u7247"]}),t("button",{className:"text-btn close-btn",onClick:p,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[t("div",{className:`tip-words-container ${s?"finished":"genarating"}`,children:t("p",{className:"tip-text",children:s?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D..."})}),t("img",{className:"memo-img",src:s}),r("div",{className:"memo-container",ref:c,children:[t("span",{className:"time-text",children:y.createdAtStr}),t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:y.formattedContent}}),t(V,{when:h.length>0,children:t("div",{className:"images-container",children:h.map((E,i)=>t("img",{crossOrigin:"anonymous",src:E,onLoad:m,onError:m,decoding:"async"},i))})}),t("div",{className:"watermark-container",children:r("span",{className:"normal-text",children:["by ",t("span",{className:"name-text",children:l==null?void 0:l.username})]})})]})]})]})};function Dt(a){Q({className:"share-memo-image-dialog"},Tt,{memo:a})}const wt=a=>{var C;const{memo:e}=a,n=v(T({},e),{formattedContent:q(e.content),createdAtStr:b.getDateTimeString(e.createdAt)}),[s,o]=z(!1),c=Array.from((C=n.content.match(j))!=null?C:[]),l=()=>{Se(n)},y=()=>{R.setMarkMemoId(n.id)},h=()=>{R.setEditMemoId(n.id)},f=async()=>{if(s){try{await D.hideMemoById(n.id),await D.fetchMoreMemos()}catch(E){k.error(E.message)}R.getState().editMemoId===n.id&&R.setEditMemoId("")}else o()},x=()=>{s&&o(!1)},p=()=>{Dt(n)},m=async E=>{var u;const i=E.target;if(i.className==="memo-link-text"){const g=(u=i.dataset)==null?void 0:u.value,N=await D.getMemoById(g!=null?g:"");N?Se(N):(k.error("MEMO Not Found"),i.classList.remove("memo-link-text"))}else i.className==="todo-block"};return r("div",{className:`memo-wrapper ${"memos-"+n.id}`,onMouseLeave:x,children:[r("div",{className:"memo-top-wrapper",children:[t("span",{className:"time-text",onClick:l,children:n.createdAtStr}),r("div",{className:"btns-container",children:[t("span",{className:"text-btn more-action-btn",children:t("img",{className:"icon-img",src:"/icons/more.svg"})}),t("div",{className:"more-action-btns-wrapper",children:r("div",{className:"more-action-btns-container",children:[t("span",{className:"text-btn",onClick:l,children:"\u67E5\u770B\u8BE6\u60C5"}),t("span",{className:"text-btn",onClick:y,children:"Mark"}),t("span",{className:"text-btn",onClick:p,children:"\u5206\u4EAB"}),t("span",{className:"text-btn",onClick:h,children:"\u7F16\u8F91"}),t("span",{className:`text-btn delete-btn ${s?"final-confirm":""}`,onClick:f,children:s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]}),t("div",{className:"memo-content-text",onClick:m,dangerouslySetInnerHTML:{__html:n.formattedContent}}),t(V,{when:c.length>0,children:t("div",{className:"images-wrapper",children:c.map((E,i)=>t(me,{className:"memo-img",imgUrl:E},i))})})]})};function q(a){var c;const e=document.createElement("div");e.innerHTML=St(a).split("<br>").map(l=>l!==""?`<p>${l}</p>`:"<br>").join(""),a=e.innerHTML;const{shouldUseMarkdownParser:n,shouldSplitMemoWord:s,shouldHideImageUrl:o}=R.getState();n&&(a=Et(a)),o&&(a=a.replace(j,"")),e.innerHTML=a;for(const l of e.querySelectorAll("p"))l.textContent===""&&((c=l.firstElementChild)==null?void 0:c.tagName)!=="BR"&&l.remove();return a=e.innerHTML,a=a.replace(ee,"<span class='tag-span'>#$1</span>").replace(Ne,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(ue,"<span class='memo-link-text' data-value='$2'>$1</span>"),s&&(a=a.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5]?)/g,"$1 $2 $3")),a}var vt=d.exports.memo(wt);const kt=a=>{var o;const{memo:e}=a,n=v(T({},e),{formattedContent:q(e.content),createdAtStr:b.getDateTimeString(e.createdAt),timeStr:b.getTimeString(e.createdAt)}),s=Array.from((o=n.content.match(j))!=null?o:[]);return r("div",{className:"daily-memo-wrapper",children:[t("div",{className:"time-wrapper",children:t("span",{className:"normal-text",children:n.timeStr})}),r("div",{className:"memo-content-container",children:[t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:n.formattedContent}}),t(V,{when:s.length>0,children:t("div",{className:"images-container",children:s.map((c,l)=>t("img",{crossOrigin:"anonymous",src:c,decoding:"async"},l))})})]})]})};const Ft=a=>{const{className:e,datestamp:n,handleDateStampChange:s}=a,[o,c]=d.exports.useState(he(n));d.exports.useEffect(()=>{c(he(n))},[n]);const l=new Date(o),y=l.getDay()===0?7:l.getDay(),h=[];for(let m=1;m<y;m++)h.push({date:0,datestamp:l.getTime()-G*(7-m)});const f=At(o);for(let m=1;m<=f;m++)h.push({date:m,datestamp:l.getTime()+G*(m-1)});const x=m=>{s(m)},p=m=>{const C=l.getFullYear(),E=l.getMonth()+1;let i=0;E===1&&m===-1?i=new Date(`${C-1}/12/1`).getTime():E===12&&m===1?i=new Date(`${C+1}/1/1`).getTime():i=new Date(`${C}/${E+m}/1`).getTime(),c(he(i))};return r("div",{className:`date-picker-wrapper ${e}`,children:[r("div",{className:"date-picker-header",children:[t("span",{className:"btn-text",onClick:()=>p(-1),children:t("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),r("span",{className:"normal-text",children:[l.getFullYear()," \u5E74 ",l.getMonth()+1," \u6708"]}),t("span",{className:"btn-text",onClick:()=>p(1),children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),r("div",{className:"date-picker-day-container",children:[r("div",{className:"date-picker-day-header",children:[t("span",{className:"day-item",children:"\u5468\u4E00"}),t("span",{className:"day-item",children:"\u5468\u4E8C"}),t("span",{className:"day-item",children:"\u5468\u4E09"}),t("span",{className:"day-item",children:"\u5468\u56DB"}),t("span",{className:"day-item",children:"\u5468\u4E94"}),t("span",{className:"day-item",children:"\u5468\u516D"}),t("span",{className:"day-item",children:"\u5468\u65E5"})]}),h.map(m=>m.date===0?t("span",{className:"day-item null",children:""},m.datestamp):t("span",{className:`day-item ${m.datestamp===n?"current":""}`,onClick:()=>x(m.datestamp),children:m.date},m.datestamp))]})]})};function At(a){const e=new Date(a),n=new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`);return((n.getMonth()===11?new Date(`${n.getFullYear()+1}/1`):new Date(`${n.getFullYear()}/${n.getMonth()+2}/1`)).getTime()-n.getTime())/G}function he(a){const e=new Date(a);return new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`).getTime()}const Bt=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],It=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],Ot=a=>{const e=te(),[n,s]=d.exports.useState([]),[o,c]=d.exports.useState(b.getDateStampByDate(b.getDateString(a.currentDateStamp))),[l,y]=z(!1),h=d.exports.useRef(null),f=new Date(o);d.exports.useEffect(()=>{const m=()=>{const i=D.getState().memos.filter(u=>b.getTimeStampByDate(u.createdAt)>=o&&b.getTimeStampByDate(u.createdAt)<o+G).sort((u,g)=>b.getTimeStampByDate(u.createdAt)-b.getTimeStampByDate(g.createdAt));s(i),e.setFinish()},{memos:C}=D.getState(),E=C.slice(-1).pop();E&&b.getTimeStampByDate(E.createdAt)>=o?(e.setLoading(),D.fetchAllMemos().then(()=>{m()}).catch(i=>{k.error(i.message)})):m()},[o]);const x=()=>{y(!1),setTimeout(()=>{const m=b.getOSVersion();(m==="MacOS"||m==="Unknown")&&window.scrollTo(0,0),html2canvas(h.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(C=>{Ee(C.toDataURL())})},0)},p=m=>{c(m),y(!1)};return r(_,{children:[t("div",{className:"dialog-header-container",children:r("div",{className:"btns-wrapper",children:[r("div",{className:"btns-container",children:[t("span",{className:"btn-text",onClick:()=>c(o-G),children:t("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),t("span",{className:"btn-text",onClick:()=>c(o+G),children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),r("div",{className:"btns-container",children:[t("span",{className:"btn-text",onClick:x,children:t("img",{className:"icon-img",src:"/icons/share.svg"})}),t("span",{className:"btn-text",onClick:()=>a.destroy(),children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]})]})}),r("div",{className:"dialog-content-container",ref:h,children:[r("div",{className:"date-card-container",onClick:()=>y(),children:[t("div",{className:"year-text",children:f.getFullYear()}),r("div",{className:"date-container",children:[t("div",{className:"month-text",children:Bt[f.getMonth()]}),t("div",{className:"date-text",children:f.getDate()}),t("div",{className:"day-text",children:It[f.getDay()]})]})]}),t(Ft,{className:`date-picker ${l?"":"hide"}`,datestamp:o,handleDateStampChange:p}),e.isLoading?t("div",{className:"tip-container",children:t("p",{className:"tip-text",children:"\u52AA\u529B\u52A0\u8F7D\u4E2D..."})}):n.length===0?t("div",{className:"tip-container",children:t("p",{className:"tip-text",children:"\u7A7A\u7A7A\u5982\u4E5F"})}):t("div",{className:"dailymemos-wrapper",children:n.map(m=>t(kt,{memo:m},`${m.id}-${m.updatedAt}`))})]})]})};function Lt(a=Date.now()){Q({className:"daily-memo-diary-dialog"},Ot,{currentDateStamp:a})}const _t=()=>{const{userState:{user:a},memoState:{memos:e}}=d.exports.useContext($),[n,s]=d.exports.useState({memosAmount:0,tagsAmount:0}),o=a?a.username:"Memos",c=a?Math.ceil((Date.now()-b.getTimeStampByDate(a.createdAt))/1e3/3600/24):0;d.exports.useEffect(()=>{D.getMyDataAmount().then(h=>{s(h)}).catch(h=>{k.error(h.message)})},[e]);const l=d.exports.useCallback(()=>{O.pushHistory("/"),O.clearQuery()},[]);return r("div",{className:"user-banner-container",children:[r("div",{className:"userinfo-header-container",children:[t("p",{className:"username-text",onClick:l,children:o}),t("span",{className:"action-btn menu-popup-btn",onMouseEnter:()=>{const h=document.querySelector(".sidebar-wrapper"),f=document.querySelector(".menu-btns-popup");f.style.top=54-h.scrollTop+"px"},children:t("img",{src:"/icons/more.svg",className:"icon-img"})}),t(mt,{})]}),r("div",{className:"status-text-container",children:[r("div",{className:"status-text memos-text",children:[t("span",{className:"amount-text",children:n.memosAmount}),t("span",{className:"type-text",children:"MEMO"})]}),r("div",{className:"status-text tags-text",children:[t("span",{className:"amount-text",children:n.tagsAmount}),t("span",{className:"type-text",children:"TAG"})]}),r("div",{className:"status-text duration-text",onClick:()=>Lt(),children:[t("span",{className:"amount-text",children:c}),t("span",{className:"type-text",children:"DAY"})]})]})]})};const Pt=()=>{const{locationState:{query:a},memoState:{memos:e}}=d.exports.useContext($),n=te(),[s,o]=z(),[c,l]=d.exports.useState([]),[y,h]=d.exports.useState([]),[f,x]=d.exports.useState(a.tag);return d.exports.useEffect(()=>{D.getMyTags().then(p=>{const m=p.sort((i,u)=>b.getTimeStampByDate(u.createdAt)-b.getTimeStampByDate(i.createdAt)).sort((i,u)=>u.level-i.level),C={subTags:[]},E=[];for(const i of m){if(i.pinnedAt){E.push(v(T({},i),{key:i.text,subTags:[]}));continue}const u=i.text.split("/");let g=C,N="";for(let S=0;S<u.length;S++){const w=u[S];S===0?N+=w:N+="/"+w;let I=null;for(const L of g.subTags)if(L.text===N){I=L;break}I?I.level+=i.level:(I=v(T({},i),{id:"",key:w,text:N,subTags:[]}),g.subTags.push(I)),g.subTags.sort((L,Y)=>Y.level-L.level),N===i.text&&(I.id=i.id),g=I}}C.subTags.sort((i,u)=>u.level-i.level),l(C.subTags),E.sort((i,u)=>b.getTimeStampByDate(u.pinnedAt)-b.getTimeStampByDate(i.pinnedAt)),h(E),n.setFinish()}).catch(p=>{n.setError(),k.error(p)})},[e,s]),d.exports.useEffect(()=>{x(a.tag)},[a]),n.isLoading?null:t(_,{children:r("div",{className:"tags-wrapper",children:[y.length===0?null:r(_,{children:[t("p",{className:"title-text",children:"\u7F6E\u9876\u6807\u7B7E"}),t("div",{className:"tags-container",children:y.map((p,m)=>t(pe,{tag:p,tagQuery:f,refresh:o},p.id+"-"+m))})]}),t("p",{className:"title-text",children:"\u5168\u90E8\u6807\u7B7E"}),r("div",{className:"tags-container",children:[c.map((p,m)=>t(pe,{tag:p,tagQuery:f,refresh:o},p.id+"-"+m)),t(V,{when:c.length<5,children:r("p",{className:"tag-tip-container",children:["\u8F93\u5165",t("span",{className:"code-text",children:"# Tag "}),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~"]})})]})]})})},pe=a=>{const{refresh:e,tag:n,tagQuery:s}=a,o=s===n.text,c=n.subTags.length>0,[l,y]=z(s.includes(n.text)&&!o),h=n.id!=="";d.exports.useEffect(()=>{y(s.indexOf(n.text)===0&&!o)},[s,n]);const f=()=>{const C=o?"":n.text;C&&(b.copyTextToClipboard(`# ${C} `),D.polishTag(n.id).catch(()=>{})),O.pushHistory("/"),O.setTagQuery(C)},x=C=>{C.stopPropagation(),n.pinnedAt?D.unpinTag(n.id):D.pinTag(n.id),e()},p=C=>{h?(C.stopPropagation(),Rt(n)):k.info("\u8FD9\u4E2A\u4E0D\u662F\u771F\u6B63\u7684\u6807\u7B7E\uFF0C\u6240\u4EE5\u65E0\u6CD5\u91CD\u547D\u540D\u3002\u8BD5\u8BD5\u91CD\u547D\u540D\u5B83\u7684\u5B50\u6807\u7B7E\u5427")},m=C=>{C.stopPropagation(),y()};return r(_,{children:[r("div",{className:`tag-item-container ${o?"active":""}`,onClick:f,children:[r("div",{className:"tag-text-container",children:[t("span",{className:"icon-text",children:"#"}),t("div",{className:"action-btns-wrapper",children:r("div",{className:"action-btns-container",children:[t("span",{className:"text-btn",onClick:x,children:n.pinnedAt?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876"}),t("span",{className:"text-btn",onClick:p,children:"\u91CD\u547D\u540D"})]})}),t("span",{className:"tag-text",children:n.key})]}),t("div",{className:"btns-container",children:c?t("span",{className:`action-btn toggle-btn ${l?"shown":""}`,onClick:m,children:t("img",{className:"icon-img",src:`/icons/arrow-right${o?"-white":""}.svg`})}):null})]}),c?t("div",{className:`subtags-container ${l?"":"hidden"}`,children:n.subTags.map((C,E)=>t(pe,{tag:C,tagQuery:s,refresh:e},C.id+"-"+E))}):null]})},Ut=a=>{const{destroy:e,tag:n}=a,s=d.exports.useRef(null),o=()=>{e()},c=()=>{var y;const l=(y=s.current)==null?void 0:y.value;if(!l||l===n.text){e();return}D.updateTagText(n.id,l).then(()=>{D.clearMemos(),D.fetchMoreMemos(),e()}).catch(()=>{})};return r(_,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"}),"\u6807\u7B7E\u91CD\u547D\u540D"]}),t("button",{className:"text-btn close-btn",onClick:o,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("p",{className:"tag-text",children:["\u65E7\uFF1A",n.text]}),t("input",{className:"text-input",type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E",ref:s}),r("div",{className:"btns-container",children:[t("span",{className:"btn-text cancel-btn",onClick:o,children:"\u53D6\u6D88"}),t("span",{className:"btn-text confirm-btn",onClick:c,children:"\u786E\u5B9A"})]})]})]})};function Rt(a){Q({className:"rename-tag-dialog"},Ut,{tag:a})}const be={width:12,height:7},$t=(a,e)=>{const n=[];for(let s=1;s<=a;s++)n.push({timestamp:e+G*s,count:0});return n},Ht=()=>{const a=b.getDateStampByDate(Date.now()),e=new Date(a).getDay()||7,n=new Array(7-e).fill(0),{memoState:{memos:s}}=d.exports.useContext($),[o,c]=d.exports.useState([]),[l,y]=d.exports.useState(null),[h,f]=d.exports.useState(null),x=d.exports.useRef(null),p=d.exports.useRef(null);d.exports.useEffect(()=>{const i=b.getDateStampByDate(Date.now()),u=new Date(i).getDay()||7,g=(be.width-1)*be.height+u,N=i-g*G,S=$t(g,N);D.getMemosStat().then(w=>{for(const I of w){const L=(b.getDateStampByDate(I.timestamp)-N)/(1e3*3600*24)-1;L>=0&&(S[L].count+=1)}c([...S])}).catch(w=>{k.error(w.message)})},[s.length]);const m=d.exports.useCallback((i,u)=>{var I,L;y(u);const{isMobileView:g}=R.getState(),N=i.target,S=document.querySelector(".sidebar-wrapper");p.current.style.left=N.offsetLeft-((L=(I=x.current)==null?void 0:I.offsetLeft)!=null?L:0)+"px";let w=N.offsetTop;g||(w-=S.scrollTop),p.current.style.top=w+"px"},[]),C=d.exports.useCallback(()=>{y(null)},[]),E=d.exports.useCallback(i=>{O.getState().query.from===i.timestamp?(O.setFromAndToQuery(0,0),f(null)):i.count>0&&(O.setFromAndToQuery(i.timestamp,i.timestamp+G),f(i))},[]);return r("div",{className:"usage-heat-map-wrapper",ref:x,children:[r("div",{className:"day-tip-text-container",children:[t("span",{className:"tip-text",children:"Mon"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Wed"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Fri"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Sun"})]}),r("div",{ref:p,className:"usage-detail-container pop-up "+(l?"":"hidden"),children:[l==null?void 0:l.count," memos on ",t("span",{className:"date-text",children:new Date(l==null?void 0:l.timestamp).toDateString()})]}),r("div",{className:"usage-heat-map",children:[o.map((i,u)=>{const g=i.count,N=g<=0?"":g<=1?"stat-day-L1-bg":g<=2?"stat-day-L2-bg":g<=4?"stat-day-L3-bg":"stat-day-L4-bg";return t("span",{className:`stat-container ${N} ${h===i?"current":""} ${a===i.timestamp?"today":""}`,onMouseEnter:S=>m(S,i),onMouseLeave:C,onClick:()=>E(i)},u)}),n.map((i,u)=>t("span",{className:"stat-container null"},u))]})]})};const Gt=()=>{const{locationState:a}=d.exports.useContext($);d.exports.useEffect(()=>{const n=document.querySelector(J);n==null||n.classList.remove(Z)},[a]);const e=d.exports.useCallback(n=>{if(n.stopPropagation(),n.target.className==="sidebar-wrapper"){const o=document.querySelector(J);o==null||o.classList.remove(Z)}},[]);return r("aside",{className:"sidebar-wrapper",onClick:e,children:[t(_t,{}),t(Ht,{}),t(Pt,{})]})};function Qt(){const{locationState:{pathname:a}}=d.exports.useContext($),e=te();return d.exports.useEffect(()=>{U.doSignIn().catch(()=>{}).finally(async()=>{U.getState().user?(await D.fetchMoreMemos().catch(()=>{}),e.setFinish()):O.replaceHistory("/signin")})},[]),d.exports.useEffect(()=>{a!=="/"&&O.clearQuery()},[a]),t(_,{children:e.isLoading?null:r("section",{id:"page-container",children:[t(Gt,{}),t("main",{className:"content-wrapper",children:ia(a)})]})})}const Vt=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function Me(a,e){return e.minLength!==void 0&&a.length<e.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:e.maxLength!==void 0&&a.length>e.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:e.noSpace&&a.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:e.noChinese&&Vt.test(a)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const Te={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},qt=()=>{const[a,e]=d.exports.useState(""),[n,s]=d.exports.useState(""),o=d.exports.useRef(null);d.exports.useEffect(()=>{const f=x=>{var p;x.key==="Enter"&&((p=o.current)==null||p.click())};return document.body.addEventListener("keypress",f),()=>{document.body.removeEventListener("keypress",f)}},[]);const c=f=>{const x=f.target.value;e(x)},l=f=>{const x=f.target.value;s(x)},y=()=>{xe()},h=async()=>{const f=Me(a,Te);if(!f.result){k.error("\u7528\u6237\u540D "+f.reason);return}const x=Me(n,Te);if(!x.result){k.error("\u5BC6\u7801 "+x.reason);return}try{const p=A.signin,{succeed:m,message:C}=await p(a,n);if(!m&&C){k.error("\u{1F61F} "+C);return}await U.doSignIn()?(D.clearMemos(),D.fetchMoreMemos().catch(()=>{}),O.replaceHistory("/")):k.error("\u{1F61F} \u4E0D\u77E5\u9053\u53D1\u751F\u4E86\u4EC0\u4E48\u9519\u8BEF")}catch(p){console.error(p),k.error("\u{1F61F} "+p.message)}};return t("div",{className:"page-wrapper signin",children:r("div",{className:"page-container",children:[t("div",{className:"page-header-container",children:r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F44B}"})," \u8D26\u53F7\u6CE8\u518C / \u767B\u5F55"]})}),r("div",{className:"page-content-container",children:[r("label",{className:"form-label input-form-label",children:[t("input",{type:"text",value:a,onChange:c}),t("span",{className:"normal-text "+(a===""?"":"not-null"),children:"\u8D26\u53F7"})]}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:n,onChange:l}),t("span",{className:"normal-text "+(n===""?"":"not-null"),children:"\u5BC6\u7801"})]})]}),r("div",{className:"page-footer-container",children:[t("div",{className:"btns-container",children:t("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"Sign In with GitHub"})}),r("div",{className:"btns-container",children:[t("button",{className:"text-btn signup-btn disabled",onClick:()=>k.info("\u6CE8\u518C\u5DF2\u5173\u95ED"),children:"\u6CE8\u518C"}),t("span",{className:"split-text",children:"/"}),t("button",{className:"text-btn signin-btn",ref:o,onClick:h,children:"\u767B\u5F55"})]})]}),r("p",{className:"tip-text",children:["\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\uFF0C\u53EF\u8F93\u5165 ",t("code",{children:"guest, 123456"})," \u8FDB\u884C\u4F53\u9A8C\u3002",t("br",{}),r("span",{className:"text-btn",onClick:y,children:[t("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E\u672C\u7AD9"]})]})]})})},jt={"/signin":t(qt,{}),"*":t(Qt,{})};function Wt(){const[a,e]=d.exports.useState(!1);return d.exports.useCallback(()=>{e(s=>!s)},[])}const Yt=d.exports.forwardRef((a,e)=>{var g,N;const{className:n,initialContent:s,placeholder:o,showConfirmBtn:c,showCancelBtn:l,showTools:y,onConfirmBtnClick:h,onCancelBtnClick:f,onContentChange:x}=a,p=d.exports.useRef(null),m=Wt();d.exports.useEffect(()=>{s&&(p.current.value=s,m())},[]),d.exports.useEffect(()=>{var S;p.current&&(p.current.style.height="auto",p.current.style.height=((S=p.current.scrollHeight)!=null?S:0)+"px")},[(g=p.current)==null?void 0:g.value]),d.exports.useImperativeHandle(e,()=>({focus:()=>{p.current.focus()},insertText:S=>{const w=p.current.value;p.current.value=w+S,x(p.current.value),m()},setContent:S=>{p.current.value=ae(S),m()},getContent:()=>{var S,w;return(w=(S=p.current)==null?void 0:S.value)!=null?w:""}}),[]);const C=d.exports.useCallback(()=>{x(p.current.value),m()},[]),E=d.exports.useCallback(S=>{S.stopPropagation(),S.code==="Enter"&&(S.metaKey||S.ctrlKey)&&i(),m()},[]),i=d.exports.useCallback(()=>{h(p.current.value),p.current.value="",m()},[]),u=d.exports.useCallback(()=>{f()},[]);return r("div",{className:"common-editor-wrapper "+n,children:[t("textarea",{className:"common-editor-inputer",rows:1,placeholder:o,ref:p,onInput:C,onKeyDown:E}),r("div",{className:"common-tools-wrapper",children:[t(V,{when:y,children:t("div",{className:"common-tools-container"})}),r("div",{className:"btns-right-container",children:[t(V,{when:l,children:t("button",{className:"action-btn cancel-btn",onClick:u,children:"\u64A4\u9500\u4FEE\u6539"})}),t(V,{when:c,children:r("button",{className:"action-btn confirm-btn",disabled:!((N=p.current)==null?void 0:N.value),onClick:i,children:["\u8BB0\u4E0B",t("span",{className:"icon-text",children:"\u270D\uFE0F"})]})})]})]})]})});const Kt=()=>{const{globalState:a}=d.exports.useContext($),e=d.exports.useRef(null),n=d.exports.useRef(a);d.exports.useEffect(()=>{var h,f;if(a.markMemoId){const p=`${((h=e.current)==null?void 0:h.getContent())?`
`:""}Mark: [@MEMO](${a.markMemoId})`;(f=e.current)==null||f.insertText(p),R.setMarkMemoId("")}n.current.editMemoId!==a.editMemoId&&a.editMemoId&&D.getMemoById(a.editMemoId).then(x=>{var p,m,C;x&&((m=e.current)==null||m.setContent((p=x.content)!=null?p:""),(C=e.current)==null||C.focus())}),n.current=a},[a.markMemoId,a.editMemoId]);const s=d.exports.useCallback(async h=>{var C,E;if(h===""){k.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}const{editMemoId:f}=R.getState(),{query:x}=O.getState();h=ae(h.replaceAll("&nbsp;"," "));const p=b.dedupe(Array.from((C=h.match(ee))!=null?C:[])).map(i=>i.replace(ee,"$1").trim()),m=[];try{for(const i of p){const u=await D.createTag(i);m.push(u)}if(f){const i=await D.getMemoById(f);if(i&&i.content!==h){const u=(E=i.tags)!=null?E:[],g=u.map(S=>S.text);m.push(...u);for(let S=0;S<m.length;){const w=m[S],I=w.text;p.includes(I)?(S++,g.includes(I)||await D.createMemoTag(i.id,w.id)):(m.splice(S,1),await D.removeMemoTag(i.id,w.id))}const N=await D.updateMemo(i.id,h);N.tags=m,N.updatedAt=b.getDateTimeString(Date.now()),D.editMemo(N)}R.setEditMemoId("")}else{const i=await D.createMemo(h);i.tags=m;for(const g of m)await D.createMemoTag(i.id,g.id);const u=x.tag;u!==""&&!p.includes(u)&&O.setTagQuery(""),D.pushMemo(i)}}catch(i){k.error(i.message)}ge("")},[]),o=d.exports.useCallback(()=>{var h;R.setEditMemoId(""),(h=e.current)==null||h.setContent(""),ge("")},[]),c=d.exports.useCallback(h=>{const f=document.createElement("div");f.innerHTML=h,f.innerText.trim()===""&&(h=""),ge(h)},[]),{editMemoId:l}=a,y=d.exports.useMemo(()=>({className:"memo-editor",initialContent:zt(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,showCancelBtn:l!=="",showTools:!0,onConfirmBtnClick:s,onCancelBtnClick:o,onContentChange:c}),[l]);return r("div",{className:"memo-editor-wrapper "+(l?"edit-ing":""),children:[t("p",{className:"tip-text "+(l?"":"hidden"),children:"\u6B63\u5728\u4FEE\u6539\u4E2D..."}),t(Yt,T({ref:e},y))]})};function zt(){var a;return(a=W.get(["editorContentCache"]).editorContentCache)!=null?a:""}function ge(a){W.set({editorContentCache:a})}const Xt=()=>{const{locationState:{query:{text:a,type:e}}}=d.exports.useContext($),n=d.exports.useRef(null),s=c=>{const{type:l}=O.getState().query;c===l&&(c=""),O.setMemoTypeQuery(c)};return r("div",{className:"search-bar-container",children:[r("div",{className:"search-bar-inputer",children:[t("img",{className:"icon-img",src:"/icons/search.svg"}),t("input",{className:"text-input",type:"text",placeholder:"",ref:n,value:a,onChange:c=>{const l=c.currentTarget.value;O.setTextQuery(l)}})]}),t("div",{className:"quickly-action-wrapper",children:r("div",{className:"quickly-action-container",children:[t("p",{className:"title-text",children:"QUICKLY FILTER"}),r("div",{className:"section-container types-container",children:[t("span",{className:"section-text",children:"\u7C7B\u578B:"}),de.map((c,l)=>r("div",{children:[t("span",{className:`type-item ${e===c.type?"selected":""}`,onClick:()=>{s(c.type)},children:c.text}),l+1<de.length?t("span",{className:"split-text",children:"/"}):null]},c.type))]})]})})]})};const Jt=()=>{const a=d.exports.useCallback(()=>{O.clearQuery()},[]),e=d.exports.useCallback(n=>{n.stopPropagation();const s=document.querySelector(J);s&&s.classList.add(Z)},[]);return r("div",{className:"section-header-container memos-header-container",children:[r("div",{className:"title-text",onClick:a,children:[t("button",{className:"action-btn",onClick:e,children:t("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})}),t("span",{className:"normal-text",children:"MEMO"})]}),t(Xt,{})]})};function Zt(a,e,n=[]){const s=d.exports.useRef(),o=d.exports.useCallback(()=>{s.current&&clearTimeout(s.current)},[]);return d.exports.useCallback((...l)=>{o(),s.current=window.setTimeout(()=>{a(...l)},e)},n)}const ea=a=>{for(const e of de)if(e.type===a)return e.text;return""},ta=()=>{const{locationState:{query:a},memoState:{memos:e}}=d.exports.useContext($),[n,s]=d.exports.useState(!1),[o,c]=d.exports.useState(!1),l=d.exports.useRef(null),y=a.tag,h={from:a.from,to:a.to},f=a.type,x=a.text,p=Boolean(y||h.from!==0&&h.from<h.to||f||x),m=p?e.filter(u=>{let g=!0;const N=[];for(const S of u.tags){const w=S.text.split("/");let I="";for(let L=0;L<w.length;L++)L===0?I+=w[L]:I+="/"+w[L],N.push(I)}return y!==""&&!N.includes(y)&&(g=!1),h.from!==0&&h.from<h.to&&(b.getTimeStampByDate(u.createdAt)<h.from||b.getTimeStampByDate(u.createdAt)>h.to)&&(g=!1),f!==""&&(f==="NOT_TAGGED"?u.content.match(ee)!==null&&(g=!1):f==="LINKED"?u.content.match(Ne)===null&&(g=!1):f==="IMAGED"?u.content.match(j)===null&&(g=!1):f==="CONNECTED"&&u.content.match(ue)===null&&(g=!1)),x!==""&&!u.content.includes(x)&&(g=!1),g}):e;d.exports.useEffect(()=>{var u;(u=l.current)==null||u.scrollTo({top:0}),!o&&p&&(s(!0),D.fetchAllMemos().then(g=>{g!==!1&&(c(!0),s(!1))}))},[o,p,a]);const C=async()=>{if(!(n||o)){s(!0);try{const u=await D.fetchMoreMemos();Array.isArray(u)&&u.length===0&&c(!0)}catch(u){k.error(u.message)}s(!1)}},E=d.exports.useCallback(u=>{const g=u.target;if(g.tagName==="SPAN"&&g.className==="tag-span"){const N=g.innerText.slice(1);O.getState().query.tag===N?O.setTagQuery(""):O.setTagQuery(N)}},[]),i=Zt(()=>{if(n||o)return;const{offsetHeight:u,scrollTop:g,scrollHeight:N}=l.current;u+g+10>N&&C()},100,[n,o]);return r(_,{children:[t(aa,{showFilter:p,tagQuery:y,duration:h,memoType:f,textQuery:x}),r("div",{className:`memolist-wrapper ${o?"completed":""}`,onClick:E,onScroll:i,ref:l,children:[m.map(u=>t(vt,{memo:u},`${u.id}-${u.updatedAt}`)),p?t("div",{className:"status-text-container",children:t("p",{className:"status-text",children:n?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":o&&m.length===0?"\u7A7A\u7A7A\u5982\u4E5F":""})}):t("div",{className:`status-text-container ${o?"completed":""} ${n||o?"":"invisible"}`,children:t("p",{className:"status-text",children:o?"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}":"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})})]})]})},aa=a=>{const{showFilter:e,tagQuery:n,duration:s,memoType:o,textQuery:c}=a;return r("div",{className:`filter-query-container ${e?"":"hidden"}`,children:[t("span",{className:"tip-text",children:"\u7B5B\u9009\uFF1A"}),r("div",{className:"filter-item-container "+(s.from!==0&&s.from<s.to?"":"hidden"),onClick:()=>{O.setFromAndToQuery(0,0)},children:[t("span",{className:"icon-text",children:"\u{1F5D3}\uFE0F"})," ",b.getDateString(s.from)," \u81F3 ",b.getDateString(s.to)]}),r("div",{className:"filter-item-container "+(n?"":"hidden"),onClick:()=>{O.setTagQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"})," ",n]}),r("div",{className:"filter-item-container "+(o?"":"hidden"),onClick:()=>{O.setMemoTypeQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F4E6}"})," ",ea(o)]}),r("div",{className:"filter-item-container "+(c?"":"hidden"),onClick:()=>{O.setTextQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F50D}"})," ",c]})]})};function na(){return r(_,{children:[t(Jt,{}),t(Kt,{}),t(ta,{})]})}const sa=a=>{var x,p;const{memo:e,handleDeletedMemoAction:n}=a,s=v(T({},e),{formattedContent:q(e.content),createdAtStr:b.getDateTimeString(e.createdAt),deletedAtStr:b.getDateTimeString((x=e.deletedAt)!=null?x:Date.now())}),[o,c]=z(!1),l=Array.from((p=s.content.match(j))!=null?p:[]),y=async()=>{if(o)try{await D.deleteMemoById(s.id),n(s.id)}catch(m){k.error(m.message)}else c()},h=async()=>{try{await D.restoreMemoById(s.id),n(s.id),k.info("\u6062\u590D\u6210\u529F")}catch(m){k.error(m.message)}},f=()=>{o&&c(!1)};return r("div",{className:`memo-wrapper ${"memos-"+s.id}`,onMouseLeave:f,children:[r("div",{className:"memo-top-wrapper",children:[r("span",{className:"time-text",children:["\u5220\u9664\u4E8E ",s.deletedAtStr]}),r("div",{className:"btns-container",children:[t("span",{className:"text-btn more-action-btn",children:t("img",{className:"icon-img",src:"/icons/more.svg"})}),t("div",{className:"more-action-btns-wrapper",children:r("div",{className:"more-action-btns-container",children:[t("span",{className:"text-btn restore-btn",onClick:h,children:"\u6062\u590D"}),t("span",{className:`text-btn delete-btn ${o?"final-confirm":""}`,onClick:y,children:o?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5B8C\u5168\u5220\u9664"})]})})]})]}),t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:s.formattedContent}}),t(V,{when:l.length>0,children:t("div",{className:"images-wrapper",children:l.map((m,C)=>t(me,{className:"memo-img",imgUrl:m},C))})})]})};const oa=()=>{const a=te(),[e,n]=d.exports.useState([]);d.exports.useEffect(()=>{D.fetchDeletedMemos().then(c=>{c!==!1&&n(c),a.setFinish()})},[]);const s=d.exports.useCallback(c=>{n(e.filter(l=>l.id!==c))},[e]),o=d.exports.useCallback(c=>{c.stopPropagation();const l=document.querySelector(J);l&&l.classList.add(Z)},[]);return r("div",{className:"memo-trash-wrapper",children:[t("div",{className:"section-header-container",children:r("div",{className:"title-text",children:[t("button",{className:"action-btn",onClick:o,children:t("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})}),t("span",{className:"normal-text",children:"\u56DE\u6536\u7AD9"})]})}),a.isLoading?null:e.length===0?t("div",{className:"empty-container",children:t("p",{className:"empty-text",children:"No Zettels."})}):e.map(c=>t(sa,{memo:c,handleDeletedMemoAction:s},`${c.id}-${c.updatedAt}`))]})},ra={"/trash":t(oa,{}),"*":t(na,{})},De=a=>e=>{for(const n of Object.keys(a))if(n===e)return a[n];return a["*"]},ca=De(jt),ia=De(ra);function la(){const{locationState:{pathname:a}}=d.exports.useContext($);return d.exports.useEffect(()=>{const e=()=>{R.setIsMobileView(document.body.clientWidth<=875)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),t(_,{children:ca(a)})}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(a,e){return Object.prototype.toString.call(a).toLowerCase()==="[object regexp]"?this.replace(a,e):this.replace(new RegExp(a,"g"),e)})})();K.render(t(Ue.StrictMode,{children:t(ye,{store:F,context:$,children:t(la,{})})}),document.getElementById("root"));
