var De=Object.defineProperty,we=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var te=(a,t,n)=>t in a?De(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,w=(a,t)=>{for(var n in t||(t={}))Te.call(t,n)&&te(a,n,t[n]);if(ie)for(var n of ie(t))Fe.call(t,n)&&te(a,n,t[n]);return a},k=(a,t)=>we(a,ve(t));var U=(a,t,n)=>(te(a,typeof t!="symbol"?t+"":t,n),n);import{r as u,R as e,a as Q}from"./vendor.4f50e650.js";const ke=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}};ke();const ue=a=>{const{children:t,store:n,context:s}=a,[r,l]=u.exports.useState(n.getState());return u.exports.useEffect(()=>{const m=n.subscribe(o=>{l(o)});return()=>{m()}},[]),e.createElement(s.Provider,{value:r},t)};function Ae(a){const t=Object.keys(a),n={};for(const s of t)typeof a[s]=="function"&&(n[s]=a[s]);return(s={},r)=>{let l=!1;const m={};for(const o of t){const h=s[o],p=n[o](h,r);m[o]=p,l=l||p!==h}return l?m:s}}function Be(a,t){const n=[];let s=a;return{dispatch:o=>{const h=t(s,o),p=s;s=h;for(const g of n)g(s,p)},getState:()=>s,subscribe:o=>{let h=!0;return n.push(o),()=>{if(!h)return;const p=n.indexOf(o);n.splice(p,1),h=!1}}}}function Ie(a,t){switch(t.type){case"SET_MARK_MEMO_ID":return k(w({},a),{markMemoId:t.payload.markMemoId});case"SET_EDIT_MEMO_ID":return k(w({},a),{editMemoId:t.payload.editMemoId});case"SET_APP_SETTING":return w(w({},a),t.payload);default:return a}}const Le={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,showDarkMode:!1};function _e(a,t){switch(t.type){case"SET_TAG_QUERY":return k(w({},a),{query:k(w({},a.query),{tag:t.payload.tag})});case"SET_FROM_TO_QUERY":return k(w({},a),{query:k(w({},a.query),{from:t.payload.from,to:t.payload.to})});case"SET_TYPE":return k(w({},a),{query:k(w({},a.query),{type:t.payload.type})});case"SET_TEXT":return k(w({},a),{query:k(w({},a.query),{text:t.payload.text})});case"SET_HASH":return k(w({},a),{hash:t.payload.hash});default:return a}}const Ue={hash:"",query:{tag:"",from:0,to:0,type:"",text:""}};var M;(function(a){function t(){return Date.now()}a.getNowTimeStamp=t;function n(){const d=navigator.appVersion;let i="Unknown";return d.indexOf("Win")!=-1?i="Windows":d.indexOf("Mac")!=-1?i="MacOS":d.indexOf("Linux")!=-1&&(i="Linux"),i}a.getOSVersion=n;function s(d){return typeof d=="string"&&(d=d.replaceAll("-","/")),new Date(d).getTime()}a.getTimeStampByDate=s;function r(d){const i=new Date(s(d));return new Date(i.getFullYear(),i.getMonth(),i.getDate()).getTime()}a.getDateStampByDate=r;function l(d){const i=new Date(s(d)),E=i.getFullYear(),N=i.getMonth()+1,S=i.getDate();return`${E}/${N}/${S}`}a.getDateString=l;function m(d){const i=new Date(s(d)),E=i.getHours(),N=i.getMinutes(),S=E<10?"0"+E:E,b=N<10?"0"+N:N;return`${S}:${b}`}a.getTimeString=m;function o(d){const i=new Date(s(d)),E=i.getFullYear(),N=i.getMonth()+1,S=i.getDate(),b=i.getHours(),B=i.getMinutes(),_=i.getSeconds(),W=N<10?"0"+N:N,z=S<10?"0"+S:S,X=b<10?"0"+b:b,J=B<10?"0"+B:B,Z=_<10?"0"+_:_;return`${E}-${W}-${z} ${X}:${J}:${Z}`}a.getDateTimeString=o;function h(d){return Array.from(new Set(d))}a.dedupe=h;function p(d){const i=new Set,E=[];for(const N of d)i.has(N.id)||(i.add(N.id),E.push(N));return E}a.dedupeObjectWithId=p;function g(d,i){let E=null;return()=>{E&&clearTimeout(E),E=setTimeout(d,i)}}a.debounce=g;function f(d,i){let E=!0;return()=>{if(!E)return!1;E=!1,setTimeout(()=>{d(),E=!0},i)}}a.throttle=f;function c(d){const i=[],E=Object.keys(d),N=Object.values(d);for(let S=0;S<E.length;++S)N[S]&&i.push(`${E[S]}=${N[S]}`);return i.join("&")}a.iterObjectToParamsString=c;async function x(d){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(d)}catch(i){console.warn("Copy to clipboard failed.",i)}else console.warn("Copy to clipboard failed, methods not supports.")}a.copyTextToClipboard=x;function y(d){return new Promise((i,E)=>{const N=new Image;N.onload=()=>{const{width:S,height:b}=N;S>0&&b>0?i({width:S,height:b}):i({width:0,height:0})},N.onerror=()=>{i({width:0,height:0})},N.className="hidden",N.src=d,document.body.appendChild(N),N.remove()})}a.getImageSize=y})(M||(M={}));function Oe(a,t){switch(t.type){case"SET_MEMOS":return{memos:[...t.payload.memos]};case"PUSH_MEMO":return{memos:[t.payload.memo,...a.memos].sort((s,r)=>M.getTimeStampByDate(r.createdAt)-M.getTimeStampByDate(s.createdAt))};case"PUSH_MEMOS":return{memos:[...t.payload.memos,...a.memos].sort((s,r)=>M.getTimeStampByDate(r.createdAt)-M.getTimeStampByDate(s.createdAt))};case"DELETE_MEMO_BY_ID":return{memos:[...a.memos].filter(n=>n.id!==t.payload.id)};case"EDIT_MEMO":return{memos:a.memos.map(s=>s.id===t.payload.id?w(w({},s),t.payload):s)};default:return a}}const Pe={memos:[]};function Re(a,t){switch(t.type){case"SIGN_IN":return{user:t.payload.user};case"SIGN_OUT":return{user:null};default:return a}}const $e={user:null},T=Be({globalState:Le,locationState:Ue,memoState:Pe,userState:$e},Ae({globalState:Ie,locationState:_e,memoState:Oe,userState:Re})),P=u.exports.createContext(T.getState());var G;(function(a){function t(r){const l={};for(const m of r)try{const o=localStorage.getItem(m);if(o!==null){const h=JSON.parse(o);l[m]=h}}catch(o){console.error("Get storage failed in ",m,o)}return l}a.get=t;function n(r){for(const l in r)try{const m=JSON.stringify(r[l]);localStorage.setItem(l,m)}catch(m){console.error("Save storage failed in ",l,m)}}a.set=n;function s(){var l;const r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r),(l=r.contentWindow)==null||l.localStorage.setItem("t",Date.now().toString()),r.remove()}a.emitStorageChangedEvent=s})(G||(G={}));class He{constructor(){U(this,"getState",()=>T.getState().globalState);U(this,"setEditMemoId",t=>{T.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:t}})});U(this,"setMarkMemoId",t=>{T.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:t}})});U(this,"setAppSetting",t=>{T.dispatch({type:"SET_APP_SETTING",payload:t}),G.set(t)});var s,r,l,m;const t=G.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser","showDarkMode"]),n={shouldSplitMemoWord:(s=t.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(r=t.shouldHideImageUrl)!=null?r:!0,shouldUseMarkdownParser:(l=t.shouldUseMarkdownParser)!=null?l:!0,showDarkMode:(m=t.showDarkMode)!=null?m:!1};this.setAppSetting(n)}}const O=new He,Y=()=>{let a=M.iterObjectToParamsString(T.getState().locationState.query);a?a="?"+a:a="",history.replaceState(null,"","/"+a)};class Qe{constructor(){U(this,"initLocation",()=>{var n,s,r,l,m;const t=new URLSearchParams(window.location.search);this.setTagQuery((n=t.get("tag"))!=null?n:""),this.setFromAndToQuery(parseInt((s=t.get("from"))!=null?s:"0"),parseInt((r=t.get("to"))!=null?r:"0")),this.setMemoTypeQuery((l=t.get("type"))!=null?l:""),this.setTextQuery((m=t.get("text"))!=null?m:"")});U(this,"getState",()=>T.getState().locationState);U(this,"clearQuery",()=>{T.dispatch({type:"SET_TAG_QUERY",payload:{tag:""}}),T.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:0,to:0}}),Y()});U(this,"setHash",t=>{T.dispatch({type:"SET_HASH",payload:{hash:t}}),Y()});U(this,"setMemoTypeQuery",(t="")=>{T.dispatch({type:"SET_TYPE",payload:{type:t}}),Y()});U(this,"setTextQuery",t=>{T.dispatch({type:"SET_TEXT",payload:{text:t}}),Y()});U(this,"setTagQuery",t=>{T.dispatch({type:"SET_TAG_QUERY",payload:{tag:t}}),Y()});U(this,"setFromAndToQuery",(t,n)=>{T.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:t,to:n}}),Y()});this.initLocation()}}const L=new Qe;var F;(function(a){async function t(C){const V=await(await fetch(C,{method:"GET"})).json();if(!V.succeed)throw V;return V}a.get=t;async function n(C,I){const ee=await(await fetch(C,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)})).json();if(!ee.succeed)throw ee;return ee}a.post=n;function s(){return t("/api/user/me")}a.getUserInfo=s;function r(C,I){return n("/api/user/signin",{username:C,password:I})}a.signin=r;function l(C,I){return n("/api/user/signup",{username:C,password:I})}a.signup=l;function m(){return n("/api/user/signout")}a.signout=m;function o(C){return t("/api/user/checkusername?username="+C)}a.checkUsernameUsable=o;function h(C){return n("/api/user/checkpassword",{password:C})}a.checkPasswordValid=h;function p(C="",I=""){return n("/api/user/update",{username:C,password:I})}a.updateUserinfo=p;function g(C=0,I=20){return t(`/api/memo/all?offset=${C}&amount=${I}`)}a.getMyMemos=g;function f(C){return n("/api/memo/new",{content:C})}a.createMemo=f;function c(C){return t("/api/memo/?id="+C)}a.getMemoById=c;function x(C){return n("/api/memo/delete",{memoId:C})}a.deleteMemo=x;function y(C,I){return n("/api/memo/update",{memoId:C,content:I})}a.updateMemo=y;function d(){return t("/api/memo/count")}a.getMemosCount=d;function i(C){return n("/api/tag/new",{text:C})}a.createTag=i;function E(C,I){return n("/api/tag/link",{memoId:C,tagId:I})}a.createMemoTag=E;function N(C,I){return n("/api/tag/rmlink",{memoId:C,tagId:I})}a.removeMemoTag=N;function S(C){return t("/api/tag/memo?id="+C)}a.getTagsByMemoId=S;function b(){return t("/api/tag/all")}a.getMyTags=b;function B(C){return n("/api/tag/delete",{tagId:C})}a.deleteTagById=B;function _(C){return n("/api/tag/polish",{tagId:C})}a.polishTag=_;function W(C,I){return n("/api/tag/update",{id:C,text:I})}a.updateTagText=W;function z(){return t("/api/user/amount")}a.getMyDataAmount=z;function X(C){return t("/api/base/srctype?url="+C)}a.getUrlContentType=X;function J(){return t("/api/memo/stat")}a.getMemosStat=J;function Z(){return n("/api/user/updategh",{githubName:""})}a.removeGithubName=Z})(F||(F={}));const ae="div#page-container",ne="mobile-show-sidebar",Ge=20,se=200,Ye=400,$=3600*24*1e3,K=/#\s(.+?)\s/g,de=/(https?:\/\/[^\s<\\*>']+)/g,j=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,pe=/\[@(.+?)\]\((.+?)\)/g,re=[{type:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{type:"LINKED",text:"\u6709\u94FE\u63A5"},{type:"IMAGED",text:"\u6709\u56FE\u7247"}];class je{getState(){return T.getState().userState}async doSignIn(){const{data:t}=await F.getUserInfo();return t?T.dispatch({type:"SIGN_IN",payload:{user:t}}):A.doSignOut(),t}async doSignOut(){F.signout().catch(()=>{}),T.dispatch({type:"SIGN_OUT",payload:{user:null}})}async checkUsernameUsable(t){const{data:n}=await F.checkUsernameUsable(t);return n}async updateUsername(t){await F.updateUserinfo(t)}async removeGithubName(){await F.removeGithubName()}async checkPasswordValid(t){const{data:n}=await F.checkPasswordValid(t);return n}async updatePassword(t){await F.updateUserinfo("",t)}}const A=new je;class qe{constructor(){U(this,"isFetching",!1)}getState(){return T.getState().memoState}async fetchMoreMemos(){if(!A.getState().user||this.isFetching)return!1;this.isFetching=!0;const{data:t}=await F.getMyMemos(this.getState().memos.length,Ge),n=t.map(s=>w({},s));return T.dispatch({type:"PUSH_MEMOS",payload:{memos:n}}),this.isFetching=!1,n}async fetchAllMemos(){if(!A.getState().user)return!1;this.isFetching=!0;const{data:{memosAmount:t}}=await F.getMyDataAmount(),{data:n}=await F.getMyMemos(0,t),s=n.map(r=>w({},r));return s.length>0&&T.dispatch({type:"SET_MEMOS",payload:{memos:s}}),this.isFetching=!1,n}pushMemo(t){T.dispatch({type:"PUSH_MEMO",payload:{memo:w({},t)}})}async getMemoById(t){for(const s of this.getState().memos)if(s.id===t)return s;const{data:n}=await F.getMemoById(t);return n}async deleteMemoById(t){await F.deleteMemo(t),T.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:t}})}editMemo(t){T.dispatch({type:"EDIT_MEMO",payload:t})}clearMemos(){T.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(t){const{data:n}=await F.createMemo(t);return n}async updateMemo(t,n){const{data:s}=await F.updateMemo(t,n);return s}async createTag(t){const{data:n}=await F.createTag(t);return n}async removeMemoTag(t,n){await F.removeMemoTag(t,n)}async createMemoTag(t,n){await F.createMemoTag(t,n)}async getMyDataAmount(){const{data:t}=await F.getMyDataAmount();return t}async getMemosStat(){const{data:t}=await F.getMemosStat();return t}async getMyTags(){if(!A.getState().user)return[];const{data:t}=await F.getMyTags();return t}async polishTag(t){await F.polishTag(t)}async updateTagText(t,n){await F.updateTagText(t,n)}}const D=new qe,Ve=()=>{const{userState:{user:a}}=u.exports.useContext(P),t=a?a.username:"Memos",n=u.exports.useCallback(()=>{L.clearQuery()},[]),s=u.exports.useCallback(()=>{const r=document.querySelector(ae);r&&r.classList.add(ne)},[]);return e.createElement("div",{className:"mobile-header-container"},e.createElement("p",{className:"username-text",onClick:n},t),e.createElement("div",{className:"btns-container"},e.createElement("button",{className:"action-btn show-sidebar",onClick:s},e.createElement("img",{className:"icon-img",src:"/icons/fold.svg",alt:"fold"}))))};const Ke=a=>{const{destory:t,duration:n}=a;return u.exports.useEffect(()=>{n>0&&setTimeout(()=>{t()},n)},[]),e.createElement("div",{className:"toast-container",onClick:t},e.createElement("p",{className:"content-text"},a.content))},v=(()=>{const a=document.createElement("div");a.className="toast-list-container",document.body.appendChild(a);let t=0;const n=[],s=m=>{const o=document.createElement("div");o.className=`toast-wrapper ${m.type}`,a.appendChild(o),t++,n.push(o),setTimeout(()=>{o.classList.add("showup")},0);const h={destory:()=>{o.classList.add("destory"),setTimeout(()=>{if(!!o.parentElement&&(t--,t===0)){for(const p of n)Q.unmountComponentAtNode(p),p.remove();n.splice(0,n.length)}},Ye)}};return Q.render(e.createElement(Ke,k(w({},m),{destory:h.destory})),o),h};return{info:(m,o=3e3)=>s({type:"normal",content:m,duration:o}),error:(m,o=3e3)=>s({type:"error",content:m,duration:o})}})(),We=a=>{const{children:t,when:n}=a;return n?e.createElement(e.Fragment,null,t):null},H=We;const ze={className:"",content:"",placeholder:"",showConfirmBtn:!0,showCancelBtn:!1,showTools:!1},Xe=(a=ze)=>{const{className:t,content:n,placeholder:s,showConfirmBtn:r,showCancelBtn:l,showTools:m,handleConfirmBtnClick:o,handleCancelBtnClick:h,handleContentChange:p}=a,[g,f]=u.exports.useState(n),c=u.exports.useRef(null);u.exports.useEffect(()=>{g&&c.current&&(c.current.innerHTML=g)},[]),u.exports.useImperativeHandle(a.editorRef,()=>({focus:()=>{var N;(N=c.current)==null||N.focus()},insertText:N=>{const S=g+N;f(S),c.current&&(c.current.innerHTML=S),p&&p(S)},setContent:N=>{const S=N;f(S),c.current&&(c.current.innerHTML=S)},getContent:()=>g}));const x=u.exports.useCallback(N=>{const S=N.clipboardData.getData("text"),b=window.getSelection();!b||!b.rangeCount||(b.deleteFromDocument(),b.getRangeAt(0).insertNode(document.createTextNode(S)),N.preventDefault(),f(S),p&&p(S))},[]),y=u.exports.useCallback(N=>{const S=N.currentTarget.innerHTML;f(S),p&&p(S)},[]),d=u.exports.useCallback(N=>{if(N.stopPropagation(),N.key==="Tab"){N.preventDefault();const S=window.getSelection();if(!S||!S.rangeCount)return;S.deleteFromDocument();const b=S.getRangeAt(0),B=document.createTextNode("    ");b.insertNode(B),b.setEndAfter(B),b.setStartAfter(B),S.removeAllRanges(),S.addRange(b)}else if(N.key==="Backspace")c.current&&c.current.innerHTML==="<br>"&&(c.current.innerHTML="",f(""));else if(N.key==="Enter"){N.preventDefault();const S=window.getSelection();if(!S||!S.rangeCount)return;S.deleteFromDocument();const b=S.getRangeAt(0),B=document.createElement("p"),_=document.createElement("br");B.appendChild(_),b.insertNode(B),b.setEndAfter(_),b.setStartAfter(_),S.removeAllRanges(),S.addRange(b)}},[]),i=u.exports.useCallback(()=>{o&&(o(g),c.current&&(c.current.innerHTML=""),f(""))},[g]),E=u.exports.useCallback(()=>{h&&h()},[]);return e.createElement("div",{className:"common-editor-wrapper "+t},e.createElement("div",{className:"common-editor-inputer",contentEditable:!0,ref:c,onPaste:x,onInput:y,onKeyDown:d}),e.createElement("p",{className:g===""?"common-editor-placeholder":"hidden"},s),e.createElement("div",{className:"common-tools-wrapper"},e.createElement(H,{when:m},e.createElement("div",{className:"common-tools-container"})),e.createElement("div",{className:"btns-right-container"},e.createElement(H,{when:l},e.createElement("button",{className:"action-btn cancel-btn",onClick:E},"\u64A4\u9500\u4FEE\u6539")),e.createElement(H,{when:r},e.createElement("button",{className:"action-btn confirm-btn",disabled:g.length===0,onClick:i},"\u8BB0\u4E0B",e.createElement("span",{className:"icon-text"},"\u270D\uFE0F"))))))};var Je=u.exports.forwardRef(Xe);const Ze=()=>{const{globalState:a,locationState:{query:t}}=u.exports.useContext(P),n=e.useRef(null),[s,r]=u.exports.useState(a.editMemoId);u.exports.useEffect(()=>{var p;if(a.markMemoId){const g=`Mark: [@MEMO](${a.markMemoId})`;(p=n.current)==null||p.insertText(`<p>${g}</p>`)}a.editMemoId!==s&&(r(a.editMemoId),a.editMemoId&&D.getMemoById(a.editMemoId).then(g=>{var f,c,x;g&&((c=n.current)==null||c.setContent((f=g.content)!=null?f:""),(x=n.current)==null||x.focus())}))},[a]);const l=async p=>{var c,x;if(p===""){v.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}p=p.replaceAll("&nbsp;"," ");const g=M.dedupe(Array.from((c=p.match(K))!=null?c:[])).map(y=>y.replace(K,"$1").trim()),f=[];try{for(const y of g){if(y.length>36)throw new Error("\u6807\u7B7E\u592A\u957F\u4E86");const d=await D.createTag(y);f.push(d)}if(s){const y=await D.getMemoById(s);if(y&&y.content!==p){const d=(x=y.tags)!=null?x:[],i=d.map(N=>N.text);f.push(...d);for(let N=0;N<f.length;){const S=f[N],b=S.text;g.includes(b)?(N++,i.includes(b)||await D.createMemoTag(y.id,S.id)):(f.splice(N,1),await D.removeMemoTag(y.id,S.id))}const E=await D.updateMemo(y.id,p);y.content=E.content,y.tags=f,y.updatedAt=M.getDateTimeString(Date.now()),D.editMemo(y)}O.setEditMemoId("")}else{const y=await D.createMemo(p);y.tags=f;for(const i of f)await D.createMemoTag(y.id,i.id);const d=t.tag;d!==""&&!g.includes(d)&&L.setTagQuery(""),D.pushMemo(y)}}catch(y){v.error(y.message)}oe("")},m=u.exports.useCallback(()=>{var p;O.setEditMemoId(""),(p=n.current)==null||p.setContent(""),oe("")},[]),o=u.exports.useCallback(async p=>{const g=document.createElement("div");g.innerHTML=p,g.innerText.trim()===""&&(p=""),oe(p)},[s]),h=u.exports.useMemo(()=>({className:"memo-editor",content:et(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,handleConfirmBtnClick:l,showCancelBtn:s!=="",handleCancelBtnClick:m,showTools:!0,handleContentChange:o,editorRef:n}),[s]);return e.createElement("div",{className:"memo-editor-wrapper "+(s?"edit-ing":"")},e.createElement("p",{className:"tip-text "+(s?"":"hidden")},"\u6B63\u5728\u4FEE\u6539\u4E2D..."),e.createElement(Je,w({},h)))};function et(){var a;return(a=G.get(["editorContentCache"]).editorContentCache)!=null?a:""}function oe(a){G.set({editorContentCache:a})}function tt(a,t,n=[]){const s=u.exports.useRef(),r=u.exports.useCallback(()=>{s.current&&clearTimeout(s.current)},[]);return u.exports.useCallback((...m)=>{r(),s.current=window.setTimeout(()=>{a(...m)},t)},n)}const at=/```([\s\S]*?)```/g,nt=/[*] /g,st=/(\d+)\. /g,rt=a=>a.replace(at,"<pre lang=''>$1</pre>").replace(nt,"<span class='counter-text'>\u2022</span>").replace(st,"<span class='counter-text'>$1.</span>");function ce(a=!1){const[t,n]=u.exports.useState(a),s=u.exports.useCallback(r=>{n(r!==void 0?r:l=>!l)},[]);return[t,s]}const ot=a=>{const{children:t,className:n,clickSpaceDestroy:s,destroy:r}=a,l=()=>{s&&r()};return e.createElement("div",{className:`dialog-wrapper ${n}`,onClick:l},e.createElement("div",{className:"dialog-container",onClick:m=>m.stopPropagation()},t))};function R(a,t,n){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var o;(o=s.firstElementChild)==null||o.classList.add("showup")},0);const r={destroy:()=>{var o,h;(o=s.firstElementChild)==null||o.classList.remove("showup"),(h=s.firstElementChild)==null||h.classList.add("showoff"),setTimeout(()=>{s.remove(),Q.unmountComponentAtNode(s)},se)}},l=k(w({},n),{destroy:r.destroy});let m=e.createElement(ot,w({destroy:r.destroy,clickSpaceDestroy:!0},a),e.createElement(t,w({},l)));return a.useAppContext&&(m=e.createElement(ue,{store:T,context:P},m)),Q.render(m,s),r}const ct=({destroy:a,imgUrl:t})=>{const n=u.exports.useRef(null),[s,r]=u.exports.useState(-1);u.exports.useEffect(()=>{M.getImageSize(t).then(({width:h})=>{r(h!==0?80:0)})},[]);const l=()=>{a()},m=()=>{s>30&&r(s-10)},o=()=>{r(s+10)};return e.createElement(e.Fragment,null,e.createElement("button",{className:"text-btn close-btn",onClick:l},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"})),e.createElement("div",{className:"img-container"},e.createElement("img",{className:s<=0?"hidden":"",ref:n,width:s+"%",src:t}),e.createElement("span",{className:"loading-text "+(s===-1?"":"hidden")},"\u56FE\u7247\u52A0\u8F7D\u4E2D..."),e.createElement("span",{className:"loading-text "+(s===0?"":"hidden")},"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5")),e.createElement("div",{className:"action-btns-container"},e.createElement("button",{className:"text-btn",onClick:m},"\u2796"),e.createElement("button",{className:"text-btn",onClick:o},"\u2795"),e.createElement("button",{className:"text-btn",onClick:()=>r(80)},"\u2B55")))};function ge(a){R({className:"preview-image-dialog"},ct,{imgUrl:a})}const Ee=a=>{const{className:t,imgUrl:n}=a,s=()=>{ge(n)};return e.createElement("div",{className:"image-container "+t,onClick:s},e.createElement("img",{src:n,decoding:"async",loading:"lazy"}))};function le(){const[a,t]=u.exports.useState({isLoading:!0,isFailed:!1,isSucceed:!1});return k(w({},a),{setLoading:()=>{t(k(w({},a),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{t(k(w({},a),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{t(k(w({},a),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const lt=a=>{var r;const{memo:t}=a,n=k(w({},t),{formattedContent:q(t.content),createdAtStr:M.getDateTimeString(t.createdAt),timeStr:M.getTimeString(t.createdAt)}),s=Array.from((r=n.content.match(j))!=null?r:[]);return e.createElement("div",{className:"daily-memo-wrapper"},e.createElement("div",{className:"time-wrapper"},e.createElement("span",{className:"normal-text"},n.timeStr)),e.createElement("div",{className:"memo-content-container"},e.createElement("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:n.formattedContent}}),e.createElement(H,{when:s.length>0},e.createElement("div",{className:"images-container"},s.map((l,m)=>e.createElement("img",{key:m,crossOrigin:"anonymous",src:l,decoding:"async"}))))))};const mt=a=>{const{className:t,datestamp:n,handleDateStampChange:s}=a,[r,l]=u.exports.useState(me(n));u.exports.useEffect(()=>{l(me(n))},[n]);const m=new Date(r),o=m.getDay()===0?7:m.getDay(),h=[];for(let c=1;c<o;c++)h.push({date:0,datestamp:m.getTime()-$*(7-c)});const p=it(r);for(let c=1;c<=p;c++)h.push({date:c,datestamp:m.getTime()+$*(c-1)});const g=c=>{s(c)},f=c=>{const x=m.getFullYear(),y=m.getMonth()+1;let d=0;y===1&&c===-1?d=new Date(`${x-1}/12/1`).getTime():y===12&&c===1?d=new Date(`${x+1}/1/1`).getTime():d=new Date(`${x}/${y+c}/1`).getTime(),l(me(d))};return e.createElement("div",{className:`date-picker-wrapper ${t}`},e.createElement("div",{className:"date-picker-header"},e.createElement("span",{className:"btn-text",onClick:()=>f(-1)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-left.svg"})),e.createElement("span",{className:"normal-text"},m.getFullYear()," \u5E74 ",m.getMonth()+1," \u6708"),e.createElement("span",{className:"btn-text",onClick:()=>f(1)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"}))),e.createElement("div",{className:"date-picker-day-container"},e.createElement("div",{className:"date-picker-day-header"},e.createElement("span",{className:"day-item"},"\u5468\u4E00"),e.createElement("span",{className:"day-item"},"\u5468\u4E8C"),e.createElement("span",{className:"day-item"},"\u5468\u4E09"),e.createElement("span",{className:"day-item"},"\u5468\u56DB"),e.createElement("span",{className:"day-item"},"\u5468\u4E94"),e.createElement("span",{className:"day-item"},"\u5468\u516D"),e.createElement("span",{className:"day-item"},"\u5468\u65E5")),h.map(c=>c.date===0?e.createElement("span",{key:c.datestamp,className:"day-item null"},""):e.createElement("span",{key:c.datestamp,className:`day-item ${c.datestamp===n?"current":""}`,onClick:()=>g(c.datestamp)},c.date))))};function it(a){const t=new Date(a),n=new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`);return((n.getMonth()===11?new Date(`${n.getFullYear()+1}/1`):new Date(`${n.getFullYear()}/${n.getMonth()+2}/1`)).getTime()-n.getTime())/$}function me(a){const t=new Date(a);return new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`).getTime()}const ut=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],dt=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],pt=a=>{const t=le(),[n,s]=u.exports.useState([]),[r,l]=u.exports.useState(M.getDateStampByDate(M.getDateString(a.currentDateStamp))),[m,o]=ce(!1),h=u.exports.useRef(null),p=new Date(r);u.exports.useEffect(()=>{const c=()=>{const d=D.getState().memos.filter(i=>M.getTimeStampByDate(i.createdAt)>=r&&M.getTimeStampByDate(i.createdAt)<r+$).sort((i,E)=>M.getTimeStampByDate(i.createdAt)-M.getTimeStampByDate(E.createdAt));s(d),t.setFinish()},{memos:x}=D.getState(),y=x.slice(-1).pop();y&&M.getTimeStampByDate(y.createdAt)>=r?(t.setLoading(),D.fetchAllMemos().then(()=>{c()}).catch(d=>{v.error(d.message)})):c()},[r]);const g=()=>{o(!1),setTimeout(()=>{const c=M.getOSVersion();(c==="MacOS"||c==="Unknown")&&window.scrollTo(0,0),h.current&&html2canvas(h.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:O.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(x=>{ge(x.toDataURL())})},0)},f=c=>{l(c),o(!1)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("div",{className:"btns-wrapper"},e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"btn-text",onClick:()=>l(r-$)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-left.svg"})),e.createElement("span",{className:"btn-text",onClick:()=>l(r+$)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"}))),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"btn-text",onClick:g},e.createElement("img",{className:"icon-img",src:"/icons/share.svg"})),e.createElement("span",{className:"btn-text",onClick:()=>a.destroy()},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))))),e.createElement("div",{className:"dialog-content-container",ref:h},e.createElement("div",{className:"date-card-container",onClick:()=>o()},e.createElement("div",{className:"year-text"},p.getFullYear()),e.createElement("div",{className:"date-container"},e.createElement("div",{className:"month-text"},ut[p.getMonth()]),e.createElement("div",{className:"date-text"},p.getDate()),e.createElement("div",{className:"day-text"},dt[p.getDay()]))),e.createElement(mt,{className:`date-picker ${m?"":"hide"}`,datestamp:r,handleDateStampChange:f}),t.isLoading?e.createElement("div",{className:"tip-container"},e.createElement("p",{className:"tip-text"},"\u52AA\u529B\u52A0\u8F7D\u4E2D...")):n.length===0?e.createElement("div",{className:"tip-container"},e.createElement("p",{className:"tip-text"},"\u7A7A\u7A7A\u5982\u4E5F")):e.createElement("div",{className:"dailymemos-wrapper"},n.map(c=>e.createElement(lt,{key:`${c.id}-${c.updatedAt}`,memo:c})))))};function fe(a=Date.now()){R({className:"daily-memo-diary-dialog"},pt,{currentDateStamp:a})}const gt=a=>{var x;const{memo:t,destroy:n}=a,[s,r]=u.exports.useState(""),l=u.exports.useRef(null),{user:m}=A.getState(),o=k(w({},t),{formattedContent:q(t.content),createdAtStr:M.getDateTimeString(t.createdAt)}),h=Array.from((x=o.content.match(j))!=null?x:[]),[p,g]=u.exports.useState(h.length);u.exports.useEffect(()=>{const y=l.current;setTimeout(()=>{if(p===0){const d=M.getOSVersion();(d==="MacOS"||d==="Unknown")&&window.scrollTo(0,0),y&&html2canvas(y,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:O.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(i=>{r(i.toDataURL())})}},se+100)},[p]);const f=()=>{n()},c=y=>{y.type==="error"&&(v.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),y.target.remove()),g(p-1)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F970}"),"\u5206\u4EAB Memo \u56FE\u7247"),e.createElement("button",{className:"text-btn close-btn",onClick:f},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:`tip-words-container ${s?"finished":"genarating"}`},e.createElement("p",{className:"tip-text"},s?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D...")),e.createElement("img",{className:"memo-img",src:s}),e.createElement("div",{className:"memo-container",ref:l},e.createElement("span",{className:"time-text"},o.createdAtStr),e.createElement("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:o.formattedContent}}),e.createElement(H,{when:h.length>0},e.createElement("div",{className:"images-container"},h.map((y,d)=>e.createElement("img",{key:d,crossOrigin:"anonymous",src:y,onLoad:c,onError:c,decoding:"async"})))),e.createElement("div",{className:"watermark-container"},e.createElement("span",{className:"normal-text"},"by ",e.createElement("span",{className:"name-text"},m==null?void 0:m.username))))))};function he(a){R({className:"gen-memo-image-dialog"},gt,{memo:a})}const Et=a=>{var f;const{memoId:t,destroy:n}=a,[s,r]=u.exports.useState(),[l,m]=u.exports.useState([]),[o,h]=u.exports.useState([]);u.exports.useEffect(()=>{(async()=>{var y;const x=await D.getMemoById(t);x&&(h(Array.from((y=x.content.match(j))!=null?y:[])),r(k(w({},x),{formattedContent:q(x.content),createdAtStr:M.getDateTimeString(x.createdAt)})))})()},[]),u.exports.useEffect(()=>{(async()=>{if(!s)return;const x=[],y=[...s.content.matchAll(pe)];for(const d of y)if(d&&d.length===3){const i=d[2],E=await D.getMemoById(i);E&&(x.push(k(w({},E),{formattedContent:q(E.content),createdAtStr:M.getDateTimeString(E.createdAt)})),m([...x]))}})()},[s]);const p=()=>{s&&he(s)},g=async c=>{var y;const x=c.target;if(x.className==="memo-link-text"){const d=(y=x.dataset)==null?void 0:y.value;d&&await D.getMemoById(d)&&(n(),ye(d))}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F4D5}"),"Memo Story"),e.createElement("button",{className:"text-btn close-btn",onClick:n},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:"memo-container current"},e.createElement("div",{className:"memo-header-container"},e.createElement("p",{className:"time-text"},s==null?void 0:s.createdAtStr),e.createElement("span",{className:"action-btn",onClick:p},"Share")),e.createElement("div",{className:"memo-content-text",onClick:g,dangerouslySetInnerHTML:{__html:(f=s==null?void 0:s.formattedContent)!=null?f:""}}),e.createElement(H,{when:o.length>0},e.createElement("div",{className:"images-wrapper"},o.map((c,x)=>e.createElement(Ee,{className:"memo-img",key:x,imgUrl:c}))))),e.createElement("p",{className:"normal-text "+(l.length===0?"hidden":"")},"\u94FE\u63A5\u4E86 ",l.length," \u4E2A Memo"),e.createElement("div",{className:"down-memos-wrapper "+(l.length!==0?"":"hidden")},l.map(c=>e.createElement("div",{className:"memo-container",key:c.id},e.createElement("div",{className:"memo-header-container"},e.createElement("p",{className:"time-text"},c.createdAtStr)),e.createElement("div",{className:"memo-content-text",onClick:g,dangerouslySetInnerHTML:{__html:c.formattedContent}}))))))};function ye(a){R({className:"memo-story-dialog"},Et,{memoId:a})}const ft=a=>{var x;const{memo:t}=a,n=k(w({},t),{formattedContent:q(t.content),createdAtStr:M.getDateTimeString(t.createdAt)}),[s,r]=ce(!1),l=Array.from((x=n.content.match(j))!=null?x:[]),m=()=>{fe(M.getTimeStampByDate(n.createdAt))},o=()=>{O.setMarkMemoId(n.id)},h=()=>{O.setEditMemoId(n.id)},p=async()=>{if(s){try{await D.deleteMemoById(n.id),await D.fetchMoreMemos()}catch(y){v.error(y.message)}O.getState().editMemoId===n.id&&O.setEditMemoId("")}else r()},g=()=>{s&&r(!1)},f=()=>{he(n)},c=async y=>{var i;const d=y.target;if(d.className==="memo-link-text"){const E=(i=d.dataset)==null?void 0:i.value;E&&await D.getMemoById(E)&&ye(E)}};return e.createElement("div",{className:"memo-wrapper",onMouseLeave:g},e.createElement("div",{className:"memo-top-wrapper"},e.createElement("span",{className:"time-text",onClick:m},n.createdAtStr),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"text-btn more-action-btn"}),e.createElement("div",{className:"more-action-btns-wrapper"},e.createElement("div",{className:"more-action-btns-container"},e.createElement("span",{className:"text-btn",onClick:o},"Mark"),e.createElement("span",{className:"text-btn",onClick:f},"\u5206\u4EAB"),e.createElement("span",{className:"text-btn",onClick:h},"\u7F16\u8F91"),e.createElement("span",{className:"text-btn delete-btn",onClick:p},s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"))))),e.createElement("div",{className:"memo-content-text",onClick:c,dangerouslySetInnerHTML:{__html:n.formattedContent}}),e.createElement(H,{when:l.length>0},e.createElement("div",{className:"images-wrapper"},l.map((y,d)=>e.createElement(Ee,{className:"memo-img",key:d,imgUrl:y})))))};function q(a){var m;const t=document.createElement("div");t.innerHTML=a;const n=document.createElement("p");for(;t.firstChild&&t.firstChild.nodeName!=="P";){const o=t.firstChild;o.nodeName==="#text"?n.innerHTML+=o.nodeValue:n.innerHTML+=o.outerHTML,o.remove()}n.innerHTML!==""&&(t.prepend(n),a=t.innerHTML);const{shouldUseMarkdownParser:s,shouldSplitMemoWord:r,shouldHideImageUrl:l}=O.getState();s&&(a=rt(a)),r&&(a=a.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5]?)/g,"$1 $2 $3")),l&&(a=a.replace(j,"")),t.innerHTML=a;for(const o of t.querySelectorAll("p"))o.textContent===""&&((m=o.firstElementChild)==null?void 0:m.tagName)!=="BR"&&o.remove();return a=t.innerHTML,a=a.replace(K,"<span class='tag-span'>#$1</span>").replace(de,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(pe,"<span class='memo-link-text' data-value='$2'>$1</span>"),a}var ht=e.memo(ft);const yt=a=>{for(const t of re)if(t.type===a)return t.text;return""},Nt=()=>{const{locationState:{query:a},memoState:{memos:t}}=u.exports.useContext(P),[n,s]=u.exports.useState(!1),[r,l]=u.exports.useState(!1),m=u.exports.useRef(null),o=a.tag,h={from:a.from,to:a.to},p=a.type,g=a.text,f=Boolean(o||h.from!==0&&h.from<h.to||p||g),c=t.filter(i=>{let E=!0;const N=[];for(const S of i.tags){const b=S.text.split("/");let B="";for(let _=0;_<b.length;_++)_===0?B+=b[_]:B+="/"+b[_],N.push(B)}return o!==""&&!N.includes(o)&&(E=!1),h.from!==0&&h.from<h.to&&(M.getTimeStampByDate(i.createdAt)<h.from||M.getTimeStampByDate(i.createdAt)>h.to)&&(E=!1),p!==""&&(p==="NOT_TAGGED"?i.content.match(K)!==null&&(E=!1):p==="LINKED"?i.content.match(de)===null&&(E=!1):p==="IMAGED"&&i.content.match(j)===null&&(E=!1)),g!==""&&!i.content.includes(g)&&(E=!1),E});u.exports.useEffect(()=>{var i;(i=m.current)==null||i.scrollTo({top:0}),!r&&f&&(s(!0),D.fetchAllMemos().then(E=>{E||(l(!0),s(!1))}))},[r,f]);const x=async()=>{if(!(n||r)){s(!0);try{const i=await D.fetchMoreMemos();Array.isArray(i)&&i.length===0&&l(!0)}catch(i){v.error(i.message)}s(!1)}},y=u.exports.useCallback(i=>{const E=i.target;if(E.tagName==="SPAN"&&E.className==="tag-span"){const N=E.innerText.slice(1);L.getState().query.tag===N?L.setTagQuery(""):L.setTagQuery(N)}},[]),d=tt(()=>{if(!(n||r)&&m.current){const{offsetHeight:i,scrollTop:E,scrollHeight:N}=m.current;i+E+10>N&&x()}},100,[n,r]);return e.createElement("div",{className:`memolist-wrapper ${r?"completed":""}`,onClick:y,onScroll:d,ref:m},e.createElement(xt,{showFilter:f,tagQuery:o,duration:h,memoType:p,textQuery:g}),c.map(i=>e.createElement(ht,{key:`${i.id}-${i.updatedAt}`,memo:i})),f?e.createElement("div",{className:"status-text-container"},e.createElement("p",{className:"status-text"},n?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":r&&c.length===0?"\u7A7A\u7A7A\u5982\u4E5F":"")):e.createElement("div",{className:`status-text-container ${r?"completed":""} ${n||r?"":"invisible"}`},e.createElement("p",{className:"status-text"},r?"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}":"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...")))},xt=a=>{const{showFilter:t,tagQuery:n,duration:s,memoType:r,textQuery:l}=a;return e.createElement("div",{className:`filter-query-container ${t?"":"hidden"}`},e.createElement("span",{className:"tip-text"},"\u7B5B\u9009\uFF1A"),e.createElement("div",{className:"filter-item-container "+(s.from!==0&&s.from<s.to?"":"hidden"),onClick:()=>{L.setFromAndToQuery(0,0)}},e.createElement("span",{className:"icon-text"},"\u{1F5D3}\uFE0F")," ",M.getDateString(s.from)," \u81F3 ",M.getDateString(s.to)),e.createElement("div",{className:"filter-item-container "+(n?"":"hidden"),onClick:()=>{L.setTagQuery("")}},e.createElement("span",{className:"icon-text"},"\u{1F3F7}\uFE0F")," ",n),e.createElement("div",{className:"filter-item-container "+(r?"":"hidden"),onClick:()=>{L.setMemoTypeQuery("")}},e.createElement("span",{className:"icon-text"},"\u{1F4E6}")," ",yt(r)),e.createElement("div",{className:"filter-item-container "+(l?"":"hidden"),onClick:()=>{L.setTextQuery("")}},e.createElement("span",{className:"icon-text"},"\u{1F50D}")," ",l))};const St=({destroy:a})=>{const{userState:t}=u.exports.useContext(P),n=t.user,[s,r]=u.exports.useState(n.username),[l,m]=u.exports.useState(!1),[o,h]=u.exports.useState(!1),p=()=>{a()},g=d=>{const i=d.target.value;r(i)},f=async()=>{if(n.username==="guest"){v.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(s===n.username){m(!1);return}try{if(!await A.checkUsernameUsable(s)){v.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await A.updateUsername(s),await A.doSignIn(),m(!1),v.info("\u4FEE\u6539\u6210\u529F~")}catch(d){v.error(d.message)}},c=()=>{if(n.username==="guest"){v.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}bt()},x=async()=>{if(o){try{await A.removeGithubName(),await A.doSignIn()}catch(d){v.error(d.message)}h(!1)}else h(!0)},y=d=>{d.preventDefault()};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F920}"),"\u6211\u7684\u8D26\u53F7"),e.createElement("button",{className:"text-btn close-btn",onClick:p},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:"section-container account-section-container"},e.createElement("p",{className:"title-text"},"\u57FA\u672C\u4FE1\u606F"),e.createElement("label",{className:"form-label input-form-label"},e.createElement("span",{className:"normal-text"},"ID\uFF1A"),e.createElement("span",{className:"normal-text"},n.id)),e.createElement("label",{className:"form-label input-form-label"},e.createElement("span",{className:"normal-text"},"\u521B\u5EFA\u65F6\u95F4\uFF1A"),e.createElement("span",{className:"normal-text"},M.getDateString(n.createdAt))),e.createElement("label",{className:"form-label input-form-label username-label"},e.createElement("span",{className:"normal-text"},"\u8D26\u53F7\uFF1A"),e.createElement("input",{type:"text",readOnly:!l,value:s,onClick:()=>{m(!0)},onChange:g}),e.createElement("div",{className:"btns-container",onClick:y},e.createElement("span",{className:"text-btn confirm-btn "+(l?"":"hidden"),onClick:f},"\u4FDD\u5B58"),e.createElement("span",{className:"text-btn cancel-btn "+(l?"":"hidden"),onClick:()=>{r(n.username),m(!1)}},"\u64A4\u9500"))),e.createElement("label",{className:"form-label password-label"},e.createElement("span",{className:"normal-text"},"\u5BC6\u7801\uFF1A"),e.createElement("span",{className:"text-btn",onClick:c},"\u4FEE\u6539\u5BC6\u7801"))),e.createElement("div",{className:"section-container account-section-container"},e.createElement("p",{className:"title-text"},"\u5173\u8054\u8D26\u53F7"),e.createElement("label",{className:"form-label input-form-label"},e.createElement("span",{className:"normal-text"},"GitHub\uFF1A"),n.githubName?e.createElement(e.Fragment,null,e.createElement("a",{className:"value-text",href:"https://github.com/"+n.githubName},n.githubName),e.createElement("span",{className:"btn-text",onMouseLeave:()=>h(!1),onClick:x},o?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A")):e.createElement(e.Fragment,null,e.createElement("span",{className:"value-text"},"\u65E0"),e.createElement("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist"},"\u524D\u5F80\u7ED1\u5B9A"))))))},Ct=({destroy:a})=>{const[t,n]=u.exports.useState(""),[s,r]=u.exports.useState(""),[l,m]=u.exports.useState("");u.exports.useEffect(()=>{},[]);const o=()=>{a()},h=c=>{const x=c.target.value;n(x)},p=c=>{const x=c.target.value;r(x)},g=c=>{const x=c.target.value;m(x)},f=async()=>{if(t===""||s===""||l===""){v.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==l){v.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),m("");return}try{if(!await A.checkPasswordValid(t)){v.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),n("");return}await A.updatePassword(s),v.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),o()}catch(c){v.error(c)}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},"\u4FEE\u6539\u5BC6\u7801"),e.createElement("button",{className:"text-btn close-btn",onClick:o},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("p",{className:"tip-text"},"\u5982\u679C\u662F GitHub \u767B\u5F55\uFF0C\u5219\u521D\u59CB\u5BC6\u7801\u4E3A\u7528\u6237\u540D"),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:t,onChange:h}),e.createElement("span",{className:"normal-text "+(t===""?"":"not-null")},"\u65E7\u5BC6\u7801")),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:s,onChange:p}),e.createElement("span",{className:"normal-text "+(s===""?"":"not-null")},"\u65B0\u5BC6\u7801")),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:l,onChange:g}),e.createElement("span",{className:"normal-text "+(l===""?"":"not-null")},"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801")),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"text-btn cancel-btn",onClick:o},"\u53D6\u6D88"),e.createElement("span",{className:"text-btn confirm-btn",onClick:f},"\u4FDD\u5B58"))))};function bt(){R({className:"change-password-dialog"},Ct)}function Mt(){R({className:"my-account-dialog",useAppContext:!0},St)}const Dt=({destroy:a})=>{const t=()=>{a()};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F600}"),"\u5173\u4E8E ",e.createElement("b",null,"Memos")),e.createElement("button",{className:"text-btn close-btn",onClick:t},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("p",null,"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"),e.createElement("br",null),e.createElement("i",null,"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"),e.createElement("ul",null,e.createElement("li",null,"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5}\u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1}\u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5}\u8BFB\u540E\u611F..."),e.createElement("li",null,"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"),e.createElement("li",null,"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B")),e.createElement("br",null),e.createElement("i",null,"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"),e.createElement("ul",null,e.createElement("li",null,"\u2728"," ",e.createElement("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer"},"\u5F00\u6E90\u9879\u76EE")),e.createElement("li",null,"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"),e.createElement("li",null,"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B")),e.createElement("br",null),e.createElement("p",null,"Enjoy it and have fun~ "),e.createElement("hr",null),e.createElement("p",{className:"normal-text"},"BTW, my personal site:"," ",e.createElement("a",{target:"_blank",href:"https://justsven.top",rel:"noreferrer"},"https://justsven.top")," ","\u{1F440}"),e.createElement("p",{className:"normal-text"},"Last update at 2021/9/30 10:28:20 \u{1F389}")))};function Ne(){R({className:"about-site-dialog"},Dt)}const wt=({destroy:a})=>{const{globalState:{shouldHideImageUrl:t,shouldSplitMemoWord:n,shouldUseMarkdownParser:s,showDarkMode:r}}=u.exports.useContext(P);u.exports.useEffect(()=>{},[]);const l=()=>{a()},m=c=>{const x=c.target.checked;O.setAppSetting({shouldSplitMemoWord:x})},o=c=>{const x=c.target.checked;O.setAppSetting({shouldHideImageUrl:x})},h=c=>{const x=c.target.checked;O.setAppSetting({showDarkMode:x})},p=c=>{const x=c.target.checked;O.setAppSetting({shouldUseMarkdownParser:x})},g=async()=>{await D.fetchAllMemos();for(const c of D.getState().memos)await D.updateMemo(c.id,c.content.replace("&nbsp;"," ").replace(/#(.+?)#/g,"# $1 "))},f=async()=>{await D.fetchAllMemos();const c=D.getState().memos.map(d=>k(w({},d),{tags:d.tags.map(i=>i.text)})),x=JSON.stringify(c),y=document.createElement("a");y.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(x)),y.setAttribute("download","data.json"),y.style.display="none",document.body.appendChild(y),y.click(),document.body.removeChild(y)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u2699\uFE0F"),"\u504F\u597D\u8BBE\u7F6E"),e.createElement("button",{className:"text-btn close-btn",onClick:l},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:"section-container preferences-section-container"},e.createElement("p",{className:"title-text"},"\u5E38\u89C4"),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"\u6DF1\u8272\u6A21\u5F0F"),e.createElement("img",{className:"icon-img",src:r?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:r,onChange:h}))),e.createElement("div",{className:"section-container preferences-section-container"},e.createElement("p",{className:"title-text"},"Memo \u663E\u793A\u76F8\u5173"),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"),e.createElement("img",{className:"icon-img",src:n?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:n,onChange:m})),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"),e.createElement("img",{className:"icon-img",src:t?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:t,onChange:o})),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"markdown \u683C\u5F0F\u89E3\u6790"),e.createElement("img",{className:"icon-img",src:s?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:s,onChange:p}),e.createElement("span",{className:"tip-text"},"\u76EE\u524D\u652F\u6301\u5217\u8868\u3001\u4EE3\u7801\u5757"))),e.createElement("div",{className:"section-container hidden"},e.createElement("p",{className:"title-text"},"\u5176\u4ED6"),e.createElement("div",{className:"btn-container"},e.createElement("button",{className:"btn export-btn",onClick:f},"\u5BFC\u51FA\u6570\u636E(JSON)"),e.createElement("button",{className:"btn clean-btn",onClick:g},"Memo Clean")))))};function vt(){R({className:"preferences-dialog",useAppContext:!0},wt)}const Tt=({destroy:a})=>{const{locationState:{query:{text:t,type:n}}}=u.exports.useContext(P),s=u.exports.useRef(null);u.exports.useEffect(()=>{var o;(o=s.current)==null||o.focus()},[]);const r=o=>{const{type:h}=L.getState().query;o===h&&(o=""),L.setMemoTypeQuery(o)},l=o=>{const h=o.currentTarget.value;L.setTextQuery(h)},m=o=>{o.code==="Enter"&&a()};return e.createElement(e.Fragment,null,e.createElement("div",{className:"search-bar-inputer"},e.createElement("img",{className:"icon-img",src:"/icons/search.svg"}),e.createElement("input",{className:"text-input",type:"text",placeholder:"Search for memos",ref:s,value:t,onChange:l,onKeyPress:m})),e.createElement("div",{className:"special-type-selector"},e.createElement("p",{className:"title-text"},"QUICKLY FILTER"),e.createElement("div",{className:"section-container types-container"},e.createElement("span",{className:"section-text"},"Type:"),re.map((o,h)=>e.createElement("div",{key:o.type},e.createElement("span",{className:`type-item ${n===o.type?"selected":""}`,onClick:()=>{r(o.type)}},o.text),h+1<re.length?e.createElement("span",{className:"split-text"},"/"):null)))))},xe=()=>{const a="search-bar-dialog-wrapper",t=document.querySelector(`.${a}`);t&&t.parentElement?(t.classList.remove("showup"),t.classList.add("showoff"),setTimeout(()=>{t&&t.parentElement&&(t.parentElement.remove(),Q.unmountComponentAtNode(t.parentElement))},se)):R({className:a,useAppContext:!0},Tt)};const Ft=({visibility:a})=>{const t=()=>{vt()},n=()=>{Ne()},s=()=>{A.doSignOut(),location.reload()},r=()=>{xe()};return e.createElement("div",{className:"menu-btns-popup "+(a?"":"hidden")},e.createElement("button",{className:"text-btn action-btn",onClick:Mt},e.createElement("span",{className:"icon"},"\u{1F920}")," \u6211\u7684\u8D26\u53F7"),e.createElement("button",{className:"text-btn action-btn",onClick:t},e.createElement("span",{className:"icon"},"\u2699\uFE0F")," \u504F\u597D\u8BBE\u7F6E"),e.createElement("button",{className:"text-btn action-btn",onClick:r},e.createElement("span",{className:"icon"},"\u{1F50D}")," \u641C\u7D22"),e.createElement("button",{className:"text-btn action-btn",onClick:n},e.createElement("span",{className:"icon"},"\u{1F600}")," \u5173\u4E8E"),e.createElement("button",{className:"text-btn action-btn",onClick:s},e.createElement("span",{className:"icon"},"\u{1F44B}")," \u9000\u51FA"))};const kt=()=>{const{userState:{user:a},memoState:{memos:t}}=u.exports.useContext(P),[n,s]=u.exports.useState({memosAmount:0,tagsAmount:0}),[r,l]=u.exports.useState(!1),m=a?a.username:"Memos",o=a?Math.ceil((Date.now()-M.getTimeStampByDate(a.createdAt))/1e3/3600/24):0;u.exports.useEffect(()=>{!A.getState().user||D.getMyDataAmount().then(g=>{s(g)}).catch(g=>{v.error(g.message)})},[t]);const h=u.exports.useCallback(g=>{g.stopPropagation();const f=!r;if(f){const c=()=>{l(!1),document.body.removeEventListener("click",c)};document.body.addEventListener("click",c)}l(f)},[r]),p=u.exports.useCallback(()=>{L.clearQuery()},[]);return e.createElement("div",{className:"user-banner-container"},e.createElement("div",{className:"userinfo-header-container"},e.createElement("p",{className:"username-text",onClick:p},m),e.createElement("button",{className:"action-btn menu-popup-btn",onClick:h}),e.createElement(Ft,{visibility:r})),e.createElement("div",{className:"status-text-container"},e.createElement("div",{className:"status-text memos-text"},e.createElement("span",{className:"amount-text"},n.memosAmount),e.createElement("span",{className:"type-text"},"MEMO")),e.createElement("div",{className:"status-text tags-text"},e.createElement("span",{className:"amount-text"},n.tagsAmount),e.createElement("span",{className:"type-text"},"TAG")),e.createElement("div",{className:"status-text duration-text",onClick:()=>fe()},e.createElement("span",{className:"amount-text"},o),e.createElement("span",{className:"type-text"},"DAY"))))};const At=()=>{const{locationState:{query:a},memoState:{memos:t}}=u.exports.useContext(P),[n,s]=u.exports.useState([]),[r,l]=u.exports.useState(a.tag),m=le();return u.exports.useEffect(()=>{!A.getState().user||D.getMyTags().then(o=>{const h=o.sort((g,f)=>M.getTimeStampByDate(f.createdAt)-M.getTimeStampByDate(g.createdAt)).sort((g,f)=>f.level-g.level),p={subTags:[]};for(const g of h){const f=g.text.split("/");let c=p,x="";for(let y=0;y<f.length;y++){const d=f[y];y===0?x+=d:x+="/"+d;let i=null;for(const E of c.subTags)if(E.text===x){i=E;break}i?i.level+=g.level:(i={id:"",key:d,text:x,level:g.level,subTags:[],deep:y},c.subTags.push(i)),c.subTags.sort((E,N)=>N.level-E.level),x===g.text&&(i.id=g.id),c=i}}p.subTags.sort((g,f)=>f.level-g.level),s(p.subTags),m.setFinish()}).catch(o=>{m.setError(),v.error(o)})},[t]),u.exports.useEffect(()=>{l(a.tag);const o=document.querySelector(ae);o==null||o.classList.remove(ne)},[a]),e.createElement("div",{className:"tags-wrapper"},e.createElement("p",{className:"title-text"},"\u5E38\u7528\u6807\u7B7E"),e.createElement("div",{className:"tags-container"},m.isLoading?e.createElement(e.Fragment,null):e.createElement(e.Fragment,null,n.map((o,h)=>e.createElement(Se,{key:o.id+"-"+h,tag:o,tagQuery:r})),e.createElement(H,{when:n.length<5},e.createElement("p",{className:"tag-tip-container"},"\u8F93\u5165",e.createElement("span",{className:"code-text"},"# Tag "),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~")))))},Se=a=>{const{tag:t,tagQuery:n}=a,s=n===t.text,r=t.subTags.length>0,[l,m]=ce(n.includes(t.text)&&!s),o=t.id!=="";u.exports.useEffect(()=>{l||m(n.includes(t.text)&&!s)},[n,t]);const h=()=>{const f=s?"":t.text;f&&(M.copyTextToClipboard(`# ${f} `),D.polishTag(t.id).catch(()=>{})),L.setTagQuery(f)},p=f=>{o&&(f.stopPropagation(),It(t))},g=f=>{f.stopPropagation(),m()};return e.createElement(e.Fragment,null,e.createElement("div",{className:`tag-item-container ${s?"active":""}`,onClick:h},e.createElement("div",{className:"tag-text-container"},e.createElement("div",{className:`icon-container ${o?"rename-able":""}`,onClick:p},e.createElement("span",{className:"icon-text"},"#"),o?e.createElement("span",{className:"rename-btn"},s?e.createElement("img",{className:"icon-img",src:"/icons/edit-white.svg"}):e.createElement("img",{className:"icon-img",src:"/icons/edit.svg"})):null),e.createElement("span",{className:"tag-text"},t.key)),e.createElement("div",{className:"btns-container"},r?e.createElement("span",{className:`action-btn toggle-btn ${l?"shown":""}`,onClick:g},s?e.createElement("img",{className:"icon-img",src:"/icons/arrow-right-white.svg"}):e.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"})):null)),r?e.createElement("div",{className:`subtags-container ${l?"":"hidden"}`},t.subTags.map((f,c)=>e.createElement(Se,{key:f.id+"-"+c,tag:f,tagQuery:n}))):null)},Bt=a=>{const{destroy:t,tag:n}=a,s=u.exports.useRef(null),r=()=>{t()},l=()=>{var o;const m=(o=s.current)==null?void 0:o.value;if(!m||m===n.text){t();return}if(m.length>36){v.error("\u6807\u7B7E\u592A\u957F\u5566\uFF0CMAX=36");return}D.updateTagText(n.id,m).then(()=>{D.clearMemos(),D.fetchAllMemos(),t()}).catch(()=>{})};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F3F7}\uFE0F"),"\u6807\u7B7E\u91CD\u547D\u540D"),e.createElement("button",{className:"text-btn close-btn",onClick:r},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("p",{className:"tag-text"},"\u65E7\uFF1A",n.text),e.createElement("input",{className:"text-input",type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E",ref:s}),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"btn-text cancel-btn",onClick:r},"\u53D6\u6D88"),e.createElement("span",{className:"btn-text confirm-btn",onClick:l},"\u786E\u5B9A"))))};function It(a){R({className:"rename-tag-dialog"},Bt,{tag:a})}const Ce={width:12,height:7},Lt=()=>{const a=M.getDateStampByDate(Date.now()),t=new Date(a).getDay()||7,n=(Ce.width-1)*Ce.height+t,s=a-n*$,r=new Array(7-t).fill(0),l=()=>{const E=[];for(let N=1;N<=n;N++)E.push({timestamp:s+$*N,count:0});return E},{memoState:{memos:m}}=u.exports.useContext(P),[o,h]=u.exports.useState(l()),[p,g]=u.exports.useState(null),[f,c]=u.exports.useState(null),x=u.exports.useRef(null);u.exports.useEffect(()=>{if(!A.getState().user)return;const E=l();D.getMemosStat().then(N=>{for(const S of N){const b=(M.getDateStampByDate(S.timestamp)-s)/(1e3*3600*24)-1;b>=0&&(E[b].count=S.amount)}h([...E])}).catch(N=>{v.error(N.message)})},[m.length]);const y=u.exports.useCallback((E,N)=>{if(g(N),x.current){const S=E.target;x.current.style.left=S.offsetLeft+"px",x.current.style.top=S.offsetTop+"px"}},[]),d=u.exports.useCallback(()=>{g(null)},[]),i=u.exports.useCallback(E=>{L.getState().query.from===E.timestamp?(L.setFromAndToQuery(0,0),c(null)):E.count>0&&(L.setFromAndToQuery(E.timestamp,E.timestamp+$),c(E))},[]);return e.createElement("div",{className:"usage-heat-map-wrapper"},e.createElement("div",{className:"day-tip-text-container"},e.createElement("span",{className:"tip-text"},"Mon"),e.createElement("span",{className:"tip-text"}),e.createElement("span",{className:"tip-text"},"Wed"),e.createElement("span",{className:"tip-text"}),e.createElement("span",{className:"tip-text"},"Fri"),e.createElement("span",{className:"tip-text"}),e.createElement("span",{className:"tip-text"},"Sun")),e.createElement("div",{ref:x,className:"usage-detail-container pop-up "+(p?"":"hidden")},p==null?void 0:p.count," memos on ",e.createElement("span",{className:"date-text"},new Date(p==null?void 0:p.timestamp).toDateString())),e.createElement("div",{className:"usage-heat-map"},o.map((E,N)=>{const S=E.count,b=S<=0?"":S<=2?"stat-day-L1-bg":S<=4?"stat-day-L2-bg":S<=6?"stat-day-L3-bg":"stat-day-L4-bg";return e.createElement("span",{className:"stat-container "+b+(f===E?" current":" "),key:N,onMouseEnter:B=>y(B,E),onMouseLeave:d,onClick:()=>i(E)})}),r.map((E,N)=>e.createElement("span",{className:"stat-container null",key:N}))))};const _t=()=>{u.exports.useEffect(()=>{},[]);const a=u.exports.useCallback(t=>{if(t.target.className==="sidebar-wrapper"){const s=document.querySelector(ae);s==null||s.classList.remove(ne)}},[]);return e.createElement("div",{className:"sidebar-wrapper",onClick:a},e.createElement(kt,null),e.createElement(Lt,null),e.createElement(At,null))},Ut=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function be(a,t){return t.minLength!==void 0&&a.length<t.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:t.maxLength!==void 0&&a.length>t.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:t.noSpace&&a.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:t.noChinese&&Ut.test(a)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const Me={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},Ot=({destroy:a})=>{const[t,n]=u.exports.useState(""),[s,r]=u.exports.useState(""),l=u.exports.useRef(null);u.exports.useEffect(()=>{const g=f=>{var c;f.key==="Enter"&&((c=l.current)==null||c.click())};return document.body.addEventListener("keypress",g),()=>{document.body.removeEventListener("keypress",g)}},[]);const m=g=>{const f=g.target.value;n(f)},o=g=>{const f=g.target.value;r(f)},h=()=>{Ne()},p=async()=>{const g=be(t,Me);if(!g.result){v.error("\u7528\u6237\u540D "+g.reason);return}const f=be(s,Me);if(!f.result){v.error("\u5BC6\u7801 "+f.reason);return}try{const c=F.signin,{succeed:x,message:y}=await c(t,s);if(!x&&y){v.error("\u{1F61F} "+y);return}await A.doSignIn()?(D.fetchMoreMemos().catch(()=>{}),a()):v.error("\u{1F61F} \u4E0D\u77E5\u9053\u53D1\u751F\u4E86\u4EC0\u4E48\u9519\u8BEF")}catch(c){console.error(c),v.error("\u{1F61F} "+c.message)}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F44B}")," \u8D26\u53F7\u6CE8\u518C / \u767B\u5F55")),e.createElement("div",{className:"dialog-content-container"},e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"text",value:t,onChange:m}),e.createElement("span",{className:"normal-text "+(t===""?"":"not-null")},"\u8D26\u53F7")),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:s,onChange:o}),e.createElement("span",{className:"normal-text "+(s===""?"":"not-null")},"\u5BC6\u7801"))),e.createElement("div",{className:"dialog-footer-container"},e.createElement("div",{className:"btns-container"},e.createElement("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist"},"Sign In with GitHub")),e.createElement("div",{className:"btns-container"},e.createElement("button",{className:"text-btn signup-btn disabled",onClick:()=>v.info("\u6CE8\u518C\u5DF2\u5173\u95ED")},"\u6CE8\u518C"),e.createElement("span",{className:"split-text"},"/"),e.createElement("button",{className:"text-btn signin-btn",ref:l,onClick:p},"\u767B\u5F55"))),e.createElement("p",{className:"tip-text"},"\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\uFF0C\u53EF\u8F93\u5165 ",e.createElement("code",null,"guest, 123456")," \u8FDB\u884C\u4F53\u9A8C\u3002",e.createElement("br",null),e.createElement("span",{className:"text-btn",onClick:h},e.createElement("span",{className:"icon-text"},"\u{1F600}"),"\u5173\u4E8E\u672C\u7AD9")))};function Pt(){R({className:"signin-dialog",clickSpaceDestroy:!1},Ot)}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(a,t){return Object.prototype.toString.call(a).toLowerCase()==="[object regexp]"?this.replace(a,t):this.replace(new RegExp(a,"g"),t)})})();function Rt(){const{globalState:{showDarkMode:a}}=u.exports.useContext(P),t=le();return u.exports.useEffect(()=>{A.doSignIn().catch(()=>{}).finally(()=>{A.getState().user?D.fetchMoreMemos():Pt(),t.setFinish()});const n=s=>{if(!A.getState().user)return;const{ctrlKey:r,metaKey:l,code:m}=s;(r||l)&&m==="KeyP"&&(s.preventDefault(),xe())};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[]),u.exports.useEffect(()=>{a?document.body.classList.add("dark"):document.body.classList.remove("dark")},[a]),e.createElement(e.Fragment,null,e.createElement("div",{id:"page-container"},e.createElement(_t,null),e.createElement("div",{className:"content-wrapper"},e.createElement(Ve,null),e.createElement(Ze,null),t.isLoading?null:e.createElement(Nt,null))))}Q.render(e.createElement(ue,{store:T,context:P},e.createElement(Rt,null)),document.getElementById("root"));
