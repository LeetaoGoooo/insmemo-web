var _e=Object.defineProperty,Ue=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var ue=(n,e,a)=>e in n?_e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a,C=(n,e)=>{for(var a in e||(e={}))Qe.call(e,a)&&ue(n,a,e[a]);if(Se)for(var a of Se(e))Re.call(e,a)&&ue(n,a,e[a]);return n},D=(n,e)=>Ue(n,Pe(e));var I=(n,e,a)=>(ue(n,typeof e!="symbol"?e+"":e,a),a);import{j as de,r as u,R as ne,a as $e}from"./vendor.e8256409.js";const qe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}};qe();const t=de.exports.jsx,c=de.exports.jsxs,L=de.exports.Fragment,Ce=n=>{const{children:e,store:a,context:s}=n,[r,o]=u.exports.useState(a.getState());return u.exports.useEffect(()=>{const i=a.subscribe(p=>{o(p)});return()=>{i()}},[]),t(s.Provider,{value:r,children:e})};function Ge(n){const e=Object.keys(n),a={};for(const s of e)typeof n[s]=="function"&&(a[s]=n[s]);return(s={},r)=>{let o=!1;const i={};for(const p of e){const m=s[p],y=a[p](m,r);i[p]=y,o=o||y!==m}return o?i:s}}function He(n,e){const a=[];let s=n;return{dispatch:p=>{const m=e(s,p),y=s;s=m;for(const N of a)N(s,y)},getState:()=>s,subscribe:p=>{let m=!0;return a.push(p),()=>{if(!m)return;const y=a.indexOf(p);a.splice(y,1),m=!1}}}}function je(n,e){switch(e.type){case"SET_MARK_MEMO_ID":return e.payload.markMemoId===n.markMemoId?n:D(C({},n),{markMemoId:e.payload.markMemoId});case"SET_EDIT_MEMO_ID":return e.payload.editMemoId===n.editMemoId?n:D(C({},n),{editMemoId:e.payload.editMemoId});case"SET_MOBILE_VIEW":return e.payload.isMobileView===n.isMobileView?n:D(C({},n),{isMobileView:e.payload.isMobileView});case"SET_APP_SETTING":return C(C({},n),e.payload);default:return n}}const We={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,isMobileView:!1};function Ye(n,e){switch(e.type){case"SET_LOCATION":return e.payload;case"SET_PATHNAME":return e.payload.pathname===n.pathname?n:D(C({},n),{pathname:e.payload.pathname});case"SET_HASH":return e.payload.hash===n.hash?n:D(C({},n),{hash:e.payload.hash});case"SET_QUERY":return D(C({},n),{query:C({},e.payload)});case"SET_TAG_QUERY":return e.payload.tag===n.query.tag?n:D(C({},n),{query:D(C({},n.query),{tag:e.payload.tag})});case"SET_DURATION_QUERY":return e.payload.duration===n.query.duration?n:D(C({},n),{query:D(C({},n.query),{duration:C(C({},n.query.duration),e.payload.duration)})});case"SET_TYPE":return e.payload.type===n.query.type?n:D(C({},n),{query:D(C({},n.query),{type:e.payload.type})});case"SET_TEXT":return e.payload.text===n.query.text?n:D(C({},n),{query:D(C({},n.query),{text:e.payload.text})});case"SET_QUERY_FILTER":return e.payload===n.query.filter?n:D(C({},n),{query:D(C({},n.query),{filter:e.payload})});default:return n}}const Ve={pathname:"/",hash:"",query:{tag:"",duration:null,type:"",text:"",filter:""}};var me;(function(n){function e(){return Date.now()}n.getNowTimeStamp=e;function a(){const S=navigator.appVersion;let E="Unknown";return S.indexOf("Win")!=-1?E="Windows":S.indexOf("Mac")!=-1?E="MacOS":S.indexOf("Linux")!=-1&&(E="Linux"),E}n.getOSVersion=a;function s(S){return typeof S=="string"&&(S=S.replaceAll("-","/")),new Date(S).getTime()}n.getTimeStampByDate=s;function r(S){const E=new Date(s(S));return new Date(E.getFullYear(),E.getMonth(),E.getDate()).getTime()}n.getDateStampByDate=r;function o(S){const E=new Date(s(S)),b=E.getFullYear(),T=E.getMonth()+1,B=E.getDate();return`${b}/${T}/${B}`}n.getDateString=o;function i(S){const E=new Date(s(S)),b=E.getHours(),T=E.getMinutes(),B=b<10?"0"+b:b,Q=T<10?"0"+T:T;return`${B}:${Q}`}n.getTimeString=i;function p(S){const E=new Date(s(S)),b=E.getFullYear(),T=E.getMonth()+1,B=E.getDate(),Q=E.getHours(),F=E.getMinutes(),$=E.getSeconds(),te=T<10?"0"+T:T,le=B<10?"0"+B:B,Ie=Q<10?"0"+Q:Q,Oe=F<10?"0"+F:F,Le=$<10?"0"+$:$;return`${b}/${te}/${le} ${Ie}:${Oe}:${Le}`}n.getDateTimeString=p;function m(S){return Array.from(new Set(S))}n.dedupe=m;function y(S){const E=new Set,b=[];for(const T of S)E.has(T.id)||(E.add(T.id),b.push(T));return b}n.dedupeObjectWithId=y;function N(S,E){let b=null;return()=>{b&&clearTimeout(b),b=setTimeout(S,E)}}n.debounce=N;function g(S,E){let b=!0;return()=>{if(!b)return!1;b=!1,setTimeout(()=>{S(),b=!0},E)}}n.throttle=g;function l(S){const E=[],b=Object.keys(S).sort();for(const T of b){const B=S[T];B&&(typeof B=="object"?E.push(...l(B).split("&")):E.push(`${T}=${B}`))}return E.join("&")}n.transformObjectToParamsString=l;function d(S){const E={},b=S.split("&");for(const T of b){const[B,Q]=T.split("=");B&&Q&&(E[B]=Q)}return E}n.transformParamsStringToObject=d;function h(S){if(!S)return{};const E={},b=Object.keys(S).sort();for(const T of b){const B=S[T];if(typeof B=="object"){const Q=h(JSON.parse(JSON.stringify(B)));Q&&Object.keys(Q).length>0&&(E[T]=Q)}else Boolean(B)&&(E[T]=B)}return E}n.filterObjectNullKeys=h;async function f(S){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(S)}catch(E){console.warn("Copy to clipboard failed.",E)}else console.warn("Copy to clipboard failed, methods not supports.")}n.copyTextToClipboard=f;function x(S){return new Promise(E=>{const b=new Image;b.onload=()=>{const{width:T,height:B}=b;T>0&&B>0?E({width:T,height:B}):E({width:0,height:0})},b.onerror=()=>{E({width:0,height:0})},b.className="hidden",b.src=S,document.body.appendChild(b),b.remove()})}n.getImageSize=x;function w(S){var E;for(let b=0;b<S.children.length;b++){const T=S.children[b];if(T.tagName==="P"&&T.textContent===""&&((E=T.firstElementChild)==null?void 0:E.tagName)!=="BR"){T.remove(),b--;continue}T.childElementCount>0&&w(T)}}n.clearDangerHTMLNode=w})(me||(me={}));var v=me;function Ke(n,e){switch(e.type){case"SET_MEMOS":{const a=v.dedupeObjectWithId(e.payload.memos.sort((s,r)=>v.getTimeStampByDate(r.createdAt)-v.getTimeStampByDate(s.createdAt)));return D(C({},n),{memos:[...a]})}case"SET_TAGS":return D(C({},n),{tags:e.payload.tags});case"INSERT_MEMO":{const a=v.dedupeObjectWithId([e.payload.memo,...n.memos].sort((s,r)=>v.getTimeStampByDate(r.createdAt)-v.getTimeStampByDate(s.createdAt)));return D(C({},n),{memos:a})}case"DELETE_MEMO_BY_ID":return D(C({},n),{memos:[...n.memos].filter(a=>a.id!==e.payload.id)});case"EDIT_MEMO":{const a=n.memos.map(s=>s.id===e.payload.id?C(C({},s),e.payload):s);return D(C({},n),{memos:a})}default:return n}}const ze={memos:[],tags:[]};function Je(n,e){switch(e.type){case"SIGN_IN":return{user:e.payload.user};case"SIGN_OUT":return{user:null};default:return n}}const Xe={user:null};function Ze(n,e){switch(e.type){case"SET_QUERIES":{const a=v.dedupeObjectWithId(e.payload.queries.sort((s,r)=>v.getTimeStampByDate(r.createdAt)-v.getTimeStampByDate(s.createdAt)).sort((s,r)=>{var o,i;return v.getTimeStampByDate((o=r.pinnedAt)!=null?o:0)-v.getTimeStampByDate((i=s.pinnedAt)!=null?i:0)}));return D(C({},n),{queries:a})}case"INSERT_QUERY":{const a=v.dedupeObjectWithId([e.payload.query,...n.queries].sort((s,r)=>v.getTimeStampByDate(r.createdAt)-v.getTimeStampByDate(s.createdAt)));return D(C({},n),{queries:a})}case"DELETE_QUERY_BY_ID":return D(C({},n),{queries:[...n.queries].filter(a=>a.id!==e.payload.id)});case"UPDATE_QUERY":{const a=n.queries.map(s=>s.id===e.payload.id?C(C({},s),e.payload):s);return D(C({},n),{queries:a})}default:return n}}const et={queries:[]},M=He({globalState:We,locationState:Ve,memoState:ze,userState:Xe,queryState:et},Ge({globalState:je,locationState:Ye,memoState:Ke,userState:Je,queryState:Ze})),P=u.exports.createContext(M.getState());var J;(function(n){function e(r){const o={};for(const i of r)try{const p=localStorage.getItem(i);if(p!==null){const m=JSON.parse(p);o[i]=m}}catch(p){console.error("Get storage failed in ",i,p)}return o}n.get=e;function a(r){for(const o in r)try{const i=JSON.stringify(r[o]);localStorage.setItem(o,i)}catch(i){console.error("Save storage failed in ",o,i)}}n.set=a;function s(){var o;const r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r),(o=r.contentWindow)==null||o.localStorage.setItem("t",Date.now().toString()),r.remove()}n.emitStorageChangedEvent=s})(J||(J={}));class tt{constructor(){I(this,"getState",()=>M.getState().globalState);I(this,"setEditMemoId",e=>{M.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:e}})});I(this,"setMarkMemoId",e=>{M.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:e}})});I(this,"setIsMobileView",e=>{M.dispatch({type:"SET_MOBILE_VIEW",payload:{isMobileView:e}})});I(this,"setAppSetting",e=>{M.dispatch({type:"SET_APP_SETTING",payload:e}),J.set(e)});var s,r,o;const e=J.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser"]),a={shouldSplitMemoWord:(s=e.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(r=e.shouldHideImageUrl)!=null?r:!0,shouldUseMarkdownParser:(o=e.shouldUseMarkdownParser)!=null?o:!0};this.setAppSetting(a)}}const q=new tt,H=(n="replace")=>{const{query:e,pathname:a,hash:s}=M.getState().locationState;let r=v.transformObjectToParamsString(e);r?r="?"+r:r="",n==="replace"?window.history.replaceState(null,"",a+s+r):window.history.pushState(null,"",a+s+r)};class nt{constructor(){I(this,"updateStateWithLocation",()=>{var m,y,N,g,l,d;const{pathname:e,search:a,hash:s}=window.location,r=new URLSearchParams(a),o={pathname:"/",hash:"",query:{tag:"",duration:null,text:"",type:"",filter:""}};o.query.tag=(m=r.get("tag"))!=null?m:"",o.query.type=(y=r.get("type"))!=null?y:"",o.query.text=(N=r.get("text"))!=null?N:"",o.query.filter=(g=r.get("filter"))!=null?g:"";const i=parseInt((l=r.get("from"))!=null?l:"0"),p=parseInt((d=r.get("to"))!=null?d:"0");p>i&&p!==0&&(o.query.duration={from:i,to:p}),o.hash=s,o.pathname=this.getValidPathname(e),M.dispatch({type:"SET_LOCATION",payload:o})});I(this,"getState",()=>M.getState().locationState);I(this,"clearQuery",()=>{M.dispatch({type:"SET_QUERY",payload:{tag:"",duration:null,text:"",type:"",filter:""}}),H()});I(this,"setQuery",e=>{M.dispatch({type:"SET_QUERY",payload:e}),H()});I(this,"setHash",e=>{M.dispatch({type:"SET_HASH",payload:{hash:e}}),H()});I(this,"setPathname",e=>{M.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H()});I(this,"pushHistory",e=>{M.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H("push")});I(this,"replaceHistory",e=>{M.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H("replace")});I(this,"setMemoTypeQuery",(e="")=>{M.dispatch({type:"SET_TYPE",payload:{type:e}}),H()});I(this,"setMemoFilter",e=>{M.dispatch({type:"SET_QUERY_FILTER",payload:e}),H()});I(this,"setTextQuery",e=>{M.dispatch({type:"SET_TEXT",payload:{text:e}}),H()});I(this,"setTagQuery",e=>{M.dispatch({type:"SET_TAG_QUERY",payload:{tag:e}}),H()});I(this,"setFromAndToQuery",(e,a)=>{M.dispatch({type:"SET_DURATION_QUERY",payload:{duration:{from:e,to:a}}}),H()});I(this,"getValidPathname",e=>["/","/signin","/recycle","/setting"].includes(e)?e:"/");this.updateStateWithLocation(),window.onpopstate=()=>{this.updateStateWithLocation()}}}const A=new nt;async function z(n){const a=await(await fetch(n,{method:"GET"})).json();if(!a.succeed)throw a;return a}async function R(n,e){const s=await(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(!s.succeed)throw s;return s}var pe;(function(n){function e(){return z("/api/user/me")}n.getUserInfo=e;function a(F,$){return R("/api/user/signin",{username:F,password:$})}n.signin=a;function s(F,$){return R("/api/user/signup",{username:F,password:$})}n.signup=s;function r(){return R("/api/user/signout")}n.signout=r;function o(F){return z("/api/user/checkusername?username="+F)}n.checkUsernameUsable=o;function i(F){return R("/api/user/checkpassword",{password:F})}n.checkPasswordValid=i;function p(F,$,te,le){return R("/api/user/update",{username:F,password:$,githubName:te,wxUserId:le})}n.updateUserinfo=p;function m(){return z("/api/memo/all")}n.getMyMemos=m;function y(){return z("/api/memo/deleted")}n.getMyDeletedMemos=y;function N(F){return R("/api/memo/new",{content:F})}n.createMemo=N;function g(F){return z("/api/memo/?id="+F)}n.getMemoById=g;function l(F){return R("/api/memo/hide",{memoId:F})}n.hideMemo=l;function d(F){return R("/api/memo/restore",{memoId:F})}n.restoreMemo=d;function h(F){return R("/api/memo/delete",{memoId:F})}n.deleteMemo=h;function f(F,$){return R("/api/memo/update",{memoId:F,content:$})}n.updateMemo=f;function x(F){return z("/api/memo/linked?memoId="+F)}n.getLinkedMemos=x;function w(){return R("/api/user/updategh",{githubName:""})}n.removeGithubName=w;function S(){return z("/api/query/all")}n.getMyQueries=S;function E(F,$){return R("/api/query/new",{title:F,querystring:$})}n.createQuery=E;function b(F,$,te){return R("/api/query/update",{queryId:F,title:$,querystring:te})}n.updateQuery=b;function T(F){return R("/api/query/delete",{queryId:F})}n.deleteQueryById=T;function B(F){return R("/api/query/pin",{queryId:F})}n.pinQuery=B;function Q(F){return R("/api/query/unpin",{queryId:F})}n.unpinQuery=Q})(pe||(pe={}));var _=pe;const ae="#page-container",se="mobile-show-sidebar",xe=200,at=400,W=3600*24*1e3,X=/#\s(.+?)\s/g,ce=/(https?:\/\/[^\s<\\*>']+)/g,Y=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,re=/\[@(.+?)\]\((.+?)\)/g;class st{getState(){return M.getState().userState}async doSignIn(){const{data:e}=await _.getUserInfo();return e?M.dispatch({type:"SIGN_IN",payload:{user:e}}):U.doSignOut(),e}async doSignOut(){_.signout().catch(()=>{}).finally(()=>{M.dispatch({type:"SIGN_OUT",payload:{user:null}})})}async checkUsernameUsable(e){const{data:a}=await _.checkUsernameUsable(e);return a}async updateUsername(e){await _.updateUserinfo(e)}async removeGithubName(){await _.updateUserinfo(void 0,void 0,"")}async checkPasswordValid(e){const{data:a}=await _.checkPasswordValid(e);return a}async updatePassword(e){await _.updateUserinfo(void 0,e)}async updateWxUserId(e){await _.updateUserinfo(void 0,void 0,void 0,e)}}const U=new st;class rt{getState(){return M.getState().memoState}async fetchAllMemos(){if(!U.getState().user)return!1;const{data:e}=await _.getMyMemos(),a=[];for(const s of e)a.push(s);return M.dispatch({type:"SET_MEMOS",payload:{memos:a}}),a}async fetchDeletedMemos(){if(!U.getState().user)return!1;const{data:e}=await _.getMyDeletedMemos();return e}pushMemo(e){M.dispatch({type:"INSERT_MEMO",payload:{memo:C({},e)}})}getMemoById(e){for(const a of this.getState().memos)if(a.id===e)return a;return null}async hideMemoById(e){await _.hideMemo(e),M.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:e}})}async restoreMemoById(e){await _.restoreMemo(e),O.clearMemos(),O.fetchAllMemos()}async deleteMemoById(e){await _.deleteMemo(e)}editMemo(e){M.dispatch({type:"EDIT_MEMO",payload:e})}updateTagsState(){var s;const{memos:e}=this.getState(),a=new Set;for(const r of e)for(const o of Array.from((s=r.content.match(X))!=null?s:[]))a.add(o.replace(X,"$1").trim());M.dispatch({type:"SET_TAGS",payload:{tags:Array.from(a)}})}clearMemos(){M.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(e){const{data:a}=await _.createMemo(e);return a}async updateMemo(e,a){const{data:s}=await _.updateMemo(e,a);return s}async getLinkedMemos(e){const{data:a}=await _.getLinkedMemos(e);return a}}const O=new rt;class ot{getState(){return M.getState().queryState}async getMyAllQueries(){if(!U.getState().user)return!1;const{data:e}=await _.getMyQueries();return M.dispatch({type:"SET_QUERIES",payload:{queries:e}}),e}getQueryById(e){for(const a of this.getState().queries)if(a.id===e)return a}pushQuery(e){M.dispatch({type:"INSERT_QUERY",payload:{query:C({},e)}})}editQuery(e){M.dispatch({type:"UPDATE_QUERY",payload:e})}async deleteQuery(e){await _.deleteQueryById(e),M.dispatch({type:"DELETE_QUERY_BY_ID",payload:{id:e}})}async createQuery(e,a){const{data:s}=await _.createQuery(e,a);return s}async updateQuery(e,a,s){const{data:r}=await _.updateQuery(e,a,s);return r}async pinQuery(e){await _.pinQuery(e)}async unpinQuery(e){await _.unpinQuery(e)}}const G=new ot;function Z(n=!1){const[e,a]=u.exports.useState(n),s=u.exports.useCallback(r=>{a(r!==void 0?r:o=>!o)},[]);return[e,s]}const ct=n=>{const{children:e,className:a,clickSpaceDestroy:s,destroy:r}=n,o=()=>{s&&r()};return t("div",{className:`dialog-wrapper ${a}`,onClick:o,children:t("div",{className:"dialog-container",onClick:i=>i.stopPropagation(),children:e})})};function V(n,e,a){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var p;(p=s.firstElementChild)==null||p.classList.add("showup")},0);const r={destroy:()=>{var p,m;(p=s.firstElementChild)==null||p.classList.remove("showup"),(m=s.firstElementChild)==null||m.classList.add("showoff"),setTimeout(()=>{s.remove(),ne.unmountComponentAtNode(s)},xe)}},o=D(C({},a),{destroy:r.destroy});let i=t(ct,D(C({destroy:r.destroy,clickSpaceDestroy:!0},n),{children:t(e,C({},o))}));return n.useAppContext&&(i=t(Ce,{store:M,context:P,children:i})),ne.render(i,s),r}const it=({destroy:n})=>c(L,{children:[c("div",{className:"dialog-header-container",children:[c("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F920}"}),"\u5173\u4E8E ",t("b",{children:"Memos"})]}),t("button",{className:"text-btn close-btn",onClick:()=>{n()},children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),c("div",{className:"dialog-content-container",children:[t("p",{children:"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"}),t("br",{}),t("i",{children:"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"}),c("ul",{children:[c("li",{children:["\u5B9E\u8DF5 ",t("strong",{children:"\u5362\u66FC\u5361\u7247\u76D2\u7B14\u8BB0\u6CD5"}),"\uFF1B"]}),t("li",{children:"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5} \u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1} \u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5} \u8BFB\u540E\u611F..."}),t("li",{children:"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"}),t("li",{children:"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B"})]}),t("br",{}),t("i",{children:"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"}),c("ul",{children:[c("li",{children:["\u2728"," ",t("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer",children:"\u5F00\u6E90\u9879\u76EE"})]}),t("li",{children:"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"}),t("li",{children:"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B"})]}),t("br",{}),t("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web/discussions",rel:"noreferrer",children:"\u{1F914} \u95EE\u9898\u53CD\u9988"}),t("br",{}),t("p",{children:"Enjoy it and have fun~ "}),t("hr",{}),c("p",{className:"normal-text",children:["Last updated on ",t("span",{className:"pre-text",children:"2021/11/3 8:15:39"})," \u{1F389}"]})]})]});function ve(){V({className:"about-site-dialog"},it)}const lt=n=>{const{shownStatus:e,toggleShownStatus:a}=n;u.exports.useEffect(()=>{const m=()=>{a(!1)};return window.addEventListener("click",m),()=>{window.removeEventListener("click",m)}},[]);const s=m=>{m.stopPropagation(),a(!1)},r=()=>{A.pushHistory("/setting")},o=()=>{A.pushHistory("/recycle")},i=()=>{ve()},p=async()=>{await U.doSignOut(),A.replaceHistory("/signin")};return c("div",{className:`menu-btns-popup ${e?"":"hidden"}`,onClick:s,children:[c("button",{className:"text-btn action-btn",onClick:r,children:[t("span",{className:"icon",children:"\u{1F464}"})," \u8D26\u53F7\u4E0E\u8BBE\u7F6E"]}),c("button",{className:"text-btn action-btn",onClick:o,children:[t("span",{className:"icon",children:"\u{1F5D1}\uFE0F"})," \u56DE\u6536\u7AD9"]}),c("button",{className:"text-btn action-btn",onClick:i,children:[t("span",{className:"icon",children:"\u{1F920}"})," \u5173\u4E8E"]}),c("button",{className:"text-btn action-btn",onClick:p,children:[t("span",{className:"icon",children:"\u{1F44B}"})," \u9000\u51FA"]})]})};function ee(n=!0){const[e,a]=u.exports.useState({isLoading:n,isFailed:!1,isSucceed:!1});return D(C({},e),{setLoading:()=>{a(D(C({},e),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{a(D(C({},e),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{a(D(C({},e),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const ut=({destroy:n,imgUrl:e})=>{const a=u.exports.useRef(null),[s,r]=u.exports.useState(-1);u.exports.useEffect(()=>{v.getImageSize(e).then(({width:m})=>{r(m!==0?80:0)})},[]);const o=()=>{n()},i=()=>{s>30&&r(s-10)},p=()=>{r(s+10)};return c(L,{children:[t("button",{className:"text-btn close-btn",onClick:o,children:t("img",{className:"icon-img",src:"/icons/close.svg"})}),c("div",{className:"img-container",children:[t("img",{className:s<=0?"hidden":"",ref:a,width:s+"%",src:e}),t("span",{className:"loading-text "+(s===-1?"":"hidden"),children:"\u56FE\u7247\u52A0\u8F7D\u4E2D..."}),t("span",{className:"loading-text "+(s===0?"":"hidden"),children:"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5"})]}),c("div",{className:"action-btns-container",children:[t("button",{className:"text-btn",onClick:i,children:"\u2796"}),t("button",{className:"text-btn",onClick:p,children:"\u2795"}),t("button",{className:"text-btn",onClick:()=>r(80),children:"\u2B55"})]})]})};function be(n){V({className:"preview-image-dialog"},ut,{imgUrl:n})}const dt=/```([\s\S]*?)```/g,mt=/\*\*(.+?)\*\*/g,pt=/\*(.+?)\*/g,ht=/\[ \] /g,gt=/\[x\] /g,ft=/[*] /g,yt=/(\d+)\. /g,Nt=n=>n.replace(dt,"<pre lang=''>$1</pre>").replace(ft,"<span class='counter-block'>\u2022</span>").replace(yt,"<span class='counter-block'>$1.</span>").replace(ht,"<span class='todo-block' data-type='todo'>\u2B1C</span>").replace(gt,"<span class='todo-block' data-type='done'>\u2705</span>").replace(mt,"<strong>$1</strong>").replace(pt,"<em>$1</em>"),he=n=>{const e=document.createElement("div");return e.className="memo-content-text",e.innerHTML=n,e.innerText},Et=n=>n.replace(/\n/g,"<br>"),St=n=>{const e=document.createElement("div");return e.textContent=n,e.innerHTML},Ct=n=>{const{children:e,when:a}=n;return a?t(L,{children:e}):null},j=Ct;const ge=n=>{const{className:e,imgUrl:a}=n,s=()=>{be(a)};return t("div",{className:"image-container "+e,onClick:s,children:t("img",{src:a,decoding:"async",loading:"lazy"})})};const xt=n=>{const{destory:e,duration:a}=n;return u.exports.useEffect(()=>{a>0&&setTimeout(()=>{e()},a)},[]),t("div",{className:"toast-container",onClick:e,children:t("p",{className:"content-text",children:n.content})})};class vt{constructor(){I(this,"shownToastAmount",0);I(this,"toastWrapper");I(this,"shownToastContainers",[]);I(this,"info",(e,a=3e3)=>this.showToast({type:"normal",content:e,duration:a}));I(this,"success",(e,a=3e3)=>this.showToast({type:"success",content:e,duration:a}));I(this,"error",(e,a=3e3)=>this.showToast({type:"error",content:e,duration:a}));I(this,"showToast",e=>{const a=document.createElement("div");a.className=`toast-wrapper ${e.type}`,this.toastWrapper.appendChild(a),this.shownToastAmount++,this.shownToastContainers.push(a),setTimeout(()=>{a.classList.add("showup")},0);const s={destory:()=>{a.classList.add("destory"),setTimeout(()=>{if(!!a.parentElement&&(this.shownToastAmount--,this.shownToastAmount===0)){for(const r of this.shownToastContainers)ne.unmountComponentAtNode(r),r.remove();this.shownToastContainers.splice(0,this.shownToastContainers.length)}},at)}};return ne.render(t(xt,D(C({},e),{destory:s.destory})),a),s});const e="toast-list-container",a=document.createElement("div");a.className=e,document.body.appendChild(a),this.toastWrapper=a}}var k=new vt;const bt=n=>{var g;const[e,a]=u.exports.useState(D(C({},n.memo),{createdAtStr:v.getDateTimeString(n.memo.createdAt)})),[s,r]=u.exports.useState([]),[o,i]=u.exports.useState([]),p=Array.from((g=e.content.match(Y))!=null?g:[]);u.exports.useEffect(()=>{(async()=>{try{const d=[],h=[...e.content.matchAll(re)];for(const x of h)if(x&&x.length===3){const w=x[2],S=O.getMemoById(w);S&&d.push(D(C({},S),{createdAtStr:v.getDateTimeString(S.createdAt),dateStr:v.getDateString(S.createdAt)}))}r([...d]);const f=await O.getLinkedMemos(e.id);i(f.sort((x,w)=>v.getTimeStampByDate(w.createdAt)-v.getTimeStampByDate(x.createdAt)).map(x=>D(C({},x),{createdAtStr:v.getDateTimeString(x.createdAt),dateStr:v.getDateString(x.createdAt)})))}catch(d){}})()},[e.id]);const m=u.exports.useCallback(async l=>{var h;const d=l.target;if(d.className==="memo-link-text"){const f=(h=d.dataset)==null?void 0:h.value,x=O.getMemoById(f!=null?f:"");if(x){const w=D(C({},x),{createdAtStr:v.getDateTimeString(x.createdAt)});r([]),i([]),a(w)}else k.error("MEMO Not Found"),d.classList.remove("memo-link-text")}},[]),y=u.exports.useCallback(l=>{r([]),i([]),a(l)},[]),N=u.exports.useCallback(()=>{n.destroy(),q.setEditMemoId(e.id)},[e.id]);return c(L,{children:[c("div",{className:"memo-card-container",children:[c("div",{className:"header-container",children:[t("p",{className:"time-text",children:e.createdAtStr}),c("div",{className:"btns-container",children:[t("button",{className:"text-btn edit-btn",onClick:N,children:t("img",{className:"icon-img",src:"/icons/edit.svg"})}),t("button",{className:"text-btn close-btn",onClick:n.destroy,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]})]}),c("div",{className:"memo-container",children:[t("div",{className:"memo-content-text",onClick:m,dangerouslySetInnerHTML:{__html:K(e.content)}}),t(j,{when:p.length>0,children:t("div",{className:"images-wrapper",children:p.map((l,d)=>t(ge,{className:"memo-img",imgUrl:l},d))})})]}),t("div",{className:"layer-container"}),s.map((l,d)=>d<4?t("div",{className:"background-layer-container",style:{bottom:(d+1)*-3+"px",left:(d+1)*5+"px",width:`calc(100% - ${(d+1)*10}px)`,zIndex:-d-1}},d):null)]}),s.length>0?c("div",{className:"linked-memos-wrapper",children:[c("p",{className:"normal-text",children:["\u5173\u8054\u4E86 ",s.length," \u4E2A MEMO"]}),s.map(l=>{const d=he(K(l.content)).replaceAll(`
`," ");return c("div",{className:"linked-memo-container",onClick:()=>y(l),children:[c("span",{className:"time-text",children:[l.dateStr," "]}),d]},l.id)})]}):null,o.length>0?c("div",{className:"linked-memos-wrapper",children:[c("p",{className:"normal-text",children:[o.length," \u4E2A\u94FE\u63A5\u81F3\u6B64\u7684 MEMO"]}),o.map(l=>{const d=he(K(l.content)).replaceAll(`
`," ");return c("div",{className:"linked-memo-container",onClick:()=>y(l),children:[c("span",{className:"time-text",children:[l.dateStr," "]}),d]},l.id)})]}):null]})};function De(n){V({className:"memo-card-dialog"},bt,{memo:n})}const Dt=n=>{var d;const{memo:e,destroy:a}=n,[s,r]=u.exports.useState(""),o=u.exports.useRef(null),{user:i}=U.getState(),p=D(C({},e),{createdAtStr:v.getDateTimeString(e.createdAt)}),m=Array.from((d=p.content.match(Y))!=null?d:[]),[y,N]=u.exports.useState(m.length);u.exports.useEffect(()=>{setTimeout(()=>{if(!!o.current&&y===0){const h=v.getOSVersion();(h==="MacOS"||h==="Unknown")&&window.scrollTo(0,0),html2canvas(o.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(f=>{r(f.toDataURL())})}},xe+100)},[y]);const g=()=>{a()},l=h=>{h.type==="error"&&(k.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),h.target.remove()),N(y-1)};return c(L,{children:[c("div",{className:"dialog-header-container",children:[c("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F970}"}),"\u5206\u4EAB Memo \u56FE\u7247"]}),t("button",{className:"text-btn close-btn",onClick:g,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),c("div",{className:"dialog-content-container",children:[t("div",{className:`tip-words-container ${s?"finished":"genarating"}`,children:t("p",{className:"tip-text",children:s?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D..."})}),t("img",{className:"memo-img",src:s}),c("div",{className:"memo-container",ref:o,children:[t("span",{className:"time-text",children:p.createdAtStr}),t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:K(p.content)}}),t(j,{when:m.length>0,children:t("div",{className:"images-container",children:m.map((h,f)=>t("img",{crossOrigin:"anonymous",src:h,onLoad:l,onError:l,decoding:"async"},f))})}),t("div",{className:"watermark-container",children:c("span",{className:"normal-text",children:["by ",t("span",{className:"name-text",children:i==null?void 0:i.username})]})})]})]})]})};function wt(n){V({className:"share-memo-image-dialog"},Dt,{memo:n})}const Ft=n=>{var d;const{memo:e}=n,a=D(C({},e),{createdAtStr:v.getDateTimeString(e.createdAt)}),[s,r]=Z(!1),o=Array.from((d=a.content.match(Y))!=null?d:[]),i=()=>{De(a)},p=()=>{q.setMarkMemoId(a.id)},m=()=>{q.setEditMemoId(a.id)},y=async()=>{if(s){try{await O.hideMemoById(a.id)}catch(h){k.error(h.message)}q.getState().editMemoId===a.id&&q.setEditMemoId("")}else r()},N=()=>{s&&r(!1)},g=()=>{wt(a)},l=async h=>{var x;const f=h.target;if(f.className==="memo-link-text"){const w=(x=f.dataset)==null?void 0:x.value,S=O.getMemoById(w!=null?w:"");S?De(S):(k.error("MEMO Not Found"),f.classList.remove("memo-link-text"))}else f.className==="todo-block"};return c("div",{className:`memo-wrapper ${"memos-"+a.id}`,onMouseLeave:N,children:[c("div",{className:"memo-top-wrapper",children:[t("span",{className:"time-text",onClick:i,children:a.createdAtStr}),c("div",{className:"btns-container",children:[t("span",{className:"text-btn more-action-btn",children:t("img",{className:"icon-img",src:"/icons/more.svg"})}),t("div",{className:"more-action-btns-wrapper",children:c("div",{className:"more-action-btns-container",children:[t("span",{className:"text-btn",onClick:i,children:"\u67E5\u770B\u8BE6\u60C5"}),t("span",{className:"text-btn",onClick:p,children:"Mark"}),t("span",{className:"text-btn",onClick:g,children:"\u5206\u4EAB"}),t("span",{className:"text-btn",onClick:m,children:"\u7F16\u8F91"}),t("span",{className:`text-btn delete-btn ${s?"final-confirm":""}`,onClick:y,children:s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]}),t("div",{className:"memo-content-text",onClick:l,dangerouslySetInnerHTML:{__html:K(a.content)}}),t(j,{when:o.length>0,children:t("div",{className:"images-wrapper",children:o.map((h,f)=>t(ge,{className:"memo-img",imgUrl:h},f))})})]})};function K(n){var o;n=St(n),n=Et(n).split("<br>").map(i=>`<p>${i!==""?i:"<br>"}</p>`).join("");const{shouldUseMarkdownParser:e,shouldSplitMemoWord:a,shouldHideImageUrl:s}=q.getState();e&&(n=Nt(n)),s&&(n=n.replace(Y,"")),a&&(n=n.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)/g,"$1 $2").replace(/([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5])/g,"$1 $2")),n=n.replace(X,"<span class='tag-span'>#$1</span>").replace(ce,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(re,"<span class='memo-link-text' data-value='$2'>$1</span>");const r=document.createElement("div");r.innerHTML=n;for(let i=0;i<r.children.length;i++){const p=r.children[i];if(p.tagName==="P"&&p.textContent===""&&((o=p.firstElementChild)==null?void 0:o.tagName)!=="BR"){p.remove(),i--;continue}}return r.innerHTML}var Tt=u.exports.memo(Ft);const Mt=n=>{var r;const{memo:e}=n,a=D(C({},e),{createdAtStr:v.getDateTimeString(e.createdAt),timeStr:v.getTimeString(e.createdAt)}),s=Array.from((r=a.content.match(Y))!=null?r:[]);return c("div",{className:"daily-memo-wrapper",children:[t("div",{className:"time-wrapper",children:t("span",{className:"normal-text",children:a.timeStr})}),c("div",{className:"memo-content-container",children:[t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:K(a.content)}}),t(j,{when:s.length>0,children:t("div",{className:"images-container",children:s.map((o,i)=>t("img",{crossOrigin:"anonymous",src:o,decoding:"async"},i))})})]})]})};const kt=n=>{const{className:e,datestamp:a,handleDateStampChange:s}=n,[r,o]=u.exports.useState(fe(a));u.exports.useEffect(()=>{o(fe(a))},[a]);const i=new Date(r),p=i.getDay()===0?7:i.getDay(),m=[];for(let l=1;l<p;l++)m.push({date:0,datestamp:i.getTime()-W*(7-l)});const y=At(r);for(let l=1;l<=y;l++)m.push({date:l,datestamp:i.getTime()+W*(l-1)});const N=l=>{s(l)},g=l=>{const d=i.getFullYear(),h=i.getMonth()+1;let f=0;h===1&&l===-1?f=new Date(`${d-1}/12/1`).getTime():h===12&&l===1?f=new Date(`${d+1}/1/1`).getTime():f=new Date(`${d}/${h+l}/1`).getTime(),o(fe(f))};return c("div",{className:`date-picker-wrapper ${e}`,children:[c("div",{className:"date-picker-header",children:[t("span",{className:"btn-text",onClick:()=>g(-1),children:t("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),c("span",{className:"normal-text",children:[i.getFullYear()," \u5E74 ",i.getMonth()+1," \u6708"]}),t("span",{className:"btn-text",onClick:()=>g(1),children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),c("div",{className:"date-picker-day-container",children:[c("div",{className:"date-picker-day-header",children:[t("span",{className:"day-item",children:"\u5468\u4E00"}),t("span",{className:"day-item",children:"\u5468\u4E8C"}),t("span",{className:"day-item",children:"\u5468\u4E09"}),t("span",{className:"day-item",children:"\u5468\u56DB"}),t("span",{className:"day-item",children:"\u5468\u4E94"}),t("span",{className:"day-item",children:"\u5468\u516D"}),t("span",{className:"day-item",children:"\u5468\u65E5"})]}),m.map(l=>l.date===0?t("span",{className:"day-item null",children:""},l.datestamp):t("span",{className:`day-item ${l.datestamp===a?"current":""}`,onClick:()=>N(l.datestamp),children:l.date},l.datestamp))]})]})};function At(n){const e=new Date(n),a=new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`);return((a.getMonth()===11?new Date(`${a.getFullYear()+1}/1`):new Date(`${a.getFullYear()}/${a.getMonth()+2}/1`)).getTime()-a.getTime())/W}function fe(n){const e=new Date(n);return new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`).getTime()}const Bt=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],It=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],Ot=n=>{const e=ee(),[a,s]=u.exports.useState([]),[r,o]=u.exports.useState(v.getDateStampByDate(v.getDateString(n.currentDateStamp))),[i,p]=Z(!1),m=u.exports.useRef(null),y=new Date(r);u.exports.useEffect(()=>{(()=>{const d=O.getState().memos.filter(h=>v.getTimeStampByDate(h.createdAt)>=r&&v.getTimeStampByDate(h.createdAt)<r+W).sort((h,f)=>v.getTimeStampByDate(h.createdAt)-v.getTimeStampByDate(f.createdAt));s(d),e.setFinish()})()},[r]);const N=()=>{p(!1),setTimeout(()=>{if(!m.current)return;const l=v.getOSVersion();(l==="MacOS"||l==="Unknown")&&window.scrollTo(0,0),html2canvas(m.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(d=>{be(d.toDataURL())})},0)},g=l=>{o(l),p(!1)};return c(L,{children:[t("div",{className:"dialog-header-container",children:c("div",{className:"btns-wrapper",children:[c("div",{className:"btns-container",children:[t("span",{className:"btn-text",onClick:()=>o(r-W),children:t("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),t("span",{className:"btn-text",onClick:()=>o(r+W),children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),c("div",{className:"btns-container",children:[t("span",{className:"btn-text",onClick:N,children:t("img",{className:"icon-img",src:"/icons/share.svg"})}),t("span",{className:"btn-text",onClick:()=>n.destroy(),children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]})]})}),c("div",{className:"dialog-content-container",ref:m,children:[c("div",{className:"date-card-container",onClick:()=>p(),children:[t("div",{className:"year-text",children:y.getFullYear()}),c("div",{className:"date-container",children:[t("div",{className:"month-text",children:Bt[y.getMonth()]}),t("div",{className:"date-text",children:y.getDate()}),t("div",{className:"day-text",children:It[y.getDay()]})]})]}),t(kt,{className:`date-picker ${i?"":"hide"}`,datestamp:r,handleDateStampChange:g}),e.isLoading?t("div",{className:"tip-container",children:t("p",{className:"tip-text",children:"\u52AA\u529B\u52A0\u8F7D\u4E2D..."})}):a.length===0?t("div",{className:"tip-container",children:t("p",{className:"tip-text",children:"\u7A7A\u7A7A\u5982\u4E5F"})}):t("div",{className:"dailymemos-wrapper",children:a.map(l=>t(Mt,{memo:l},`${l.id}-${l.updatedAt}`))})]})]})};function Lt(n=Date.now()){V({className:"daily-memo-diary-dialog"},Ot,{currentDateStamp:n})}const _t=()=>{const{userState:{user:n},memoState:{memos:e,tags:a}}=u.exports.useContext(P),s=n?n.username:"Memos",r=n?Math.ceil((Date.now()-v.getTimeStampByDate(n.createdAt))/1e3/3600/24):0,[o,i]=Z(!1),p=u.exports.useCallback(()=>{A.pushHistory("/"),A.clearQuery()},[]);return c("div",{className:"user-banner-container",children:[c("div",{className:"userinfo-header-container",children:[t("p",{className:"username-text",onClick:p,children:s}),t("span",{className:"action-btn menu-popup-btn",onClick:()=>{const y=document.querySelector(".sidebar-wrapper"),N=document.querySelector(".menu-btns-popup");N.style.top=54-y.scrollTop+"px",i()},children:t("img",{src:"/icons/more.svg",className:"icon-img"})}),t(lt,{shownStatus:o,toggleShownStatus:i})]}),c("div",{className:"status-text-container",children:[c("div",{className:"status-text memos-text",children:[t("span",{className:"amount-text",children:e.length}),t("span",{className:"type-text",children:"MEMO"})]}),c("div",{className:"status-text tags-text",children:[t("span",{className:"amount-text",children:a.length}),t("span",{className:"type-text",children:"TAG"})]}),c("div",{className:"status-text duration-text",onClick:()=>Lt(),children:[t("span",{className:"amount-text",children:r}),t("span",{className:"type-text",children:"DAY"})]})]})]})},oe={TAG:{value:"TAG",text:"\u6807\u7B7E",operators:[{text:"\u5305\u62EC",value:"CONTAIN"},{text:"\u6392\u9664",value:"NOT_CONTAIN"}]},TYPE:{value:"TYPE",text:"\u7C7B\u578B",operators:[{value:"IS",text:"\u662F"},{value:"IS_NOT",text:"\u4E0D\u662F"}],values:[{value:"CONNECTED",text:"\u6709\u5173\u8054"},{value:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{value:"LINKED",text:"\u6709\u8D85\u94FE\u63A5"},{value:"IMAGED",text:"\u6709\u56FE\u7247"}]},TEXT:{value:"TEXT",text:"\u6587\u672C",operators:[{value:"CONTAIN",text:"\u5305\u62EC"},{value:"NOT_CONTAIN",text:"\u6392\u9664"}]}},ye=oe.TYPE.values,Ut=n=>{for(const e of ye)if(e.value===n)return e.text;return""},Pt=()=>({type:"TAG",value:{operator:"CONTAIN",value:""},relation:"AND"}),we=(n,e)=>{let a=!0;for(const s of e){const{relation:r}=s,o=Qt(n,s);r==="OR"?a=a||o:a=a&&o}return a},Qt=(n,e)=>{const{type:a,value:{operator:s,value:r}}=e;if(r==="")return!0;let o=!0;if(a==="TAG"){let i=n.content.includes(`# ${r}`);s==="NOT_CONTAIN"&&(i=!i),o=i}else if(a==="TYPE"){let i=!1;(r==="NOT_TAGGED"&&n.content.match(X)===null||r==="LINKED"&&n.content.match(ce)!==null||r==="IMAGED"&&n.content.match(Y)!==null||r==="CONNECTED"&&n.content.match(re)!==null)&&(i=!0),s==="IS_NOT"&&(i=!i),o=i}else if(a==="TEXT"){let i=n.content.includes(r);s==="NOT_CONTAIN"&&(i=!i),o=i}return o};const Rt=n=>{const{destroy:e,queryId:a}=n,[s,r]=u.exports.useState(""),[o,i]=u.exports.useState([]),p=ee(!1);u.exports.useEffect(()=>{const d=G.getQueryById(a!=null?a:"");if(d){r(d.title);const h=JSON.parse(d.querystring);Array.isArray(h)&&i(h)}},[a]);const m=d=>{const h=d.target.value;r(h)},y=async()=>{if(!s){k.error("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01");return}try{if(a){const d=await G.updateQuery(a,s,JSON.stringify(o));G.editQuery(d)}else{const d=await G.createQuery(s,JSON.stringify(o));G.pushQuery(d)}}catch(d){k.error(d.message)}e()},N=()=>{if(o.length>0&&o[o.length-1].value.value===""){k.info("\u5148\u5B8C\u5584\u4E0A\u4E00\u4E2A\u8FC7\u6EE4\u5668\u5427");return}i([...o,Pt()])},g=(d,h)=>{const f=[...o];f[d]=h,i(f)},l=d=>{const h=o.filter((f,x)=>x!==d);i(h)};return c(L,{children:[c("div",{className:"dialog-header-container",children:[c("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F516}"}),a?"\u7F16\u8F91\u68C0\u7D22":"\u521B\u5EFA\u68C0\u7D22"]}),t("button",{className:"text-btn close-btn",onClick:e,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),c("div",{className:"dialog-content-container",children:[c("div",{className:"form-item-container input-form-container",children:[t("span",{className:"normal-text",children:"\u6807\u9898"}),t("input",{className:"title-input",type:"text",value:s,onChange:m})]}),c("div",{className:"form-item-container filter-form-container",children:[t("span",{className:"normal-text",children:"\u8FC7\u6EE4\u5668"}),c("div",{className:"filters-wrapper",children:[o.map((d,h)=>t($t,{index:h,filter:d,handleFilterChange:g,handleFilterRemove:l},`${h}-${Date.now()}`)),t("div",{className:"create-filter-btn",onClick:N,children:"\u6DFB\u52A0\u7B5B\u9009\u6761\u4EF6"})]})]})]}),c("div",{className:"dialog-footer-container",children:[t("div",{}),t("div",{className:"btns-container",children:t("button",{className:`text-btn save-btn ${p.isLoading?"requesting":""}`,onClick:y,children:"\u4FDD\u5B58"})})]})]})},$t=n=>{const{index:e,filter:a,handleFilterChange:s,handleFilterRemove:r}=n,{type:o}=a,[i,p]=u.exports.useState(t(L,{}));u.exports.useEffect(()=>{let d=t(L,{});Object.keys(oe).includes(o)&&(d=t("select",{className:"operator-selector",value:a.value.operator,onChange:N,children:oe[o].operators.map(f=>t("option",{value:f.value,children:f.text},f.value))}));let h=t(L,{});switch(o){case"TYPE":{h=c("select",{className:"value-selector",value:a.value.value,onChange:g,children:[t("option",{value:""}),oe.TYPE.values.map(f=>t("option",{value:f.value,children:f.text},f.value))]});break}case"TAG":{h=c("select",{className:"value-selector",value:a.value.value,onChange:g,children:[t("option",{value:""}),O.getState().tags.map(f=>t("option",{value:f,children:f},f))]});break}case"TEXT":{h=t("input",{className:"value-inputer",value:a.value.value,onChange:g,type:"text",name:"",id:""});break}}p(c(L,{children:[d,h]}))},[o,a]);const m=d=>{const h=d.target.value;["AND","OR"].includes(h)&&s(e,D(C({},a),{relation:h}))},y=d=>{const h=d.target.value;s(e,D(C({},a),{type:h}))},N=d=>{const h=d.target.value;s(e,D(C({},a),{value:D(C({},a.value),{operator:h})}))},g=d=>{const h=d.target.value;s(e,D(C({},a),{value:D(C({},a.value),{value:h})}))},l=()=>{r(e)};return c("div",{className:"memo-filter-input-wrapper",children:[e>0?c("select",{className:"relation-selector",onChange:m,value:n.filter.relation,children:[t("option",{value:"AND",children:"\u4E14"}),t("option",{value:"OR",children:"\u6216"})]}):null,t("select",{className:"type-selector",onChange:y,value:o,children:Object.values(oe).map(d=>t("option",{value:d.value,children:d.text},d.value))}),i,t("img",{className:"remove-btn",src:"/icons/close.svg",onClick:l})]})};function Ne(n){V({className:"create-query-dialog"},Rt,{queryId:n})}const qt=()=>{const{queryState:{queries:n},locationState:{query:{filter:e}}}=u.exports.useContext(P),a=ee(),s=n.sort((r,o)=>v.getTimeStampByDate(o.createdAt)-v.getTimeStampByDate(r.createdAt)).sort((r,o)=>{var i,p;return v.getTimeStampByDate((i=o.pinnedAt)!=null?i:0)-v.getTimeStampByDate((p=r.pinnedAt)!=null?p:0)});return u.exports.useEffect(()=>{G.getMyAllQueries().catch(()=>{}).finally(()=>{a.setFinish()})},[]),c("div",{className:"queries-wrapper",children:[c("p",{className:"title-text",children:[t("span",{className:"normal-text",children:"\u5FEB\u901F\u68C0\u7D22"}),t("span",{className:"text-btn",onClick:()=>Ne(),children:"+"})]}),t(j,{when:a.isSucceed&&s.length===0,children:t("div",{className:"create-query-btn-container",children:t("span",{className:"text-btn",onClick:()=>Ne(),children:"\u521B\u5EFA\u68C0\u7D22"})})}),t("div",{className:"queries-container",children:s.map(r=>t(Gt,{query:r,isActive:r.id===e},r.id))})]})},Gt=n=>{const{query:e,isActive:a}=n,[s,r]=Z(!1),o=()=>{a?A.setMemoFilter(""):(["/","/recycle"].includes(A.getState().pathname)||A.setPathname("/"),A.setMemoFilter(e.id))},i=async N=>{if(N.stopPropagation(),s)try{await G.deleteQuery(e.id)}catch(g){k.error(g.message)}else r()},p=N=>{N.stopPropagation(),Ne(e.id)},m=async N=>{N.stopPropagation();try{e.pinnedAt?(await G.unpinQuery(e.id),G.editQuery(D(C({},e),{pinnedAt:void 0}))):(await G.pinQuery(e.id),G.editQuery(D(C({},e),{pinnedAt:v.getDateTimeString(Date.now())})))}catch(g){}},y=N=>{N.stopPropagation(),r(!1)};return t(L,{children:c("div",{className:`query-item-container ${a?"active":""}`,onClick:o,children:[c("div",{className:"query-text-container",children:[t("span",{className:"icon-text",children:"#"}),t("span",{className:"query-text",children:e.title})]}),c("div",{className:"btns-container",children:[t("span",{className:"action-btn toggle-btn",children:t("img",{className:"icon-img",src:`/icons/more${a?"-white":""}.svg`})}),t("div",{className:"action-btns-wrapper",children:c("div",{className:"action-btns-container",children:[t("span",{className:"text-btn",onClick:m,children:e.pinnedAt?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876"}),t("span",{className:"text-btn",onClick:p,children:"\u7F16\u8F91"}),t("span",{className:`text-btn delete-btn ${s?"final-confirm":""}`,onClick:i,onMouseLeave:y,children:s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]})})};const Ht=()=>{const{locationState:{query:{tag:n}},memoState:{tags:e,memos:a}}=u.exports.useContext(P),[s,r]=u.exports.useState([]);return u.exports.useEffect(()=>{O.updateTagsState()},[a]),u.exports.useEffect(()=>{const o=Array.from(e).sort(),i={subTags:[]};for(const p of o){const m=p.split("/");let y=i,N="";for(let g=0;g<m.length;g++){const l=m[g];g===0?N+=l:N+="/"+l;let d=null;for(const h of y.subTags)if(h.text===N){d=h;break}d||(d={key:l,text:N,subTags:[]},y.subTags.push(d)),y=d}}r(i.subTags)},[e]),c("div",{className:"tags-wrapper",children:[t("p",{className:"title-text",children:"\u5E38\u7528\u6807\u7B7E"}),c("div",{className:"tags-container",children:[s.map((o,i)=>t(Fe,{tag:o,tagQuery:n},o.text+"-"+i)),t(j,{when:s.length<5,children:c("p",{className:"tag-tip-container",children:["\u8F93\u5165",t("span",{className:"code-text",children:"# Tag "}),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~"]})})]})]})},Fe=n=>{const{tag:e,tagQuery:a}=n,s=a===e.text,r=e.subTags.length>0,[o,i]=Z(!1),p=()=>{s?A.setTagQuery(""):(v.copyTextToClipboard(`# ${e.text} `),["/","/recycle"].includes(A.getState().pathname)||A.setPathname("/"),A.setTagQuery(e.text))},m=y=>{y.stopPropagation(),i()};return c(L,{children:[c("div",{className:`tag-item-container ${s?"active":""}`,onClick:p,children:[c("div",{className:"tag-text-container",children:[t("span",{className:"icon-text",children:"#"}),t("span",{className:"tag-text",children:e.key})]}),t("div",{className:"btns-container",children:r?t("span",{className:`action-btn toggle-btn ${o?"shown":""}`,onClick:m,children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})}):null})]}),r?t("div",{className:`subtags-container ${o?"":"hidden"}`,children:e.subTags.map((y,N)=>t(Fe,{tag:y,tagQuery:a},y.text+"-"+N))}):null]})};const Te={width:12,height:7},Me=(n,e)=>{const a=[];for(let s=1;s<=n;s++)a.push({timestamp:e+W*s,count:0});return a},jt=()=>{const n=v.getDateStampByDate(Date.now()),e=new Date(n).getDay()||7,a=new Array(7-e).fill(0),s=(Te.width-1)*Te.height+e,r=n-s*W,{memoState:{memos:o}}=u.exports.useContext(P),[i,p]=u.exports.useState(Me(s,r)),[m,y]=u.exports.useState(null),[N,g]=u.exports.useState(null),l=u.exports.useRef(null),d=u.exports.useRef(null);u.exports.useEffect(()=>{const w=Me(s,r);for(const S of o){const E=(v.getDateStampByDate(S.createdAt)-r)/(1e3*3600*24)-1;E>=0&&(w[E].count+=1)}p([...w])},[o]);const h=u.exports.useCallback((w,S)=>{var Q,F;if(y(S),!d.current)return;const{isMobileView:E}=q.getState(),b=w.target,T=document.querySelector(".sidebar-wrapper");d.current.style.left=b.offsetLeft-((F=(Q=l.current)==null?void 0:Q.offsetLeft)!=null?F:0)+"px";let B=b.offsetTop;E||(B-=T.scrollTop),d.current.style.top=B+"px"},[]),f=u.exports.useCallback(()=>{y(null)},[]),x=u.exports.useCallback(w=>{var S;((S=A.getState().query.duration)==null?void 0:S.from)===w.timestamp?(A.setFromAndToQuery(0,0),g(null)):w.count>0&&(["/","/recycle"].includes(A.getState().pathname)||A.setPathname("/"),A.setFromAndToQuery(w.timestamp,w.timestamp+W),g(w))},[]);return c("div",{className:"usage-heat-map-wrapper",ref:l,children:[c("div",{className:"day-tip-text-container",children:[t("span",{className:"tip-text",children:"Mon"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Wed"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Fri"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Sun"})]}),c("div",{ref:d,className:"usage-detail-container pop-up "+(m?"":"hidden"),children:[m==null?void 0:m.count," memos on ",t("span",{className:"date-text",children:new Date(m==null?void 0:m.timestamp).toDateString()})]}),c("div",{className:"usage-heat-map",children:[i.map((w,S)=>{const E=w.count,b=E<=0?"":E<=1?"stat-day-L1-bg":E<=2?"stat-day-L2-bg":E<=4?"stat-day-L3-bg":"stat-day-L4-bg";return t("span",{className:`stat-container ${b} ${N===w?"current":""} ${n===w.timestamp?"today":""}`,onMouseEnter:T=>h(T,w),onMouseLeave:f,onClick:()=>x(w)},S)}),a.map((w,S)=>t("span",{className:"stat-container null"},S))]})]})};const Wt=()=>{const{locationState:n}=u.exports.useContext(P);u.exports.useEffect(()=>{const a=document.querySelector(ae);a==null||a.classList.remove(se)},[n]);const e=u.exports.useCallback(a=>{if(a.stopPropagation(),a.target.className==="sidebar-wrapper"){const r=document.querySelector(ae);r==null||r.classList.remove(se)}},[]);return c("aside",{className:"sidebar-wrapper",onClick:e,children:[t(_t,{}),t(jt,{}),t(qt,{}),t(Ht,{})]})};function Yt(){const{locationState:{pathname:n}}=u.exports.useContext(P),e=ee();return u.exports.useEffect(()=>{const{user:a}=U.getState();a?e.setFinish():U.doSignIn().catch(()=>{}).finally(()=>{U.getState().user?e.setFinish():A.replaceHistory("/signin")})},[]),t(L,{children:e.isLoading?null:c("section",{id:"page-container",children:[t(Wt,{}),t("main",{className:"content-wrapper",children:En(n)})]})})}const Vt=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function ie(n,e){return e.minLength!==void 0&&n.length<e.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:e.maxLength!==void 0&&n.length>e.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:e.noSpace&&n.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:e.noChinese&&Vt.test(n)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const ke={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},Kt=()=>{const[n,e]=u.exports.useState(""),[a,s]=u.exports.useState(""),r=u.exports.useRef(null),o=ee(!1);u.exports.useEffect(()=>{const N=g=>{var l;g.key==="Enter"&&((l=r.current)==null||l.click())};return document.body.addEventListener("keypress",N),()=>{document.body.removeEventListener("keypress",N)}},[]);const i=N=>{const g=N.target.value;e(g)},p=N=>{const g=N.target.value;s(g)},m=()=>{ve()},y=async()=>{if(o.isLoading)return;const N=ie(n,ke);if(!N.result){k.error("\u7528\u6237\u540D "+N.reason);return}const g=ie(a,ke);if(!g.result){k.error("\u5BC6\u7801 "+g.reason);return}try{o.setLoading();const l=_.signin,{succeed:d,message:h}=await l(n,a);if(!d&&h){k.error("\u{1F61F} "+h);return}await U.doSignIn()?A.replaceHistory("/"):k.error("\u{1F61F} \u767B\u5F55\u5931\u8D25")}catch(l){console.error(l),k.error("\u{1F61F} "+l.message)}o.setFinish()};return t("div",{className:"page-wrapper signin",children:c("div",{className:"page-container",children:[t("div",{className:"page-header-container",children:c("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F44B}"})," \u8D26\u53F7\u6CE8\u518C / \u767B\u5F55"]})}),c("div",{className:"page-content-container",children:[c("div",{className:"form-item-container input-form-container",children:[t("span",{className:"normal-text "+(n===""?"":"not-null"),children:"\u8D26\u53F7"}),t("input",{type:"text",value:n,onChange:i})]}),c("div",{className:"form-item-container input-form-container",children:[t("span",{className:"normal-text "+(a===""?"":"not-null"),children:"\u5BC6\u7801"}),t("input",{type:"password",value:a,onChange:p})]})]}),c("div",{className:"page-footer-container",children:[t("div",{className:"btns-container",children:window.location.origin.includes("justsven.top")?t("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"Sign In with GitHub"}):null}),c("div",{className:"btns-container",children:[t("button",{className:"text-btn signup-btn disabled",onClick:()=>k.info("\u6CE8\u518C\u5DF2\u5173\u95ED"),children:"\u6CE8\u518C"}),t("span",{className:"split-text",children:"/"}),t("button",{className:`text-btn signin-btn ${o.isLoading?"requesting":""}`,ref:r,onClick:y,children:"\u767B\u5F55"})]})]}),c("p",{className:"tip-text",children:["\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\uFF0C\u53EF\u8F93\u5165 ",t("code",{children:"guest, 123456"})," \u8FDB\u884C\u4F53\u9A8C\u3002",t("br",{}),c("span",{className:"text-btn",onClick:m,children:[t("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E\u672C\u7AD9"]})]})]})})},zt={"/signin":t(Kt,{}),"*":t(Yt,{})};function Jt(){const[n,e]=u.exports.useState(!1);return u.exports.useCallback(()=>{e(s=>!s)},[])}const Xt=u.exports.forwardRef((n,e)=>{var w,S;const{className:a,initialContent:s,placeholder:r,showConfirmBtn:o,showCancelBtn:i,showTools:p,onConfirmBtnClick:m,onCancelBtnClick:y,onContentChange:N}=n,g=u.exports.useRef(null),l=Jt();u.exports.useEffect(()=>{s&&(g.current.value=s,l())},[]),u.exports.useEffect(()=>{var E;g.current&&(g.current.style.height="auto",g.current.style.height=((E=g.current.scrollHeight)!=null?E:0)+"px")},[(w=g.current)==null?void 0:w.value]),u.exports.useImperativeHandle(e,()=>({focus:()=>{g.current.focus()},insertText:E=>{const b=g.current.value;g.current.value=b+E,N(g.current.value),l()},setContent:E=>{g.current.value=E,l()},getContent:()=>{var E,b;return(b=(E=g.current)==null?void 0:E.value)!=null?b:""}}),[]);const d=u.exports.useCallback(()=>{N(g.current.value),l()},[]),h=u.exports.useCallback(E=>{E.stopPropagation(),E.code==="Enter"&&(E.metaKey||E.ctrlKey)&&f(),l()},[]),f=u.exports.useCallback(()=>{m(g.current.value),g.current.value="",l()},[]),x=u.exports.useCallback(()=>{y()},[]);return c("div",{className:"common-editor-wrapper "+a,children:[t("textarea",{className:"common-editor-inputer",rows:1,placeholder:r,ref:g,onInput:d,onKeyDown:h}),c("div",{className:"common-tools-wrapper",children:[t(j,{when:p,children:t("div",{className:"common-tools-container"})}),c("div",{className:"btns-right-container",children:[t(j,{when:i,children:t("button",{className:"action-btn cancel-btn",onClick:x,children:"\u64A4\u9500\u4FEE\u6539"})}),t(j,{when:o,children:c("button",{className:"action-btn confirm-btn",disabled:!((S=g.current)==null?void 0:S.value),onClick:f,children:["\u8BB0\u4E0B",t("span",{className:"icon-text",children:"\u270D\uFE0F"})]})})]})]})]})});const Zt=()=>{const{globalState:n}=u.exports.useContext(P),e=u.exports.useRef(null),a=u.exports.useRef(n);u.exports.useEffect(()=>{var m,y,N,g,l;if(n.markMemoId){const h=`${((m=e.current)==null?void 0:m.getContent())?`
`:""}Mark: [@MEMO](${n.markMemoId})`;(y=e.current)==null||y.insertText(h),q.setMarkMemoId("")}if(n.editMemoId&&n.editMemoId!==a.current.editMemoId){const d=O.getMemoById(n.editMemoId);d&&((g=e.current)==null||g.setContent((N=d.content)!=null?N:""),(l=e.current)==null||l.focus())}a.current=n},[n.markMemoId,n.editMemoId]);const s=u.exports.useCallback(async m=>{if(m===""){k.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}const{editMemoId:y}=q.getState();m=m.replaceAll("&nbsp;"," ");try{if(y){const N=O.getMemoById(y);if(N&&N.content!==m){const g=await O.updateMemo(N.id,m);g.updatedAt=v.getDateTimeString(Date.now()),O.editMemo(g)}q.setEditMemoId("")}else{const N=await O.createMemo(m);O.pushMemo(N)}A.clearQuery()}catch(N){k.error(N.message)}Ee("")},[]),r=u.exports.useCallback(()=>{var m;q.setEditMemoId(""),(m=e.current)==null||m.setContent(""),Ee("")},[]),o=u.exports.useCallback(m=>{const y=document.createElement("div");y.innerHTML=m,y.innerText.trim()===""&&(m=""),Ee(m)},[]),{editMemoId:i}=n,p=u.exports.useMemo(()=>({className:"memo-editor",initialContent:en(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,showCancelBtn:i!=="",showTools:!0,onConfirmBtnClick:s,onCancelBtnClick:r,onContentChange:o}),[i]);return c("div",{className:"memo-editor-wrapper "+(i?"edit-ing":""),children:[t("p",{className:"tip-text "+(i?"":"hidden"),children:"\u6B63\u5728\u4FEE\u6539\u4E2D..."}),t(Xt,C({ref:e},p))]})};function en(){var n;return(n=J.get(["editorContentCache"]).editorContentCache)!=null?n:""}function Ee(n){J.set({editorContentCache:n})}const tn=()=>{const{locationState:{query:{type:n}}}=u.exports.useContext(P),e=s=>{const{type:r}=A.getState().query;s===r&&(s=""),A.setMemoTypeQuery(s)};return c("div",{className:"search-bar-container",children:[c("div",{className:"search-bar-inputer",children:[t("img",{className:"icon-img",src:"/icons/search.svg"}),t("input",{className:"text-input",type:"text",placeholder:"",onChange:s=>{const r=s.currentTarget.value;A.setTextQuery(r)}})]}),t("div",{className:"quickly-action-wrapper",children:c("div",{className:"quickly-action-container",children:[t("p",{className:"title-text",children:"QUICKLY FILTER"}),c("div",{className:"section-container types-container",children:[t("span",{className:"section-text",children:"\u7C7B\u578B:"}),t("div",{className:"values-container",children:ye.map((s,r)=>c("div",{children:[t("span",{className:`type-item ${n===s.value?"selected":""}`,onClick:()=>{e(s.value)},children:s.text}),r+1<ye.length?t("span",{className:"split-text",children:"/"}):null]},s.value))})]})]})})]})};const nn=()=>{const{locationState:{query:{filter:n}},queryState:{queries:e}}=u.exports.useContext(P),[a,s]=u.exports.useState("MEMOS");u.exports.useEffect(()=>{const i=G.getQueryById(n);s(i?i.title:"MEMOS")},[n,e]);const r=u.exports.useCallback(()=>{A.clearQuery()},[]),o=u.exports.useCallback(i=>{i.stopPropagation();const p=document.querySelector(ae);p&&p.classList.add(se)},[]);return c("div",{className:"section-header-container memos-header-container",children:[c("div",{className:"title-text",onClick:r,children:[t("button",{className:"action-btn",onClick:o,children:t("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})}),t("span",{className:"normal-text",children:a})]}),t(tn,{})]})};const Ae=()=>{const{locationState:{query:n}}=u.exports.useContext(P),{tag:e,duration:a,type:s,text:r,filter:o}=n,i=G.getQueryById(o),p=Boolean(e||a&&a.from<a.to||s||r||i);return c("div",{className:`filter-query-container ${p?"":"hidden"}`,children:[t("span",{className:"tip-text",children:"\u7B5B\u9009\uFF1A"}),c("div",{className:"filter-item-container "+(i?"":"hidden"),onClick:()=>{A.setMemoFilter("")},children:[t("span",{className:"icon-text",children:"\u{1F516}"})," ",i==null?void 0:i.title]}),c("div",{className:"filter-item-container "+(e?"":"hidden"),onClick:()=>{A.setTagQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"})," ",e]}),c("div",{className:"filter-item-container "+(s?"":"hidden"),onClick:()=>{A.setMemoTypeQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F4E6}"})," ",Ut(s)]}),a&&a.from<a.to?c("div",{className:"filter-item-container",onClick:()=>{A.setFromAndToQuery(0,0)},children:[t("span",{className:"icon-text",children:"\u{1F5D3}\uFE0F"})," ",v.getDateString(a.from)," \u81F3 ",v.getDateString(a.to)]}):null,c("div",{className:"filter-item-container "+(r?"":"hidden"),onClick:()=>{A.setTextQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F50D}"})," ",r]})]})};const an=()=>{const{locationState:{query:n},memoState:{memos:e}}=u.exports.useContext(P),[a,s]=u.exports.useState(!0),[r,o]=u.exports.useState(!1),i=u.exports.useRef(null),{tag:p,duration:m,type:y,text:N,filter:g}=n,l=Boolean(p||m&&m.from<m.to||y||N),d=l||g?e.filter(f=>{let x=!0;const w=G.getQueryById(g);if(w){const S=JSON.parse(w.querystring);Array.isArray(S)&&(x=we(f,S))}return p&&!f.content.includes(`# ${p}`)&&(x=!1),m&&m.from<m.to&&(v.getTimeStampByDate(f.createdAt)<m.from||v.getTimeStampByDate(f.createdAt)>m.to)&&(x=!1),y&&(y==="NOT_TAGGED"&&f.content.match(X)!==null||y==="LINKED"&&f.content.match(ce)===null||y==="IMAGED"&&f.content.match(Y)===null||y==="CONNECTED"&&f.content.match(re)===null)&&(x=!1),N&&!f.content.includes(N)&&(x=!1),x}):e;u.exports.useEffect(()=>{var f;(f=i.current)==null||f.scrollTo({top:0}),O.fetchAllMemos().then(x=>{x!==!1&&(o(!0),s(!1))})},[]);const h=u.exports.useCallback(f=>{const x=f.target;if(x.tagName==="SPAN"&&x.className==="tag-span"){const w=x.innerText.slice(1);A.getState().query.tag===w?A.setTagQuery(""):A.setTagQuery(w)}},[]);return c("div",{className:`memolist-wrapper ${r?"completed":""}`,onClick:h,ref:i,children:[d.map(f=>t(Tt,{memo:f},`${f.id}-${f.updatedAt}`)),l?t("div",{className:"status-text-container",children:t("p",{className:"status-text",children:a?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":r&&d.length===0?"\u7A7A\u7A7A\u5982\u4E5F":""})}):t("div",{className:`status-text-container ${r?"completed":""} ${a||r?"":"invisible"}`,children:t("p",{className:"status-text",children:r?"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}":"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})})]})};function sn(){return c(L,{children:[t(nn,{}),t(Zt,{}),t(Ae,{}),t(an,{})]})}const rn=n=>{var N,g;const{memo:e,handleDeletedMemoAction:a}=n,s=D(C({},e),{createdAtStr:v.getDateTimeString(e.createdAt),deletedAtStr:v.getDateTimeString((N=e.deletedAt)!=null?N:Date.now())}),[r,o]=Z(!1),i=Array.from((g=s.content.match(Y))!=null?g:[]),p=async()=>{if(r)try{await O.deleteMemoById(s.id),a(s.id)}catch(l){k.error(l.message)}else o()},m=async()=>{try{await O.restoreMemoById(s.id),a(s.id),k.info("\u6062\u590D\u6210\u529F")}catch(l){k.error(l.message)}},y=()=>{r&&o(!1)};return c("div",{className:`memo-wrapper ${"memos-"+s.id}`,onMouseLeave:y,children:[c("div",{className:"memo-top-wrapper",children:[c("span",{className:"time-text",children:["\u5220\u9664\u4E8E ",s.deletedAtStr]}),c("div",{className:"btns-container",children:[t("span",{className:"text-btn more-action-btn",children:t("img",{className:"icon-img",src:"/icons/more.svg"})}),t("div",{className:"more-action-btns-wrapper",children:c("div",{className:"more-action-btns-container",children:[t("span",{className:"text-btn restore-btn",onClick:m,children:"\u6062\u590D"}),t("span",{className:`text-btn delete-btn ${r?"final-confirm":""}`,onClick:p,children:r?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5B8C\u5168\u5220\u9664"})]})})]})]}),t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:K(s.content)}}),t(j,{when:i.length>0,children:t("div",{className:"images-wrapper",children:i.map((l,d)=>t(ge,{className:"memo-img",imgUrl:l},d))})})]})};const on=()=>{const{locationState:{query:n}}=u.exports.useContext(P),e=ee(),[a,s]=u.exports.useState([]),{tag:r,duration:o,type:i,text:p,filter:m}=n,y=G.getQueryById(m),g=Boolean(r||o&&o.from<o.to||i||p||y)||y?a.filter(h=>{let f=!0;if(y){const x=JSON.parse(y.querystring);Array.isArray(x)&&(f=we(h,x))}return r&&!h.content.includes(`# ${r}`)&&(f=!1),o&&o.from<o.to&&(v.getTimeStampByDate(h.createdAt)<o.from||v.getTimeStampByDate(h.createdAt)>o.to)&&(f=!1),i&&(i==="NOT_TAGGED"&&h.content.match(X)!==null||i==="LINKED"&&h.content.match(ce)===null||i==="IMAGED"&&h.content.match(Y)===null||i==="CONNECTED"&&h.content.match(re)===null)&&(f=!1),p&&!h.content.includes(p)&&(f=!1),f}):a;u.exports.useEffect(()=>{O.fetchAllMemos(),O.fetchDeletedMemos().then(h=>{h!==!1&&s(h),e.setFinish()}),A.clearQuery()},[]);const l=u.exports.useCallback(h=>{s(a.filter(f=>f.id!==h))},[a]),d=u.exports.useCallback(h=>{h.stopPropagation();const f=document.querySelector(ae);f&&f.classList.add(se)},[]);return c("div",{className:"memo-trash-wrapper",children:[t("div",{className:"section-header-container",children:c("div",{className:"title-text",children:[t("button",{className:"action-btn",onClick:d,children:t("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})}),t("span",{className:"normal-text",children:"\u56DE\u6536\u7AD9"})]})}),t(Ae,{}),e.isLoading?t("div",{className:"tip-text-container",children:t("p",{className:"tip-text",children:"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})}):a.length===0?t("div",{className:"tip-text-container",children:t("p",{className:"tip-text",children:"Here is No Zettels."})}):t("div",{className:"deleted-memos-container",children:g.map(h=>t(rn,{memo:h,handleDeletedMemoAction:l},`${h.id}-${h.updatedAt}`))})]})};const cn={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},ln=({destroy:n})=>{const[e,a]=u.exports.useState(""),[s,r]=u.exports.useState(""),[o,i]=u.exports.useState("");u.exports.useEffect(()=>{},[]);const p=()=>{n()},m=l=>{const d=l.target.value;a(d)},y=l=>{const d=l.target.value;r(d)},N=l=>{const d=l.target.value;i(d)},g=async()=>{if(e===""||s===""||o===""){k.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==o){k.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),i("");return}const l=ie(s,cn);if(!l.result){k.error("\u5BC6\u7801 "+l.reason);return}try{if(!await U.checkPasswordValid(e)){k.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),a("");return}await U.updatePassword(s),k.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),p()}catch(d){k.error(d)}};return c(L,{children:[c("div",{className:"dialog-header-container",children:[t("p",{className:"title-text",children:"\u4FEE\u6539\u5BC6\u7801"}),t("button",{className:"text-btn close-btn",onClick:p,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),c("div",{className:"dialog-content-container",children:[c("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text "+(e===""?"":"not-null"),children:"\u65E7\u5BC6\u7801"}),t("input",{type:"password",value:e,onChange:m})]}),c("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text "+(s===""?"":"not-null"),children:"\u65B0\u5BC6\u7801"}),t("input",{type:"password",value:s,onChange:y})]}),c("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text "+(o===""?"":"not-null"),children:"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801"}),t("input",{type:"password",value:o,onChange:N})]}),c("div",{className:"btns-container",children:[t("span",{className:"text-btn cancel-btn",onClick:p,children:"\u53D6\u6D88"}),t("span",{className:"text-btn confirm-btn",onClick:g,children:"\u4FDD\u5B58"})]})]})]})};function un(){V({className:"change-password-dialog"},ln)}const dn=({destroy:n})=>{const[e,a]=u.exports.useState("");u.exports.useEffect(()=>{},[]);const s=()=>{n()},r=i=>{const p=i.target.value;a(p)},o=async()=>{if(e===""){k.error("\u5FAE\u4FE1 id \u4E0D\u80FD\u4E3A\u7A7A");return}try{await U.updateWxUserId(e),U.doSignIn(),k.info("\u7ED1\u5B9A\u6210\u529F\uFF01"),s()}catch(i){k.error(i)}};return c(L,{children:[c("div",{className:"dialog-header-container",children:[t("p",{className:"title-text",children:"\u7ED1\u5B9A\u5FAE\u4FE1 OpenID"}),t("button",{className:"text-btn close-btn",onClick:s,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),c("div",{className:"dialog-content-container",children:[c("p",{className:"tip-text",children:["\u5173\u6CE8\u5FAE\u4FE1\u516C\u4F17\u53F7\u201C\u5C0F\u8C08\u95F2\u4E8B\u201D\uFF0C\u4E3B\u52A8\u53D1\u9001\u4EFB\u610F\u6D88\u606F\uFF0C\u5373\u53EF\u83B7\u53D6 ",t("strong",{children:"OpenID"})," \u3002"]}),c("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text "+(e===""?"":"not-null"),children:"\u5FAE\u4FE1 OpenID"}),t("input",{type:"text",value:e,onChange:r})]}),c("div",{className:"btns-container",children:[t("span",{className:"text-btn cancel-btn",onClick:s,children:"\u53D6\u6D88"}),t("span",{className:"text-btn confirm-btn",onClick:o,children:"\u4FDD\u5B58"})]})]})]})};function mn(){V({className:"bind-wxid-dialog"},dn)}const pn={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},hn=()=>{const{userState:n}=u.exports.useContext(P),e=n.user,[a,s]=u.exports.useState(e.username),[r,o]=u.exports.useState(!1),[i,p]=u.exports.useState(!1),[m,y]=u.exports.useState(!1),N=x=>{const w=x.target.value;s(w)},g=async()=>{if(e.username==="guest"){k.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(a===e.username){o(!1);return}const x=ie(a,pn);if(!x.result){k.error("\u7528\u6237\u540D "+x.reason);return}try{if(!await U.checkUsernameUsable(a)){k.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await U.updateUsername(a),await U.doSignIn(),o(!1),k.info("\u4FEE\u6539\u6210\u529F~")}catch(w){k.error(w.message)}},l=()=>{if(e.username==="guest"){k.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}un()},d=async()=>{if(i){try{await U.removeGithubName(),await U.doSignIn()}catch(x){k.error(x.message)}p(!1)}else p(!0)},h=async()=>{if(m){try{await U.updateWxUserId(""),await U.doSignIn()}catch(x){k.error(x.message)}y(!1)}else y(!0)},f=x=>{x.preventDefault()};return c(L,{children:[c("div",{className:"section-container account-section-container",children:[t("p",{className:"title-text",children:"\u57FA\u672C\u4FE1\u606F"}),c("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"ID\uFF1A"}),t("span",{className:"normal-text",children:e.id})]}),c("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"\u521B\u5EFA\u65F6\u95F4\uFF1A"}),t("span",{className:"normal-text",children:v.getDateString(e.createdAt)})]}),c("label",{className:"form-label input-form-label username-label",children:[t("span",{className:"normal-text",children:"\u8D26\u53F7\uFF1A"}),t("input",{type:"text",readOnly:!r,value:a,onClick:()=>{o(!0)},onChange:N}),c("div",{className:"btns-container",onClick:f,children:[t("span",{className:"text-btn confirm-btn "+(r?"":"hidden"),onClick:g,children:"\u4FDD\u5B58"}),t("span",{className:"text-btn cancel-btn "+(r?"":"hidden"),onClick:()=>{s(e.username),o(!1)},children:"\u64A4\u9500"})]})]}),c("label",{className:"form-label password-label",children:[t("span",{className:"normal-text",children:"\u5BC6\u7801\uFF1A"}),t("span",{className:"text-btn",onClick:l,children:"\u4FEE\u6539\u5BC6\u7801"})]})]}),c("div",{className:"section-container connect-section-container",children:[t("p",{className:"title-text",children:"\u5173\u8054\u8D26\u53F7"}),c("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"\u5FAE\u4FE1 OpenID\uFF1A"}),e.wxUserId?c(L,{children:[t("span",{className:"value-text",children:"************"}),t("span",{className:`btn-text unbind-btn ${m?"final-confirm":""}`,onMouseLeave:()=>y(!1),onClick:h,children:m?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A"})]}):c(L,{children:[t("span",{className:"value-text",children:"\u65E0"}),t("span",{className:"btn-text bind-btn",onClick:()=>{mn()},children:"\u7ED1\u5B9A ID"})]})]}),c("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"GitHub\uFF1A"}),e.githubName?c(L,{children:[t("a",{className:"value-text",href:"https://github.com/"+e.githubName,children:e.githubName}),t("span",{className:`btn-text unbind-btn ${i?"final-confirm":""}`,onMouseLeave:()=>p(!1),onClick:d,children:i?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A"})]}):c(L,{children:[t("span",{className:"value-text",children:"\u65E0"}),t("a",{className:"btn-text link-btn",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"\u524D\u5F80\u7ED1\u5B9A"})]})]})]})]})};const gn=()=>{const{globalState:n}=u.exports.useContext(P),{shouldHideImageUrl:e,shouldSplitMemoWord:a,shouldUseMarkdownParser:s}=n,r=`\u{1F44B} \u4F60\u597D\u5440\uFF5E
\u6211\u662F\u4E00\u4E2Ademo\uFF1A
* \u{1F44F} \u6B22\u8FCE\u4F7F\u7528memos\uFF1B`,o=()=>{q.setAppSetting({shouldSplitMemoWord:!a})},i=()=>{q.setAppSetting({shouldHideImageUrl:!e})},p=()=>{q.setAppSetting({shouldUseMarkdownParser:!s})},m=async()=>{const N=O.getState().memos.map(d=>C({},d)),g=JSON.stringify(N),l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(g)),l.setAttribute("download","data.json"),l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l)},y=async()=>{const N=O.getState().memos;for(const g of N)O.updateMemo(g.id,he(g.content))};return c(L,{children:[c("div",{className:"section-container preferences-section-container",children:[t("p",{className:"title-text",children:"Memo \u663E\u793A\u76F8\u5173"}),t("div",{className:"demo-content-container memo-content-text",dangerouslySetInnerHTML:{__html:K(r)}}),c("label",{className:"form-label checkbox-form-label",onClick:o,children:[t("span",{className:"normal-text",children:"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"}),t("img",{className:"icon-img",src:a?"/icons/checkbox-active.svg":"/icons/checkbox.svg"})]}),c("label",{className:"form-label checkbox-form-label",onClick:p,children:[t("span",{className:"normal-text",children:"\u90E8\u5206 markdown \u683C\u5F0F\u89E3\u6790"}),t("img",{className:"icon-img",src:s?"/icons/checkbox-active.svg":"/icons/checkbox.svg"})]}),c("label",{className:"form-label checkbox-form-label",onClick:i,children:[t("span",{className:"normal-text",children:"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"}),t("img",{className:"icon-img",src:e?"/icons/checkbox-active.svg":"/icons/checkbox.svg"})]})]}),c("div",{className:"section-container hidden",children:[t("p",{className:"title-text",children:"\u5176\u4ED6"}),c("div",{className:"btn-container",children:[t("button",{className:"btn export-btn",onClick:m,children:"\u5BFC\u51FA\u6570\u636E(JSON)"}),t("button",{className:"btn format-btn",onClick:y,children:"\u683C\u5F0F\u5316\u6570\u636E"})]})]})]})};const fn=()=>{u.exports.useContext(P),u.exports.useEffect(()=>{O.fetchAllMemos()},[]);const n=u.exports.useCallback(e=>{e.stopPropagation();const a=document.querySelector(ae);a&&a.classList.add(se)},[]);return c("div",{className:"preference-wrapper",children:[t("div",{className:"section-header-container",children:c("div",{className:"title-text",children:[t("button",{className:"action-btn",onClick:n,children:t("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})}),t("span",{className:"normal-text",children:"\u8D26\u53F7\u4E0E\u8BBE\u7F6E"})]})}),c("div",{className:"sections-wrapper",children:[t(hn,{}),t(gn,{})]})]})},yn={"/recycle":t(on,{}),"/setting":t(fn,{}),"*":t(sn,{})},Be=n=>e=>{for(const a of Object.keys(n))if(a===e)return n[a];return n["*"]},Nn=Be(zt),En=Be(yn);function Sn(){const{locationState:{pathname:n}}=u.exports.useContext(P);return u.exports.useEffect(()=>{const e=()=>{q.setIsMobileView(document.body.clientWidth<=875)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),t(L,{children:Nn(n)})}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(n,e){return Object.prototype.toString.call(n).toLowerCase()==="[object regexp]"?this.replace(n,e):this.replace(new RegExp(n,"g"),e)})})();ne.render(t($e.StrictMode,{children:t(Ce,{store:M,context:P,children:t(Sn,{})})}),document.getElementById("root"));
