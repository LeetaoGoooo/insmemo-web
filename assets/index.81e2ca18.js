var Te=Object.defineProperty,we=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var te=(a,t,n)=>t in a?Te(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,T=(a,t)=>{for(var n in t||(t={}))Fe.call(t,n)&&te(a,n,t[n]);if(ue)for(var n of ue(t))ke.call(t,n)&&te(a,n,t[n]);return a},k=(a,t)=>we(a,ve(t));var P=(a,t,n)=>(te(a,typeof t!="symbol"?t+"":t,n),n);import{r as i,R as e,a as V}from"./vendor.4f50e650.js";const Ae=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerpolicy&&(c.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?c.credentials="include":r.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(r){if(r.ep)return;r.ep=!0;const c=n(r);fetch(r.href,c)}};Ae();const de=a=>{const{children:t,store:n,context:s}=a,[r,c]=i.exports.useState(n.getState());return i.exports.useEffect(()=>{const l=n.subscribe(o=>{c(o)});return()=>{l()}},[]),e.createElement(s.Provider,{value:r},t)};function Be(a){const t=Object.keys(a),n={};for(const s of t)typeof a[s]=="function"&&(n[s]=a[s]);return(s={},r)=>{let c=!1;const l={};for(const o of t){const g=s[o],N=n[o](g,r);l[o]=N,c=c||N!==g}return c?l:s}}function Ie(a,t){const n=[];let s=a;return{dispatch:o=>{const g=t(s,o),N=s;s=g;for(const h of n)h(s,N)},getState:()=>s,subscribe:o=>{let g=!0;return n.push(o),()=>{if(!g)return;const N=n.indexOf(o);n.splice(N,1),g=!1}}}}function Le(a,t){switch(t.type){case"SET_MARK_MEMO_ID":return k(T({},a),{markMemoId:t.payload.markMemoId});case"SET_EDIT_MEMO_ID":return k(T({},a),{editMemoId:t.payload.editMemoId});case"SET_APP_SETTING":return T(T({},a),t.payload);default:return a}}const _e={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,showDarkMode:!1};function Ue(a,t){switch(t.type){case"SET_TAG_QUERY":return k(T({},a),{query:k(T({},a.query),{tag:t.payload.tag})});case"SET_FROM_TO_QUERY":return k(T({},a),{query:k(T({},a.query),{from:t.payload.from,to:t.payload.to})});case"SET_TYPE":return k(T({},a),{query:k(T({},a.query),{type:t.payload.type})});case"SET_TEXT":return k(T({},a),{query:k(T({},a.query),{text:t.payload.text})});case"SET_HASH":return k(T({},a),{hash:t.payload.hash});default:return a}}const Oe={hash:"",query:{tag:"",from:0,to:0,type:"",text:""}};var D;(function(a){function t(){return Date.now()}a.getNowTimeStamp=t;function n(){const p=navigator.appVersion;let u="Unknown";return p.indexOf("Win")!=-1?u="Windows":p.indexOf("Mac")!=-1?u="MacOS":p.indexOf("Linux")!=-1&&(u="Linux"),u}a.getOSVersion=n;function s(p){return typeof p=="string"&&(p=p.replaceAll("-","/")),new Date(p).getTime()}a.getTimeStampByDate=s;function r(p){const u=new Date(s(p));return new Date(u.getFullYear(),u.getMonth(),u.getDate()).getTime()}a.getDateStampByDate=r;function c(p){const u=new Date(s(p)),E=u.getFullYear(),x=u.getMonth()+1,b=u.getDate();return`${E}/${x}/${b}`}a.getDateString=c;function l(p){const u=new Date(s(p)),E=u.getHours(),x=u.getMinutes(),b=E<10?"0"+E:E,S=x<10?"0"+x:x;return`${b}:${S}`}a.getTimeString=l;function o(p){const u=new Date(s(p)),E=u.getFullYear(),x=u.getMonth()+1,b=u.getDate(),S=u.getHours(),A=u.getMinutes(),_=u.getSeconds(),j=x<10?"0"+x:x,q=b<10?"0"+b:b,B=S<10?"0"+S:S,O=A<10?"0"+A:A,Q=_<10?"0"+_:_;return`${E}/${j}/${q} ${B}:${O}:${Q}`}a.getDateTimeString=o;function g(p){return Array.from(new Set(p))}a.dedupe=g;function N(p){const u=new Set,E=[];for(const x of p)u.has(x.id)||(u.add(x.id),E.push(x));return E}a.dedupeObjectWithId=N;function h(p,u){let E=null;return()=>{E&&clearTimeout(E),E=setTimeout(p,u)}}a.debounce=h;function d(p,u){let E=!0;return()=>{if(!E)return!1;E=!1,setTimeout(()=>{p(),E=!0},u)}}a.throttle=d;function m(p){const u=[],E=Object.keys(p),x=Object.values(p);for(let b=0;b<E.length;++b)x[b]&&u.push(`${E[b]}=${x[b]}`);return u.join("&")}a.iterObjectToParamsString=m;async function y(p){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(p)}catch(u){console.warn("Copy to clipboard failed.",u)}else console.warn("Copy to clipboard failed, methods not supports.")}a.copyTextToClipboard=y;function f(p){return new Promise((u,E)=>{const x=new Image;x.onload=()=>{const{width:b,height:S}=x;b>0&&S>0?u({width:b,height:S}):u({width:0,height:0})},x.onerror=()=>{u({width:0,height:0})},x.className="hidden",x.src=p,document.body.appendChild(x),x.remove()})}a.getImageSize=f})(D||(D={}));function Pe(a,t){switch(t.type){case"SET_MEMOS":return{memos:[...t.payload.memos]};case"PUSH_MEMO":return{memos:[t.payload.memo,...a.memos].sort((s,r)=>D.getTimeStampByDate(r.createdAt)-D.getTimeStampByDate(s.createdAt))};case"PUSH_MEMOS":return{memos:[...t.payload.memos,...a.memos].sort((s,r)=>D.getTimeStampByDate(r.createdAt)-D.getTimeStampByDate(s.createdAt))};case"DELETE_MEMO_BY_ID":return{memos:[...a.memos].filter(n=>n.id!==t.payload.id)};case"EDIT_MEMO":return{memos:a.memos.map(s=>s.id===t.payload.id?T(T({},s),t.payload):s)};default:return a}}const Re={memos:[]};function $e(a,t){switch(t.type){case"SIGN_IN":return{user:t.payload.user};case"SIGN_OUT":return{user:null};default:return a}}const He={user:null},w=Ie({globalState:_e,locationState:Oe,memoState:Re,userState:He},Be({globalState:Le,locationState:Ue,memoState:Pe,userState:$e})),$=i.exports.createContext(w.getState());var K;(function(a){function t(r){const c={};for(const l of r)try{const o=localStorage.getItem(l);if(o!==null){const g=JSON.parse(o);c[l]=g}}catch(o){console.error("Get storage failed in ",l,o)}return c}a.get=t;function n(r){for(const c in r)try{const l=JSON.stringify(r[c]);localStorage.setItem(c,l)}catch(l){console.error("Save storage failed in ",c,l)}}a.set=n;function s(){var c;const r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r),(c=r.contentWindow)==null||c.localStorage.setItem("t",Date.now().toString()),r.remove()}a.emitStorageChangedEvent=s})(K||(K={}));class Qe{constructor(){P(this,"getState",()=>w.getState().globalState);P(this,"setEditMemoId",t=>{w.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:t}})});P(this,"setMarkMemoId",t=>{w.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:t}})});P(this,"setAppSetting",t=>{w.dispatch({type:"SET_APP_SETTING",payload:t}),K.set(t)});var s,r,c,l;const t=K.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser","showDarkMode"]),n={shouldSplitMemoWord:(s=t.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(r=t.shouldHideImageUrl)!=null?r:!0,shouldUseMarkdownParser:(c=t.shouldUseMarkdownParser)!=null?c:!0,showDarkMode:(l=t.showDarkMode)!=null?l:!1};this.setAppSetting(n)}}const R=new Qe,W=()=>{let a=D.iterObjectToParamsString(w.getState().locationState.query);a?a="?"+a:a="",history.replaceState(null,"","/"+a)};class Ge{constructor(){P(this,"initLocation",()=>{var n,s,r,c,l;const t=new URLSearchParams(window.location.search);this.setTagQuery((n=t.get("tag"))!=null?n:""),this.setFromAndToQuery(parseInt((s=t.get("from"))!=null?s:"0"),parseInt((r=t.get("to"))!=null?r:"0")),this.setMemoTypeQuery((c=t.get("type"))!=null?c:""),this.setTextQuery((l=t.get("text"))!=null?l:"")});P(this,"getState",()=>w.getState().locationState);P(this,"clearQuery",()=>{w.dispatch({type:"SET_TAG_QUERY",payload:{tag:""}}),w.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:0,to:0}}),W()});P(this,"setHash",t=>{w.dispatch({type:"SET_HASH",payload:{hash:t}}),W()});P(this,"setMemoTypeQuery",(t="")=>{w.dispatch({type:"SET_TYPE",payload:{type:t}}),W()});P(this,"setTextQuery",t=>{w.dispatch({type:"SET_TEXT",payload:{text:t}}),W()});P(this,"setTagQuery",t=>{w.dispatch({type:"SET_TAG_QUERY",payload:{tag:t}}),W()});P(this,"setFromAndToQuery",(t,n)=>{w.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:t,to:n}}),W()});this.initLocation()}}const U=new Ge;var F;(function(a){async function t(C){const J=await(await fetch(C,{method:"GET"})).json();if(!J.succeed)throw J;return J}a.get=t;async function n(C,I){const ee=await(await fetch(C,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)})).json();if(!ee.succeed)throw ee;return ee}a.post=n;function s(){return t("/api/user/me")}a.getUserInfo=s;function r(C,I){return n("/api/user/signin",{username:C,password:I})}a.signin=r;function c(C,I){return n("/api/user/signup",{username:C,password:I})}a.signup=c;function l(){return n("/api/user/signout")}a.signout=l;function o(C){return t("/api/user/checkusername?username="+C)}a.checkUsernameUsable=o;function g(C){return n("/api/user/checkpassword",{password:C})}a.checkPasswordValid=g;function N(C="",I=""){return n("/api/user/update",{username:C,password:I})}a.updateUserinfo=N;function h(C=0,I=20){return t(`/api/memo/all?offset=${C}&amount=${I}`)}a.getMyMemos=h;function d(C){return n("/api/memo/new",{content:C})}a.createMemo=d;function m(C){return t("/api/memo/?id="+C)}a.getMemoById=m;function y(C){return n("/api/memo/delete",{memoId:C})}a.deleteMemo=y;function f(C,I){return n("/api/memo/update",{memoId:C,content:I})}a.updateMemo=f;function p(){return t("/api/memo/count")}a.getMemosCount=p;function u(C){return n("/api/tag/new",{text:C})}a.createTag=u;function E(C,I){return n("/api/tag/link",{memoId:C,tagId:I})}a.createMemoTag=E;function x(C,I){return n("/api/tag/rmlink",{memoId:C,tagId:I})}a.removeMemoTag=x;function b(C){return t("/api/tag/memo?id="+C)}a.getTagsByMemoId=b;function S(){return t("/api/tag/all")}a.getMyTags=S;function A(C){return n("/api/tag/delete",{tagId:C})}a.deleteTagById=A;function _(C){return n("/api/tag/polish",{tagId:C})}a.polishTag=_;function j(C,I){return n("/api/tag/update",{id:C,text:I})}a.updateTagText=j;function q(){return t("/api/user/amount")}a.getMyDataAmount=q;function B(C){return t("/api/base/srctype?url="+C)}a.getUrlContentType=B;function O(){return t("/api/memo/stat")}a.getMemosStat=O;function Q(){return n("/api/user/updategh",{githubName:""})}a.removeGithubName=Q})(F||(F={}));const ae="div#page-container",ne="mobile-show-sidebar",Ye=20,se=200,je=400,G=3600*24*1e3,Z=/#\s(.+?)\s/g,pe=/(https?:\/\/[^\s<\\*>']+)/g,z=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,ge=/\[@(.+?)\]\((.+?)\)/g,re=[{type:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{type:"LINKED",text:"\u6709\u94FE\u63A5"},{type:"IMAGED",text:"\u6709\u56FE\u7247"}];class qe{getState(){return w.getState().userState}async doSignIn(){const{data:t}=await F.getUserInfo();return t?w.dispatch({type:"SIGN_IN",payload:{user:t}}):L.doSignOut(),t}async doSignOut(){F.signout().catch(()=>{}),w.dispatch({type:"SIGN_OUT",payload:{user:null}})}async checkUsernameUsable(t){const{data:n}=await F.checkUsernameUsable(t);return n}async updateUsername(t){await F.updateUserinfo(t)}async removeGithubName(){await F.removeGithubName()}async checkPasswordValid(t){const{data:n}=await F.checkPasswordValid(t);return n}async updatePassword(t){await F.updateUserinfo("",t)}}const L=new qe;class Ve{constructor(){P(this,"isFetching",!1)}getState(){return w.getState().memoState}async fetchMoreMemos(){if(!L.getState().user||this.isFetching)return!1;this.isFetching=!0;const{data:t}=await F.getMyMemos(this.getState().memos.length,Ye),n=t.map(s=>T({},s));return w.dispatch({type:"PUSH_MEMOS",payload:{memos:n}}),this.isFetching=!1,n}async fetchAllMemos(){if(!L.getState().user)return!1;this.isFetching=!0;const{data:{memosAmount:t}}=await F.getMyDataAmount(),{data:n}=await F.getMyMemos(0,t),s=n.map(r=>T({},r));return s.length>0&&w.dispatch({type:"SET_MEMOS",payload:{memos:s}}),this.isFetching=!1,n}pushMemo(t){w.dispatch({type:"PUSH_MEMO",payload:{memo:T({},t)}})}async getMemoById(t){for(const s of this.getState().memos)if(s.id===t)return s;const{data:n}=await F.getMemoById(t);return n}async deleteMemoById(t){await F.deleteMemo(t),w.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:t}})}editMemo(t){w.dispatch({type:"EDIT_MEMO",payload:t})}clearMemos(){w.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(t){const{data:n}=await F.createMemo(t);return n}async updateMemo(t,n){const{data:s}=await F.updateMemo(t,n);return s}async createTag(t){const{data:n}=await F.createTag(t);return n}async removeMemoTag(t,n){await F.removeMemoTag(t,n)}async createMemoTag(t,n){await F.createMemoTag(t,n)}async getMyDataAmount(){const{data:t}=await F.getMyDataAmount();return t}async getMemosStat(){const{data:t}=await F.getMemosStat();return t}async getMyTags(){if(!L.getState().user)return[];const{data:t}=await F.getMyTags();return t}async polishTag(t){await F.polishTag(t)}async updateTagText(t,n){await F.updateTagText(t,n)}}const M=new Ve,Ke=()=>{const{userState:{user:a}}=i.exports.useContext($),t=a?a.username:"Memos",n=i.exports.useCallback(()=>{U.clearQuery()},[]),s=i.exports.useCallback(()=>{const r=document.querySelector(ae);r&&r.classList.add(ne)},[]);return e.createElement("div",{className:"mobile-header-container"},e.createElement("p",{className:"username-text",onClick:n},t),e.createElement("div",{className:"btns-container"},e.createElement("button",{className:"action-btn show-sidebar",onClick:s},e.createElement("img",{className:"icon-img",src:"/icons/fold.svg",alt:"fold"}))))},We=/```([\s\S]*?)```/g,ze=/[*] /g,Xe=/(\d+)\. /g,Je=a=>a.replace(We,"<pre lang=''>$1</pre>").replace(ze,"<span class='counter-text'>\u2022</span>").replace(Xe,"<span class='counter-text'>$1.</span>"),oe=a=>{const t=document.createElement("div");t.className="memo-content-text",t.innerHTML=a,document.body.appendChild(t);const n=t.innerText;return t.remove(),n},Ze=a=>a.replace(/\n\n/g,"<p>&nbsp;</p>").replace(/\n/g,"<br>");const et=a=>{const{destory:t,duration:n}=a;return i.exports.useEffect(()=>{n>0&&setTimeout(()=>{t()},n)},[]),e.createElement("div",{className:"toast-container",onClick:t},e.createElement("p",{className:"content-text"},a.content))},v=(()=>{const a=document.createElement("div");a.className="toast-list-container",document.body.appendChild(a);let t=0;const n=[],s=l=>{const o=document.createElement("div");o.className=`toast-wrapper ${l.type}`,a.appendChild(o),t++,n.push(o),setTimeout(()=>{o.classList.add("showup")},0);const g={destory:()=>{o.classList.add("destory"),setTimeout(()=>{if(!!o.parentElement&&(t--,t===0)){for(const N of n)V.unmountComponentAtNode(N),N.remove();n.splice(0,n.length)}},je)}};return V.render(e.createElement(et,k(T({},l),{destory:g.destory})),o),g};return{info:(l,o=3e3)=>s({type:"normal",content:l,duration:o}),error:(l,o=3e3)=>s({type:"error",content:l,duration:o})}})(),tt=a=>{const{children:t,when:n}=a;return n?e.createElement(e.Fragment,null,t):null},Y=tt;function at(){const[a,t]=i.exports.useState(!1);return i.exports.useCallback(()=>{t(s=>!s)},[])}const nt=e.forwardRef((a,t)=>{var b;const{className:n,initialContent:s,placeholder:r,showConfirmBtn:c,showCancelBtn:l,showTools:o,onConfirmBtnClick:g,onCancelBtnClick:N,onContentChange:h}=a,d=i.exports.useRef(null),m=at();i.exports.useEffect(()=>{s?d.current.innerHTML=s:d.current.innerHTML="<br>"},[]),i.exports.useImperativeHandle(t,()=>({focus:()=>{d.current.focus()},insertText:S=>{d.current.innerHTML+=`<br>${S}`,h(d.current.innerText),m()},setContent:S=>{d.current.innerText=oe(S),m()},getContent:()=>{var S,A;return(A=(S=d.current)==null?void 0:S.innerText)!=null?A:""}}),[]);const y=i.exports.useCallback(S=>{const A=S.clipboardData.getData("text"),_=window.getSelection();!_||!_.rangeCount||(_.deleteFromDocument(),_.getRangeAt(0).insertNode(document.createTextNode(A)),S.preventDefault(),h(d.current.innerText),m())},[]),f=i.exports.useCallback(()=>{h(d.current.innerText),m()},[]),p=i.exports.useCallback(S=>{var A,_,j,q;if(S.stopPropagation(),S.key==="Tab"){S.preventDefault();const B=window.getSelection();if(!B||!B.rangeCount)return;B.deleteFromDocument();const O=B.getRangeAt(0),Q=document.createTextNode("	");O.insertNode(Q),O.setStartAfter(Q),O.setEndAfter(Q),B.removeAllRanges(),B.addRange(O)}else if(S.key==="Backspace")setTimeout(()=>{var B;((B=d.current)==null?void 0:B.innerText)===""&&(d.current.innerHTML="<br>",m())},0);else if(S.key==="Enter"&&!S.shiftKey){if(S.preventDefault(),!((A=d.current)==null?void 0:A.lastElementChild)||((_=d.current)==null?void 0:_.lastElementChild)!==((j=d.current)==null?void 0:j.lastChild)){const I=document.createElement("br");(q=d.current)==null||q.appendChild(I)}const B=window.getSelection();if(!B||!B.rangeCount)return;B.deleteFromDocument();const O=B.getRangeAt(0),Q=document.createTextNode(" "),C=document.createElement("br");O.insertNode(C),O.insertNode(Q),O.setStartAfter(C),O.setEndAfter(C),B.removeAllRanges(),B.addRange(O)}m()},[]),u=i.exports.useCallback(()=>{var S,A;g((A=(S=d.current)==null?void 0:S.innerText)!=null?A:""),d.current.innerHTML="<br>",m()},[]),E=i.exports.useCallback(()=>{N()},[]),x=Boolean(((b=d.current)==null?void 0:b.innerHTML)==="<br>");return e.createElement("div",{className:"common-editor-wrapper "+n},e.createElement("div",{className:"common-editor-inputer",contentEditable:!0,ref:d,onPaste:y,onInput:f,onKeyDown:p}),e.createElement("p",{className:x?"common-editor-placeholder":"hidden"},r),e.createElement("div",{className:"common-tools-wrapper"},e.createElement(Y,{when:o},e.createElement("div",{className:"common-tools-container"})),e.createElement("div",{className:"btns-right-container"},e.createElement(Y,{when:l},e.createElement("button",{className:"action-btn cancel-btn",onClick:E},"\u64A4\u9500\u4FEE\u6539")),e.createElement(Y,{when:c},e.createElement("button",{className:"action-btn confirm-btn",disabled:x,onClick:u},"\u8BB0\u4E0B",e.createElement("span",{className:"icon-text"},"\u270D\uFE0F"))))))});const st=()=>{const{globalState:a}=i.exports.useContext($),t=i.exports.useRef(null);i.exports.useEffect(()=>{var o;if(a.markMemoId){const g=`Mark: [@MEMO](${a.markMemoId})`;(o=t.current)==null||o.insertText(g)}a.editMemoId&&M.getMemoById(a.editMemoId).then(g=>{var N,h,d;g&&((h=t.current)==null||h.setContent((N=g.content)!=null?N:""),(d=t.current)==null||d.focus())})},[a]);const n=i.exports.useCallback(async o=>{var m,y;if(o===""){v.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}const{editMemoId:g}=R.getState(),{query:N}=U.getState();o=oe(o.replaceAll("&nbsp;"," "));const h=D.dedupe(Array.from((m=o.match(Z))!=null?m:[])).map(f=>f.replace(Z,"$1").trim()),d=[];try{for(const f of h){const p=await M.createTag(f);d.push(p)}if(g){const f=await M.getMemoById(g);if(f&&f.content!==o){const p=(y=f.tags)!=null?y:[],u=p.map(x=>x.text);d.push(...p);for(let x=0;x<d.length;){const b=d[x],S=b.text;h.includes(S)?(x++,u.includes(S)||await M.createMemoTag(f.id,b.id)):(d.splice(x,1),await M.removeMemoTag(f.id,b.id))}const E=await M.updateMemo(f.id,o);E.tags=d,E.updatedAt=D.getDateTimeString(Date.now()),M.editMemo(E)}R.setEditMemoId("")}else{const f=await M.createMemo(o);f.tags=d;for(const u of d)await M.createMemoTag(f.id,u.id);const p=N.tag;p!==""&&!h.includes(p)&&U.setTagQuery(""),M.pushMemo(f)}}catch(f){v.error(f.message)}ce("")},[]),s=i.exports.useCallback(()=>{var o;R.setEditMemoId(""),(o=t.current)==null||o.setContent(""),ce("")},[]),r=i.exports.useCallback(o=>{const g=document.createElement("div");g.innerHTML=o,g.innerText.trim()===""&&(o=""),ce(o)},[]),{editMemoId:c}=a,l=i.exports.useMemo(()=>({className:"memo-editor",initialContent:rt(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,showCancelBtn:c!=="",showTools:!0,onConfirmBtnClick:n,onCancelBtnClick:s,onContentChange:r}),[c]);return e.createElement("div",{className:"memo-editor-wrapper "+(c?"edit-ing":"")},e.createElement("p",{className:"tip-text "+(c?"":"hidden")},"\u6B63\u5728\u4FEE\u6539\u4E2D..."),e.createElement(nt,T({ref:t},l)))};function rt(){var a;return(a=K.get(["editorContentCache"]).editorContentCache)!=null?a:""}function ce(a){K.set({editorContentCache:a})}function ot(a,t,n=[]){const s=i.exports.useRef(),r=i.exports.useCallback(()=>{s.current&&clearTimeout(s.current)},[]);return i.exports.useCallback((...l)=>{r(),s.current=window.setTimeout(()=>{a(...l)},t)},n)}function le(a=!1){const[t,n]=i.exports.useState(a),s=i.exports.useCallback(r=>{n(r!==void 0?r:c=>!c)},[]);return[t,s]}const ct=a=>{const{children:t,className:n,clickSpaceDestroy:s,destroy:r}=a,c=()=>{s&&r()};return e.createElement("div",{className:`dialog-wrapper ${n}`,onClick:c},e.createElement("div",{className:"dialog-container",onClick:l=>l.stopPropagation()},t))};function H(a,t,n){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var o;(o=s.firstElementChild)==null||o.classList.add("showup")},0);const r={destroy:()=>{var o,g;(o=s.firstElementChild)==null||o.classList.remove("showup"),(g=s.firstElementChild)==null||g.classList.add("showoff"),setTimeout(()=>{s.remove(),V.unmountComponentAtNode(s)},se)}},c=k(T({},n),{destroy:r.destroy});let l=e.createElement(ct,T({destroy:r.destroy,clickSpaceDestroy:!0},a),e.createElement(t,T({},c)));return a.useAppContext&&(l=e.createElement(de,{store:w,context:$},l)),V.render(l,s),r}const lt=({destroy:a,imgUrl:t})=>{const n=i.exports.useRef(null),[s,r]=i.exports.useState(-1);i.exports.useEffect(()=>{D.getImageSize(t).then(({width:g})=>{r(g!==0?80:0)})},[]);const c=()=>{a()},l=()=>{s>30&&r(s-10)},o=()=>{r(s+10)};return e.createElement(e.Fragment,null,e.createElement("button",{className:"text-btn close-btn",onClick:c},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"})),e.createElement("div",{className:"img-container"},e.createElement("img",{className:s<=0?"hidden":"",ref:n,width:s+"%",src:t}),e.createElement("span",{className:"loading-text "+(s===-1?"":"hidden")},"\u56FE\u7247\u52A0\u8F7D\u4E2D..."),e.createElement("span",{className:"loading-text "+(s===0?"":"hidden")},"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5")),e.createElement("div",{className:"action-btns-container"},e.createElement("button",{className:"text-btn",onClick:l},"\u2796"),e.createElement("button",{className:"text-btn",onClick:o},"\u2795"),e.createElement("button",{className:"text-btn",onClick:()=>r(80)},"\u2B55")))};function Ee(a){H({className:"preview-image-dialog"},lt,{imgUrl:a})}const fe=a=>{const{className:t,imgUrl:n}=a,s=()=>{Ee(n)};return e.createElement("div",{className:"image-container "+t,onClick:s},e.createElement("img",{src:n,decoding:"async",loading:"lazy"}))};function me(){const[a,t]=i.exports.useState({isLoading:!0,isFailed:!1,isSucceed:!1});return k(T({},a),{setLoading:()=>{t(k(T({},a),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{t(k(T({},a),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{t(k(T({},a),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const mt=a=>{var r;const{memo:t}=a,n=k(T({},t),{formattedContent:X(t.content),createdAtStr:D.getDateTimeString(t.createdAt),timeStr:D.getTimeString(t.createdAt)}),s=Array.from((r=n.content.match(z))!=null?r:[]);return e.createElement("div",{className:"daily-memo-wrapper"},e.createElement("div",{className:"time-wrapper"},e.createElement("span",{className:"normal-text"},n.timeStr)),e.createElement("div",{className:"memo-content-container"},e.createElement("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:n.formattedContent}}),e.createElement(Y,{when:s.length>0},e.createElement("div",{className:"images-container"},s.map((c,l)=>e.createElement("img",{key:l,crossOrigin:"anonymous",src:c,decoding:"async"}))))))};const it=a=>{const{className:t,datestamp:n,handleDateStampChange:s}=a,[r,c]=i.exports.useState(ie(n));i.exports.useEffect(()=>{c(ie(n))},[n]);const l=new Date(r),o=l.getDay()===0?7:l.getDay(),g=[];for(let m=1;m<o;m++)g.push({date:0,datestamp:l.getTime()-G*(7-m)});const N=ut(r);for(let m=1;m<=N;m++)g.push({date:m,datestamp:l.getTime()+G*(m-1)});const h=m=>{s(m)},d=m=>{const y=l.getFullYear(),f=l.getMonth()+1;let p=0;f===1&&m===-1?p=new Date(`${y-1}/12/1`).getTime():f===12&&m===1?p=new Date(`${y+1}/1/1`).getTime():p=new Date(`${y}/${f+m}/1`).getTime(),c(ie(p))};return e.createElement("div",{className:`date-picker-wrapper ${t}`},e.createElement("div",{className:"date-picker-header"},e.createElement("span",{className:"btn-text",onClick:()=>d(-1)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-left.svg"})),e.createElement("span",{className:"normal-text"},l.getFullYear()," \u5E74 ",l.getMonth()+1," \u6708"),e.createElement("span",{className:"btn-text",onClick:()=>d(1)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"}))),e.createElement("div",{className:"date-picker-day-container"},e.createElement("div",{className:"date-picker-day-header"},e.createElement("span",{className:"day-item"},"\u5468\u4E00"),e.createElement("span",{className:"day-item"},"\u5468\u4E8C"),e.createElement("span",{className:"day-item"},"\u5468\u4E09"),e.createElement("span",{className:"day-item"},"\u5468\u56DB"),e.createElement("span",{className:"day-item"},"\u5468\u4E94"),e.createElement("span",{className:"day-item"},"\u5468\u516D"),e.createElement("span",{className:"day-item"},"\u5468\u65E5")),g.map(m=>m.date===0?e.createElement("span",{key:m.datestamp,className:"day-item null"},""):e.createElement("span",{key:m.datestamp,className:`day-item ${m.datestamp===n?"current":""}`,onClick:()=>h(m.datestamp)},m.date))))};function ut(a){const t=new Date(a),n=new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`);return((n.getMonth()===11?new Date(`${n.getFullYear()+1}/1`):new Date(`${n.getFullYear()}/${n.getMonth()+2}/1`)).getTime()-n.getTime())/G}function ie(a){const t=new Date(a);return new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`).getTime()}const dt=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],pt=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],gt=a=>{const t=me(),[n,s]=i.exports.useState([]),[r,c]=i.exports.useState(D.getDateStampByDate(D.getDateString(a.currentDateStamp))),[l,o]=le(!1),g=i.exports.useRef(null),N=new Date(r);i.exports.useEffect(()=>{const m=()=>{const p=M.getState().memos.filter(u=>D.getTimeStampByDate(u.createdAt)>=r&&D.getTimeStampByDate(u.createdAt)<r+G).sort((u,E)=>D.getTimeStampByDate(u.createdAt)-D.getTimeStampByDate(E.createdAt));s(p),t.setFinish()},{memos:y}=M.getState(),f=y.slice(-1).pop();f&&D.getTimeStampByDate(f.createdAt)>=r?(t.setLoading(),M.fetchAllMemos().then(()=>{m()}).catch(p=>{v.error(p.message)})):m()},[r]);const h=()=>{o(!1),setTimeout(()=>{const m=D.getOSVersion();(m==="MacOS"||m==="Unknown")&&window.scrollTo(0,0),html2canvas(g.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:R.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(y=>{Ee(y.toDataURL())})},0)},d=m=>{c(m),o(!1)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("div",{className:"btns-wrapper"},e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"btn-text",onClick:()=>c(r-G)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-left.svg"})),e.createElement("span",{className:"btn-text",onClick:()=>c(r+G)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"}))),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"btn-text",onClick:h},e.createElement("img",{className:"icon-img",src:"/icons/share.svg"})),e.createElement("span",{className:"btn-text",onClick:()=>a.destroy()},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))))),e.createElement("div",{className:"dialog-content-container",ref:g},e.createElement("div",{className:"date-card-container",onClick:()=>o()},e.createElement("div",{className:"year-text"},N.getFullYear()),e.createElement("div",{className:"date-container"},e.createElement("div",{className:"month-text"},dt[N.getMonth()]),e.createElement("div",{className:"date-text"},N.getDate()),e.createElement("div",{className:"day-text"},pt[N.getDay()]))),e.createElement(it,{className:`date-picker ${l?"":"hide"}`,datestamp:r,handleDateStampChange:d}),t.isLoading?e.createElement("div",{className:"tip-container"},e.createElement("p",{className:"tip-text"},"\u52AA\u529B\u52A0\u8F7D\u4E2D...")):n.length===0?e.createElement("div",{className:"tip-container"},e.createElement("p",{className:"tip-text"},"\u7A7A\u7A7A\u5982\u4E5F")):e.createElement("div",{className:"dailymemos-wrapper"},n.map(m=>e.createElement(mt,{key:`${m.id}-${m.updatedAt}`,memo:m})))))};function he(a=Date.now()){H({className:"daily-memo-diary-dialog"},gt,{currentDateStamp:a})}const Et=a=>{var y;const{memo:t,destroy:n}=a,[s,r]=i.exports.useState(""),c=i.exports.useRef(null),{user:l}=L.getState(),o=k(T({},t),{formattedContent:X(t.content),createdAtStr:D.getDateTimeString(t.createdAt)}),g=Array.from((y=o.content.match(z))!=null?y:[]),[N,h]=i.exports.useState(g.length);i.exports.useEffect(()=>{setTimeout(()=>{if(N===0){const f=D.getOSVersion();(f==="MacOS"||f==="Unknown")&&window.scrollTo(0,0),html2canvas(c.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:R.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(p=>{r(p.toDataURL())})}},se+100)},[N]);const d=()=>{n()},m=f=>{f.type==="error"&&(v.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),f.target.remove()),h(N-1)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F970}"),"\u5206\u4EAB Memo \u56FE\u7247"),e.createElement("button",{className:"text-btn close-btn",onClick:d},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:`tip-words-container ${s?"finished":"genarating"}`},e.createElement("p",{className:"tip-text"},s?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D...")),e.createElement("img",{className:"memo-img",src:s}),e.createElement("div",{className:"memo-container",ref:c},e.createElement("span",{className:"time-text"},o.createdAtStr),e.createElement("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:o.formattedContent}}),e.createElement(Y,{when:g.length>0},e.createElement("div",{className:"images-container"},g.map((f,p)=>e.createElement("img",{key:p,crossOrigin:"anonymous",src:f,onLoad:m,onError:m,decoding:"async"})))),e.createElement("div",{className:"watermark-container"},e.createElement("span",{className:"normal-text"},"by ",e.createElement("span",{className:"name-text"},l==null?void 0:l.username))))))};function ye(a){H({className:"share-memo-image-dialog"},Et,{memo:a})}const ft=a=>{var d;const{memoId:t,destroy:n}=a,[s,r]=i.exports.useState(),[c,l]=i.exports.useState([]),[o,g]=i.exports.useState([]);i.exports.useEffect(()=>{(async()=>{var f;const y=await M.getMemoById(t);y&&(g(Array.from((f=y.content.match(z))!=null?f:[])),r(k(T({},y),{formattedContent:X(y.content),createdAtStr:D.getDateTimeString(y.createdAt)})))})()},[]),i.exports.useEffect(()=>{(async()=>{if(!s)return;const y=[],f=[...s.content.matchAll(ge)];for(const p of f)if(p&&p.length===3){const u=p[2],E=await M.getMemoById(u);E&&(y.push(k(T({},E),{formattedContent:X(E.content),createdAtStr:D.getDateTimeString(E.createdAt)})),l([...y]))}})()},[s]);const N=()=>{s&&ye(s)},h=async m=>{var f;const y=m.target;if(y.className==="memo-link-text"){const p=(f=y.dataset)==null?void 0:f.value;p&&await M.getMemoById(p)&&(n(),Ne(p))}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F4D5}"),"Memo Story"),e.createElement("button",{className:"text-btn close-btn",onClick:n},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:"memo-container current"},e.createElement("div",{className:"memo-header-container"},e.createElement("p",{className:"time-text"},s==null?void 0:s.createdAtStr),e.createElement("span",{className:"action-btn",onClick:N},"Share")),e.createElement("div",{className:"memo-content-text",onClick:h,dangerouslySetInnerHTML:{__html:(d=s==null?void 0:s.formattedContent)!=null?d:""}}),e.createElement(Y,{when:o.length>0},e.createElement("div",{className:"images-wrapper"},o.map((m,y)=>e.createElement(fe,{className:"memo-img",key:y,imgUrl:m}))))),e.createElement("p",{className:"normal-text "+(c.length===0?"hidden":"")},"\u94FE\u63A5\u4E86 ",c.length," \u4E2A Memo"),e.createElement("div",{className:"down-memos-wrapper "+(c.length!==0?"":"hidden")},c.map(m=>e.createElement("div",{className:"memo-container",key:m.id},e.createElement("div",{className:"memo-header-container"},e.createElement("p",{className:"time-text"},m.createdAtStr)),e.createElement("div",{className:"memo-content-text",onClick:h,dangerouslySetInnerHTML:{__html:m.formattedContent}}))))))};function Ne(a){H({className:"memo-story-dialog"},ft,{memoId:a})}const ht=a=>{var y;const{memo:t}=a,n=k(T({},t),{formattedContent:X(t.content),createdAtStr:D.getDateTimeString(t.createdAt)}),[s,r]=le(!1),c=Array.from((y=n.content.match(z))!=null?y:[]),l=()=>{he(D.getTimeStampByDate(n.createdAt))},o=()=>{R.setMarkMemoId(n.id)},g=()=>{R.setEditMemoId(n.id)},N=async()=>{if(s){try{await M.deleteMemoById(n.id),await M.fetchMoreMemos()}catch(f){v.error(f.message)}R.getState().editMemoId===n.id&&R.setEditMemoId("")}else r()},h=()=>{s&&r(!1)},d=()=>{ye(n)},m=async f=>{var u;const p=f.target;if(p.className==="memo-link-text"){const E=(u=p.dataset)==null?void 0:u.value;E&&await M.getMemoById(E)&&Ne(E)}};return e.createElement("div",{className:"memo-wrapper",onMouseLeave:h},e.createElement("div",{className:"memo-top-wrapper"},e.createElement("span",{className:"time-text",onClick:l},n.createdAtStr),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"text-btn more-action-btn"}),e.createElement("div",{className:"more-action-btns-wrapper"},e.createElement("div",{className:"more-action-btns-container"},e.createElement("span",{className:"text-btn",onClick:o},"Mark"),e.createElement("span",{className:"text-btn",onClick:d},"\u5206\u4EAB"),e.createElement("span",{className:"text-btn",onClick:g},"\u7F16\u8F91"),e.createElement("span",{className:"text-btn delete-btn",onClick:N},s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"))))),e.createElement("div",{className:"memo-content-text",onClick:m,dangerouslySetInnerHTML:{__html:n.formattedContent}}),e.createElement(Y,{when:c.length>0},e.createElement("div",{className:"images-wrapper"},c.map((f,p)=>e.createElement(fe,{className:"memo-img",key:p,imgUrl:f})))))};function X(a){var c;const t=document.createElement("div");t.innerHTML=Ze(a).split(/<br>/).map(l=>l!==""?`<p>${l}</p>`:"").join(""),a=t.innerHTML;const{shouldUseMarkdownParser:n,shouldSplitMemoWord:s,shouldHideImageUrl:r}=R.getState();n&&(a=Je(a)),s&&(a=a.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5]?)/g,"$1 $2 $3")),r&&(a=a.replace(z,"")),t.innerHTML=a;for(const l of t.querySelectorAll("p"))l.textContent===""&&((c=l.firstElementChild)==null?void 0:c.tagName)!=="BR"&&l.remove();return a=t.innerHTML,a=a.replace(Z,"<span class='tag-span'>#$1</span>").replace(pe,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(ge,"<span class='memo-link-text' data-value='$2'>$1</span>"),a}var yt=e.memo(ht);const Nt=a=>{for(const t of re)if(t.type===a)return t.text;return""},xt=()=>{const{locationState:{query:a},memoState:{memos:t}}=i.exports.useContext($),[n,s]=i.exports.useState(!1),[r,c]=i.exports.useState(!1),l=i.exports.useRef(null),o=a.tag,g={from:a.from,to:a.to},N=a.type,h=a.text,d=Boolean(o||g.from!==0&&g.from<g.to||N||h),m=t.filter(u=>{let E=!0;const x=[];for(const b of u.tags){const S=b.text.split("/");let A="";for(let _=0;_<S.length;_++)_===0?A+=S[_]:A+="/"+S[_],x.push(A)}return o!==""&&!x.includes(o)&&(E=!1),g.from!==0&&g.from<g.to&&(D.getTimeStampByDate(u.createdAt)<g.from||D.getTimeStampByDate(u.createdAt)>g.to)&&(E=!1),N!==""&&(N==="NOT_TAGGED"?u.content.match(Z)!==null&&(E=!1):N==="LINKED"?u.content.match(pe)===null&&(E=!1):N==="IMAGED"&&u.content.match(z)===null&&(E=!1)),h!==""&&!u.content.includes(h)&&(E=!1),E});i.exports.useEffect(()=>{var u;(u=l.current)==null||u.scrollTo({top:0}),!r&&d&&(s(!0),M.fetchAllMemos().then(E=>{E!==!1&&(c(!0),s(!1))}))},[r,d]);const y=async()=>{if(!(n||r)){s(!0);try{const u=await M.fetchMoreMemos();Array.isArray(u)&&u.length===0&&c(!0)}catch(u){v.error(u.message)}s(!1)}},f=i.exports.useCallback(u=>{const E=u.target;if(E.tagName==="SPAN"&&E.className==="tag-span"){const x=E.innerText.slice(1);U.getState().query.tag===x?U.setTagQuery(""):U.setTagQuery(x)}},[]),p=ot(()=>{if(n||r)return;const{offsetHeight:u,scrollTop:E,scrollHeight:x}=l.current;u+E+10>x&&y()},100,[n,r]);return e.createElement("div",{className:`memolist-wrapper ${r?"completed":""}`,onClick:f,onScroll:p,ref:l},e.createElement(St,{showFilter:d,tagQuery:o,duration:g,memoType:N,textQuery:h}),m.map(u=>e.createElement(yt,{key:`${u.id}-${u.updatedAt}`,memo:u})),d?e.createElement("div",{className:"status-text-container"},e.createElement("p",{className:"status-text"},n?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":r&&m.length===0?"\u7A7A\u7A7A\u5982\u4E5F":"")):e.createElement("div",{className:`status-text-container ${r?"completed":""} ${n||r?"":"invisible"}`},e.createElement("p",{className:"status-text"},r?"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}":"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...")))},St=a=>{const{showFilter:t,tagQuery:n,duration:s,memoType:r,textQuery:c}=a;return e.createElement("div",{className:`filter-query-container ${t?"":"hidden"}`},e.createElement("span",{className:"tip-text"},"\u7B5B\u9009\uFF1A"),e.createElement("div",{className:"filter-item-container "+(s.from!==0&&s.from<s.to?"":"hidden"),onClick:()=>{U.setFromAndToQuery(0,0)}},e.createElement("span",{className:"icon-text"},"\u{1F5D3}\uFE0F")," ",D.getDateString(s.from)," \u81F3 ",D.getDateString(s.to)),e.createElement("div",{className:"filter-item-container "+(n?"":"hidden"),onClick:()=>{U.setTagQuery("")}},e.createElement("span",{className:"icon-text"},"\u{1F3F7}\uFE0F")," ",n),e.createElement("div",{className:"filter-item-container "+(r?"":"hidden"),onClick:()=>{U.setMemoTypeQuery("")}},e.createElement("span",{className:"icon-text"},"\u{1F4E6}")," ",Nt(r)),e.createElement("div",{className:"filter-item-container "+(c?"":"hidden"),onClick:()=>{U.setTextQuery("")}},e.createElement("span",{className:"icon-text"},"\u{1F50D}")," ",c))};const Ct=({destroy:a})=>{const{userState:t}=i.exports.useContext($),n=t.user,[s,r]=i.exports.useState(n.username),[c,l]=i.exports.useState(!1),[o,g]=i.exports.useState(!1),N=()=>{a()},h=p=>{const u=p.target.value;r(u)},d=async()=>{if(n.username==="guest"){v.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(s===n.username){l(!1);return}try{if(!await L.checkUsernameUsable(s)){v.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await L.updateUsername(s),await L.doSignIn(),l(!1),v.info("\u4FEE\u6539\u6210\u529F~")}catch(p){v.error(p.message)}},m=()=>{if(n.username==="guest"){v.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}Dt()},y=async()=>{if(o){try{await L.removeGithubName(),await L.doSignIn()}catch(p){v.error(p.message)}g(!1)}else g(!0)},f=p=>{p.preventDefault()};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F920}"),"\u6211\u7684\u8D26\u53F7"),e.createElement("button",{className:"text-btn close-btn",onClick:N},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:"section-container account-section-container"},e.createElement("p",{className:"title-text"},"\u57FA\u672C\u4FE1\u606F"),e.createElement("label",{className:"form-label input-form-label"},e.createElement("span",{className:"normal-text"},"ID\uFF1A"),e.createElement("span",{className:"normal-text"},n.id)),e.createElement("label",{className:"form-label input-form-label"},e.createElement("span",{className:"normal-text"},"\u521B\u5EFA\u65F6\u95F4\uFF1A"),e.createElement("span",{className:"normal-text"},D.getDateString(n.createdAt))),e.createElement("label",{className:"form-label input-form-label username-label"},e.createElement("span",{className:"normal-text"},"\u8D26\u53F7\uFF1A"),e.createElement("input",{type:"text",readOnly:!c,value:s,onClick:()=>{l(!0)},onChange:h}),e.createElement("div",{className:"btns-container",onClick:f},e.createElement("span",{className:"text-btn confirm-btn "+(c?"":"hidden"),onClick:d},"\u4FDD\u5B58"),e.createElement("span",{className:"text-btn cancel-btn "+(c?"":"hidden"),onClick:()=>{r(n.username),l(!1)}},"\u64A4\u9500"))),e.createElement("label",{className:"form-label password-label"},e.createElement("span",{className:"normal-text"},"\u5BC6\u7801\uFF1A"),e.createElement("span",{className:"text-btn",onClick:m},"\u4FEE\u6539\u5BC6\u7801"))),e.createElement("div",{className:"section-container account-section-container"},e.createElement("p",{className:"title-text"},"\u5173\u8054\u8D26\u53F7"),e.createElement("label",{className:"form-label input-form-label"},e.createElement("span",{className:"normal-text"},"GitHub\uFF1A"),n.githubName?e.createElement(e.Fragment,null,e.createElement("a",{className:"value-text",href:"https://github.com/"+n.githubName},n.githubName),e.createElement("span",{className:"btn-text",onMouseLeave:()=>g(!1),onClick:y},o?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A")):e.createElement(e.Fragment,null,e.createElement("span",{className:"value-text"},"\u65E0"),e.createElement("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist"},"\u524D\u5F80\u7ED1\u5B9A"))))))},bt=({destroy:a})=>{const[t,n]=i.exports.useState(""),[s,r]=i.exports.useState(""),[c,l]=i.exports.useState("");i.exports.useEffect(()=>{},[]);const o=()=>{a()},g=m=>{const y=m.target.value;n(y)},N=m=>{const y=m.target.value;r(y)},h=m=>{const y=m.target.value;l(y)},d=async()=>{if(t===""||s===""||c===""){v.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==c){v.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),l("");return}try{if(!await L.checkPasswordValid(t)){v.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),n("");return}await L.updatePassword(s),v.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),o()}catch(m){v.error(m)}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},"\u4FEE\u6539\u5BC6\u7801"),e.createElement("button",{className:"text-btn close-btn",onClick:o},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("p",{className:"tip-text"},"\u5982\u679C\u662F GitHub \u767B\u5F55\uFF0C\u5219\u521D\u59CB\u5BC6\u7801\u4E3A\u7528\u6237\u540D"),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:t,onChange:g}),e.createElement("span",{className:"normal-text "+(t===""?"":"not-null")},"\u65E7\u5BC6\u7801")),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:s,onChange:N}),e.createElement("span",{className:"normal-text "+(s===""?"":"not-null")},"\u65B0\u5BC6\u7801")),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:c,onChange:h}),e.createElement("span",{className:"normal-text "+(c===""?"":"not-null")},"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801")),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"text-btn cancel-btn",onClick:o},"\u53D6\u6D88"),e.createElement("span",{className:"text-btn confirm-btn",onClick:d},"\u4FDD\u5B58"))))};function Dt(){H({className:"change-password-dialog"},bt)}function Mt(){H({className:"my-account-dialog",useAppContext:!0},Ct)}const Tt=({destroy:a})=>{const t=()=>{a()};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F600}"),"\u5173\u4E8E ",e.createElement("b",null,"Memos")),e.createElement("button",{className:"text-btn close-btn",onClick:t},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("p",null,"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"),e.createElement("br",null),e.createElement("i",null,"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"),e.createElement("ul",null,e.createElement("li",null,"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5}\u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1}\u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5}\u8BFB\u540E\u611F..."),e.createElement("li",null,"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"),e.createElement("li",null,"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B")),e.createElement("br",null),e.createElement("i",null,"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"),e.createElement("ul",null,e.createElement("li",null,"\u2728"," ",e.createElement("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer"},"\u5F00\u6E90\u9879\u76EE")),e.createElement("li",null,"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"),e.createElement("li",null,"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B")),e.createElement("br",null),e.createElement("p",null,"Enjoy it and have fun~ "),e.createElement("hr",null),e.createElement("p",{className:"normal-text"},"Last update at ",e.createElement("pre",null," 2021/10/08 16:34:39 ")," \u{1F389}"),e.createElement("p",{className:"normal-text"},"BTW, my personal site:",e.createElement("a",{target:"_blank",href:"https://justsven.top",rel:"noreferrer"},"https://justsven.top"))))};function xe(){H({className:"about-site-dialog"},Tt)}const wt=({destroy:a})=>{const{globalState:{shouldHideImageUrl:t,shouldSplitMemoWord:n,shouldUseMarkdownParser:s,showDarkMode:r}}=i.exports.useContext($);i.exports.useEffect(()=>{},[]);const c=()=>{a()},l=m=>{const y=m.target.checked;R.setAppSetting({shouldSplitMemoWord:y})},o=m=>{const y=m.target.checked;R.setAppSetting({shouldHideImageUrl:y})},g=m=>{const y=m.target.checked;R.setAppSetting({showDarkMode:y})},N=m=>{const y=m.target.checked;R.setAppSetting({shouldUseMarkdownParser:y})},h=async()=>{await M.fetchAllMemos();for(const m of M.getState().memos)await M.updateMemo(m.id,oe(m.content))},d=async()=>{await M.fetchAllMemos();const m=M.getState().memos.map(p=>k(T({},p),{tags:p.tags.map(u=>u.text)})),y=JSON.stringify(m),f=document.createElement("a");f.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(y)),f.setAttribute("download","data.json"),f.style.display="none",document.body.appendChild(f),f.click(),document.body.removeChild(f)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u2699\uFE0F"),"\u504F\u597D\u8BBE\u7F6E"),e.createElement("button",{className:"text-btn close-btn",onClick:c},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:"section-container preferences-section-container"},e.createElement("p",{className:"title-text"},"\u5E38\u89C4"),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"\u6DF1\u8272\u6A21\u5F0F"),e.createElement("img",{className:"icon-img",src:r?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:r,onChange:g}))),e.createElement("div",{className:"section-container preferences-section-container"},e.createElement("p",{className:"title-text"},"Memo \u663E\u793A\u76F8\u5173"),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"),e.createElement("img",{className:"icon-img",src:n?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:n,onChange:l})),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"),e.createElement("img",{className:"icon-img",src:t?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:t,onChange:o})),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"markdown \u683C\u5F0F\u89E3\u6790"),e.createElement("img",{className:"icon-img",src:s?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:s,onChange:N}),e.createElement("span",{className:"tip-text"},"\u76EE\u524D\u652F\u6301\u5217\u8868\u3001\u4EE3\u7801\u5757"))),e.createElement("div",{className:"section-container hidden"},e.createElement("p",{className:"title-text"},"\u5176\u4ED6"),e.createElement("div",{className:"btn-container"},e.createElement("button",{className:"btn export-btn",onClick:d},"\u5BFC\u51FA\u6570\u636E(JSON)"),e.createElement("button",{className:"btn clean-btn",onClick:h},"Memo Clean")))))};function vt(){H({className:"preferences-dialog",useAppContext:!0},wt)}const Ft=({destroy:a})=>{const{locationState:{query:{text:t,type:n}}}=i.exports.useContext($),s=i.exports.useRef(null);i.exports.useEffect(()=>{var o;(o=s.current)==null||o.focus()},[]);const r=o=>{const{type:g}=U.getState().query;o===g&&(o=""),U.setMemoTypeQuery(o)},c=o=>{const g=o.currentTarget.value;U.setTextQuery(g)},l=o=>{o.code==="Enter"&&a()};return e.createElement(e.Fragment,null,e.createElement("div",{className:"search-bar-inputer"},e.createElement("img",{className:"icon-img",src:"/icons/search.svg"}),e.createElement("input",{className:"text-input",type:"text",placeholder:"Search for memos",ref:s,value:t,onChange:c,onKeyPress:l})),e.createElement("div",{className:"special-type-selector"},e.createElement("p",{className:"title-text"},"QUICKLY FILTER"),e.createElement("div",{className:"section-container types-container"},e.createElement("span",{className:"section-text"},"Type:"),re.map((o,g)=>e.createElement("div",{key:o.type},e.createElement("span",{className:`type-item ${n===o.type?"selected":""}`,onClick:()=>{r(o.type)}},o.text),g+1<re.length?e.createElement("span",{className:"split-text"},"/"):null)))))},Se=()=>{const a="search-bar-dialog-wrapper",t=document.querySelector(`.${a}`);t&&t.parentElement?(t.classList.remove("showup"),t.classList.add("showoff"),setTimeout(()=>{t&&t.parentElement&&(t.parentElement.remove(),V.unmountComponentAtNode(t.parentElement))},se)):H({className:a,useAppContext:!0},Ft)};const kt=({visibility:a})=>{const t=()=>{vt()},n=()=>{xe()},s=()=>{L.doSignOut(),location.reload()},r=()=>{Se()};return e.createElement("div",{className:"menu-btns-popup "+(a?"":"hidden")},e.createElement("button",{className:"text-btn action-btn",onClick:Mt},e.createElement("span",{className:"icon"},"\u{1F920}")," \u6211\u7684\u8D26\u53F7"),e.createElement("button",{className:"text-btn action-btn",onClick:t},e.createElement("span",{className:"icon"},"\u2699\uFE0F")," \u504F\u597D\u8BBE\u7F6E"),e.createElement("button",{className:"text-btn action-btn",onClick:r},e.createElement("span",{className:"icon"},"\u{1F50D}")," \u641C\u7D22"),e.createElement("button",{className:"text-btn action-btn",onClick:n},e.createElement("span",{className:"icon"},"\u{1F600}")," \u5173\u4E8E"),e.createElement("button",{className:"text-btn action-btn",onClick:s},e.createElement("span",{className:"icon"},"\u{1F44B}")," \u9000\u51FA"))};const At=()=>{const{userState:{user:a},memoState:{memos:t}}=i.exports.useContext($),[n,s]=i.exports.useState({memosAmount:0,tagsAmount:0}),[r,c]=i.exports.useState(!1),l=a?a.username:"Memos",o=a?Math.ceil((Date.now()-D.getTimeStampByDate(a.createdAt))/1e3/3600/24):0;i.exports.useEffect(()=>{!L.getState().user||M.getMyDataAmount().then(h=>{s(h)}).catch(h=>{v.error(h.message)})},[t]);const g=i.exports.useCallback(h=>{h.stopPropagation();const d=!r;if(d){const m=()=>{c(!1),document.body.removeEventListener("click",m)};document.body.addEventListener("click",m)}c(d)},[r]),N=i.exports.useCallback(()=>{U.clearQuery()},[]);return e.createElement("div",{className:"user-banner-container"},e.createElement("div",{className:"userinfo-header-container"},e.createElement("p",{className:"username-text",onClick:N},l),e.createElement("button",{className:"action-btn menu-popup-btn",onClick:g}),e.createElement(kt,{visibility:r})),e.createElement("div",{className:"status-text-container"},e.createElement("div",{className:"status-text memos-text"},e.createElement("span",{className:"amount-text"},n.memosAmount),e.createElement("span",{className:"type-text"},"MEMO")),e.createElement("div",{className:"status-text tags-text"},e.createElement("span",{className:"amount-text"},n.tagsAmount),e.createElement("span",{className:"type-text"},"TAG")),e.createElement("div",{className:"status-text duration-text",onClick:()=>he()},e.createElement("span",{className:"amount-text"},o),e.createElement("span",{className:"type-text"},"DAY"))))};const Bt=()=>{const{locationState:{query:a},memoState:{memos:t}}=i.exports.useContext($),[n,s]=i.exports.useState([]),[r,c]=i.exports.useState(a.tag),l=me();return i.exports.useEffect(()=>{!L.getState().user||M.getMyTags().then(o=>{const g=o.sort((h,d)=>D.getTimeStampByDate(d.createdAt)-D.getTimeStampByDate(h.createdAt)).sort((h,d)=>d.level-h.level),N={subTags:[]};for(const h of g){const d=h.text.split("/");let m=N,y="";for(let f=0;f<d.length;f++){const p=d[f];f===0?y+=p:y+="/"+p;let u=null;for(const E of m.subTags)if(E.text===y){u=E;break}u?u.level+=h.level:(u={id:"",key:p,text:y,level:h.level,subTags:[],deep:f},m.subTags.push(u)),m.subTags.sort((E,x)=>x.level-E.level),y===h.text&&(u.id=h.id),m=u}}N.subTags.sort((h,d)=>d.level-h.level),s(N.subTags),l.setFinish()}).catch(o=>{l.setError(),v.error(o)})},[t]),i.exports.useEffect(()=>{c(a.tag);const o=document.querySelector(ae);o==null||o.classList.remove(ne)},[a]),e.createElement("div",{className:"tags-wrapper"},e.createElement("p",{className:"title-text"},"\u5E38\u7528\u6807\u7B7E"),e.createElement("div",{className:"tags-container"},l.isLoading?e.createElement(e.Fragment,null):e.createElement(e.Fragment,null,n.map((o,g)=>e.createElement(Ce,{key:o.id+"-"+g,tag:o,tagQuery:r})),e.createElement(Y,{when:n.length<5},e.createElement("p",{className:"tag-tip-container"},"\u8F93\u5165",e.createElement("span",{className:"code-text"},"# Tag "),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~")))))},Ce=a=>{const{tag:t,tagQuery:n}=a,s=n===t.text,r=t.subTags.length>0,[c,l]=le(n.includes(t.text)&&!s),o=t.id!=="";i.exports.useEffect(()=>{c||l(n.includes(t.text)&&!s)},[n,t]);const g=()=>{const d=s?"":t.text;d&&(D.copyTextToClipboard(`# ${d} `),M.polishTag(t.id).catch(()=>{})),U.setTagQuery(d)},N=d=>{o&&(d.stopPropagation(),Lt(t))},h=d=>{d.stopPropagation(),l()};return e.createElement(e.Fragment,null,e.createElement("div",{className:`tag-item-container ${s?"active":""}`,onClick:g},e.createElement("div",{className:"tag-text-container"},e.createElement("div",{className:`icon-container ${o?"rename-able":""}`,onClick:N},e.createElement("span",{className:"icon-text"},"#"),o?e.createElement("span",{className:"rename-btn"},s?e.createElement("img",{className:"icon-img",src:"/icons/edit-white.svg"}):e.createElement("img",{className:"icon-img",src:"/icons/edit.svg"})):null),e.createElement("span",{className:"tag-text"},t.key)),e.createElement("div",{className:"btns-container"},r?e.createElement("span",{className:`action-btn toggle-btn ${c?"shown":""}`,onClick:h},s?e.createElement("img",{className:"icon-img",src:"/icons/arrow-right-white.svg"}):e.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"})):null)),r?e.createElement("div",{className:`subtags-container ${c?"":"hidden"}`},t.subTags.map((d,m)=>e.createElement(Ce,{key:d.id+"-"+m,tag:d,tagQuery:n}))):null)},It=a=>{const{destroy:t,tag:n}=a,s=i.exports.useRef(null),r=()=>{t()},c=()=>{var o;const l=(o=s.current)==null?void 0:o.value;if(!l||l===n.text){t();return}M.updateTagText(n.id,l).then(()=>{M.clearMemos(),M.fetchAllMemos(),t()}).catch(()=>{})};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F3F7}\uFE0F"),"\u6807\u7B7E\u91CD\u547D\u540D"),e.createElement("button",{className:"text-btn close-btn",onClick:r},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("p",{className:"tag-text"},"\u65E7\uFF1A",n.text),e.createElement("input",{className:"text-input",type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E",ref:s}),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"btn-text cancel-btn",onClick:r},"\u53D6\u6D88"),e.createElement("span",{className:"btn-text confirm-btn",onClick:c},"\u786E\u5B9A"))))};function Lt(a){H({className:"rename-tag-dialog"},It,{tag:a})}const be={width:12,height:7},_t=()=>{const a=D.getDateStampByDate(Date.now()),t=new Date(a).getDay()||7,n=(be.width-1)*be.height+t,s=a-n*G,r=new Array(7-t).fill(0),c=()=>{const E=[];for(let x=1;x<=n;x++)E.push({timestamp:s+G*x,count:0});return E},{memoState:{memos:l}}=i.exports.useContext($),[o,g]=i.exports.useState(c()),[N,h]=i.exports.useState(null),[d,m]=i.exports.useState(null),y=i.exports.useRef(null);i.exports.useEffect(()=>{if(!L.getState().user)return;const E=c();M.getMemosStat().then(x=>{for(const b of x){const S=(D.getDateStampByDate(b.timestamp)-s)/(1e3*3600*24)-1;S>=0&&(E[S].count=b.amount)}g([...E])}).catch(x=>{v.error(x.message)})},[l.length]);const f=i.exports.useCallback((E,x)=>{h(x);const b=E.target;y.current.style.left=b.offsetLeft+"px",y.current.style.top=b.offsetTop+"px"},[]),p=i.exports.useCallback(()=>{h(null)},[]),u=i.exports.useCallback(E=>{U.getState().query.from===E.timestamp?(U.setFromAndToQuery(0,0),m(null)):E.count>0&&(U.setFromAndToQuery(E.timestamp,E.timestamp+G),m(E))},[]);return e.createElement("div",{className:"usage-heat-map-wrapper"},e.createElement("div",{className:"day-tip-text-container"},e.createElement("span",{className:"tip-text"},"Mon"),e.createElement("span",{className:"tip-text"}),e.createElement("span",{className:"tip-text"},"Wed"),e.createElement("span",{className:"tip-text"}),e.createElement("span",{className:"tip-text"},"Fri"),e.createElement("span",{className:"tip-text"}),e.createElement("span",{className:"tip-text"},"Sun")),e.createElement("div",{ref:y,className:"usage-detail-container pop-up "+(N?"":"hidden")},N==null?void 0:N.count," memos on ",e.createElement("span",{className:"date-text"},new Date(N==null?void 0:N.timestamp).toDateString())),e.createElement("div",{className:"usage-heat-map"},o.map((E,x)=>{const b=E.count,S=b<=0?"":b<=1?"stat-day-L1-bg":b<=2?"stat-day-L2-bg":b<=4?"stat-day-L3-bg":"stat-day-L4-bg";return e.createElement("span",{className:"stat-container "+S+(d===E?" current":" "),key:x,onMouseEnter:A=>f(A,E),onMouseLeave:p,onClick:()=>u(E)})}),r.map((E,x)=>e.createElement("span",{className:"stat-container null",key:x}))))};const Ut=()=>{i.exports.useEffect(()=>{},[]);const a=i.exports.useCallback(t=>{if(t.target.className==="sidebar-wrapper"){const s=document.querySelector(ae);s==null||s.classList.remove(ne)}},[]);return e.createElement("div",{className:"sidebar-wrapper",onClick:a},e.createElement(At,null),e.createElement(_t,null),e.createElement(Bt,null))},Ot=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function De(a,t){return t.minLength!==void 0&&a.length<t.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:t.maxLength!==void 0&&a.length>t.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:t.noSpace&&a.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:t.noChinese&&Ot.test(a)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const Me={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},Pt=({destroy:a})=>{const[t,n]=i.exports.useState(""),[s,r]=i.exports.useState(""),c=i.exports.useRef(null);i.exports.useEffect(()=>{const h=d=>{var m;d.key==="Enter"&&((m=c.current)==null||m.click())};return document.body.addEventListener("keypress",h),()=>{document.body.removeEventListener("keypress",h)}},[]);const l=h=>{const d=h.target.value;n(d)},o=h=>{const d=h.target.value;r(d)},g=()=>{xe()},N=async()=>{const h=De(t,Me);if(!h.result){v.error("\u7528\u6237\u540D "+h.reason);return}const d=De(s,Me);if(!d.result){v.error("\u5BC6\u7801 "+d.reason);return}try{const m=F.signin,{succeed:y,message:f}=await m(t,s);if(!y&&f){v.error("\u{1F61F} "+f);return}await L.doSignIn()?(M.fetchMoreMemos().catch(()=>{}),a()):v.error("\u{1F61F} \u4E0D\u77E5\u9053\u53D1\u751F\u4E86\u4EC0\u4E48\u9519\u8BEF")}catch(m){console.error(m),v.error("\u{1F61F} "+m.message)}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F44B}")," \u8D26\u53F7\u6CE8\u518C / \u767B\u5F55")),e.createElement("div",{className:"dialog-content-container"},e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"text",value:t,onChange:l}),e.createElement("span",{className:"normal-text "+(t===""?"":"not-null")},"\u8D26\u53F7")),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:s,onChange:o}),e.createElement("span",{className:"normal-text "+(s===""?"":"not-null")},"\u5BC6\u7801"))),e.createElement("div",{className:"dialog-footer-container"},e.createElement("div",{className:"btns-container"},e.createElement("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist"},"Sign In with GitHub")),e.createElement("div",{className:"btns-container"},e.createElement("button",{className:"text-btn signup-btn disabled",onClick:()=>v.info("\u6CE8\u518C\u5DF2\u5173\u95ED")},"\u6CE8\u518C"),e.createElement("span",{className:"split-text"},"/"),e.createElement("button",{className:"text-btn signin-btn",ref:c,onClick:N},"\u767B\u5F55"))),e.createElement("p",{className:"tip-text"},"\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\uFF0C\u53EF\u8F93\u5165 ",e.createElement("code",null,"guest, 123456")," \u8FDB\u884C\u4F53\u9A8C\u3002",e.createElement("br",null),e.createElement("span",{className:"text-btn",onClick:g},e.createElement("span",{className:"icon-text"},"\u{1F600}"),"\u5173\u4E8E\u672C\u7AD9")))};function Rt(){H({className:"signin-dialog",clickSpaceDestroy:!1},Pt)}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(a,t){return Object.prototype.toString.call(a).toLowerCase()==="[object regexp]"?this.replace(a,t):this.replace(new RegExp(a,"g"),t)})})();function $t(){const{globalState:{showDarkMode:a}}=i.exports.useContext($),t=me();return i.exports.useEffect(()=>{L.doSignIn().catch(()=>{}).finally(()=>{L.getState().user?M.fetchMoreMemos():Rt(),t.setFinish()});const n=s=>{if(!L.getState().user)return;const{ctrlKey:r,metaKey:c,code:l}=s;(r||c)&&l==="KeyP"&&(s.preventDefault(),Se())};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[]),i.exports.useEffect(()=>{a?document.body.classList.add("dark"):document.body.classList.remove("dark")},[a]),e.createElement(e.Fragment,null,e.createElement("div",{id:"page-container"},e.createElement(Ut,null),e.createElement("div",{className:"content-wrapper"},e.createElement(Ke,null),e.createElement(st,null),t.isLoading?null:e.createElement(xt,null))))}V.render(e.createElement(de,{store:w,context:$},e.createElement($t,null)),document.getElementById("root"));
