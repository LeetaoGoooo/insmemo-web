var we=Object.defineProperty,De=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var te=(a,t,n)=>t in a?we(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,D=(a,t)=>{for(var n in t||(t={}))Te.call(t,n)&&te(a,n,t[n]);if(me)for(var n of me(t))Fe.call(t,n)&&te(a,n,t[n]);return a},k=(a,t)=>De(a,ve(t));var U=(a,t,n)=>(te(a,typeof t!="symbol"?t+"":t,n),n);import{r as u,R as e,a as Q}from"./vendor.4f50e650.js";const ke=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}};ke();const ie=a=>{const{children:t,store:n,context:s}=a,[r,l]=u.exports.useState(n.getState());return u.exports.useEffect(()=>{const m=n.subscribe(o=>{l(o)});return()=>{m()}},[]),e.createElement(s.Provider,{value:r},t)};function Ae(a){const t=Object.keys(a),n={};for(const s of t)typeof a[s]=="function"&&(n[s]=a[s]);return(s={},r)=>{let l=!1;const m={};for(const o of t){const f=s[o],p=n[o](f,r);m[o]=p,l=l||p!==f}return l?m:s}}function Be(a,t){const n=[];let s=a;return{dispatch:o=>{const f=t(s,o),p=s;s=f;for(const g of n)g(s,p)},getState:()=>s,subscribe:o=>{let f=!0;return n.push(o),()=>{if(!f)return;const p=n.indexOf(o);n.splice(p,1),f=!1}}}}function Ie(a,t){switch(t.type){case"SET_MARK_MEMO_ID":return k(D({},a),{markMemoId:t.payload.markMemoId});case"SET_EDIT_MEMO_ID":return k(D({},a),{editMemoId:t.payload.editMemoId});case"SET_APP_SETTING":return D(D({},a),t.payload);default:return a}}const Le={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,showDarkMode:!1};function _e(a,t){switch(t.type){case"SET_TAG_QUERY":return k(D({},a),{query:k(D({},a.query),{tag:t.payload.tag})});case"SET_FROM_TO_QUERY":return k(D({},a),{query:k(D({},a.query),{from:t.payload.from,to:t.payload.to})});case"SET_TYPE":return k(D({},a),{query:k(D({},a.query),{type:t.payload.type})});case"SET_TEXT":return k(D({},a),{query:k(D({},a.query),{text:t.payload.text})});case"SET_HASH":return k(D({},a),{hash:t.payload.hash});default:return a}}const Ue={hash:"",query:{tag:"",from:0,to:0,type:"",text:""}};var M;(function(a){function t(){return Date.now()}a.getNowTimeStamp=t;function n(){const d=navigator.appVersion;let i="Unknown";return d.indexOf("Win")!=-1?i="Windows":d.indexOf("Mac")!=-1?i="MacOS":d.indexOf("Linux")!=-1&&(i="Linux"),i}a.getOSVersion=n;function s(d){return typeof d=="string"&&(d=d.replaceAll("-","/")),new Date(d).getTime()}a.getTimeStampByDate=s;function r(d){const i=new Date(s(d));return new Date(i.getFullYear(),i.getMonth(),i.getDate()).getTime()}a.getDateStampByDate=r;function l(d){const i=new Date(s(d)),y=i.getFullYear(),S=i.getMonth()+1,C=i.getDate();return`${y}/${S}/${C}`}a.getDateString=l;function m(d){const i=new Date(s(d)),y=i.getFullYear(),S=i.getMonth()+1,C=i.getDate(),A=i.getHours(),_=i.getMinutes(),q=i.getSeconds(),z=S<10?"0"+S:S,X=C<10?"0"+C:C,J=A<10?"0"+A:A,Z=_<10?"0"+_:_,b=q<10?"0"+q:q;return`${y}-${z}-${X} ${J}:${Z}:${b}`}a.getTimeStampString=m;function o(d){const i=new Date(s(d)),y=i.getHours(),S=i.getMinutes(),C=y<10?"0"+y:y,A=S<10?"0"+S:S;return`${C}:${A}`}a.getTimeString=o;function f(d){return Array.from(new Set(d))}a.dedupe=f;function p(d){const i=new Set,y=[];for(const S of d)i.has(S.id)||(i.add(S.id),y.push(S));return y}a.dedupeObjectWithId=p;function g(d,i){let y=null;return()=>{y&&clearTimeout(y),y=setTimeout(d,i)}}a.debounce=g;function E(d,i){let y=!0;return()=>{if(!y)return!1;y=!1,setTimeout(()=>{d(),y=!0},i)}}a.throttle=E;function c(d){const i=[],y=Object.keys(d),S=Object.values(d);for(let C=0;C<y.length;++C)S[C]&&i.push(`${y[C]}=${S[C]}`);return i.join("&")}a.iterObjectToParamsString=c;async function N(d){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(d)}catch(i){console.warn("Copy to clipboard failed.",i)}else console.warn("Copy to clipboard failed, methods not supports.")}a.copyTextToClipboard=N;function h(d){const i=document.createElement("div");return i.innerHTML=d,i.innerText}a.parseHTMLToRawString=h;function x(d){return new Promise((i,y)=>{const S=new Image;S.onload=()=>{const{width:C,height:A}=S;C>0&&A>0?i({width:C,height:A}):i({width:0,height:0})},S.onerror=()=>{i({width:0,height:0})},S.className="hidden",S.src=d,document.body.appendChild(S),S.remove()})}a.getImageSize=x})(M||(M={}));function Oe(a,t){switch(t.type){case"SET_MEMOS":return{memos:[...t.payload.memos]};case"PUSH_MEMO":return{memos:[t.payload.memo,...a.memos].sort((s,r)=>M.getTimeStampByDate(r.createdAt)-M.getTimeStampByDate(s.createdAt))};case"PUSH_MEMOS":return{memos:[...t.payload.memos,...a.memos].sort((s,r)=>M.getTimeStampByDate(r.createdAt)-M.getTimeStampByDate(s.createdAt))};case"DELETE_MEMO_BY_ID":return{memos:[...a.memos].filter(n=>n.id!==t.payload.id)};case"EDIT_MEMO":return{memos:a.memos.map(s=>s.id===t.payload.id?D(D({},s),t.payload):s)};default:return a}}const Pe={memos:[]};function Re(a,t){switch(t.type){case"SIGN_IN":return{user:t.payload.user};case"SIGN_OUT":return{user:null};default:return a}}const $e={user:null},T=Be({globalState:Le,locationState:Ue,memoState:Pe,userState:$e},Ae({globalState:Ie,locationState:_e,memoState:Oe,userState:Re})),P=u.exports.createContext(T.getState());var G;(function(a){function t(r){const l={};for(const m of r)try{const o=localStorage.getItem(m);if(o!==null){const f=JSON.parse(o);l[m]=f}}catch(o){console.error("Get storage failed in ",m,o)}return l}a.get=t;function n(r){for(const l in r)try{const m=JSON.stringify(r[l]);localStorage.setItem(l,m)}catch(m){console.error("Save storage failed in ",l,m)}}a.set=n;function s(){var l;const r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r),(l=r.contentWindow)==null||l.localStorage.setItem("t",Date.now().toString()),r.remove()}a.emitStorageChangedEvent=s})(G||(G={}));class He{constructor(){U(this,"getState",()=>T.getState().globalState);U(this,"setEditMemoId",t=>{T.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:t}})});U(this,"setMarkMemoId",t=>{T.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:t}})});U(this,"setAppSetting",t=>{T.dispatch({type:"SET_APP_SETTING",payload:t}),G.set(t)});var s,r,l,m;const t=G.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser","showDarkMode"]),n={shouldSplitMemoWord:(s=t.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(r=t.shouldHideImageUrl)!=null?r:!0,shouldUseMarkdownParser:(l=t.shouldUseMarkdownParser)!=null?l:!0,showDarkMode:(m=t.showDarkMode)!=null?m:!1};this.setAppSetting(n)}}const O=new He,Y=()=>{let a=M.iterObjectToParamsString(T.getState().locationState.query);a?a="?"+a:a="",history.replaceState(null,"","/"+a)};class Qe{constructor(){U(this,"initLocation",()=>{var n,s,r,l,m;const t=new URLSearchParams(window.location.search);this.setTagQuery((n=t.get("tag"))!=null?n:""),this.setFromAndToQuery(parseInt((s=t.get("from"))!=null?s:"0"),parseInt((r=t.get("to"))!=null?r:"0")),this.setMemoTypeQuery((l=t.get("type"))!=null?l:""),this.setTextQuery((m=t.get("text"))!=null?m:"")});U(this,"getState",()=>T.getState().locationState);U(this,"clearQuery",()=>{T.dispatch({type:"SET_TAG_QUERY",payload:{tag:""}}),T.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:0,to:0}}),Y()});U(this,"setHash",t=>{T.dispatch({type:"SET_HASH",payload:{hash:t}}),Y()});U(this,"setMemoTypeQuery",(t="")=>{T.dispatch({type:"SET_TYPE",payload:{type:t}}),Y()});U(this,"setTextQuery",t=>{T.dispatch({type:"SET_TEXT",payload:{text:t}}),Y()});U(this,"setTagQuery",t=>{T.dispatch({type:"SET_TAG_QUERY",payload:{tag:t}}),Y()});U(this,"setFromAndToQuery",(t,n)=>{T.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:t,to:n}}),Y()});this.initLocation()}}const L=new Qe;var F;(function(a){async function t(b){const K=await(await fetch(b,{method:"GET"})).json();if(!K.succeed)throw K;return K}a.get=t;async function n(b,I){const ee=await(await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)})).json();if(!ee.succeed)throw ee;return ee}a.post=n;function s(){return t("/api/user/me")}a.getUserInfo=s;function r(b,I){return n("/api/user/signin",{username:b,password:I})}a.signin=r;function l(b,I){return n("/api/user/signup",{username:b,password:I})}a.signup=l;function m(){return n("/api/user/signout")}a.signout=m;function o(b){return t("/api/user/checkusername?username="+b)}a.checkUsernameUsable=o;function f(b){return n("/api/user/checkpassword",{password:b})}a.checkPasswordValid=f;function p(b="",I=""){return n("/api/user/update",{username:b,password:I})}a.updateUserinfo=p;function g(b=0,I=20){return t(`/api/memo/all?offset=${b}&amount=${I}`)}a.getMyMemos=g;function E(b){return n("/api/memo/new",{content:b})}a.createMemo=E;function c(b){return t("/api/memo/?id="+b)}a.getMemoById=c;function N(b){return n("/api/memo/delete",{memoId:b})}a.deleteMemo=N;function h(b,I){return n("/api/memo/update",{memoId:b,content:I})}a.updateMemo=h;function x(){return t("/api/memo/count")}a.getMemosCount=x;function d(b){return n("/api/tag/new",{text:b})}a.createTag=d;function i(b,I){return n("/api/tag/link",{memoId:b,tagId:I})}a.createMemoTag=i;function y(b,I){return n("/api/tag/rmlink",{memoId:b,tagId:I})}a.removeMemoTag=y;function S(b){return t("/api/tag/memo?id="+b)}a.getTagsByMemoId=S;function C(){return t("/api/tag/all")}a.getMyTags=C;function A(b){return n("/api/tag/delete",{tagId:b})}a.deleteTagById=A;function _(b){return n("/api/tag/polish",{tagId:b})}a.polishTag=_;function q(b,I){return n("/api/tag/update",{id:b,text:I})}a.updateTagText=q;function z(){return t("/api/user/amount")}a.getMyDataAmount=z;function X(b){return t("/api/base/srctype?url="+b)}a.getUrlContentType=X;function J(){return t("/api/memo/stat")}a.getMemosStat=J;function Z(){return n("/api/user/updategh",{githubName:""})}a.removeGithubName=Z})(F||(F={}));const ae="div#page-container",ne="mobile-show-sidebar",Ge=20,se=200,Ye=400,$=3600*24*1e3,W=/#\s(.+?)\s/g,ue=/(https?:\/\/[^\s<\\*>']+)/g,j=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,de=/\[@(.+?)\]\((.+?)\)/g,re=[{type:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{type:"LINKED",text:"\u6709\u94FE\u63A5"},{type:"IMAGED",text:"\u6709\u56FE\u7247"}];class je{getState(){return T.getState().userState}async doSignIn(){const{data:t}=await F.getUserInfo();return t?T.dispatch({type:"SIGN_IN",payload:{user:t}}):B.doSignOut(),t}async doSignOut(){F.signout().catch(()=>{}),T.dispatch({type:"SIGN_OUT",payload:{user:null}})}async checkUsernameUsable(t){const{data:n}=await F.checkUsernameUsable(t);return n}async updateUsername(t){await F.updateUserinfo(t)}async removeGithubName(){await F.removeGithubName()}async checkPasswordValid(t){const{data:n}=await F.checkPasswordValid(t);return n}async updatePassword(t){await F.updateUserinfo("",t)}}const B=new je;class qe{constructor(){U(this,"isFetching",!1)}getState(){return T.getState().memoState}async fetchMoreMemos(){if(!B.getState().user||this.isFetching)return!1;this.isFetching=!0;const{data:t}=await F.getMyMemos(this.getState().memos.length,Ge),n=t.map(s=>D({},s));return T.dispatch({type:"PUSH_MEMOS",payload:{memos:n}}),this.isFetching=!1,n}async fetchAllMemos(){if(!B.getState().user||this.isFetching)return!1;this.isFetching=!0;const{data:{memosAmount:t}}=await F.getMyDataAmount(),{data:n}=await F.getMyMemos(this.getState().memos.length,t),s=n.map(r=>D({},r));s.length>0&&T.dispatch({type:"PUSH_MEMOS",payload:{memos:s}}),this.isFetching=!1}pushMemo(t){T.dispatch({type:"PUSH_MEMO",payload:{memo:D({},t)}})}async getMemoById(t){for(const s of this.getState().memos)if(s.id===t)return s;const{data:n}=await F.getMemoById(t);return n}async deleteMemoById(t){await F.deleteMemo(t),T.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:t}})}editMemo(t){T.dispatch({type:"EDIT_MEMO",payload:t})}clearMemos(){T.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(t){const{data:n}=await F.createMemo(t);return n}async updateMemo(t,n){const{data:s}=await F.updateMemo(t,n);return s}async createTag(t){const{data:n}=await F.createTag(t);return n}async removeMemoTag(t,n){await F.removeMemoTag(t,n)}async createMemoTag(t,n){await F.createMemoTag(t,n)}async getMyDataAmount(){const{data:t}=await F.getMyDataAmount();return t}async getMemosStat(){const{data:t}=await F.getMemosStat();return t}async getMyTags(){if(!B.getState().user)return[];const{data:t}=await F.getMyTags();return t}async polishTag(t){await F.polishTag(t)}async updateTagText(t,n){await F.updateTagText(t,n)}}const w=new qe,Ve=()=>{const{userState:{user:a}}=u.exports.useContext(P),t=a?a.username:"Memos",n=u.exports.useCallback(()=>{L.clearQuery()},[]),s=u.exports.useCallback(()=>{const r=document.querySelector(ae);r&&r.classList.add(ne)},[]);return e.createElement("div",{className:"mobile-header-container"},e.createElement("p",{className:"username-text",onClick:n},t),e.createElement("div",{className:"btns-container"},e.createElement("button",{className:"action-btn show-sidebar",onClick:s},e.createElement("img",{className:"icon-img",src:"/icons/fold.svg",alt:"fold"}))))};const Ke=a=>{const{destory:t,duration:n}=a;return u.exports.useEffect(()=>{n>0&&setTimeout(()=>{t()},n)},[]),e.createElement("div",{className:"toast-container",onClick:t},e.createElement("p",{className:"content-text"},a.content))},v=(()=>{const a=document.createElement("div");a.className="toast-list-container",document.body.appendChild(a);let t=0;const n=[],s=m=>{const o=document.createElement("div");o.className=`toast-wrapper ${m.type}`,a.appendChild(o),t++,n.push(o),setTimeout(()=>{o.classList.add("showup")},0);const f={destory:()=>{o.classList.add("destory"),setTimeout(()=>{if(!!o.parentElement&&(t--,t===0)){for(const p of n)Q.unmountComponentAtNode(p),p.remove();n.splice(0,n.length)}},Ye)}};return Q.render(e.createElement(Ke,k(D({},m),{destory:f.destory})),o),f};return{info:(m,o=3e3)=>s({type:"normal",content:m,duration:o}),error:(m,o=3e3)=>s({type:"error",content:m,duration:o})}})(),We=a=>{const{children:t,when:n}=a;return n?e.createElement(e.Fragment,null,t):null},H=We;const ze={className:"",content:"",placeholder:"",showConfirmBtn:!0,showCancelBtn:!1,showTools:!1},Xe=(a=ze)=>{const{className:t,content:n,placeholder:s,showConfirmBtn:r,showCancelBtn:l,showTools:m,handleConfirmBtnClick:o,handleCancelBtnClick:f,handleContentChange:p}=a,[g,E]=u.exports.useState(n),c=u.exports.useRef(null);u.exports.useEffect(()=>{g&&c.current&&(c.current.innerHTML=g)},[]),u.exports.useImperativeHandle(a.editorRef,()=>({focus:()=>{var y;(y=c.current)==null||y.focus()},insertText:y=>{const S=g+y;E(S),c.current&&(c.current.innerHTML=S),p&&p(S)},setContent:y=>{const S=y;E(S),c.current&&(c.current.innerHTML=S)},getContent:()=>g}));const N=u.exports.useCallback(y=>{const S=y.clipboardData.getData("text"),C=window.getSelection();!C||!C.rangeCount||(C.deleteFromDocument(),C.getRangeAt(0).insertNode(document.createTextNode(S)),y.preventDefault(),E(S),p&&p(S))},[]),h=u.exports.useCallback(y=>{const S=y.currentTarget.innerHTML;E(S),p&&p(S)},[]),x=u.exports.useCallback(y=>{if(y.stopPropagation(),y.key==="Tab"){y.preventDefault();const S=window.getSelection();if(!S||!S.rangeCount)return;S.deleteFromDocument();const C=S.getRangeAt(0),A=document.createTextNode("    ");C.insertNode(A),C.setEndAfter(A),C.setStartAfter(A),S.removeAllRanges(),S.addRange(C)}else if(y.key==="Backspace")c.current&&c.current.innerHTML==="<br>"&&(c.current.innerHTML="",E(""));else if(y.key==="Enter"){y.preventDefault();const S=window.getSelection();if(!S||!S.rangeCount)return;S.deleteFromDocument();const C=S.getRangeAt(0),A=document.createElement("p"),_=document.createElement("br");A.appendChild(_),C.insertNode(A),C.setEndAfter(_),C.setStartAfter(_),S.removeAllRanges(),S.addRange(C)}},[]),d=u.exports.useCallback(()=>{o&&(o(g),c.current&&(c.current.innerHTML=""),E(""))},[g]),i=u.exports.useCallback(()=>{f&&f()},[]);return e.createElement("div",{className:"common-editor-wrapper "+t},e.createElement("div",{className:"common-editor-inputer",contentEditable:!0,ref:c,onPaste:N,onInput:h,onKeyDown:x}),e.createElement("p",{className:g===""?"common-editor-placeholder":"hidden"},s),e.createElement("div",{className:"common-tools-wrapper"},e.createElement(H,{when:m},e.createElement("div",{className:"common-tools-container"})),e.createElement("div",{className:"btns-right-container"},e.createElement(H,{when:l},e.createElement("button",{className:"action-btn cancel-btn",onClick:i},"\u64A4\u9500\u4FEE\u6539")),e.createElement(H,{when:r},e.createElement("button",{className:"action-btn confirm-btn",disabled:g.length===0,onClick:d},"\u8BB0\u4E0B",e.createElement("span",{className:"icon-text"},"\u270D\uFE0F"))))))};var Je=u.exports.forwardRef(Xe);const Ze=()=>{const{globalState:a,locationState:{query:t}}=u.exports.useContext(P),n=e.useRef(null),[s,r]=u.exports.useState(a.editMemoId);u.exports.useEffect(()=>{var p;if(a.markMemoId){const g=`Mark: [@MEMO](${a.markMemoId})`;(p=n.current)==null||p.insertText(`<p>${g}</p>`)}a.editMemoId!==s&&(r(a.editMemoId),a.editMemoId&&w.getMemoById(a.editMemoId).then(g=>{var E,c,N;g&&((c=n.current)==null||c.setContent((E=g.content)!=null?E:""),(N=n.current)==null||N.focus())}))},[a]);const l=async p=>{var c,N;if(p===""){v.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}p=p.replaceAll("&nbsp;"," ");const g=M.dedupe(Array.from((c=p.match(W))!=null?c:[])).map(h=>h.replace(W,"$1").trim()),E=[];try{for(const h of g){if(h.length>36)throw new Error("\u6807\u7B7E\u592A\u957F\u4E86");const x=await w.createTag(h);E.push(x)}if(s){const h=await w.getMemoById(s);if(h&&h.content!==p){const x=(N=h.tags)!=null?N:[],d=x.map(y=>y.text);E.push(...x);for(let y=0;y<E.length;){const S=E[y],C=S.text;g.includes(C)?(y++,d.includes(C)||await w.createMemoTag(h.id,S.id)):(E.splice(y,1),await w.removeMemoTag(h.id,S.id))}const i=await w.updateMemo(h.id,p);h.content=i.content,h.tags=E,h.updatedAt=M.getTimeStampString(Date.now()),w.editMemo(h)}O.setEditMemoId("")}else{const h=await w.createMemo(p);h.tags=E;for(const d of E)await w.createMemoTag(h.id,d.id);const x=t.tag;x!==""&&!g.includes(x)&&L.setTagQuery(""),w.pushMemo(h)}}catch(h){v.error(h.message)}oe("")},m=u.exports.useCallback(()=>{var p;O.setEditMemoId(""),(p=n.current)==null||p.setContent(""),oe("")},[]),o=u.exports.useCallback(async p=>{const g=document.createElement("div");g.innerHTML=p,g.innerText.trim()===""&&(p=""),oe(p)},[s]),f=u.exports.useMemo(()=>({className:"memo-editor",content:et(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,handleConfirmBtnClick:l,showCancelBtn:s!=="",handleCancelBtnClick:m,showTools:!0,handleContentChange:o,editorRef:n}),[s]);return e.createElement("div",{className:"memo-editor-wrapper "+(s?"edit-ing":"")},e.createElement("p",{className:"tip-text "+(s?"":"hidden")},"\u6B63\u5728\u4FEE\u6539\u4E2D..."),e.createElement(Je,D({},f)))};function et(){var a;return(a=G.get(["editorContentCache"]).editorContentCache)!=null?a:""}function oe(a){G.set({editorContentCache:a})}function tt(a,t,n=[]){const s=u.exports.useRef(),r=u.exports.useCallback(()=>{s.current&&clearTimeout(s.current)},[]);return u.exports.useCallback((...m)=>{r(),s.current=window.setTimeout(()=>{a(...m)},t)},n)}const at=/```([\s\S]*?)```/g,nt=/[*] /g,st=/(\d+)\. /g,rt=a=>a.replace(at,"<pre lang=''>$1</pre>").replace(nt,"<span class='counter-text'>\u2022</span>").replace(st,"<span class='counter-text'>$1.</span>");function ce(a=!1){const[t,n]=u.exports.useState(a),s=u.exports.useCallback(r=>{n(r!==void 0?r:l=>!l)},[]);return[t,s]}const ot=a=>{const{children:t,className:n,clickSpaceDestroy:s,destroy:r}=a,l=()=>{s&&r()};return e.createElement("div",{className:`dialog-wrapper ${n}`,onClick:l},e.createElement("div",{className:"dialog-container",onClick:m=>m.stopPropagation()},t))};function R(a,t,n){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var o;(o=s.firstElementChild)==null||o.classList.add("showup")},0);const r={destroy:()=>{var o,f;(o=s.firstElementChild)==null||o.classList.remove("showup"),(f=s.firstElementChild)==null||f.classList.add("showoff"),setTimeout(()=>{s.remove(),Q.unmountComponentAtNode(s)},se)}},l=k(D({},n),{destroy:r.destroy});let m=e.createElement(ot,D({destroy:r.destroy,clickSpaceDestroy:!0},a),e.createElement(t,D({},l)));return a.useAppContext&&(m=e.createElement(ie,{store:T,context:P},m)),Q.render(m,s),r}const ct=({destroy:a,imgUrl:t})=>{const n=u.exports.useRef(null),[s,r]=u.exports.useState(-1);u.exports.useEffect(()=>{M.getImageSize(t).then(({width:f})=>{r(f!==0?80:0)})},[]);const l=()=>{a()},m=()=>{s>30&&r(s-10)},o=()=>{r(s+10)};return e.createElement(e.Fragment,null,e.createElement("button",{className:"text-btn close-btn",onClick:l},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"})),e.createElement("div",{className:"img-container"},e.createElement("img",{className:s<=0?"hidden":"",ref:n,width:s+"%",src:t}),e.createElement("span",{className:"loading-text "+(s===-1?"":"hidden")},"\u56FE\u7247\u52A0\u8F7D\u4E2D..."),e.createElement("span",{className:"loading-text "+(s===0?"":"hidden")},"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5")),e.createElement("div",{className:"action-btns-container"},e.createElement("button",{className:"text-btn",onClick:m},"\u2796"),e.createElement("button",{className:"text-btn",onClick:o},"\u2795"),e.createElement("button",{className:"text-btn",onClick:()=>r(80)},"\u2B55")))};function pe(a){R({className:"preview-image-dialog"},ct,{imgUrl:a})}const ge=a=>{const{className:t,imgUrl:n}=a,s=()=>{pe(n)};return e.createElement("div",{className:"image-container "+t,onClick:s},e.createElement("img",{src:n,decoding:"async",loading:"lazy"}))};function Ee(){const[a,t]=u.exports.useState({isLoading:!0,isFailed:!1,isSucceed:!1});return k(D({},a),{setLoading:()=>{t(k(D({},a),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{t(k(D({},a),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{t(k(D({},a),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const lt=a=>{var r;const{memo:t}=a,n=k(D({},t),{formattedContent:V(t.content),createdAtStr:M.getTimeStampString(t.createdAt),timeStr:M.getTimeString(t.createdAt)}),s=Array.from((r=n.content.match(j))!=null?r:[]);return e.createElement("div",{className:"daily-memo-wrapper"},e.createElement("div",{className:"time-wrapper"},e.createElement("span",{className:"normal-text"},n.timeStr)),e.createElement("div",{className:"memo-content-container"},e.createElement("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:n.formattedContent}}),e.createElement(H,{when:s.length>0},e.createElement("div",{className:"images-container"},s.map((l,m)=>e.createElement("img",{key:m,crossOrigin:"anonymous",src:l,decoding:"async"}))))))};const mt=a=>{const{className:t,datestamp:n,handleDateStampChange:s}=a,[r,l]=u.exports.useState(le(n));u.exports.useEffect(()=>{l(le(n))},[n]);const m=new Date(r),o=m.getDay()===0?7:m.getDay(),f=[];for(let c=1;c<o;c++)f.push({date:0,datestamp:m.getTime()-$*(7-c)});const p=it(r);for(let c=1;c<=p;c++)f.push({date:c,datestamp:m.getTime()+$*(c-1)});const g=c=>{s(c)},E=c=>{const N=m.getFullYear(),h=m.getMonth()+1;let x=0;h===1&&c===-1?x=new Date(`${N-1}/12/1`).getTime():h===12&&c===1?x=new Date(`${N+1}/1/1`).getTime():x=new Date(`${N}/${h+c}/1`).getTime(),l(le(x))};return e.createElement("div",{className:`date-picker-wrapper ${t}`},e.createElement("div",{className:"date-picker-header"},e.createElement("span",{className:"btn-text",onClick:()=>E(-1)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-left.svg"})),e.createElement("span",{className:"normal-text"},m.getFullYear()," \u5E74 ",m.getMonth()+1," \u6708"),e.createElement("span",{className:"btn-text",onClick:()=>E(1)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"}))),e.createElement("div",{className:"date-picker-day-container"},e.createElement("div",{className:"date-picker-day-header"},e.createElement("span",{className:"day-item"},"\u5468\u4E00"),e.createElement("span",{className:"day-item"},"\u5468\u4E8C"),e.createElement("span",{className:"day-item"},"\u5468\u4E09"),e.createElement("span",{className:"day-item"},"\u5468\u56DB"),e.createElement("span",{className:"day-item"},"\u5468\u4E94"),e.createElement("span",{className:"day-item"},"\u5468\u516D"),e.createElement("span",{className:"day-item"},"\u5468\u65E5")),f.map(c=>c.date===0?e.createElement("span",{key:c.datestamp,className:"day-item null"},""):e.createElement("span",{key:c.datestamp,className:`day-item ${c.datestamp===n?"current":""}`,onClick:()=>g(c.datestamp)},c.date))))};function it(a){const t=new Date(a),n=new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`);return((n.getMonth()===11?new Date(`${n.getFullYear()+1}/1`):new Date(`${n.getFullYear()}/${n.getMonth()+2}/1`)).getTime()-n.getTime())/$}function le(a){const t=new Date(a);return new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`).getTime()}const ut=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],dt=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],pt=a=>{const t=Ee(),[n,s]=u.exports.useState([]),[r,l]=u.exports.useState(M.getDateStampByDate(M.getDateString(a.currentDateStamp))),[m,o]=ce(!1),f=u.exports.useRef(null),p=new Date(r);u.exports.useEffect(()=>{const c=()=>{const x=w.getState().memos.filter(d=>M.getTimeStampByDate(d.createdAt)>=r&&M.getTimeStampByDate(d.createdAt)<r+$).sort((d,i)=>M.getTimeStampByDate(d.createdAt)-M.getTimeStampByDate(i.createdAt));s(x),t.setFinish()},{memos:N}=w.getState(),h=N.slice(-1).pop();h&&M.getTimeStampByDate(h.createdAt)>=r?(t.setLoading(),w.fetchAllMemos().then(()=>{c()}).catch(x=>{v.error(x.message)})):c()},[r]);const g=()=>{o(!1),setTimeout(()=>{const c=M.getOSVersion();(c==="MacOS"||c==="Unknown")&&window.scrollTo(0,0),f.current&&html2canvas(f.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:O.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(N=>{pe(N.toDataURL())})},0)},E=c=>{l(c),o(!1)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("div",{className:"btns-wrapper"},e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"btn-text",onClick:()=>l(r-$)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-left.svg"})),e.createElement("span",{className:"btn-text",onClick:()=>l(r+$)},e.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"}))),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"btn-text",onClick:g},e.createElement("img",{className:"icon-img",src:"/icons/share.svg"})),e.createElement("span",{className:"btn-text",onClick:()=>a.destroy()},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))))),e.createElement("div",{className:"dialog-content-container",ref:f},e.createElement("div",{className:"date-card-container",onClick:()=>o()},e.createElement("div",{className:"year-text"},p.getFullYear()),e.createElement("div",{className:"date-container"},e.createElement("div",{className:"month-text"},ut[p.getMonth()]),e.createElement("div",{className:"date-text"},p.getDate()),e.createElement("div",{className:"day-text"},dt[p.getDay()]))),e.createElement(mt,{className:`date-picker ${m?"":"hide"}`,datestamp:r,handleDateStampChange:E}),t.isLoading?e.createElement("div",{className:"tip-container"},e.createElement("p",{className:"tip-text"},"\u52AA\u529B\u52A0\u8F7D\u4E2D...")):n.length===0?e.createElement("div",{className:"tip-container"},e.createElement("p",{className:"tip-text"},"\u7A7A\u7A7A\u5982\u4E5F")):e.createElement("div",{className:"dailymemos-wrapper"},n.map(c=>e.createElement(lt,{key:`${c.id}-${c.updatedAt}`,memo:c})))))};function fe(a=Date.now()){R({className:"daily-memo-diary-dialog"},pt,{currentDateStamp:a})}const gt=a=>{var N;const{memo:t,destroy:n}=a,[s,r]=u.exports.useState(""),l=u.exports.useRef(null),{user:m}=B.getState(),o=k(D({},t),{formattedContent:V(t.content),createdAtStr:M.getTimeStampString(t.createdAt)}),f=Array.from((N=o.content.match(j))!=null?N:[]),[p,g]=u.exports.useState(f.length);u.exports.useEffect(()=>{const h=l.current;setTimeout(()=>{if(p===0){const x=M.getOSVersion();(x==="MacOS"||x==="Unknown")&&window.scrollTo(0,0),h&&html2canvas(h,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:O.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(d=>{r(d.toDataURL())})}},se+100)},[p]);const E=()=>{n()},c=h=>{h.type==="error"&&(v.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),h.target.remove()),g(p-1)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F970}"),"\u5206\u4EAB Memo \u56FE\u7247"),e.createElement("button",{className:"text-btn close-btn",onClick:E},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:`tip-words-container ${s?"finished":"genarating"}`},e.createElement("p",{className:"tip-text"},s?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D...")),e.createElement("img",{className:"memo-img",src:s}),e.createElement("div",{className:"memo-container",ref:l},e.createElement("span",{className:"time-text"},o.createdAtStr),e.createElement("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:o.formattedContent}}),e.createElement(H,{when:f.length>0},e.createElement("div",{className:"images-container"},f.map((h,x)=>e.createElement("img",{key:x,crossOrigin:"anonymous",src:h,onLoad:c,onError:c,decoding:"async"})))),e.createElement("div",{className:"watermark-container"},e.createElement("span",{className:"normal-text"},"by ",e.createElement("span",{className:"name-text"},m==null?void 0:m.username))))))};function he(a){R({className:"gen-memo-image-dialog"},gt,{memo:a})}const Et=a=>{var E;const{memoId:t,destroy:n}=a,[s,r]=u.exports.useState(),[l,m]=u.exports.useState([]),[o,f]=u.exports.useState([]);u.exports.useEffect(()=>{(async()=>{var h;const N=await w.getMemoById(t);N&&(f(Array.from((h=N.content.match(j))!=null?h:[])),r(k(D({},N),{formattedContent:V(N.content),createdAtStr:M.getTimeStampString(N.createdAt)})))})()},[]),u.exports.useEffect(()=>{(async()=>{if(!s)return;const N=[],h=[...s.content.matchAll(de)];for(const x of h)if(x&&x.length===3){const d=x[2],i=await w.getMemoById(d);i&&(N.push(k(D({},i),{formattedContent:V(i.content),createdAtStr:M.getTimeStampString(i.createdAt)})),m([...N]))}})()},[s]);const p=()=>{s&&he(s)},g=async c=>{var h;const N=c.target;if(N.className==="memo-link-text"){const x=(h=N.dataset)==null?void 0:h.value;x&&await w.getMemoById(x)&&(n(),ye(x))}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F4D5}"),"Memo Story"),e.createElement("button",{className:"text-btn close-btn",onClick:n},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:"memo-container current"},e.createElement("div",{className:"memo-header-container"},e.createElement("p",{className:"time-text"},s==null?void 0:s.createdAtStr),e.createElement("span",{className:"action-btn",onClick:p},"Share")),e.createElement("div",{className:"memo-content-text",onClick:g,dangerouslySetInnerHTML:{__html:(E=s==null?void 0:s.formattedContent)!=null?E:""}}),e.createElement(H,{when:o.length>0},e.createElement("div",{className:"images-wrapper"},o.map((c,N)=>e.createElement(ge,{className:"memo-img",key:N,imgUrl:c}))))),e.createElement("p",{className:"normal-text "+(l.length===0?"hidden":"")},"\u94FE\u63A5\u4E86 ",l.length," \u4E2A Memo"),e.createElement("div",{className:"down-memos-wrapper "+(l.length!==0?"":"hidden")},l.map(c=>e.createElement("div",{className:"memo-container",key:c.id},e.createElement("div",{className:"memo-header-container"},e.createElement("p",{className:"time-text"},c.createdAtStr)),e.createElement("div",{className:"memo-content-text",onClick:g,dangerouslySetInnerHTML:{__html:c.formattedContent}}))))))};function ye(a){R({className:"memo-story-dialog"},Et,{memoId:a})}const ft=a=>{var N;const{memo:t}=a,n=k(D({},t),{formattedContent:V(t.content),createdAtStr:M.getTimeStampString(t.createdAt)}),[s,r]=ce(!1),l=Array.from((N=n.content.match(j))!=null?N:[]),m=()=>{fe(M.getTimeStampByDate(n.createdAt))},o=()=>{O.setMarkMemoId(n.id)},f=()=>{O.setEditMemoId(n.id)},p=async()=>{if(s){try{await w.deleteMemoById(n.id),await w.fetchMoreMemos()}catch(h){v.error(h.message)}O.getState().editMemoId===n.id&&O.setEditMemoId("")}else r()},g=()=>{s&&r(!1)},E=()=>{he(n)},c=async h=>{var d;const x=h.target;if(x.className==="memo-link-text"){const i=(d=x.dataset)==null?void 0:d.value;i&&await w.getMemoById(i)&&ye(i)}};return e.createElement("div",{className:"memo-wrapper",onMouseLeave:g},e.createElement("div",{className:"memo-top-wrapper"},e.createElement("span",{className:"time-text",onClick:m},n.createdAtStr),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"text-btn more-action-btn"}),e.createElement("div",{className:"more-action-btns-wrapper"},e.createElement("div",{className:"more-action-btns-container"},e.createElement("span",{className:"text-btn",onClick:o},"Mark"),e.createElement("span",{className:"text-btn",onClick:E},"\u5206\u4EAB"),e.createElement("span",{className:"text-btn",onClick:f},"\u7F16\u8F91"),e.createElement("span",{className:"text-btn delete-btn",onClick:p},s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"))))),e.createElement("div",{className:"memo-content-text",onClick:c,dangerouslySetInnerHTML:{__html:n.formattedContent}}),e.createElement(H,{when:l.length>0},e.createElement("div",{className:"images-wrapper"},l.map((h,x)=>e.createElement(ge,{className:"memo-img",key:x,imgUrl:h})))))};function V(a){var m;const t=document.createElement("div");t.innerHTML=a;const n=document.createElement("p");for(;t.firstChild&&t.firstChild.nodeName!=="P";){const o=t.firstChild;o.nodeName==="#text"?n.innerHTML+=o.nodeValue:n.innerHTML+=o.outerHTML,o.remove()}n.innerHTML!==""&&(t.prepend(n),a=t.innerHTML);const{shouldUseMarkdownParser:s,shouldSplitMemoWord:r,shouldHideImageUrl:l}=O.getState();s&&(a=rt(a)),r&&(a=a.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5]?)/g,"$1 $2 $3")),l&&(a=a.replace(j,"")),t.innerHTML=a;for(const o of t.querySelectorAll("p"))o.textContent===""&&((m=o.firstElementChild)==null?void 0:m.tagName)!=="BR"&&o.remove();return a=t.innerHTML,a=a.replace(W,"<span class='tag-span'>#$1</span>").replace(ue,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(de,"<span class='memo-link-text' data-value='$2'>$1</span>"),a}var ht=e.memo(ft);const yt=a=>{for(const t of re)if(t.type===a)return t.text;return""},Nt=()=>{const{locationState:{query:a},memoState:{memos:t}}=u.exports.useContext(P),[n,s]=u.exports.useState(!1),[r,l]=u.exports.useState(!1),m=u.exports.useRef(null),o=a.tag,f={from:a.from,to:a.to},p=a.type,g=a.text,E=Boolean(o||f.from!==0&&f.from<f.to||p||g),c=t.filter(d=>{let i=!0;const y=[];for(const S of d.tags){const C=S.text.split("/");let A="";for(let _=0;_<C.length;_++)_===0?A+=C[_]:A+="/"+C[_],y.push(A)}return o!==""&&!y.includes(o)&&(i=!1),f.from!==0&&f.from<f.to&&(M.getTimeStampByDate(d.createdAt)<f.from||M.getTimeStampByDate(d.createdAt)>f.to)&&(i=!1),p!==""&&(p==="NOT_TAGGED"?d.content.match(W)!==null&&(i=!1):p==="LINKED"?d.content.match(ue)===null&&(i=!1):p==="IMAGED"&&d.content.match(j)===null&&(i=!1)),g!==""&&!d.content.includes(g)&&(i=!1),i});u.exports.useEffect(()=>{var d;(d=m.current)==null||d.scrollTo({top:0}),!r&&E&&(s(!0),w.fetchAllMemos().then(()=>{l(!0),s(!1)}))},[r,E]);const N=async()=>{if(!(n||r)){s(!0);try{const d=await w.fetchMoreMemos();Array.isArray(d)&&d.length===0&&l(!0)}catch(d){v.error(d.message)}s(!1)}},h=u.exports.useCallback(d=>{const i=d.target;if(i.tagName==="SPAN"&&i.className==="tag-span"){const y=i.innerText.slice(1);L.getState().query.tag===y?L.setTagQuery(""):L.setTagQuery(y)}},[]),x=tt(()=>{if(!(n||r)&&m.current){const{offsetHeight:d,scrollTop:i,scrollHeight:y}=m.current;d+i+10>y&&N()}},100,[n,r]);return e.createElement("div",{className:`memolist-wrapper ${r?"completed":""}`,onClick:h,onScroll:x,ref:m},e.createElement(St,{showFilter:E,tagQuery:o,duration:f,memoType:p,textQuery:g}),c.map(d=>e.createElement(ht,{key:`${d.id}-${d.updatedAt}`,memo:d})),E?e.createElement("div",{className:"status-text-container"},e.createElement("p",{className:"status-text"},n?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":c.length===0?"\u7A7A\u7A7A\u5982\u4E5F":"")):e.createElement("div",{className:`status-text-container ${r?"completed":""} ${n||r?"":"invisible"}`},e.createElement("p",{className:"status-text"},r?"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}":"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...")))},St=a=>{const{showFilter:t,tagQuery:n,duration:s,memoType:r,textQuery:l}=a;return e.createElement("div",{className:`filter-query-container ${t?"":"hidden"}`},e.createElement("span",{className:"tip-text"},"\u7B5B\u9009\uFF1A"),e.createElement("div",{className:"filter-item-container "+(s.from!==0&&s.from<s.to?"":"hidden"),onClick:()=>{L.setFromAndToQuery(0,0)}},e.createElement("span",{className:"icon-text"},"\u{1F5D3}\uFE0F")," ",M.getDateString(s.from)," \u81F3 ",M.getDateString(s.to)),e.createElement("div",{className:"filter-item-container "+(n?"":"hidden"),onClick:()=>{L.setTagQuery("")}},e.createElement("span",{className:"icon-text"},"\u{1F3F7}\uFE0F")," ",n),e.createElement("div",{className:"filter-item-container "+(r?"":"hidden"),onClick:()=>{L.setMemoTypeQuery("")}},e.createElement("span",{className:"icon-text"},"\u{1F4E6}")," ",yt(r)),e.createElement("div",{className:"filter-item-container "+(l?"":"hidden"),onClick:()=>{L.setTextQuery("")}},e.createElement("span",{className:"icon-text"},"\u{1F50D}")," ",l))};const xt=({destroy:a})=>{const{userState:t}=u.exports.useContext(P),n=t.user,[s,r]=u.exports.useState(n.username),[l,m]=u.exports.useState(!1),[o,f]=u.exports.useState(!1),p=()=>{a()},g=x=>{const d=x.target.value;r(d)},E=async()=>{if(n.username==="guest"){v.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(s===n.username){m(!1);return}try{if(!await B.checkUsernameUsable(s)){v.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await B.updateUsername(s),await B.doSignIn(),m(!1),v.info("\u4FEE\u6539\u6210\u529F~")}catch(x){v.error(x.message)}},c=()=>{if(n.username==="guest"){v.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}bt()},N=async()=>{if(o){try{await B.removeGithubName(),await B.doSignIn()}catch(x){v.error(x.message)}f(!1)}else f(!0)},h=x=>{x.preventDefault()};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F920}"),"\u6211\u7684\u8D26\u53F7"),e.createElement("button",{className:"text-btn close-btn",onClick:p},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:"section-container account-section-container"},e.createElement("p",{className:"title-text"},"\u57FA\u672C\u4FE1\u606F"),e.createElement("label",{className:"form-label input-form-label"},e.createElement("span",{className:"normal-text"},"ID\uFF1A"),e.createElement("span",{className:"normal-text"},n.id)),e.createElement("label",{className:"form-label input-form-label"},e.createElement("span",{className:"normal-text"},"\u521B\u5EFA\u65F6\u95F4\uFF1A"),e.createElement("span",{className:"normal-text"},M.getDateString(n.createdAt))),e.createElement("label",{className:"form-label input-form-label username-label"},e.createElement("span",{className:"normal-text"},"\u8D26\u53F7\uFF1A"),e.createElement("input",{type:"text",readOnly:!l,value:s,onClick:()=>{m(!0)},onChange:g}),e.createElement("div",{className:"btns-container",onClick:h},e.createElement("span",{className:"text-btn confirm-btn "+(l?"":"hidden"),onClick:E},"\u4FDD\u5B58"),e.createElement("span",{className:"text-btn cancel-btn "+(l?"":"hidden"),onClick:()=>{r(n.username),m(!1)}},"\u64A4\u9500"))),e.createElement("label",{className:"form-label password-label"},e.createElement("span",{className:"normal-text"},"\u5BC6\u7801\uFF1A"),e.createElement("span",{className:"text-btn",onClick:c},"\u4FEE\u6539\u5BC6\u7801"))),e.createElement("div",{className:"section-container account-section-container"},e.createElement("p",{className:"title-text"},"\u5173\u8054\u8D26\u53F7"),e.createElement("label",{className:"form-label input-form-label"},e.createElement("span",{className:"normal-text"},"GitHub\uFF1A"),n.githubName?e.createElement(e.Fragment,null,e.createElement("a",{className:"value-text",href:"https://github.com/"+n.githubName},n.githubName),e.createElement("span",{className:"btn-text",onMouseLeave:()=>f(!1),onClick:N},o?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A")):e.createElement(e.Fragment,null,e.createElement("span",{className:"value-text"},"\u65E0"),e.createElement("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist"},"\u524D\u5F80\u7ED1\u5B9A"))))))},Ct=({destroy:a})=>{const[t,n]=u.exports.useState(""),[s,r]=u.exports.useState(""),[l,m]=u.exports.useState("");u.exports.useEffect(()=>{},[]);const o=()=>{a()},f=c=>{const N=c.target.value;n(N)},p=c=>{const N=c.target.value;r(N)},g=c=>{const N=c.target.value;m(N)},E=async()=>{if(t===""||s===""||l===""){v.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==l){v.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),m("");return}try{if(!await B.checkPasswordValid(t)){v.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),n("");return}await B.updatePassword(s),v.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),o()}catch(c){v.error(c)}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},"\u4FEE\u6539\u5BC6\u7801"),e.createElement("button",{className:"text-btn close-btn",onClick:o},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("p",{className:"tip-text"},"\u5982\u679C\u662F GitHub \u767B\u5F55\uFF0C\u5219\u521D\u59CB\u5BC6\u7801\u4E3A\u7528\u6237\u540D"),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:t,onChange:f}),e.createElement("span",{className:"normal-text "+(t===""?"":"not-null")},"\u65E7\u5BC6\u7801")),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:s,onChange:p}),e.createElement("span",{className:"normal-text "+(s===""?"":"not-null")},"\u65B0\u5BC6\u7801")),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:l,onChange:g}),e.createElement("span",{className:"normal-text "+(l===""?"":"not-null")},"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801")),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"text-btn cancel-btn",onClick:o},"\u53D6\u6D88"),e.createElement("span",{className:"text-btn confirm-btn",onClick:E},"\u4FDD\u5B58"))))};function bt(){R({className:"change-password-dialog"},Ct)}function Mt(){R({className:"my-account-dialog",useAppContext:!0},xt)}const wt=({destroy:a})=>{const t=()=>{a()};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F600}"),"\u5173\u4E8E ",e.createElement("b",null,"Memos")),e.createElement("button",{className:"text-btn close-btn",onClick:t},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("p",null,"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"),e.createElement("br",null),e.createElement("i",null,"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"),e.createElement("ul",null,e.createElement("li",null,"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5}\u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1}\u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5}\u8BFB\u540E\u611F..."),e.createElement("li",null,"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"),e.createElement("li",null,"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B")),e.createElement("br",null),e.createElement("i",null,"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"),e.createElement("ul",null,e.createElement("li",null,"\u2728"," ",e.createElement("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer"},"\u5F00\u6E90\u9879\u76EE")),e.createElement("li",null,"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"),e.createElement("li",null,"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B")),e.createElement("br",null),e.createElement("p",null,"Enjoy it and have fun~ "),e.createElement("hr",null),e.createElement("p",{className:"normal-text"},"BTW, my personal site:"," ",e.createElement("a",{target:"_blank",href:"https://justsven.top",rel:"noreferrer"},"https://justsven.top")," ","\u{1F440}"),e.createElement("p",{className:"normal-text"},"Last update at 2021/9/28 11:23:15 \u{1F389}")))};function Ne(){R({className:"about-site-dialog"},wt)}const Dt=({destroy:a})=>{const{globalState:{shouldHideImageUrl:t,shouldSplitMemoWord:n,shouldUseMarkdownParser:s,showDarkMode:r}}=u.exports.useContext(P);u.exports.useEffect(()=>{},[]);const l=()=>{a()},m=c=>{const N=c.target.checked;O.setAppSetting({shouldSplitMemoWord:N})},o=c=>{const N=c.target.checked;O.setAppSetting({shouldHideImageUrl:N})},f=c=>{const N=c.target.checked;O.setAppSetting({showDarkMode:N})},p=c=>{const N=c.target.checked;O.setAppSetting({shouldUseMarkdownParser:N})},g=async()=>{await w.fetchAllMemos();for(const c of w.getState().memos)await w.updateMemo(c.id,c.content.replace("&nbsp;"," ").replace(/#(.+?)#/g,"# $1 "))},E=async()=>{await w.fetchAllMemos();const c=w.getState().memos.map(x=>k(D({},x),{tags:x.tags.map(d=>d.text)})),N=JSON.stringify(c),h=document.createElement("a");h.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(N)),h.setAttribute("download","data.json"),h.style.display="none",document.body.appendChild(h),h.click(),document.body.removeChild(h)};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u2699\uFE0F"),"\u504F\u597D\u8BBE\u7F6E"),e.createElement("button",{className:"text-btn close-btn",onClick:l},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("div",{className:"section-container preferences-section-container"},e.createElement("p",{className:"title-text"},"\u5E38\u89C4"),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"\u6DF1\u8272\u6A21\u5F0F"),e.createElement("img",{className:"icon-img",src:r?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:r,onChange:f}))),e.createElement("div",{className:"section-container preferences-section-container"},e.createElement("p",{className:"title-text"},"Memo \u663E\u793A\u76F8\u5173"),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"),e.createElement("img",{className:"icon-img",src:n?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:n,onChange:m})),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"),e.createElement("img",{className:"icon-img",src:t?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:t,onChange:o})),e.createElement("label",{className:"form-label checkbox-form-label"},e.createElement("span",{className:"normal-text"},"markdown \u683C\u5F0F\u89E3\u6790"),e.createElement("img",{className:"icon-img",src:s?"/icons/check-active.svg":"/icons/check.svg"}),e.createElement("input",{className:"hidden",type:"checkbox",checked:s,onChange:p}),e.createElement("span",{className:"tip-text"},"\u76EE\u524D\u652F\u6301\u5217\u8868\u3001\u4EE3\u7801\u5757"))),e.createElement("div",{className:"section-container"},e.createElement("p",{className:"title-text"},"\u5176\u4ED6"),e.createElement("div",{className:"btn-container"},e.createElement("button",{className:"btn export-btn",onClick:E},"\u5BFC\u51FA\u6570\u636E(JSON)"),e.createElement("button",{className:"btn clean-btn hidden",onClick:g},"Memo Clean")))))};function vt(){R({className:"preferences-dialog",useAppContext:!0},Dt)}const Tt=({destroy:a})=>{const{locationState:{query:{text:t,type:n}}}=u.exports.useContext(P),s=u.exports.useRef(null);u.exports.useEffect(()=>{var o;(o=s.current)==null||o.focus()},[]);const r=o=>{const{type:f}=L.getState().query;o===f&&(o=""),L.setMemoTypeQuery(o)},l=o=>{const f=o.currentTarget.value;L.setTextQuery(f)},m=o=>{o.code==="Enter"&&a()};return e.createElement(e.Fragment,null,e.createElement("div",{className:"search-bar-inputer"},e.createElement("img",{className:"icon-img",src:"/icons/search.svg"}),e.createElement("input",{className:"text-input",type:"text",placeholder:"Search for memos",ref:s,value:t,onChange:l,onKeyPress:m})),e.createElement("div",{className:"special-type-selector"},e.createElement("p",{className:"title-text"},"QUICKLY FILTER"),e.createElement("div",{className:"section-container types-container"},e.createElement("span",{className:"section-text"},"Type:"),re.map((o,f)=>e.createElement("div",{key:o.type},e.createElement("span",{className:`type-item ${n===o.type?"selected":""}`,onClick:()=>{r(o.type)}},o.text),f+1<re.length?e.createElement("span",{className:"split-text"},"/"):null)))))},Se=()=>{const a="search-bar-dialog-wrapper",t=document.querySelector(`.${a}`);t&&t.parentElement?(t.classList.remove("showup"),t.classList.add("showoff"),setTimeout(()=>{t&&t.parentElement&&(t.parentElement.remove(),Q.unmountComponentAtNode(t.parentElement))},se)):R({className:a,useAppContext:!0},Tt)};const Ft=({visibility:a})=>{const t=()=>{vt()},n=()=>{Ne()},s=()=>{B.doSignOut(),location.reload()},r=()=>{Se()};return e.createElement("div",{className:"menu-btns-popup "+(a?"":"hidden")},e.createElement("button",{className:"text-btn action-btn",onClick:Mt},e.createElement("span",{className:"icon"},"\u{1F920}")," \u6211\u7684\u8D26\u53F7"),e.createElement("button",{className:"text-btn action-btn",onClick:t},e.createElement("span",{className:"icon"},"\u2699\uFE0F")," \u504F\u597D\u8BBE\u7F6E"),e.createElement("button",{className:"text-btn action-btn",onClick:r},e.createElement("span",{className:"icon"},"\u{1F50D}")," \u641C\u7D22"),e.createElement("button",{className:"text-btn action-btn",onClick:n},e.createElement("span",{className:"icon"},"\u{1F600}")," \u5173\u4E8E"),e.createElement("button",{className:"text-btn action-btn",onClick:s},e.createElement("span",{className:"icon"},"\u{1F44B}")," \u9000\u51FA"))};const kt=()=>{const{userState:{user:a},memoState:{memos:t}}=u.exports.useContext(P),[n,s]=u.exports.useState({memosAmount:0,tagsAmount:0}),[r,l]=u.exports.useState(!1),m=a?a.username:"Memos",o=a?Math.ceil((Date.now()-M.getTimeStampByDate(a.createdAt))/1e3/3600/24):0;u.exports.useEffect(()=>{!B.getState().user||w.getMyDataAmount().then(g=>{s(g)}).catch(g=>{v.error(g.message)})},[t]);const f=u.exports.useCallback(g=>{g.stopPropagation();const E=!r;if(E){const c=()=>{l(!1),document.body.removeEventListener("click",c)};document.body.addEventListener("click",c)}l(E)},[r]),p=u.exports.useCallback(()=>{L.clearQuery()},[]);return e.createElement("div",{className:"user-banner-container"},e.createElement("div",{className:"userinfo-header-container"},e.createElement("p",{className:"username-text",onClick:p},m),e.createElement("button",{className:"action-btn menu-popup-btn",onClick:f}),e.createElement(Ft,{visibility:r})),e.createElement("div",{className:"status-text-container"},e.createElement("div",{className:"status-text memos-text"},e.createElement("span",{className:"amount-text"},n.memosAmount),e.createElement("span",{className:"type-text"},"MEMO")),e.createElement("div",{className:"status-text tags-text"},e.createElement("span",{className:"amount-text"},n.tagsAmount),e.createElement("span",{className:"type-text"},"TAG")),e.createElement("div",{className:"status-text duration-text",onClick:()=>fe()},e.createElement("span",{className:"amount-text"},o),e.createElement("span",{className:"type-text"},"DAY"))))};const At=()=>{const{locationState:{query:a},memoState:{memos:t}}=u.exports.useContext(P),[n,s]=u.exports.useState([]),[r,l]=u.exports.useState(a.tag),m=Ee();return u.exports.useEffect(()=>{!B.getState().user||w.getMyTags().then(o=>{const f=o.sort((g,E)=>M.getTimeStampByDate(E.createdAt)-M.getTimeStampByDate(g.createdAt)).sort((g,E)=>E.level-g.level),p={subTags:[]};for(const g of f){const E=g.text.split("/");let c=p,N="";for(let h=0;h<E.length;h++){const x=E[h];h===0?N+=x:N+="/"+x;let d=null;for(const i of c.subTags)if(i.text===N){d=i;break}d?d.level+=g.level:(d={id:"",key:x,text:N,level:g.level,subTags:[],deep:h},c.subTags.push(d)),c.subTags.sort((i,y)=>y.level-i.level),N===g.text&&(d.id=g.id),c=d}}p.subTags.sort((g,E)=>E.level-g.level),s(p.subTags),m.setFinish()}).catch(o=>{m.setError(),v.error(o)})},[t]),u.exports.useEffect(()=>{l(a.tag);const o=document.querySelector(ae);o==null||o.classList.remove(ne)},[a]),e.createElement("div",{className:"tags-wrapper"},e.createElement("p",{className:"title-text"},"\u5E38\u7528\u6807\u7B7E"),e.createElement("div",{className:"tags-container"},m.isLoading?e.createElement(e.Fragment,null):e.createElement(e.Fragment,null,n.map((o,f)=>e.createElement(xe,{key:o.id+"-"+f,tag:o,tagQuery:r})),e.createElement(H,{when:n.length<5},e.createElement("p",{className:"tag-tip-container"},"\u8F93\u5165",e.createElement("span",{className:"code-text"},"# Tag "),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~")))))},xe=a=>{const{tag:t,tagQuery:n}=a,s=n===t.text,r=t.subTags.length>0,[l,m]=ce(n.includes(t.text)&&!s),o=t.id!=="";u.exports.useEffect(()=>{l||m(n.includes(t.text)&&!s)},[n,t]);const f=()=>{const E=s?"":t.text;E&&(M.copyTextToClipboard(`# ${E} `),w.polishTag(t.id).catch(()=>{})),L.setTagQuery(E)},p=E=>{E.stopPropagation(),o&&It(t)},g=E=>{E.stopPropagation(),m()};return e.createElement(e.Fragment,null,e.createElement("div",{className:`tag-item-container ${s?"active":""}`,onClick:f},e.createElement("p",{className:"tag-text-container"},e.createElement("div",{className:`icon-container ${o?"rename-able":""}`},e.createElement("span",{className:"icon-text"},"#"),o?e.createElement("span",{className:"rename-btn",onClick:p},s?e.createElement("img",{className:"icon-img",src:"/icons/edit-white.svg"}):e.createElement("img",{className:"icon-img",src:"/icons/edit.svg"})):null),e.createElement("span",{className:"tag-text"},t.key)),e.createElement("div",{className:"btns-container"},r?e.createElement("span",{className:`action-btn toggle-btn ${l?"shown":""}`,onClick:g},s?e.createElement("img",{className:"icon-img",src:"/icons/arrow-right-white.svg"}):e.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"})):null)),r?e.createElement("div",{className:`subtags-container ${l?"":"hidden"}`},t.subTags.map((E,c)=>e.createElement(xe,{key:E.id+"-"+c,tag:E,tagQuery:n}))):null)},Bt=a=>{const{destroy:t,tag:n}=a,s=u.exports.useRef(null),r=()=>{t()},l=()=>{var o;const m=(o=s.current)==null?void 0:o.value;if(!m||m===n.text){t();return}if(m.length>36){v.error("\u6807\u7B7E\u592A\u957F\u5566\uFF0CMAX=36");return}w.updateTagText(n.id,m).then(()=>{w.clearMemos(),w.fetchAllMemos(),t()}).catch(()=>{})};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F3F7}\uFE0F"),"\u6807\u7B7E\u91CD\u547D\u540D"),e.createElement("button",{className:"text-btn close-btn",onClick:r},e.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),e.createElement("div",{className:"dialog-content-container"},e.createElement("p",{className:"tag-text"},"\u65E7\uFF1A",n.text),e.createElement("input",{className:"text-input",type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E",ref:s}),e.createElement("div",{className:"btns-container"},e.createElement("span",{className:"btn-text cancel-btn",onClick:r},"\u53D6\u6D88"),e.createElement("span",{className:"btn-text confirm-btn",onClick:l},"\u786E\u5B9A"))))};function It(a){R({className:"rename-tag-dialog"},Bt,{tag:a})}const Ce={width:12,height:7},Lt=()=>{const a=M.getDateStampByDate(Date.now()),t=new Date(a).getDay()||7,n=(Ce.width-1)*Ce.height+t,s=a-n*$,r=new Array(7-t).fill(0),l=()=>{const i=[];for(let y=1;y<=n;y++)i.push({timestamp:s+$*y,count:0});return i},{memoState:{memos:m}}=u.exports.useContext(P),[o,f]=u.exports.useState(l()),[p,g]=u.exports.useState(null),[E,c]=u.exports.useState(null),N=u.exports.useRef(null);u.exports.useEffect(()=>{if(!B.getState().user)return;const i=l();w.getMemosStat().then(y=>{for(const S of y){const C=(M.getDateStampByDate(S.timestamp)-s)/(1e3*3600*24)-1;C>=0&&(i[C].count=S.amount)}f([...i])}).catch(y=>{v.error(y.message)})},[m.length]);const h=u.exports.useCallback((i,y)=>{if(g(y),N.current){const S=i.target;N.current.style.left=S.offsetLeft+"px",N.current.style.top=S.offsetTop+"px"}},[]),x=u.exports.useCallback(()=>{g(null)},[]),d=u.exports.useCallback(i=>{L.getState().query.from===i.timestamp?(L.setFromAndToQuery(0,0),c(null)):i.count>0&&(L.setFromAndToQuery(i.timestamp,i.timestamp+$),c(i))},[]);return e.createElement("div",{className:"usage-heat-map-wrapper"},e.createElement("div",{className:"day-tip-text-container"},e.createElement("span",{className:"tip-text"},"Mon"),e.createElement("span",{className:"tip-text"}),e.createElement("span",{className:"tip-text"},"Wed"),e.createElement("span",{className:"tip-text"}),e.createElement("span",{className:"tip-text"},"Fri"),e.createElement("span",{className:"tip-text"}),e.createElement("span",{className:"tip-text"},"Sun")),e.createElement("div",{ref:N,className:"usage-detail-container pop-up "+(p?"":"hidden")},p==null?void 0:p.count," memos on ",e.createElement("span",{className:"date-text"},new Date(p==null?void 0:p.timestamp).toDateString())),e.createElement("div",{className:"usage-heat-map"},o.map((i,y)=>{const S=i.count,C=S<=0?"":S<=2?"stat-day-L1-bg":S<=4?"stat-day-L2-bg":S<=6?"stat-day-L3-bg":"stat-day-L4-bg";return e.createElement("span",{className:"stat-container "+C+(E===i?" current":" "),key:y,onMouseEnter:A=>h(A,i),onMouseLeave:x,onClick:()=>d(i)})}),r.map((i,y)=>e.createElement("span",{className:"stat-container null",key:y}))))};const _t=()=>{u.exports.useEffect(()=>{},[]);const a=u.exports.useCallback(t=>{if(t.target.className==="sidebar-wrapper"){const s=document.querySelector(ae);s==null||s.classList.remove(ne)}},[]);return e.createElement("div",{className:"sidebar-wrapper",onClick:a},e.createElement(kt,null),e.createElement(Lt,null),e.createElement(At,null))},Ut=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function be(a,t){return t.minLength!==void 0&&a.length<t.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:t.maxLength!==void 0&&a.length>t.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:t.noSpace&&a.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:t.noChinese&&Ut.test(a)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const Me={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},Ot=({destroy:a})=>{const[t,n]=u.exports.useState(""),[s,r]=u.exports.useState(""),l=u.exports.useRef(null);u.exports.useEffect(()=>{const g=E=>{var c;E.key==="Enter"&&((c=l.current)==null||c.click())};return document.body.addEventListener("keypress",g),()=>{document.body.removeEventListener("keypress",g)}},[]);const m=g=>{const E=g.target.value;n(E)},o=g=>{const E=g.target.value;r(E)},f=()=>{Ne()},p=async()=>{const g=be(t,Me);if(!g.result){v.error("\u7528\u6237\u540D "+g.reason);return}const E=be(s,Me);if(!E.result){v.error("\u5BC6\u7801 "+E.reason);return}try{const c=F.signin,{succeed:N,message:h}=await c(t,s);if(!N&&h){v.error("\u{1F61F} "+h);return}await B.doSignIn()?(w.fetchMoreMemos().catch(()=>{}),a()):v.error("\u{1F61F} \u4E0D\u77E5\u9053\u53D1\u751F\u4E86\u4EC0\u4E48\u9519\u8BEF")}catch(c){console.error(c),v.error("\u{1F61F} "+c.message)}};return e.createElement(e.Fragment,null,e.createElement("div",{className:"dialog-header-container"},e.createElement("p",{className:"title-text"},e.createElement("span",{className:"icon-text"},"\u{1F44B}")," \u8D26\u53F7\u6CE8\u518C / \u767B\u5F55")),e.createElement("div",{className:"dialog-content-container"},e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"text",value:t,onChange:m}),e.createElement("span",{className:"normal-text "+(t===""?"":"not-null")},"\u8D26\u53F7")),e.createElement("label",{className:"form-label input-form-label"},e.createElement("input",{type:"password",value:s,onChange:o}),e.createElement("span",{className:"normal-text "+(s===""?"":"not-null")},"\u5BC6\u7801"))),e.createElement("div",{className:"dialog-footer-container"},e.createElement("div",{className:"btns-container"},e.createElement("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist"},"Login with GitHub")),e.createElement("div",{className:"btns-container"},e.createElement("button",{className:"text-btn signup-btn disabled",onClick:()=>v.info("\u6CE8\u518C\u5DF2\u5173\u95ED")},"\u6CE8\u518C"),e.createElement("span",{className:"split-text"},"/"),e.createElement("button",{className:"text-btn signin-btn",ref:l,onClick:p},"\u767B\u5F55"))),e.createElement("p",{className:"tip-text"},"\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\uFF0C\u53EF\u8F93\u5165 ",e.createElement("code",null,"guest, 123456")," \u8FDB\u884C\u4F53\u9A8C\u3002",e.createElement("br",null),e.createElement("span",{className:"text-btn",onClick:f},e.createElement("span",{className:"icon-text"},"\u{1F600}"),"\u5173\u4E8E\u672C\u7AD9")))};function Pt(){R({className:"signin-dialog",clickSpaceDestroy:!1},Ot)}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(a,t){return Object.prototype.toString.call(a).toLowerCase()==="[object regexp]"?this.replace(a,t):this.replace(new RegExp(a,"g"),t)})})();function Rt(){const{globalState:{showDarkMode:a}}=u.exports.useContext(P);return u.exports.useEffect(()=>{B.doSignIn().catch(()=>{}).finally(()=>{B.getState().user?w.fetchMoreMemos():Pt()});const t=n=>{if(!B.getState().user)return;const{ctrlKey:s,metaKey:r,code:l}=n;(s||r)&&l==="KeyP"&&(n.preventDefault(),Se())};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[]),u.exports.useEffect(()=>{a?document.body.classList.add("dark"):document.body.classList.remove("dark")},[a]),e.createElement(e.Fragment,null,e.createElement("div",{id:"page-container"},e.createElement(_t,null),e.createElement("div",{className:"content-wrapper"},e.createElement(Ve,null),e.createElement(Ze,null),e.createElement(Nt,null))))}Q.render(e.createElement(ie,{store:T,context:P},e.createElement(Rt,null)),document.getElementById("root"));
