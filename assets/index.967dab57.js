var Be=Object.defineProperty,Ie=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var ae=(t,e,a)=>e in t?Be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,C=(t,e)=>{for(var a in e||(e={}))Le.call(e,a)&&ae(t,a,e[a]);if(fe)for(var a of fe(e))Oe.call(e,a)&&ae(t,a,e[a]);return t},x=(t,e)=>Ie(t,_e(e));var M=(t,e,a)=>(ae(t,typeof e!="symbol"?e+"":e,a),a);import{j as se,r as l,R as K,a as Qe}from"./vendor.11819a74.js";const Ue=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function a(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerpolicy&&(c.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?c.credentials="include":r.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(r){if(r.ep)return;r.ep=!0;const c=a(r);fetch(r.href,c)}};Ue();const n=se.exports.jsx,o=se.exports.jsxs,T=se.exports.Fragment,ye=t=>{const{children:e,store:a,context:s}=t,[r,c]=l.exports.useState(a.getState());return l.exports.useEffect(()=>{const i=a.subscribe(g=>{c(g)});return()=>{i()}},[]),n(s.Provider,{value:r,children:e})};function Pe(t){const e=Object.keys(t),a={};for(const s of e)typeof t[s]=="function"&&(a[s]=t[s]);return(s={},r)=>{let c=!1;const i={};for(const g of e){const m=s[g],p=a[g](m,r);i[g]=p,c=c||p!==m}return c?i:s}}function Re(t,e){const a=[];let s=t;return{dispatch:g=>{const m=e(s,g),p=s;s=m;for(const y of a)y(s,p)},getState:()=>s,subscribe:g=>{let m=!0;return a.push(g),()=>{if(!m)return;const p=a.indexOf(g);a.splice(p,1),m=!1}}}}function $e(t,e){switch(e.type){case"SET_MARK_MEMO_ID":return e.payload.markMemoId===t.markMemoId?t:x(C({},t),{markMemoId:e.payload.markMemoId});case"SET_EDIT_MEMO_ID":return e.payload.editMemoId===t.editMemoId?t:x(C({},t),{editMemoId:e.payload.editMemoId});case"SET_MOBILE_VIEW":return e.payload.isMobileView===t.isMobileView?t:x(C({},t),{isMobileView:e.payload.isMobileView});case"SET_APP_SETTING":return C(C({},t),e.payload);default:return t}}const qe={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,isMobileView:!1};function He(t,e){switch(e.type){case"SET_LOCATION":return e.payload;case"SET_PATHNAME":return e.payload.pathname===t.pathname?t:x(C({},t),{pathname:e.payload.pathname});case"SET_QUERY":return x(C({},t),{query:e.payload});case"SET_TAG_QUERY":return e.payload.tag===t.query.tag?t:x(C({},t),{query:x(C({},t.query),{tag:e.payload.tag})});case"SET_DURATION_QUERY":return e.payload.duration===t.query.duration?t:x(C({},t),{query:x(C({},t.query),{duration:C(C({},t.query.duration),e.payload.duration)})});case"SET_TYPE":return e.payload.type===t.query.type?t:x(C({},t),{query:x(C({},t.query),{type:e.payload.type})});case"SET_TEXT":return e.payload.text===t.query.text?t:x(C({},t),{query:x(C({},t.query),{text:e.payload.text})});case"SET_HASH":return e.payload.hash===t.hash?t:x(C({},t),{hash:e.payload.hash});default:return t}}const Ge={pathname:"/",hash:"",query:{tag:"",duration:null,type:"",text:""}};function Ne(){const t=navigator.appVersion;let e="Unknown";return t.indexOf("Win")!=-1?e="Windows":t.indexOf("Mac")!=-1?e="MacOS":t.indexOf("Linux")!=-1&&(e="Linux"),e}function F(t){return typeof t=="string"&&(t=t.replaceAll("-","/")),new Date(t).getTime()}function re(t){const e=new Date(F(t));return new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()}function V(t){const e=new Date(F(t)),a=e.getFullYear(),s=e.getMonth()+1,r=e.getDate();return`${a}/${s}/${r}`}function Ye(t){const e=new Date(F(t)),a=e.getHours(),s=e.getMinutes(),r=a<10?"0"+a:a,c=s<10?"0"+s:s;return`${r}:${c}`}function O(t){const e=new Date(F(t)),a=e.getFullYear(),s=e.getMonth()+1,r=e.getDate(),c=e.getHours(),i=e.getMinutes(),g=e.getSeconds(),m=s<10?"0"+s:s,p=r<10?"0"+r:r,y=c<10?"0"+c:c,d=i<10?"0"+i:i,u=g<10?"0"+g:g;return`${a}/${m}/${p} ${y}:${d}:${u}`}function Ve(t){return Array.from(new Set(t))}function J(t){const e=new Set,a=[];for(const s of t)e.has(s.id)||(e.add(s.id),a.push(s));return a}function oe(t){const e=[],a=Object.keys(t).sort();for(const s of a){const r=t[s];r&&(typeof r=="object"?e.push(...oe(r).split("&")):e.push(`${s}=${r}`))}return e.join("&")}function Ce(t){if(!t)return{};const e={},a=Object.keys(t).sort();for(const s of a){const r=t[s];if(typeof r=="object"){const c=Ce(JSON.parse(JSON.stringify(r)));c&&Object.keys(c).length>0&&(e[s]=c)}else Boolean(r)&&(e[s]=r)}return e}async function je(t){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(t)}catch(e){console.warn("Copy to clipboard failed.",e)}else console.warn("Copy to clipboard failed, methods not supports.")}function We(t){return new Promise(e=>{const a=new Image;a.onload=()=>{const{width:s,height:r}=a;s>0&&r>0?e({width:s,height:r}):e({width:0,height:0})},a.onerror=()=>{e({width:0,height:0})},a.className="hidden",a.src=t,document.body.appendChild(a),a.remove()})}function Ke(t,e){switch(e.type){case"SET_MEMOS":{const a=J(e.payload.memos.sort((s,r)=>F(r.createdAt)-F(s.createdAt)));return x(C({},t),{memos:[...a]})}case"SET_TAGS":return x(C({},t),{tags:e.payload.tags});case"INSERT_MEMO":{const a=J([e.payload.memo,...t.memos].sort((s,r)=>F(r.createdAt)-F(s.createdAt)));return x(C({},t),{memos:a})}case"DELETE_MEMO_BY_ID":return x(C({},t),{memos:[...t.memos].filter(a=>a.id!==e.payload.id)});case"EDIT_MEMO":{const a=t.memos.map(s=>s.id===e.payload.id?C(C({},s),e.payload):s);return x(C({},t),{memos:a})}default:return t}}const ze={memos:[],tags:[]};function Je(t,e){switch(e.type){case"SIGN_IN":return{user:e.payload.user};case"SIGN_OUT":return{user:null};default:return t}}const Xe={user:null};function Ze(t,e){switch(e.type){case"SET_QUERIES":{const a=J(e.payload.queries.sort((s,r)=>F(r.createdAt)-F(s.createdAt)).sort((s,r)=>{var c,i;return F((c=r.pinnedAt)!=null?c:0)-F((i=s.pinnedAt)!=null?i:0)}));return x(C({},t),{queries:a})}case"INSERT_QUERY":{const a=J([e.payload.query,...t.queries].sort((s,r)=>F(r.createdAt)-F(s.createdAt)));return x(C({},t),{queries:a})}case"DELETE_QUERY_BY_ID":return x(C({},t),{queries:[...t.queries].filter(a=>a.id!==e.payload.id)});case"EDIT_QUERY":{const a=t.queries.map(s=>s.id===e.payload.id?C(C({},s),e.payload):s);return x(C({},t),{queries:a})}default:return t}}const et={queries:[]},S=Re({globalState:qe,locationState:Ge,memoState:ze,userState:Xe,queryState:et},Pe({globalState:$e,locationState:He,memoState:Ke,userState:Je,queryState:Ze})),I=l.exports.createContext(S.getState());var j;(function(t){function e(r){const c={};for(const i of r)try{const g=localStorage.getItem(i);if(g!==null){const m=JSON.parse(g);c[i]=m}}catch(g){console.error("Get storage failed in ",i,g)}return c}t.get=e;function a(r){for(const c in r)try{const i=JSON.stringify(r[c]);localStorage.setItem(c,i)}catch(i){console.error("Save storage failed in ",c,i)}}t.set=a;function s(){var c;const r=document.createElement("iframe");r.style.display="none",document.body.appendChild(r),(c=r.contentWindow)==null||c.localStorage.setItem("t",Date.now().toString()),r.remove()}t.emitStorageChangedEvent=s})(j||(j={}));class tt{constructor(){M(this,"getState",()=>S.getState().globalState);M(this,"setEditMemoId",e=>{S.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:e}})});M(this,"setMarkMemoId",e=>{S.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:e}})});M(this,"setIsMobileView",e=>{S.dispatch({type:"SET_MOBILE_VIEW",payload:{isMobileView:e}})});M(this,"setAppSetting",e=>{S.dispatch({type:"SET_APP_SETTING",payload:e}),j.set(e)});var s,r,c;const e=j.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser"]),a={shouldSplitMemoWord:(s=e.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(r=e.shouldHideImageUrl)!=null?r:!0,shouldUseMarkdownParser:(c=e.shouldUseMarkdownParser)!=null?c:!0};this.setAppSetting(a)}}const _=new tt,U=(t="replace")=>{const{query:e,pathname:a,hash:s}=S.getState().locationState;let r=oe(e);r?r="?"+r:r="",t==="replace"?window.history.replaceState(null,"",a+s+r):window.history.pushState(null,"",a+s+r)};class nt{constructor(){M(this,"updateStateWithLocation",()=>{var m,p,y,d,u;const{pathname:e,search:a,hash:s}=window.location,r=new URLSearchParams(a),c={pathname:"/",hash:"",query:{tag:"",duration:null,text:"",type:""}};c.query.tag=(m=r.get("tag"))!=null?m:"",c.query.type=(p=r.get("type"))!=null?p:"",c.query.text=(y=r.get("text"))!=null?y:"";const i=parseInt((d=r.get("from"))!=null?d:"0"),g=parseInt((u=r.get("to"))!=null?u:"0");g>i&&g!==0&&(c.query.duration={from:i,to:g}),c.hash=s,c.pathname=this.getValidPathname(e),S.dispatch({type:"SET_LOCATION",payload:c})});M(this,"getState",()=>S.getState().locationState);M(this,"clearQuery",()=>{S.dispatch({type:"SET_QUERY",payload:{tag:"",duration:null,text:"",type:""}}),U()});M(this,"setQuery",e=>{S.dispatch({type:"SET_QUERY",payload:e}),U()});M(this,"setHash",e=>{S.dispatch({type:"SET_HASH",payload:{hash:e}}),U()});M(this,"setPathname",e=>{S.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),U()});M(this,"pushHistory",e=>{S.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),U("push")});M(this,"replaceHistory",e=>{S.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),U("replace")});M(this,"setMemoTypeQuery",(e="")=>{S.dispatch({type:"SET_TYPE",payload:{type:e}}),U()});M(this,"setTextQuery",e=>{S.dispatch({type:"SET_TEXT",payload:{text:e}}),U()});M(this,"setTagQuery",e=>{S.dispatch({type:"SET_TAG_QUERY",payload:{tag:e}}),U()});M(this,"setFromAndToQuery",(e,a)=>{S.dispatch({type:"SET_DURATION_QUERY",payload:{duration:{from:e,to:a}}}),U()});M(this,"getValidPathname",e=>["/","/signin","/trash"].includes(e)?e:"/");this.updateStateWithLocation(),window.onpopstate=()=>{this.updateStateWithLocation()}}}const w=new nt;async function G(t){const a=await(await fetch(t,{method:"GET"})).json();if(!a.succeed)throw a;return a}async function L(t,e){const s=await(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(!s.succeed)throw s;return s}function at(){return G("/api/user/me")}function st(t,e){return L("/api/user/signin",{username:t,password:e})}function rt(){return L("/api/user/signout")}function ot(t){return G("/api/user/checkusername?username="+t)}function ct(t){return L("/api/user/checkpassword",{password:t})}function Ee(t="",e=""){return L("/api/user/update",{username:t,password:e})}function it(){return G("/api/memo/all")}function lt(){return G("/api/memo/trash")}function ut(t){return L("/api/memo/new",{content:t})}function dt(t){return L("/api/memo/hide",{memoId:t})}function mt(t){return L("/api/memo/restore",{memoId:t})}function pt(t){return L("/api/memo/delete",{memoId:t})}function ht(t,e){return L("/api/memo/update",{memoId:t,content:e})}function gt(t){return G("/api/memo/linkeds?memoId="+t)}function ft(){return G("/api/memo/stat")}function yt(){return L("/api/user/updategh",{githubName:""})}function Nt(){return G("/api/query/all")}function Ct(t,e){return L("/api/query/new",{title:t,querystring:e})}function Et(t,e,a){return L("/api/query/update",{queryId:t,title:e,querystring:a})}function xt(t){return L("/api/query/delete",{queryId:t})}function St(t){return L("/api/query/pin",{queryId:t})}function bt(t){return L("/api/query/unpin",{queryId:t})}const X="#page-container",Z="mobile-show-sidebar",xe=200,vt=400,$=3600*24*1e3,W=/#\s(.+?)\s/g,Se=/(https?:\/\/[^\s<\\*>']+)/g,Y=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,ce=/\[@(.+?)\]\((.+?)\)/g,ie=[{type:"CONNECTED",text:"\u6709\u5173\u8054"},{type:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{type:"LINKED",text:"\u6709\u8D85\u94FE\u63A5"},{type:"IMAGED",text:"\u6709\u56FE\u7247"}];class wt{getState(){return S.getState().userState}async doSignIn(){const{data:e}=await at();return e?S.dispatch({type:"SIGN_IN",payload:{user:e}}):B.doSignOut(),e}async doSignOut(){rt().catch(()=>{}).finally(()=>{S.dispatch({type:"SIGN_OUT",payload:{user:null}})})}async checkUsernameUsable(e){const{data:a}=await ot(e);return a}async updateUsername(e){await Ee(e)}async removeGithubName(){await yt()}async checkPasswordValid(e){const{data:a}=await ct(e);return a}async updatePassword(e){await Ee("",e)}}const B=new wt;class Ft{getState(){return S.getState().memoState}async fetchAllMemos(){if(!B.getState().user)return!1;const{data:e}=await it(),a=[];for(const s of e)a.push(s);return S.dispatch({type:"SET_MEMOS",payload:{memos:a}}),a}async fetchDeletedMemos(){if(!B.getState().user)return!1;const{data:e}=await lt();return e}pushMemo(e){S.dispatch({type:"INSERT_MEMO",payload:{memo:C({},e)}})}getMemoById(e){for(const a of this.getState().memos)if(a.id===e)return a;return null}async hideMemoById(e){await dt(e),S.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:e}})}async restoreMemoById(e){await mt(e),D.clearMemos(),D.fetchAllMemos()}async deleteMemoById(e){await pt(e)}editMemo(e){S.dispatch({type:"EDIT_MEMO",payload:e})}updateTagsState(){var s;const{memos:e}=this.getState(),a=new Set;for(const r of e)for(const c of Array.from((s=r.content.match(W))!=null?s:[]))a.add(c.replace(W,"$1").trim());S.dispatch({type:"SET_TAGS",payload:{tags:Array.from(a)}})}clearMemos(){S.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(e){const{data:a}=await ut(e);return a}async updateMemo(e,a){const{data:s}=await ht(e,a);return s}async getMemosStat(){const{data:e}=await ft();return e}async getLinkedMemos(e){const{data:a}=await gt(e);return a}getTextWithMemoType(e){for(const a of ie)if(a.type===e)return a.text;return""}}const D=new Ft;class Mt{getState(){return S.getState().queryState}async getMyAllQueries(){if(!B.getState().user)return!1;const{data:e}=await Nt();return S.dispatch({type:"SET_QUERIES",payload:{queries:e}}),e}getQueryById(e){for(const a of this.getState().queries)if(a.id===e)return a}pushQuery(e){S.dispatch({type:"INSERT_QUERY",payload:{query:C({},e)}})}editQuery(e){S.dispatch({type:"EDIT_QUERY",payload:e})}async deleteQuery(e){await xt(e),S.dispatch({type:"DELETE_QUERY_BY_ID",payload:{id:e}})}async createQuery(e,a){const{data:s}=await Ct(e,a);return s}async updateQuery(e,a,s){const{data:r}=await Et(e,a,s);return r}async pinQuery(e){await St(e)}async unpinQuery(e){await bt(e)}}const Q=new Mt;const kt=t=>{const{destory:e,duration:a}=t;return l.exports.useEffect(()=>{a>0&&setTimeout(()=>{e()},a)},[]),n("div",{className:"toast-container",onClick:e,children:n("p",{className:"content-text",children:t.content})})};class Dt{constructor(){M(this,"shownToastAmount",0);M(this,"toastWrapper");M(this,"shownToastContainers",[]);M(this,"info",(e,a=3e3)=>this.showToast({type:"normal",content:e,duration:a}));M(this,"success",(e,a=3e3)=>this.showToast({type:"success",content:e,duration:a}));M(this,"error",(e,a=3e3)=>this.showToast({type:"error",content:e,duration:a}));M(this,"showToast",e=>{const a=document.createElement("div");a.className=`toast-wrapper ${e.type}`,this.toastWrapper.appendChild(a),this.shownToastAmount++,this.shownToastContainers.push(a),setTimeout(()=>{a.classList.add("showup")},0);const s={destory:()=>{a.classList.add("destory"),setTimeout(()=>{if(!!a.parentElement&&(this.shownToastAmount--,this.shownToastAmount===0)){for(const r of this.shownToastContainers)K.unmountComponentAtNode(r),r.remove();this.shownToastContainers.splice(0,this.shownToastContainers.length)}},vt)}};return K.render(n(kt,x(C({},e),{destory:s.destory})),a),s});const e="toast-list-container",a=document.createElement("div");a.className=e,document.body.appendChild(a),this.toastWrapper=a}}var v=new Dt;const At=t=>{const{children:e,className:a,clickSpaceDestroy:s,destroy:r}=t,c=()=>{s&&r()};return n("div",{className:`dialog-wrapper ${a}`,onClick:c,children:n("div",{className:"dialog-container",onClick:i=>i.stopPropagation(),children:e})})};function q(t,e,a){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var g;(g=s.firstElementChild)==null||g.classList.add("showup")},0);const r={destroy:()=>{var g,m;(g=s.firstElementChild)==null||g.classList.remove("showup"),(m=s.firstElementChild)==null||m.classList.add("showoff"),setTimeout(()=>{s.remove(),K.unmountComponentAtNode(s)},xe)}},c=x(C({},a),{destroy:r.destroy});let i=n(At,x(C({destroy:r.destroy,clickSpaceDestroy:!0},t),{children:n(e,C({},c))}));return t.useAppContext&&(i=n(ye,{store:S,context:I,children:i})),K.render(i,s),r}const Tt=({destroy:t})=>{const{userState:e}=l.exports.useContext(I),a=e.user,[s,r]=l.exports.useState(a.username),[c,i]=l.exports.useState(!1),[g,m]=l.exports.useState(!1),p=()=>{t()},y=N=>{const A=N.target.value;r(A)},d=async()=>{if(a.username==="guest"){v.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(s===a.username){i(!1);return}try{if(!await B.checkUsernameUsable(s)){v.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await B.updateUsername(s),await B.doSignIn(),i(!1),v.info("\u4FEE\u6539\u6210\u529F~")}catch(N){v.error(N.message)}},u=()=>{if(a.username==="guest"){v.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}It()},f=async()=>{if(g){try{await B.removeGithubName(),await B.doSignIn()}catch(N){v.error(N.message)}m(!1)}else m(!0)},h=N=>{N.preventDefault()};return o(T,{children:[o("div",{className:"dialog-header-container",children:[o("p",{className:"title-text",children:[n("span",{className:"icon-text",children:"\u{1F920}"}),"\u6211\u7684\u8D26\u53F7"]}),n("button",{className:"text-btn close-btn",onClick:p,children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]}),o("div",{className:"dialog-content-container",children:[o("div",{className:"section-container account-section-container",children:[n("p",{className:"title-text",children:"\u57FA\u672C\u4FE1\u606F"}),o("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text",children:"ID\uFF1A"}),n("span",{className:"normal-text",children:a.id})]}),o("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text",children:"\u521B\u5EFA\u65F6\u95F4\uFF1A"}),n("span",{className:"normal-text",children:V(a.createdAt)})]}),o("label",{className:"form-label input-form-label username-label",children:[n("span",{className:"normal-text",children:"\u8D26\u53F7\uFF1A"}),n("input",{type:"text",readOnly:!c,value:s,onClick:()=>{i(!0)},onChange:y}),o("div",{className:"btns-container",onClick:h,children:[n("span",{className:"text-btn confirm-btn "+(c?"":"hidden"),onClick:d,children:"\u4FDD\u5B58"}),n("span",{className:"text-btn cancel-btn "+(c?"":"hidden"),onClick:()=>{r(a.username),i(!1)},children:"\u64A4\u9500"})]})]}),o("label",{className:"form-label password-label",children:[n("span",{className:"normal-text",children:"\u5BC6\u7801\uFF1A"}),n("span",{className:"text-btn",onClick:u,children:"\u4FEE\u6539\u5BC6\u7801"})]})]}),o("div",{className:"section-container account-section-container",children:[n("p",{className:"title-text",children:"\u5173\u8054\u8D26\u53F7"}),o("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text",children:"GitHub\uFF1A"}),a.githubName?o(T,{children:[n("a",{className:"value-text",href:"https://github.com/"+a.githubName,children:a.githubName}),n("span",{className:`btn-text unbind-btn ${g?"final-confirm":""}`,onMouseLeave:()=>m(!1),onClick:f,children:g?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A"})]}):o(T,{children:[n("span",{className:"value-text",children:"\u65E0"}),n("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"\u524D\u5F80\u7ED1\u5B9A"})]})]})]})]})]})},Bt=({destroy:t})=>{const[e,a]=l.exports.useState(""),[s,r]=l.exports.useState(""),[c,i]=l.exports.useState("");l.exports.useEffect(()=>{},[]);const g=()=>{t()},m=u=>{const f=u.target.value;a(f)},p=u=>{const f=u.target.value;r(f)},y=u=>{const f=u.target.value;i(f)},d=async()=>{if(e===""||s===""||c===""){v.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==c){v.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),i("");return}try{if(!await B.checkPasswordValid(e)){v.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),a("");return}await B.updatePassword(s),v.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),g()}catch(u){v.error(u)}};return o(T,{children:[o("div",{className:"dialog-header-container",children:[n("p",{className:"title-text",children:"\u4FEE\u6539\u5BC6\u7801"}),n("button",{className:"text-btn close-btn",onClick:g,children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]}),o("div",{className:"dialog-content-container",children:[n("p",{className:"tip-text",children:"\u5982\u679C\u662F GitHub \u767B\u5F55\uFF0C\u5219\u521D\u59CB\u5BC6\u7801\u4E3A\u7528\u6237\u540D"}),o("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text "+(e===""?"":"not-null"),children:"\u65E7\u5BC6\u7801"}),n("input",{type:"password",value:e,onChange:m})]}),o("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text "+(s===""?"":"not-null"),children:"\u65B0\u5BC6\u7801"}),n("input",{type:"password",value:s,onChange:p})]}),o("label",{className:"form-label input-form-label",children:[n("span",{className:"normal-text "+(c===""?"":"not-null"),children:"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801"}),n("input",{type:"password",value:c,onChange:y})]}),o("div",{className:"btns-container",children:[n("span",{className:"text-btn cancel-btn",onClick:g,children:"\u53D6\u6D88"}),n("span",{className:"text-btn confirm-btn",onClick:d,children:"\u4FDD\u5B58"})]})]})]})};function It(){q({className:"change-password-dialog"},Bt)}function _t(){q({className:"my-account-dialog",useAppContext:!0},Tt)}const Lt=({destroy:t})=>o(T,{children:[o("div",{className:"dialog-header-container",children:[o("p",{className:"title-text",children:[n("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E ",n("b",{children:"Memos"})]}),n("button",{className:"text-btn close-btn",onClick:()=>{t()},children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]}),o("div",{className:"dialog-content-container",children:[n("p",{children:"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"}),n("br",{}),n("i",{children:"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"}),o("ul",{children:[o("li",{children:["\u5B9E\u8DF5 ",n("strong",{children:"\u5362\u66FC\u5361\u7247\u76D2\u7B14\u8BB0\u6CD5"}),"\uFF1B"]}),n("li",{children:"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5} \u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1} \u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5} \u8BFB\u540E\u611F..."}),n("li",{children:"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"}),n("li",{children:"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B"})]}),n("br",{}),n("i",{children:"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"}),o("ul",{children:[o("li",{children:["\u2728"," ",n("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer",children:"\u5F00\u6E90\u9879\u76EE"})]}),n("li",{children:"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"}),n("li",{children:"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B"})]}),n("br",{}),n("p",{children:"Enjoy it and have fun~ "}),n("hr",{}),o("p",{className:"normal-text",children:["Last updated on ",n("span",{className:"pre-text",children:"2021/10/28 15:04:39"})," \u{1F389}"]})]})]});function be(){q({className:"about-site-dialog"},Lt)}const Ot=({destroy:t})=>{const{globalState:{shouldHideImageUrl:e,shouldSplitMemoWord:a,shouldUseMarkdownParser:s}}=l.exports.useContext(I);return l.exports.useEffect(()=>{},[]),o(T,{children:[o("div",{className:"dialog-header-container",children:[o("p",{className:"title-text",children:[n("span",{className:"icon-text",children:"\u2699\uFE0F"}),"\u504F\u597D\u8BBE\u7F6E"]}),n("button",{className:"text-btn close-btn",onClick:()=>{t()},children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]}),o("div",{className:"dialog-content-container",children:[o("div",{className:"section-container preferences-section-container",children:[n("p",{className:"title-text",children:"Memo \u663E\u793A\u76F8\u5173"}),o("label",{className:"form-label checkbox-form-label",children:[n("span",{className:"normal-text",children:"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"}),n("img",{className:"icon-img",src:a?"/icons/checkbox-active.svg":"/icons/checkbox.svg"}),n("input",{className:"hidden",type:"checkbox",checked:a,onChange:p=>{const y=p.target.checked;_.setAppSetting({shouldSplitMemoWord:y})}})]}),o("label",{className:"form-label checkbox-form-label",children:[n("span",{className:"normal-text",children:"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"}),n("img",{className:"icon-img",src:e?"/icons/checkbox-active.svg":"/icons/checkbox.svg"}),n("input",{className:"hidden",type:"checkbox",checked:e,onChange:p=>{const y=p.target.checked;_.setAppSetting({shouldHideImageUrl:y})}})]}),o("label",{className:"form-label checkbox-form-label",children:[n("span",{className:"normal-text",children:"markdown \u683C\u5F0F\u89E3\u6790"}),n("img",{className:"icon-img",src:s?"/icons/checkbox-active.svg":"/icons/checkbox.svg"}),n("input",{className:"hidden",type:"checkbox",checked:s,onChange:p=>{const y=p.target.checked;_.setAppSetting({shouldUseMarkdownParser:y})}}),n("span",{className:"tip-text",children:"\u652F\u6301\u5217\u8868\u3001\u52A0\u7C97/\u659C\u4F53\u3001\u4EE3\u7801\u5757"})]})]}),o("div",{className:"section-container hidden",children:[n("p",{className:"title-text",children:"\u5176\u4ED6"}),n("div",{className:"btn-container",children:n("button",{className:"btn export-btn",onClick:async()=>{await D.fetchAllMemos();const p=D.getState().memos.map(u=>C({},u)),y=JSON.stringify(p),d=document.createElement("a");d.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(y)),d.setAttribute("download","data.json"),d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d)},children:"\u5BFC\u51FA\u6570\u636E(JSON)"})})]})]})]})};function Qt(){q({className:"preferences-dialog",useAppContext:!0},Ot)}const Ut=()=>o("div",{className:"menu-btns-popup",onClick:i=>{i.stopPropagation()},children:[o("button",{className:"text-btn action-btn",onClick:()=>{_t()},children:[n("span",{className:"icon",children:"\u{1F920}"})," \u6211\u7684\u8D26\u53F7"]}),o("button",{className:"text-btn action-btn",onClick:()=>{Qt()},children:[n("span",{className:"icon",children:"\u2699\uFE0F"})," \u504F\u597D\u8BBE\u7F6E"]}),o("button",{className:"text-btn action-btn",onClick:()=>{w.pushHistory("/trash")},children:[n("span",{className:"icon",children:"\u{1F5D1}\uFE0F"})," \u56DE\u6536\u7AD9"]}),o("button",{className:"text-btn action-btn",onClick:()=>{be()},children:[n("span",{className:"icon",children:"\u{1F600}"})," \u5173\u4E8E"]}),o("button",{className:"text-btn action-btn",onClick:async()=>{await B.doSignOut(),w.replaceHistory("/signin")},children:[n("span",{className:"icon",children:"\u{1F44B}"})," \u9000\u51FA"]})]});function z(t=!1){const[e,a]=l.exports.useState(t),s=l.exports.useCallback(r=>{a(r!==void 0?r:c=>!c)},[]);return[e,s]}function ee(){const[t,e]=l.exports.useState({isLoading:!0,isFailed:!1,isSucceed:!1});return x(C({},t),{setLoading:()=>{e(x(C({},t),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{e(x(C({},t),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{e(x(C({},t),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const Pt=({destroy:t,imgUrl:e})=>{const a=l.exports.useRef(null),[s,r]=l.exports.useState(-1);l.exports.useEffect(()=>{We(e).then(({width:m})=>{r(m!==0?80:0)})},[]);const c=()=>{t()},i=()=>{s>30&&r(s-10)},g=()=>{r(s+10)};return o(T,{children:[n("button",{className:"text-btn close-btn",onClick:c,children:n("img",{className:"icon-img",src:"/icons/close.svg"})}),o("div",{className:"img-container",children:[n("img",{className:s<=0?"hidden":"",ref:a,width:s+"%",src:e}),n("span",{className:"loading-text "+(s===-1?"":"hidden"),children:"\u56FE\u7247\u52A0\u8F7D\u4E2D..."}),n("span",{className:"loading-text "+(s===0?"":"hidden"),children:"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5"})]}),o("div",{className:"action-btns-container",children:[n("button",{className:"text-btn",onClick:i,children:"\u2796"}),n("button",{className:"text-btn",onClick:g,children:"\u2795"}),n("button",{className:"text-btn",onClick:()=>r(80),children:"\u2B55"})]})]})};function ve(t){q({className:"preview-image-dialog"},Pt,{imgUrl:t})}const Rt=/```([\s\S]*?)```/g,$t=/\*\*(.+?)\*\*/g,qt=/\*(.+?)\*/g,Ht=/\[ \] /g,Gt=/\[x\] /g,Yt=/[*] /g,Vt=/(\d+)\. /g,jt=t=>t.replace(Rt,"<pre lang=''>$1</pre>").replace(Yt,"<span class='counter-block'>-</span>").replace(Vt,"<span class='counter-block'>$1.</span>").replace(Ht,"<span class='todo-block' data-type='todo'>\u2B1C</span>").replace(Gt,"<span class='todo-block' data-type='done'>\u2705</span>").replace($t,"<strong>$1</strong>").replace(qt,"<em>$1</em>"),te=t=>{const e=document.createElement("div");e.className="memo-content-text",e.innerHTML=t,document.body.appendChild(e);const a=e.innerText;return e.remove(),a},Wt=t=>t.replace(/\n/g,"<br>"),Kt=t=>{const{children:e,when:a}=t;return a?n(T,{children:e}):null},P=Kt;const le=t=>{const{className:e,imgUrl:a}=t,s=()=>{ve(a)};return n("div",{className:"image-container "+e,onClick:s,children:n("img",{src:a,decoding:"async",loading:"lazy"})})};const zt=t=>{var d,u;const[e,a]=l.exports.useState(x(C({},t.memo),{formattedContent:H(t.memo.content),createdAtStr:O(t.memo.createdAt)})),[s,r]=l.exports.useState([]),[c,i]=l.exports.useState([]),g=Array.from((d=e.content.match(Y))!=null?d:[]);l.exports.useEffect(()=>{(async()=>{try{const h=[],N=[...e.content.matchAll(ce)];for(const E of N)if(E&&E.length===3){const k=E[2],b=D.getMemoById(k);b&&h.push(x(C({},b),{formattedContent:H(b.content),createdAtStr:O(b.createdAt),dateStr:V(b.createdAt)}))}r([...h]);const A=await D.getLinkedMemos(e.id);i(A.sort((E,k)=>F(k.createdAt)-F(E.createdAt)).map(E=>x(C({},E),{formattedContent:H(E.content),createdAtStr:O(E.createdAt),dateStr:V(E.createdAt)})))}catch(h){}})()},[e.id]);const m=l.exports.useCallback(async f=>{var N;const h=f.target;if(h.className==="memo-link-text"){const A=(N=h.dataset)==null?void 0:N.value,E=D.getMemoById(A!=null?A:"");if(E){const k=x(C({},E),{formattedContent:H(E.content),createdAtStr:O(E.createdAt)});r([]),i([]),a(k)}else v.error("MEMO Not Found"),h.classList.remove("memo-link-text")}},[]),p=l.exports.useCallback(f=>{r([]),i([]),a(f)},[]),y=l.exports.useCallback(()=>{t.destroy(),_.setEditMemoId(e.id)},[e.id]);return o(T,{children:[o("div",{className:"memo-card-container",children:[o("div",{className:"header-container",children:[n("p",{className:"time-text",children:e.createdAtStr}),o("div",{className:"btns-container",children:[n("button",{className:"text-btn edit-btn",onClick:y,children:n("img",{className:"icon-img",src:"/icons/edit.svg"})}),n("button",{className:"text-btn close-btn",onClick:t.destroy,children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]})]}),o("div",{className:"memo-container",children:[n("div",{className:"memo-content-text",onClick:m,dangerouslySetInnerHTML:{__html:(u=e.formattedContent)!=null?u:""}}),n(P,{when:g.length>0,children:n("div",{className:"images-wrapper",children:g.map((f,h)=>n(le,{className:"memo-img",imgUrl:f},h))})})]}),n("div",{className:"layer-container"}),s.map((f,h)=>h<4?n("div",{className:"background-layer-container",style:{bottom:(h+1)*-3+"px",left:(h+1)*5+"px",width:`calc(100% - ${(h+1)*10}px)`,zIndex:-h-1}},h):null)]}),s.length>0?o("div",{className:"linked-memos-wrapper",children:[o("p",{className:"normal-text",children:["\u5173\u8054\u4E86 ",s.length," \u4E2A MEMO"]}),s.map(f=>{const h=te(f.formattedContent).replaceAll(`
`," ");return o("div",{className:"linked-memo-container",onClick:()=>p(f),children:[o("span",{className:"time-text",children:[f.dateStr," "]}),h]},f.id)})]}):null,c.length>0?o("div",{className:"linked-memos-wrapper",children:[o("p",{className:"normal-text",children:[c.length," \u6761\u94FE\u63A5\u81F3\u6B64\u7684 MEMO"]}),c.map(f=>{const h=te(f.formattedContent).replaceAll(`
`," ");return o("div",{className:"linked-memo-container",onClick:()=>p(f),children:[o("span",{className:"time-text",children:[f.dateStr," "]}),h]},f.id)})]}):null]})};function we(t){q({className:"memo-card-dialog"},zt,{memo:t})}const Jt=t=>{var f;const{memo:e,destroy:a}=t,[s,r]=l.exports.useState(""),c=l.exports.useRef(null),{user:i}=B.getState(),g=x(C({},e),{formattedContent:H(e.content),createdAtStr:O(e.createdAt)}),m=Array.from((f=g.content.match(Y))!=null?f:[]),[p,y]=l.exports.useState(m.length);l.exports.useEffect(()=>{setTimeout(()=>{if(!!c.current&&p===0){const h=Ne();(h==="MacOS"||h==="Unknown")&&window.scrollTo(0,0),html2canvas(c.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(N=>{r(N.toDataURL())})}},xe+100)},[p]);const d=()=>{a()},u=h=>{h.type==="error"&&(v.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),h.target.remove()),y(p-1)};return o(T,{children:[o("div",{className:"dialog-header-container",children:[o("p",{className:"title-text",children:[n("span",{className:"icon-text",children:"\u{1F970}"}),"\u5206\u4EAB Memo \u56FE\u7247"]}),n("button",{className:"text-btn close-btn",onClick:d,children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]}),o("div",{className:"dialog-content-container",children:[n("div",{className:`tip-words-container ${s?"finished":"genarating"}`,children:n("p",{className:"tip-text",children:s?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D..."})}),n("img",{className:"memo-img",src:s}),o("div",{className:"memo-container",ref:c,children:[n("span",{className:"time-text",children:g.createdAtStr}),n("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:g.formattedContent}}),n(P,{when:m.length>0,children:n("div",{className:"images-container",children:m.map((h,N)=>n("img",{crossOrigin:"anonymous",src:h,onLoad:u,onError:u,decoding:"async"},N))})}),n("div",{className:"watermark-container",children:o("span",{className:"normal-text",children:["by ",n("span",{className:"name-text",children:i==null?void 0:i.username})]})})]})]})]})};function Xt(t){q({className:"share-memo-image-dialog"},Jt,{memo:t})}const Zt=t=>{var f;const{memo:e}=t,a=x(C({},e),{formattedContent:H(e.content),createdAtStr:O(e.createdAt)}),[s,r]=z(!1),c=Array.from((f=a.content.match(Y))!=null?f:[]),i=()=>{we(a)},g=()=>{_.setMarkMemoId(a.id)},m=()=>{_.setEditMemoId(a.id)},p=async()=>{if(s){try{await D.hideMemoById(a.id)}catch(h){v.error(h.message)}_.getState().editMemoId===a.id&&_.setEditMemoId("")}else r()},y=()=>{s&&r(!1)},d=()=>{Xt(a)},u=async h=>{var A;const N=h.target;if(N.className==="memo-link-text"){const E=(A=N.dataset)==null?void 0:A.value,k=D.getMemoById(E!=null?E:"");k?we(k):(v.error("MEMO Not Found"),N.classList.remove("memo-link-text"))}else N.className==="todo-block"};return o("div",{className:`memo-wrapper ${"memos-"+a.id}`,onMouseLeave:y,children:[o("div",{className:"memo-top-wrapper",children:[n("span",{className:"time-text",onClick:i,children:a.createdAtStr}),o("div",{className:"btns-container",children:[n("span",{className:"text-btn more-action-btn",children:n("img",{className:"icon-img",src:"/icons/more.svg"})}),n("div",{className:"more-action-btns-wrapper",children:o("div",{className:"more-action-btns-container",children:[n("span",{className:"text-btn",onClick:i,children:"\u67E5\u770B\u8BE6\u60C5"}),n("span",{className:"text-btn",onClick:g,children:"Mark"}),n("span",{className:"text-btn",onClick:d,children:"\u5206\u4EAB"}),n("span",{className:"text-btn",onClick:m,children:"\u7F16\u8F91"}),n("span",{className:`text-btn delete-btn ${s?"final-confirm":""}`,onClick:p,children:s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]}),n("div",{className:"memo-content-text",onClick:u,dangerouslySetInnerHTML:{__html:a.formattedContent}}),n(P,{when:c.length>0,children:n("div",{className:"images-wrapper",children:c.map((h,N)=>n(le,{className:"memo-img",imgUrl:h},N))})})]})};function H(t){var c;const e=document.createElement("div");e.innerHTML=Wt(t).split("<br>").map(i=>i!==""?`<p>${i}</p>`:"<br>").join(""),t=e.innerHTML;const{shouldUseMarkdownParser:a,shouldSplitMemoWord:s,shouldHideImageUrl:r}=_.getState();a&&(t=jt(t)),r&&(t=t.replace(Y,"")),e.innerHTML=t;for(const i of e.querySelectorAll("p"))i.textContent===""&&((c=i.firstElementChild)==null?void 0:c.tagName)!=="BR"&&i.remove();return t=e.innerHTML,t=t.replace(W,"<span class='tag-span'>#$1</span>").replace(Se,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(ce,"<span class='memo-link-text' data-value='$2'>$1</span>"),s&&(t=t.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)/g,"$1 $2").replace(/([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5])/g,"$1 $2")),t}var en=l.exports.memo(Zt);const tn=t=>{var r;const{memo:e}=t,a=x(C({},e),{formattedContent:H(e.content),createdAtStr:O(e.createdAt),timeStr:Ye(e.createdAt)}),s=Array.from((r=a.content.match(Y))!=null?r:[]);return o("div",{className:"daily-memo-wrapper",children:[n("div",{className:"time-wrapper",children:n("span",{className:"normal-text",children:a.timeStr})}),o("div",{className:"memo-content-container",children:[n("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:a.formattedContent}}),n(P,{when:s.length>0,children:n("div",{className:"images-container",children:s.map((c,i)=>n("img",{crossOrigin:"anonymous",src:c,decoding:"async"},i))})})]})]})};const nn=t=>{const{className:e,datestamp:a,handleDateStampChange:s}=t,[r,c]=l.exports.useState(ue(a));l.exports.useEffect(()=>{c(ue(a))},[a]);const i=new Date(r),g=i.getDay()===0?7:i.getDay(),m=[];for(let u=1;u<g;u++)m.push({date:0,datestamp:i.getTime()-$*(7-u)});const p=an(r);for(let u=1;u<=p;u++)m.push({date:u,datestamp:i.getTime()+$*(u-1)});const y=u=>{s(u)},d=u=>{const f=i.getFullYear(),h=i.getMonth()+1;let N=0;h===1&&u===-1?N=new Date(`${f-1}/12/1`).getTime():h===12&&u===1?N=new Date(`${f+1}/1/1`).getTime():N=new Date(`${f}/${h+u}/1`).getTime(),c(ue(N))};return o("div",{className:`date-picker-wrapper ${e}`,children:[o("div",{className:"date-picker-header",children:[n("span",{className:"btn-text",onClick:()=>d(-1),children:n("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),o("span",{className:"normal-text",children:[i.getFullYear()," \u5E74 ",i.getMonth()+1," \u6708"]}),n("span",{className:"btn-text",onClick:()=>d(1),children:n("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),o("div",{className:"date-picker-day-container",children:[o("div",{className:"date-picker-day-header",children:[n("span",{className:"day-item",children:"\u5468\u4E00"}),n("span",{className:"day-item",children:"\u5468\u4E8C"}),n("span",{className:"day-item",children:"\u5468\u4E09"}),n("span",{className:"day-item",children:"\u5468\u56DB"}),n("span",{className:"day-item",children:"\u5468\u4E94"}),n("span",{className:"day-item",children:"\u5468\u516D"}),n("span",{className:"day-item",children:"\u5468\u65E5"})]}),m.map(u=>u.date===0?n("span",{className:"day-item null",children:""},u.datestamp):n("span",{className:`day-item ${u.datestamp===a?"current":""}`,onClick:()=>y(u.datestamp),children:u.date},u.datestamp))]})]})};function an(t){const e=new Date(t),a=new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`);return((a.getMonth()===11?new Date(`${a.getFullYear()+1}/1`):new Date(`${a.getFullYear()}/${a.getMonth()+2}/1`)).getTime()-a.getTime())/$}function ue(t){const e=new Date(t);return new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`).getTime()}const sn=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],rn=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],on=t=>{const e=ee(),[a,s]=l.exports.useState([]),[r,c]=l.exports.useState(re(V(t.currentDateStamp))),[i,g]=z(!1),m=l.exports.useRef(null),p=new Date(r);l.exports.useEffect(()=>{(()=>{const f=D.getState().memos.filter(h=>F(h.createdAt)>=r&&F(h.createdAt)<r+$).sort((h,N)=>F(h.createdAt)-F(N.createdAt));s(f),e.setFinish()})()},[r]);const y=()=>{g(!1),setTimeout(()=>{if(!m.current)return;const u=Ne();(u==="MacOS"||u==="Unknown")&&window.scrollTo(0,0),html2canvas(m.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(f=>{ve(f.toDataURL())})},0)},d=u=>{c(u),g(!1)};return o(T,{children:[n("div",{className:"dialog-header-container",children:o("div",{className:"btns-wrapper",children:[o("div",{className:"btns-container",children:[n("span",{className:"btn-text",onClick:()=>c(r-$),children:n("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),n("span",{className:"btn-text",onClick:()=>c(r+$),children:n("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),o("div",{className:"btns-container",children:[n("span",{className:"btn-text",onClick:y,children:n("img",{className:"icon-img",src:"/icons/share.svg"})}),n("span",{className:"btn-text",onClick:()=>t.destroy(),children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]})]})}),o("div",{className:"dialog-content-container",ref:m,children:[o("div",{className:"date-card-container",onClick:()=>g(),children:[n("div",{className:"year-text",children:p.getFullYear()}),o("div",{className:"date-container",children:[n("div",{className:"month-text",children:sn[p.getMonth()]}),n("div",{className:"date-text",children:p.getDate()}),n("div",{className:"day-text",children:rn[p.getDay()]})]})]}),n(nn,{className:`date-picker ${i?"":"hide"}`,datestamp:r,handleDateStampChange:d}),e.isLoading?n("div",{className:"tip-container",children:n("p",{className:"tip-text",children:"\u52AA\u529B\u52A0\u8F7D\u4E2D..."})}):a.length===0?n("div",{className:"tip-container",children:n("p",{className:"tip-text",children:"\u7A7A\u7A7A\u5982\u4E5F"})}):n("div",{className:"dailymemos-wrapper",children:a.map(u=>n(tn,{memo:u},`${u.id}-${u.updatedAt}`))})]})]})};function cn(t=Date.now()){q({className:"daily-memo-diary-dialog"},on,{currentDateStamp:t})}const ln=()=>{const{userState:{user:t},memoState:{memos:e,tags:a}}=l.exports.useContext(I),s=t?t.username:"Memos",r=t?Math.ceil((Date.now()-F(t.createdAt))/1e3/3600/24):0,c=l.exports.useCallback(()=>{w.pushHistory("/"),w.clearQuery()},[]);return o("div",{className:"user-banner-container",children:[o("div",{className:"userinfo-header-container",children:[n("p",{className:"username-text",onClick:c,children:s}),n("span",{className:"action-btn menu-popup-btn",onMouseEnter:()=>{const g=document.querySelector(".sidebar-wrapper"),m=document.querySelector(".menu-btns-popup");m.style.top=54-g.scrollTop+"px"},children:n("img",{src:"/icons/more.svg",className:"icon-img"})}),n(Ut,{})]}),o("div",{className:"status-text-container",children:[o("div",{className:"status-text memos-text",children:[n("span",{className:"amount-text",children:e.length}),n("span",{className:"type-text",children:"MEMO"})]}),o("div",{className:"status-text tags-text",children:[n("span",{className:"amount-text",children:a.length}),n("span",{className:"type-text",children:"TAG"})]}),o("div",{className:"status-text duration-text",onClick:()=>cn(),children:[n("span",{className:"amount-text",children:r}),n("span",{className:"type-text",children:"DAY"})]})]})]})};const un=t=>{const{destroy:e,queryId:a}=t,{query:s}=w.getState(),[r,c]=l.exports.useState(""),[i,g]=l.exports.useState(JSON.stringify(Ce(s)));l.exports.useEffect(()=>{const d=Q.getQueryById(a!=null?a:"");d&&(c(d.title),g(d.querystring))},[a]);const m=d=>{const u=d.target.value;c(u)},p=d=>{const u=d.target.value;g(u)},y=async()=>{if(!r){v.error("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A\uFF01");return}try{if(a){const d=await Q.updateQuery(a,r,i);Q.editQuery(d)}else{const d=await Q.createQuery(r,i);Q.pushQuery(d)}}catch(d){v.error(d.message)}e()};return o(T,{children:[o("div",{className:"dialog-header-container",children:[o("p",{className:"title-text",children:[n("span",{className:"icon-text",children:"\u{1F516}"}),a?"\u7F16\u8F91\u68C0\u7D22":"\u521B\u5EFA\u68C0\u7D22"]}),n("button",{className:"text-btn close-btn",onClick:e,children:n("img",{className:"icon-img",src:"/icons/close.svg"})})]}),o("div",{className:"dialog-content-container",children:[o("p",{className:"tip-text",children:["\u26A0\uFE0F \u8FD9\u662F\u4E00\u4E2A\u5B9E\u9A8C\u6027\u529F\u80FD\uFF01",n("br",{}),'\u901A\u8FC7\u4F7F\u7528"\u68C0\u7D22"\u7684\u6307\u5B9A\u6807\u7B7E\u3001\u6587\u672C\u3001\u65F6\u95F4\u6BB5\u7B49\uFF0C\u53EF\u4EE5\u5BF9 Memos \u8FDB\u884C\u5FEB\u901F\u5206\u7C7B\u3002',n("br",{}),'\u{1F4A1} Idea comes from "The Archive"']}),o("div",{className:"form-item-container input-form-container",children:[n("span",{className:"normal-text",children:"\u6807\u9898"}),n("input",{type:"text",value:r,onChange:m})]}),o("div",{className:"form-item-container input-form-container",children:[n("span",{className:"normal-text",children:"\u8FC7\u6EE4\u5668"}),n("textarea",{value:JSON.stringify(JSON.parse(i),null,2),disabled:!0,onChange:p})]})]}),o("div",{className:"dialog-footer-container",children:[n("div",{}),n("div",{className:"btns-container",children:n("button",{className:"text-btn save-btn",onClick:y,children:"\u4FDD\u5B58"})})]})]})};function de(t){q({className:"create-query-dialog"},un,{queryId:t})}const dn=()=>{const{queryState:{queries:t}}=l.exports.useContext(I),e=ee(),a=t.sort((s,r)=>F(r.createdAt)-F(s.createdAt)).sort((s,r)=>{var c,i;return F((c=r.pinnedAt)!=null?c:0)-F((i=s.pinnedAt)!=null?i:0)});return l.exports.useEffect(()=>{Q.getMyAllQueries().catch(()=>{}).finally(()=>{e.setFinish()})},[]),o("div",{className:"queries-wrapper",children:[o("p",{className:"title-text",children:[n("span",{className:"normal-text",children:"\u5FEB\u901F\u68C0\u7D22"}),n("span",{className:"text-btn",onClick:()=>de(),children:"+"})]}),n(P,{when:e.isSucceed&&a.length===0,children:n("div",{className:"create-query-btn-container",children:n("span",{className:"text-btn",onClick:()=>de(),children:"\u521B\u5EFA\u68C0\u7D22"})})}),n("div",{className:"queries-container",children:a.map(s=>{const r=JSON.parse(s.querystring),i="?"+oe(r)===window.location.search;return n(mn,{query:s,isActive:i},s.id)})})]})},mn=t=>{const{query:e,isActive:a}=t,s=JSON.parse(e.querystring),[r,c]=z(!1),i=()=>{a?w.clearQuery():w.setQuery(s)},g=async d=>{if(d.stopPropagation(),r)try{await Q.deleteQuery(e.id)}catch(u){v.error(u.message)}else c()},m=d=>{d.stopPropagation(),de(e.id)},p=async d=>{d.stopPropagation();try{e.pinnedAt?(await Q.unpinQuery(e.id),Q.editQuery(x(C({},e),{pinnedAt:void 0}))):(await Q.pinQuery(e.id),Q.editQuery(x(C({},e),{pinnedAt:O(Date.now())})))}catch(u){}},y=d=>{d.stopPropagation(),c(!1)};return n(T,{children:o("div",{className:`query-item-container ${a?"active":""}`,onClick:i,children:[o("div",{className:"query-text-container",children:[n("span",{className:"icon-text",children:"#"}),n("span",{className:"query-text",children:e.title})]}),o("div",{className:"btns-container",children:[n("span",{className:"action-btn toggle-btn",children:n("img",{className:"icon-img",src:`/icons/more${a?"-white":""}.svg`})}),n("div",{className:"action-btns-wrapper",children:o("div",{className:"action-btns-container",children:[n("span",{className:"text-btn",onClick:p,children:e.pinnedAt?"\u53D6\u6D88\u7F6E\u9876":"\u7F6E\u9876"}),n("span",{className:"text-btn",onClick:m,children:"\u7F16\u8F91"}),n("span",{className:`text-btn delete-btn ${r?"final-confirm":""}`,onClick:g,onMouseLeave:y,children:r?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]})})};const pn=()=>{const{locationState:{query:{tag:t}},memoState:{tags:e,memos:a}}=l.exports.useContext(I),[s,r]=l.exports.useState([]);return l.exports.useEffect(()=>{D.updateTagsState()},[a]),l.exports.useEffect(()=>{const c=Array.from(e).sort(),i={subTags:[]};for(const g of c){const m=g.split("/");let p=i,y="";for(let d=0;d<m.length;d++){const u=m[d];d===0?y+=u:y+="/"+u;let f=null;for(const h of p.subTags)if(h.text===y){f=h;break}f||(f={key:u,text:y,subTags:[]},p.subTags.push(f)),p=f}}r(i.subTags)},[e]),o("div",{className:"tags-wrapper",children:[n("p",{className:"title-text",children:"\u5E38\u7528\u6807\u7B7E"}),o("div",{className:"tags-container",children:[s.map((c,i)=>n(Fe,{tag:c,tagQuery:t},c.text+"-"+i)),n(P,{when:s.length<5,children:o("p",{className:"tag-tip-container",children:["\u8F93\u5165",n("span",{className:"code-text",children:"# Tag "}),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~"]})})]})]})},Fe=t=>{const{tag:e,tagQuery:a}=t,s=a===e.text,r=e.subTags.length>0,[c,i]=z(!1),g=()=>{s?w.setTagQuery(""):(je(`# ${e.text} `),w.setTagQuery(e.text))},m=p=>{p.stopPropagation(),i()};return o(T,{children:[o("div",{className:`tag-item-container ${s?"active":""}`,onClick:g,children:[o("div",{className:"tag-text-container",children:[n("span",{className:"icon-text",children:"#"}),n("span",{className:"tag-text",children:e.key})]}),n("div",{className:"btns-container",children:r?n("span",{className:`action-btn toggle-btn ${c?"shown":""}`,onClick:m,children:n("img",{className:"icon-img",src:"/icons/arrow-right.svg"})}):null})]}),r?n("div",{className:`subtags-container ${c?"":"hidden"}`,children:e.subTags.map((p,y)=>n(Fe,{tag:p,tagQuery:a},p.text+"-"+y))}):null]})};const Me={width:12,height:7},ke=(t,e)=>{const a=[];for(let s=1;s<=t;s++)a.push({timestamp:e+$*s,count:0});return a},hn=()=>{const t=re(Date.now()),e=new Date(t).getDay()||7,a=new Array(7-e).fill(0),s=(Me.width-1)*Me.height+e,r=t-s*$,{memoState:{memos:c}}=l.exports.useContext(I),[i,g]=l.exports.useState(ke(s,r)),[m,p]=l.exports.useState(null),[y,d]=l.exports.useState(null),u=l.exports.useRef(null),f=l.exports.useRef(null);l.exports.useEffect(()=>{const E=ke(s,r);for(const k of c){const b=(re(k.createdAt)-r)/(1e3*3600*24)-1;b>=0&&(E[b].count+=1)}g([...E])},[c]);const h=l.exports.useCallback((E,k)=>{var he,ge;if(p(k),!f.current)return;const{isMobileView:b}=_.getState(),R=E.target,ne=document.querySelector(".sidebar-wrapper");f.current.style.left=R.offsetLeft-((ge=(he=u.current)==null?void 0:he.offsetLeft)!=null?ge:0)+"px";let pe=R.offsetTop;b||(pe-=ne.scrollTop),f.current.style.top=pe+"px"},[]),N=l.exports.useCallback(()=>{p(null)},[]),A=l.exports.useCallback(E=>{var k;((k=w.getState().query.duration)==null?void 0:k.from)===E.timestamp?(w.setFromAndToQuery(0,0),d(null)):E.count>0&&(w.setFromAndToQuery(E.timestamp,E.timestamp+$),d(E))},[]);return o("div",{className:"usage-heat-map-wrapper",ref:u,children:[o("div",{className:"day-tip-text-container",children:[n("span",{className:"tip-text",children:"Mon"}),n("span",{className:"tip-text"}),n("span",{className:"tip-text",children:"Wed"}),n("span",{className:"tip-text"}),n("span",{className:"tip-text",children:"Fri"}),n("span",{className:"tip-text"}),n("span",{className:"tip-text",children:"Sun"})]}),o("div",{ref:f,className:"usage-detail-container pop-up "+(m?"":"hidden"),children:[m==null?void 0:m.count," memos on ",n("span",{className:"date-text",children:new Date(m==null?void 0:m.timestamp).toDateString()})]}),o("div",{className:"usage-heat-map",children:[i.map((E,k)=>{const b=E.count,R=b<=0?"":b<=1?"stat-day-L1-bg":b<=2?"stat-day-L2-bg":b<=4?"stat-day-L3-bg":"stat-day-L4-bg";return n("span",{className:`stat-container ${R} ${y===E?"current":""} ${t===E.timestamp?"today":""}`,onMouseEnter:ne=>h(ne,E),onMouseLeave:N,onClick:()=>A(E)},k)}),a.map((E,k)=>n("span",{className:"stat-container null"},k))]})]})};const gn=()=>{const{locationState:t}=l.exports.useContext(I);l.exports.useEffect(()=>{const a=document.querySelector(X);a==null||a.classList.remove(Z)},[t]);const e=l.exports.useCallback(a=>{if(a.stopPropagation(),a.target.className==="sidebar-wrapper"){const r=document.querySelector(X);r==null||r.classList.remove(Z)}},[]);return o("aside",{className:"sidebar-wrapper",onClick:e,children:[n(ln,{}),n(hn,{}),n(dn,{}),n(pn,{})]})};function fn(){const{locationState:{pathname:t}}=l.exports.useContext(I),e=ee();return l.exports.useEffect(()=>{const{user:a}=B.getState();a?e.setFinish():B.doSignIn().catch(()=>{}).finally(()=>{B.getState().user?e.setFinish():w.replaceHistory("/signin")})},[]),l.exports.useEffect(()=>{t!=="/"&&w.clearQuery()},[t]),n(T,{children:e.isLoading?null:o("section",{id:"page-container",children:[n(gn,{}),n("main",{className:"content-wrapper",children:In(t)})]})})}const yn=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function De(t,e){return e.minLength!==void 0&&t.length<e.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:e.maxLength!==void 0&&t.length>e.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:e.noSpace&&t.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:e.noChinese&&yn.test(t)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const Ae={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},Nn=()=>{const[t,e]=l.exports.useState(""),[a,s]=l.exports.useState(""),r=l.exports.useRef(null);l.exports.useEffect(()=>{const p=y=>{var d;y.key==="Enter"&&((d=r.current)==null||d.click())};return document.body.addEventListener("keypress",p),()=>{document.body.removeEventListener("keypress",p)}},[]);const c=p=>{const y=p.target.value;e(y)},i=p=>{const y=p.target.value;s(y)},g=()=>{be()},m=async()=>{const p=De(t,Ae);if(!p.result){v.error("\u7528\u6237\u540D "+p.reason);return}const y=De(a,Ae);if(!y.result){v.error("\u5BC6\u7801 "+y.reason);return}try{const d=st,{succeed:u,message:f}=await d(t,a);if(!u&&f){v.error("\u{1F61F} "+f);return}await B.doSignIn()?w.replaceHistory("/"):v.error("\u{1F61F} \u767B\u5F55\u5931\u8D25")}catch(d){console.error(d),v.error("\u{1F61F} "+d.message)}};return n("div",{className:"page-wrapper signin",children:o("div",{className:"page-container",children:[n("div",{className:"page-header-container",children:o("p",{className:"title-text",children:[n("span",{className:"icon-text",children:"\u{1F44B}"})," \u8D26\u53F7\u6CE8\u518C / \u767B\u5F55"]})}),o("div",{className:"page-content-container",children:[o("div",{className:"form-item-container input-form-container",children:[n("span",{className:"normal-text "+(t===""?"":"not-null"),children:"\u8D26\u53F7"}),n("input",{type:"text",value:t,onChange:c})]}),o("div",{className:"form-item-container input-form-container",children:[n("span",{className:"normal-text "+(a===""?"":"not-null"),children:"\u5BC6\u7801"}),n("input",{type:"password",value:a,onChange:i})]})]}),o("div",{className:"page-footer-container",children:[n("div",{className:"btns-container",children:n("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"Sign In with GitHub"})}),o("div",{className:"btns-container",children:[n("button",{className:"text-btn signup-btn disabled",onClick:()=>v.info("\u6CE8\u518C\u5DF2\u5173\u95ED"),children:"\u6CE8\u518C"}),n("span",{className:"split-text",children:"/"}),n("button",{className:"text-btn signin-btn",ref:r,onClick:m,children:"\u767B\u5F55"})]})]}),o("p",{className:"tip-text",children:["\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\uFF0C\u53EF\u8F93\u5165 ",n("code",{children:"guest, 123456"})," \u8FDB\u884C\u4F53\u9A8C\u3002",n("br",{}),o("span",{className:"text-btn",onClick:g,children:[n("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E\u672C\u7AD9"]})]})]})})},Cn={"/signin":n(Nn,{}),"*":n(fn,{})};function En(){const[t,e]=l.exports.useState(!1);return l.exports.useCallback(()=>{e(s=>!s)},[])}const xn=l.exports.forwardRef((t,e)=>{var E,k;const{className:a,initialContent:s,placeholder:r,showConfirmBtn:c,showCancelBtn:i,showTools:g,onConfirmBtnClick:m,onCancelBtnClick:p,onContentChange:y}=t,d=l.exports.useRef(null),u=En();l.exports.useEffect(()=>{s&&(d.current.value=s,u())},[]),l.exports.useEffect(()=>{var b;d.current&&(d.current.style.height="auto",d.current.style.height=((b=d.current.scrollHeight)!=null?b:0)+"px")},[(E=d.current)==null?void 0:E.value]),l.exports.useImperativeHandle(e,()=>({focus:()=>{d.current.focus()},insertText:b=>{const R=d.current.value;d.current.value=R+b,y(d.current.value),u()},setContent:b=>{d.current.value=te(b),u()},getContent:()=>{var b,R;return(R=(b=d.current)==null?void 0:b.value)!=null?R:""}}),[]);const f=l.exports.useCallback(()=>{y(d.current.value),u()},[]),h=l.exports.useCallback(b=>{b.stopPropagation(),b.code==="Enter"&&(b.metaKey||b.ctrlKey)&&N(),u()},[]),N=l.exports.useCallback(()=>{m(d.current.value),d.current.value="",u()},[]),A=l.exports.useCallback(()=>{p()},[]);return o("div",{className:"common-editor-wrapper "+a,children:[n("textarea",{className:"common-editor-inputer",rows:1,placeholder:r,ref:d,onInput:f,onKeyDown:h}),o("div",{className:"common-tools-wrapper",children:[n(P,{when:g,children:n("div",{className:"common-tools-container"})}),o("div",{className:"btns-right-container",children:[n(P,{when:i,children:n("button",{className:"action-btn cancel-btn",onClick:A,children:"\u64A4\u9500\u4FEE\u6539"})}),n(P,{when:c,children:o("button",{className:"action-btn confirm-btn",disabled:!((k=d.current)==null?void 0:k.value),onClick:N,children:["\u8BB0\u4E0B",n("span",{className:"icon-text",children:"\u270D\uFE0F"})]})})]})]})]})});const Sn=()=>{const{globalState:t}=l.exports.useContext(I),e=l.exports.useRef(null),a=l.exports.useRef(t);l.exports.useEffect(()=>{var m,p,y,d,u;if(t.markMemoId){const h=`${((m=e.current)==null?void 0:m.getContent())?`
`:""}Mark: [@MEMO](${t.markMemoId})`;(p=e.current)==null||p.insertText(h),_.setMarkMemoId("")}if(t.editMemoId&&t.editMemoId!==a.current.editMemoId){const f=D.getMemoById(t.editMemoId);f&&((d=e.current)==null||d.setContent((y=f.content)!=null?y:""),(u=e.current)==null||u.focus())}a.current=t},[t.markMemoId,t.editMemoId]);const s=l.exports.useCallback(async m=>{var d;if(m===""){v.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}const{editMemoId:p}=_.getState(),{query:y}=w.getState();m=te(m.replaceAll("&nbsp;"," "));try{if(p){const h=D.getMemoById(p);if(h&&h.content!==m){const N=await D.updateMemo(h.id,m);N.updatedAt=O(Date.now()),D.editMemo(N)}_.setEditMemoId("")}else{const h=await D.createMemo(m);D.pushMemo(h)}const u=Ve(Array.from((d=m.match(W))!=null?d:[])).map(h=>h.replace(W,"$1").trim()),f=y.tag;f!==""&&!u.includes(f)&&w.setTagQuery("")}catch(u){v.error(u.message)}me("")},[]),r=l.exports.useCallback(()=>{var m;_.setEditMemoId(""),(m=e.current)==null||m.setContent(""),me("")},[]),c=l.exports.useCallback(m=>{const p=document.createElement("div");p.innerHTML=m,p.innerText.trim()===""&&(m=""),me(m)},[]),{editMemoId:i}=t,g=l.exports.useMemo(()=>({className:"memo-editor",initialContent:bn(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,showCancelBtn:i!=="",showTools:!0,onConfirmBtnClick:s,onCancelBtnClick:r,onContentChange:c}),[i]);return o("div",{className:"memo-editor-wrapper "+(i?"edit-ing":""),children:[n("p",{className:"tip-text "+(i?"":"hidden"),children:"\u6B63\u5728\u4FEE\u6539\u4E2D..."}),n(xn,C({ref:e},g))]})};function bn(){var t;return(t=j.get(["editorContentCache"]).editorContentCache)!=null?t:""}function me(t){j.set({editorContentCache:t})}const vn=()=>{const{locationState:{query:{type:t}}}=l.exports.useContext(I),e=s=>{const{type:r}=w.getState().query;s===r&&(s=""),w.setMemoTypeQuery(s)};return o("div",{className:"search-bar-container",children:[o("div",{className:"search-bar-inputer",children:[n("img",{className:"icon-img",src:"/icons/search.svg"}),n("input",{className:"text-input",type:"text",placeholder:"",onChange:s=>{const r=s.currentTarget.value;w.setTextQuery(r)}})]}),n("div",{className:"quickly-action-wrapper",children:o("div",{className:"quickly-action-container",children:[n("p",{className:"title-text",children:"QUICKLY FILTER"}),o("div",{className:"section-container types-container",children:[n("span",{className:"section-text",children:"\u7C7B\u578B:"}),ie.map((s,r)=>o("div",{children:[n("span",{className:`type-item ${t===s.type?"selected":""}`,onClick:()=>{e(s.type)},children:s.text}),r+1<ie.length?n("span",{className:"split-text",children:"/"}):null]},s.type))]})]})})]})};const wn=()=>{const t=l.exports.useCallback(()=>{w.clearQuery()},[]),e=l.exports.useCallback(a=>{a.stopPropagation();const s=document.querySelector(X);s&&s.classList.add(Z)},[]);return o("div",{className:"section-header-container memos-header-container",children:[o("div",{className:"title-text",onClick:t,children:[n("button",{className:"action-btn",onClick:e,children:n("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})}),n("span",{className:"normal-text",children:"MEMOS"})]}),n(vn,{})]})};const Fn=()=>{const{locationState:{query:t}}=l.exports.useContext(I),{tag:e,duration:a,type:s,text:r}=t,c=Boolean(e||a&&a.from<a.to||s||r);return o("div",{className:`filter-query-container ${c?"":"hidden"}`,children:[n("span",{className:"tip-text",children:"\u7B5B\u9009\uFF1A"}),a&&a.from<a.to?o("div",{className:"filter-item-container",onClick:()=>{w.setFromAndToQuery(0,0)},children:[n("span",{className:"icon-text",children:"\u{1F5D3}\uFE0F"})," ",V(a.from)," \u81F3 ",V(a.to)]}):null,o("div",{className:"filter-item-container "+(e?"":"hidden"),onClick:()=>{w.setTagQuery("")},children:[n("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"})," ",e]}),o("div",{className:"filter-item-container "+(s?"":"hidden"),onClick:()=>{w.setMemoTypeQuery("")},children:[n("span",{className:"icon-text",children:"\u{1F4E6}"})," ",D.getTextWithMemoType(s)]}),o("div",{className:"filter-item-container "+(r?"":"hidden"),onClick:()=>{w.setTextQuery("")},children:[n("span",{className:"icon-text",children:"\u{1F50D}"})," ",r]})]})};const Mn=()=>{const{locationState:{query:t},memoState:{memos:e}}=l.exports.useContext(I),[a,s]=l.exports.useState(!0),[r,c]=l.exports.useState(!1),i=l.exports.useRef(null),{tag:g,duration:m,type:p,text:y}=t,d=Boolean(g||m&&m.from<m.to||p||y),u=d?e.filter(h=>{let N=!0;return g&&!h.content.includes(`# ${g} `)&&(N=!1),m&&m.from<m.to&&(F(h.createdAt)<m.from||F(h.createdAt)>m.to)&&(N=!1),p&&(p==="NOT_TAGGED"&&h.content.match(W)!==null||p==="LINKED"&&h.content.match(Se)===null||p==="IMAGED"&&h.content.match(Y)===null||p==="CONNECTED"&&h.content.match(ce)===null)&&(N=!1),y&&!h.content.includes(y)&&(N=!1),N}):e;l.exports.useEffect(()=>{var h;(h=i.current)==null||h.scrollTo({top:0}),D.fetchAllMemos().then(N=>{N!==!1&&(c(!0),s(!1))})},[]);const f=l.exports.useCallback(h=>{const N=h.target;if(N.tagName==="SPAN"&&N.className==="tag-span"){const A=N.innerText.slice(1);w.getState().query.tag===A?w.setTagQuery(""):w.setTagQuery(A)}},[]);return o("div",{className:`memolist-wrapper ${r?"completed":""}`,onClick:f,ref:i,children:[u.map(h=>n(en,{memo:h},`${h.id}-${h.updatedAt}`)),d?n("div",{className:"status-text-container",children:n("p",{className:"status-text",children:a?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":r&&u.length===0?"\u7A7A\u7A7A\u5982\u4E5F":""})}):n("div",{className:`status-text-container ${r?"completed":""} ${a||r?"":"invisible"}`,children:n("p",{className:"status-text",children:r?"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}":"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})})]})};function kn(){return o(T,{children:[n(wn,{}),n(Sn,{}),n(Fn,{}),n(Mn,{})]})}const Dn=t=>{var y,d;const{memo:e,handleDeletedMemoAction:a}=t,s=x(C({},e),{formattedContent:H(e.content),createdAtStr:O(e.createdAt),deletedAtStr:O((y=e.deletedAt)!=null?y:Date.now())}),[r,c]=z(!1),i=Array.from((d=s.content.match(Y))!=null?d:[]),g=async()=>{if(r)try{await D.deleteMemoById(s.id),a(s.id)}catch(u){v.error(u.message)}else c()},m=async()=>{try{await D.restoreMemoById(s.id),a(s.id),v.info("\u6062\u590D\u6210\u529F")}catch(u){v.error(u.message)}},p=()=>{r&&c(!1)};return o("div",{className:`memo-wrapper ${"memos-"+s.id}`,onMouseLeave:p,children:[o("div",{className:"memo-top-wrapper",children:[o("span",{className:"time-text",children:["\u5220\u9664\u4E8E ",s.deletedAtStr]}),o("div",{className:"btns-container",children:[n("span",{className:"text-btn more-action-btn",children:n("img",{className:"icon-img",src:"/icons/more.svg"})}),n("div",{className:"more-action-btns-wrapper",children:o("div",{className:"more-action-btns-container",children:[n("span",{className:"text-btn restore-btn",onClick:m,children:"\u6062\u590D"}),n("span",{className:`text-btn delete-btn ${r?"final-confirm":""}`,onClick:g,children:r?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5B8C\u5168\u5220\u9664"})]})})]})]}),n("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:s.formattedContent}}),n(P,{when:i.length>0,children:n("div",{className:"images-wrapper",children:i.map((u,f)=>n(le,{className:"memo-img",imgUrl:u},f))})})]})};const An=()=>{const t=ee(),[e,a]=l.exports.useState([]);l.exports.useEffect(()=>{D.fetchDeletedMemos().then(c=>{c!==!1&&a(c),t.setFinish()})},[]);const s=l.exports.useCallback(c=>{a(e.filter(i=>i.id!==c))},[e]),r=l.exports.useCallback(c=>{c.stopPropagation();const i=document.querySelector(X);i&&i.classList.add(Z)},[]);return o("div",{className:"memo-trash-wrapper",children:[n("div",{className:"section-header-container",children:o("div",{className:"title-text",children:[n("button",{className:"action-btn",onClick:r,children:n("img",{className:"icon-img",src:"/icons/menu.svg",alt:"menu"})}),n("span",{className:"normal-text",children:"\u56DE\u6536\u7AD9"})]})}),t.isLoading?n("div",{className:"tip-text-container",children:n("p",{className:"tip-text",children:"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})}):e.length===0?n("div",{className:"tip-text-container",children:n("p",{className:"tip-text",children:"No Zettels."})}):n("div",{className:"deleted-memos-container",children:e.map(c=>n(Dn,{memo:c,handleDeletedMemoAction:s},`${c.id}-${c.updatedAt}`))})]})},Tn={"/trash":n(An,{}),"*":n(kn,{})},Te=t=>e=>{for(const a of Object.keys(t))if(a===e)return t[a];return t["*"]},Bn=Te(Cn),In=Te(Tn);function _n(){const{locationState:{pathname:t}}=l.exports.useContext(I);return l.exports.useEffect(()=>{const e=()=>{_.setIsMobileView(document.body.clientWidth<=875)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),n(T,{children:Bn(t)})}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(t,e){return Object.prototype.toString.call(t).toLowerCase()==="[object regexp]"?this.replace(t,e):this.replace(new RegExp(t,"g"),e)})})();K.render(n(Qe.StrictMode,{children:n(ye,{store:S,context:I,children:n(_n,{})})}),document.getElementById("root"));
