var _e=Object.defineProperty,Le=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var ye=Object.getOwnPropertySymbols;var Ue=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var ce=(a,t,n)=>t in a?_e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,D=(a,t)=>{for(var n in t||(t={}))Ue.call(t,n)&&ce(a,n,t[n]);if(ye)for(var n of ye(t))Pe.call(t,n)&&ce(a,n,t[n]);return a},F=(a,t)=>Le(a,Oe(t));var O=(a,t,n)=>(ce(a,typeof t!="symbol"?t+"":t,n),n);import{j as ie,r as d,R as K,u as z,a as Ne,N as xe,S as Ce,b as X,B as Re,c as $e}from"./vendor.528c93e2.js";const He=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const i of u.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerpolicy&&(u.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?u.credentials="include":o.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}};He();const e=ie.exports.jsx,r=ie.exports.jsxs,L=ie.exports.Fragment,Se=a=>{const{children:t,store:n,context:s}=a,[o,u]=d.exports.useState(n.getState());return d.exports.useEffect(()=>{const i=n.subscribe(l=>{u(l)});return()=>{i()}},[]),e(s.Provider,{value:o,children:t})};function Qe(a){const t=Object.keys(a),n={};for(const s of t)typeof a[s]=="function"&&(n[s]=a[s]);return(s={},o)=>{let u=!1;const i={};for(const l of t){const f=s[l],x=n[l](f,o);i[l]=x,u=u||x!==f}return u?i:s}}function Ge(a,t){const n=[];let s=a;return{dispatch:l=>{const f=t(s,l),x=s;s=f;for(const C of n)C(s,x)},getState:()=>s,subscribe:l=>{let f=!0;return n.push(l),()=>{if(!f)return;const x=n.indexOf(l);n.splice(x,1),f=!1}}}}function je(a,t){switch(t.type){case"SET_MARK_MEMO_ID":return F(D({},a),{markMemoId:t.payload.markMemoId});case"SET_EDIT_MEMO_ID":return F(D({},a),{editMemoId:t.payload.editMemoId});case"SET_APP_SETTING":return D(D({},a),t.payload);default:return a}}const Ye={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,showDarkMode:!1};function qe(a,t){switch(t.type){case"SET_TAG_QUERY":return F(D({},a),{query:F(D({},a.query),{tag:t.payload.tag})});case"SET_FROM_TO_QUERY":return F(D({},a),{query:F(D({},a.query),{from:t.payload.from,to:t.payload.to})});case"SET_TYPE":return F(D({},a),{query:F(D({},a.query),{type:t.payload.type})});case"SET_TEXT":return F(D({},a),{query:F(D({},a.query),{text:t.payload.text})});case"SET_HASH":return F(D({},a),{hash:t.payload.hash});default:return a}}const Ve={hash:"",query:{tag:"",from:0,to:0,type:"",text:""}};var v;(function(a){function t(){return Date.now()}a.getNowTimeStamp=t;function n(){const h=navigator.appVersion;let m="Unknown";return h.indexOf("Win")!=-1?m="Windows":h.indexOf("Mac")!=-1?m="MacOS":h.indexOf("Linux")!=-1&&(m="Linux"),m}a.getOSVersion=n;function s(h){return typeof h=="string"&&(h=h.replaceAll("-","/")),new Date(h).getTime()}a.getTimeStampByDate=s;function o(h){const m=new Date(s(h));return new Date(m.getFullYear(),m.getMonth(),m.getDate()).getTime()}a.getDateStampByDate=o;function u(h){const m=new Date(s(h)),g=m.getFullYear(),S=m.getMonth()+1,b=m.getDate();return`${g}/${S}/${b}`}a.getDateString=u;function i(h){const m=new Date(s(h)),g=m.getHours(),S=m.getMinutes(),b=g<10?"0"+g:g,A=S<10?"0"+S:S;return`${b}:${A}`}a.getTimeString=i;function l(h){const m=new Date(s(h)),g=m.getFullYear(),S=m.getMonth()+1,b=m.getDate(),A=m.getHours(),P=m.getMinutes(),R=m.getSeconds(),te=S<10?"0"+S:S,ae=b<10?"0"+b:b,ne=A<10?"0"+A:A,se=P<10?"0"+P:P,oe=R<10?"0"+R:R;return`${g}/${te}/${ae} ${ne}:${se}:${oe}`}a.getDateTimeString=l;function f(h){return Array.from(new Set(h))}a.dedupe=f;function x(h){const m=new Set,g=[];for(const S of h)m.has(S.id)||(m.add(S.id),g.push(S));return g}a.dedupeObjectWithId=x;function C(h,m){let g=null;return()=>{g&&clearTimeout(g),g=setTimeout(h,m)}}a.debounce=C;function p(h,m){let g=!0;return()=>{if(!g)return!1;g=!1,setTimeout(()=>{h(),g=!0},m)}}a.throttle=p;function c(h){const m=[],g=Object.keys(h),S=Object.values(h);for(let b=0;b<g.length;++b)S[b]&&m.push(`${g[b]}=${S[b]}`);return m.join("&")}a.iterObjectToParamsString=c;async function y(h){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(h)}catch(m){console.warn("Copy to clipboard failed.",m)}else console.warn("Copy to clipboard failed, methods not supports.")}a.copyTextToClipboard=y;function N(h){return new Promise((m,g)=>{const S=new Image;S.onload=()=>{const{width:b,height:A}=S;b>0&&A>0?m({width:b,height:A}):m({width:0,height:0})},S.onerror=()=>{m({width:0,height:0})},S.className="hidden",S.src=h,document.body.appendChild(S),S.remove()})}a.getImageSize=N})(v||(v={}));function Ke(a,t){switch(t.type){case"SET_MEMOS":return{memos:[...t.payload.memos]};case"PUSH_MEMO":return{memos:[t.payload.memo,...a.memos].sort((s,o)=>v.getTimeStampByDate(o.createdAt)-v.getTimeStampByDate(s.createdAt))};case"PUSH_MEMOS":return{memos:[...t.payload.memos,...a.memos].sort((s,o)=>v.getTimeStampByDate(o.createdAt)-v.getTimeStampByDate(s.createdAt))};case"DELETE_MEMO_BY_ID":return{memos:[...a.memos].filter(n=>n.id!==t.payload.id)};case"EDIT_MEMO":return{memos:a.memos.map(s=>s.id===t.payload.id?D(D({},s),t.payload):s)};default:return a}}const We={memos:[]};function ze(a,t){switch(t.type){case"SIGN_IN":return{user:t.payload.user};case"SIGN_OUT":return{user:null};default:return a}}const Xe={user:null},k=Ge({globalState:Ye,locationState:Ve,memoState:We,userState:Xe},Qe({globalState:je,locationState:qe,memoState:Ke,userState:ze})),$=d.exports.createContext(k.getState());var Y;(function(a){function t(o){const u={};for(const i of o)try{const l=localStorage.getItem(i);if(l!==null){const f=JSON.parse(l);u[i]=f}}catch(l){console.error("Get storage failed in ",i,l)}return u}a.get=t;function n(o){for(const u in o)try{const i=JSON.stringify(o[u]);localStorage.setItem(u,i)}catch(i){console.error("Save storage failed in ",u,i)}}a.set=n;function s(){var u;const o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o),(u=o.contentWindow)==null||u.localStorage.setItem("t",Date.now().toString()),o.remove()}a.emitStorageChangedEvent=s})(Y||(Y={}));class Je{constructor(){O(this,"getState",()=>k.getState().globalState);O(this,"setEditMemoId",t=>{k.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:t}})});O(this,"setMarkMemoId",t=>{k.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:t}})});O(this,"setAppSetting",t=>{k.dispatch({type:"SET_APP_SETTING",payload:t}),Y.set(t)});var s,o,u,i;const t=Y.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser","showDarkMode"]),n={shouldSplitMemoWord:(s=t.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(o=t.shouldHideImageUrl)!=null?o:!0,shouldUseMarkdownParser:(u=t.shouldUseMarkdownParser)!=null?u:!0,showDarkMode:(i=t.showDarkMode)!=null?i:!1};this.setAppSetting(n)}}const U=new Je,q=()=>{let a=v.iterObjectToParamsString(k.getState().locationState.query);a?a="?"+a:a="",history.replaceState(null,"","/"+a)};class Ze{constructor(){O(this,"initLocation",()=>{var n,s,o,u,i;const t=new URLSearchParams(window.location.search);this.setTagQuery((n=t.get("tag"))!=null?n:""),this.setFromAndToQuery(parseInt((s=t.get("from"))!=null?s:"0"),parseInt((o=t.get("to"))!=null?o:"0")),this.setMemoTypeQuery((u=t.get("type"))!=null?u:""),this.setTextQuery((i=t.get("text"))!=null?i:"")});O(this,"getState",()=>k.getState().locationState);O(this,"clearQuery",()=>{k.dispatch({type:"SET_TAG_QUERY",payload:{tag:""}}),k.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:0,to:0}}),q()});O(this,"setHash",t=>{k.dispatch({type:"SET_HASH",payload:{hash:t}}),q()});O(this,"setMemoTypeQuery",(t="")=>{k.dispatch({type:"SET_TYPE",payload:{type:t}}),q()});O(this,"setTextQuery",t=>{k.dispatch({type:"SET_TEXT",payload:{text:t}}),q()});O(this,"setTagQuery",t=>{k.dispatch({type:"SET_TAG_QUERY",payload:{tag:t}}),q()});O(this,"setFromAndToQuery",(t,n)=>{k.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:t,to:n}}),q()});this.initLocation()}}const I=new Ze;var T;(function(a){async function t(E){const W=await(await fetch(E,{method:"GET"})).json();if(!W.succeed)throw W;return W}a.get=t;async function n(E,_){const re=await(await fetch(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)})).json();if(!re.succeed)throw re;return re}a.post=n;function s(){return t("/api/user/me")}a.getUserInfo=s;function o(E,_){return n("/api/user/signin",{username:E,password:_})}a.signin=o;function u(E,_){return n("/api/user/signup",{username:E,password:_})}a.signup=u;function i(){return n("/api/user/signout")}a.signout=i;function l(E){return t("/api/user/checkusername?username="+E)}a.checkUsernameUsable=l;function f(E){return n("/api/user/checkpassword",{password:E})}a.checkPasswordValid=f;function x(E="",_=""){return n("/api/user/update",{username:E,password:_})}a.updateUserinfo=x;function C(E=0,_=20){return t(`/api/memo/all?offset=${E}&amount=${_}`)}a.getMyMemos=C;function p(){return t("/api/memo/trash")}a.getMyDeletedMemos=p;function c(E){return n("/api/memo/new",{content:E})}a.createMemo=c;function y(E){return t("/api/memo/?id="+E)}a.getMemoById=y;function N(E){return n("/api/memo/hide",{memoId:E})}a.hideMemo=N;function h(E){return n("/api/memo/restore",{memoId:E})}a.restoreMemo=h;function m(E){return n("/api/memo/delete",{memoId:E})}a.deleteMemo=m;function g(E,_){return n("/api/memo/update",{memoId:E,content:_})}a.updateMemo=g;function S(){return t("/api/memo/count")}a.getMemosCount=S;function b(E){return n("/api/tag/new",{text:E})}a.createTag=b;function A(E,_){return n("/api/tag/link",{memoId:E,tagId:_})}a.createMemoTag=A;function P(E,_){return n("/api/tag/rmlink",{memoId:E,tagId:_})}a.removeMemoTag=P;function R(E){return t("/api/tag/memo?id="+E)}a.getTagsByMemoId=R;function te(){return t("/api/tag/all")}a.getMyTags=te;function ae(E){return n("/api/tag/delete",{tagId:E})}a.deleteTagById=ae;function ne(E){return n("/api/tag/polish",{tagId:E})}a.polishTag=ne;function se(E,_){return n("/api/tag/update",{id:E,text:_})}a.updateTagText=se;function oe(){return t("/api/user/amount")}a.getMyDataAmount=oe;function Ae(E){return t("/api/base/srctype?url="+E)}a.getUrlContentType=Ae;function Be(){return t("/api/memo/stat")}a.getMemosStat=Be;function Ie(){return n("/api/user/updategh",{githubName:""})}a.removeGithubName=Ie})(T||(T={}));const le="div#page-container",ue="mobile-show-sidebar",et=20,be=200,tt=400,H=3600*24*1e3,J=/#\s(.+?)\s/g,Ee=/(https?:\/\/[^\s<\\*>']+)/g,j=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,Me=/\[\@(.+?)\]\((.+?)\)/g,de=[{type:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{type:"LINKED",text:"\u6709\u94FE\u63A5"},{type:"IMAGED",text:"\u6709\u56FE\u7247"}];class at{getState(){return k.getState().userState}async doSignIn(){const{data:t}=await T.getUserInfo();return t?k.dispatch({type:"SIGN_IN",payload:{user:t}}):B.doSignOut(),t}async doSignOut(){T.signout().catch(()=>{}),k.dispatch({type:"SIGN_OUT",payload:{user:null}})}async checkUsernameUsable(t){const{data:n}=await T.checkUsernameUsable(t);return n}async updateUsername(t){await T.updateUserinfo(t)}async removeGithubName(){await T.removeGithubName()}async checkPasswordValid(t){const{data:n}=await T.checkPasswordValid(t);return n}async updatePassword(t){await T.updateUserinfo("",t)}}const B=new at;class nt{constructor(){O(this,"isFetching",!1)}getState(){return k.getState().memoState}async fetchMoreMemos(){if(!B.getState().user||this.isFetching)return!1;this.isFetching=!0;const{data:t}=await T.getMyMemos(this.getState().memos.length,et),n=t.map(s=>D({},s));return k.dispatch({type:"PUSH_MEMOS",payload:{memos:n}}),this.isFetching=!1,n}async fetchAllMemos(){if(!B.getState().user)return!1;this.isFetching=!0;const{data:{memosAmount:t}}=await T.getMyDataAmount(),{data:n}=await T.getMyMemos(0,t),s=n.map(o=>D({},o));return s.length>0&&k.dispatch({type:"SET_MEMOS",payload:{memos:s}}),this.isFetching=!1,n}async fetchDeletedMemos(){if(!B.getState().user)return!1;const{data:t}=await T.getMyDeletedMemos();return t}pushMemo(t){k.dispatch({type:"PUSH_MEMO",payload:{memo:D({},t)}})}async getMemoById(t){for(const s of this.getState().memos)if(s.id===t)return s;const{data:n}=await T.getMemoById(t);return n}async hideMemoById(t){await T.hideMemo(t),k.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:t}})}async restoreMemoById(t){await T.restoreMemo(t),M.clearMemos(),M.fetchMoreMemos()}async deleteMemoById(t){await T.deleteMemo(t)}editMemo(t){k.dispatch({type:"EDIT_MEMO",payload:t})}clearMemos(){k.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(t){const{data:n}=await T.createMemo(t);return n}async updateMemo(t,n){const{data:s}=await T.updateMemo(t,n);return s}async createTag(t){const{data:n}=await T.createTag(t);return n}async removeMemoTag(t,n){await T.removeMemoTag(t,n)}async createMemoTag(t,n){await T.createMemoTag(t,n)}async getMyDataAmount(){const{data:t}=await T.getMyDataAmount();return t}async getMemosStat(){const{data:t}=await T.getMemosStat();return t}async getMyTags(){if(!B.getState().user)return[];const{data:t}=await T.getMyTags();return t}async polishTag(t){await T.polishTag(t)}async updateTagText(t,n){await T.updateTagText(t,n)}}const M=new nt;const st=a=>{const{destory:t,duration:n}=a;return d.exports.useEffect(()=>{n>0&&setTimeout(()=>{t()},n)},[]),e("div",{className:"toast-container",onClick:t,children:e("p",{className:"content-text",children:a.content})})},w=(()=>{const a=document.createElement("div");a.className="toast-list-container",document.body.appendChild(a);let t=0;const n=[],s=i=>{const l=document.createElement("div");l.className=`toast-wrapper ${i.type}`,a.appendChild(l),t++,n.push(l),setTimeout(()=>{l.classList.add("showup")},0);const f={destory:()=>{l.classList.add("destory"),setTimeout(()=>{if(!!l.parentElement&&(t--,t===0)){for(const x of n)K.unmountComponentAtNode(x),x.remove();n.splice(0,n.length)}},tt)}};return K.render(e(st,F(D({},i),{destory:f.destory})),l),f};return{info:(i,l=3e3)=>s({type:"normal",content:i,duration:l}),error:(i,l=3e3)=>s({type:"error",content:i,duration:l})}})();const ot=a=>{const{children:t,className:n,clickSpaceDestroy:s,destroy:o}=a,u=()=>{s&&o()};return e("div",{className:`dialog-wrapper ${n}`,onClick:u,children:e("div",{className:"dialog-container",onClick:i=>i.stopPropagation(),children:t})})};function Q(a,t,n){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var l;(l=s.firstElementChild)==null||l.classList.add("showup")},0);const o={destroy:()=>{var l,f;(l=s.firstElementChild)==null||l.classList.remove("showup"),(f=s.firstElementChild)==null||f.classList.add("showoff"),setTimeout(()=>{s.remove(),K.unmountComponentAtNode(s)},be)}},u=F(D({},n),{destroy:o.destroy});let i=e(ot,F(D({destroy:o.destroy,clickSpaceDestroy:!0},a),{children:e(t,D({},u))}));return a.useAppContext&&(i=e(Se,{store:k,context:$,children:i})),K.render(i,s),o}const rt=({destroy:a})=>{const{userState:t}=d.exports.useContext($),n=t.user,[s,o]=d.exports.useState(n.username),[u,i]=d.exports.useState(!1),[l,f]=d.exports.useState(!1),x=()=>{a()},C=h=>{const m=h.target.value;o(m)},p=async()=>{if(n.username==="guest"){w.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(s===n.username){i(!1);return}try{if(!await B.checkUsernameUsable(s)){w.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await B.updateUsername(s),await B.doSignIn(),i(!1),w.info("\u4FEE\u6539\u6210\u529F~")}catch(h){w.error(h.message)}},c=()=>{if(n.username==="guest"){w.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}it()},y=async()=>{if(l){try{await B.removeGithubName(),await B.doSignIn()}catch(h){w.error(h.message)}f(!1)}else f(!0)},N=h=>{h.preventDefault()};return r(L,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[e("span",{className:"icon-text",children:"\u{1F920}"}),"\u6211\u7684\u8D26\u53F7"]}),e("button",{className:"text-btn close-btn",onClick:x,children:e("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("div",{className:"section-container account-section-container",children:[e("p",{className:"title-text",children:"\u57FA\u672C\u4FE1\u606F"}),r("label",{className:"form-label input-form-label",children:[e("span",{className:"normal-text",children:"ID\uFF1A"}),e("span",{className:"normal-text",children:n.id})]}),r("label",{className:"form-label input-form-label",children:[e("span",{className:"normal-text",children:"\u521B\u5EFA\u65F6\u95F4\uFF1A"}),e("span",{className:"normal-text",children:v.getDateString(n.createdAt)})]}),r("label",{className:"form-label input-form-label username-label",children:[e("span",{className:"normal-text",children:"\u8D26\u53F7\uFF1A"}),e("input",{type:"text",readOnly:!u,value:s,onClick:()=>{i(!0)},onChange:C}),r("div",{className:"btns-container",onClick:N,children:[e("span",{className:"text-btn confirm-btn "+(u?"":"hidden"),onClick:p,children:"\u4FDD\u5B58"}),e("span",{className:"text-btn cancel-btn "+(u?"":"hidden"),onClick:()=>{o(n.username),i(!1)},children:"\u64A4\u9500"})]})]}),r("label",{className:"form-label password-label",children:[e("span",{className:"normal-text",children:"\u5BC6\u7801\uFF1A"}),e("span",{className:"text-btn",onClick:c,children:"\u4FEE\u6539\u5BC6\u7801"})]})]}),r("div",{className:"section-container account-section-container",children:[e("p",{className:"title-text",children:"\u5173\u8054\u8D26\u53F7"}),r("label",{className:"form-label input-form-label",children:[e("span",{className:"normal-text",children:"GitHub\uFF1A"}),n.githubName?r(L,{children:[e("a",{className:"value-text",href:"https://github.com/"+n.githubName,children:n.githubName}),e("span",{className:`btn-text unbind-btn ${l?"final-confirm":""}`,onMouseLeave:()=>f(!1),onClick:y,children:l?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A"})]}):r(L,{children:[e("span",{className:"value-text",children:"\u65E0"}),e("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"\u524D\u5F80\u7ED1\u5B9A"})]})]})]})]})]})},ct=({destroy:a})=>{const[t,n]=d.exports.useState(""),[s,o]=d.exports.useState(""),[u,i]=d.exports.useState("");d.exports.useEffect(()=>{},[]);const l=()=>{a()},f=c=>{const y=c.target.value;n(y)},x=c=>{const y=c.target.value;o(y)},C=c=>{const y=c.target.value;i(y)},p=async()=>{if(t===""||s===""||u===""){w.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==u){w.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),i("");return}try{if(!await B.checkPasswordValid(t)){w.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),n("");return}await B.updatePassword(s),w.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),l()}catch(c){w.error(c)}};return r(L,{children:[r("div",{className:"dialog-header-container",children:[e("p",{className:"title-text",children:"\u4FEE\u6539\u5BC6\u7801"}),e("button",{className:"text-btn close-btn",onClick:l,children:e("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[e("p",{className:"tip-text",children:"\u5982\u679C\u662F GitHub \u767B\u5F55\uFF0C\u5219\u521D\u59CB\u5BC6\u7801\u4E3A\u7528\u6237\u540D"}),r("label",{className:"form-label input-form-label",children:[e("input",{type:"password",value:t,onChange:f}),e("span",{className:"normal-text "+(t===""?"":"not-null"),children:"\u65E7\u5BC6\u7801"})]}),r("label",{className:"form-label input-form-label",children:[e("input",{type:"password",value:s,onChange:x}),e("span",{className:"normal-text "+(s===""?"":"not-null"),children:"\u65B0\u5BC6\u7801"})]}),r("label",{className:"form-label input-form-label",children:[e("input",{type:"password",value:u,onChange:C}),e("span",{className:"normal-text "+(u===""?"":"not-null"),children:"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801"})]}),r("div",{className:"btns-container",children:[e("span",{className:"text-btn cancel-btn",onClick:l,children:"\u53D6\u6D88"}),e("span",{className:"text-btn confirm-btn",onClick:p,children:"\u4FDD\u5B58"})]})]})]})};function it(){Q({className:"change-password-dialog"},ct)}function lt(){Q({className:"my-account-dialog",useAppContext:!0},rt)}const ut=({destroy:a})=>r(L,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[e("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E ",e("b",{children:"Memos"})]}),e("button",{className:"text-btn close-btn",onClick:()=>{a()},children:e("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[e("p",{children:"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"}),e("br",{}),e("i",{children:"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"}),r("ul",{children:[e("li",{children:"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5}\u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1}\u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5}\u8BFB\u540E\u611F..."}),e("li",{children:"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"}),e("li",{children:"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B"})]}),e("br",{}),e("i",{children:"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"}),r("ul",{children:[r("li",{children:["\u2728"," ",e("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer",children:"\u5F00\u6E90\u9879\u76EE"})]}),e("li",{children:"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"}),e("li",{children:"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B"})]}),e("br",{}),e("p",{children:"Enjoy it and have fun~ "}),e("hr",{}),r("p",{className:"normal-text",children:["Last update at ",e("span",{className:"pre-text",children:"2021/10/11 15:27:39"})," \u{1F389}"]})]})]});function ve(){Q({className:"about-site-dialog"},ut)}const dt=/```([\s\S]*?)```/g,mt=/\*\*(.+?)\*\*/g,ht=/\[ \] /g,pt=/\[x\] /g,gt=/[*] /g,ft=/(\d+)\. /g,yt=a=>a.replace(dt,"<pre lang=''>$1</pre>").replace(mt,"<b>$1</b>").replace(gt,"<span class='counter-block'>\u2022</span>").replace(ft,"<span class='counter-block'>$1.</span>").replace(ht,"<span class='todo-block' data-type='todo'>\u2B1C\uFE0F</span>").replace(pt,"<span class='todo-block' data-type='done'>\u2714\uFE0F</span>"),me=a=>{const t=document.createElement("div");t.className="memo-content-text",t.innerHTML=a,document.body.appendChild(t);const n=t.innerText;return t.remove(),n},Nt=a=>a.replace(/\n/g,"<br>");const xt=({destroy:a})=>{const{globalState:{shouldHideImageUrl:t,shouldSplitMemoWord:n,shouldUseMarkdownParser:s,showDarkMode:o}}=d.exports.useContext($);return d.exports.useEffect(()=>{},[]),r(L,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[e("span",{className:"icon-text",children:"\u2699\uFE0F"}),"\u504F\u597D\u8BBE\u7F6E"]}),e("button",{className:"text-btn close-btn",onClick:()=>{a()},children:e("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("div",{className:"section-container preferences-section-container",children:[e("p",{className:"title-text",children:"\u5E38\u89C4"}),r("label",{className:"form-label checkbox-form-label",children:[e("span",{className:"normal-text",children:"\u6DF1\u8272\u6A21\u5F0F"}),e("img",{className:"icon-img",src:o?"/icons/check-active.svg":"/icons/check.svg"}),e("input",{className:"hidden",type:"checkbox",checked:o,onChange:c=>{const y=c.target.checked;U.setAppSetting({showDarkMode:y})}})]})]}),r("div",{className:"section-container preferences-section-container",children:[e("p",{className:"title-text",children:"Memo \u663E\u793A\u76F8\u5173"}),r("label",{className:"form-label checkbox-form-label",children:[e("span",{className:"normal-text",children:"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"}),e("img",{className:"icon-img",src:n?"/icons/check-active.svg":"/icons/check.svg"}),e("input",{className:"hidden",type:"checkbox",checked:n,onChange:c=>{const y=c.target.checked;U.setAppSetting({shouldSplitMemoWord:y})}})]}),r("label",{className:"form-label checkbox-form-label",children:[e("span",{className:"normal-text",children:"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"}),e("img",{className:"icon-img",src:t?"/icons/check-active.svg":"/icons/check.svg"}),e("input",{className:"hidden",type:"checkbox",checked:t,onChange:c=>{const y=c.target.checked;U.setAppSetting({shouldHideImageUrl:y})}})]}),r("label",{className:"form-label checkbox-form-label",children:[e("span",{className:"normal-text",children:"markdown \u683C\u5F0F\u89E3\u6790"}),e("img",{className:"icon-img",src:s?"/icons/check-active.svg":"/icons/check.svg"}),e("input",{className:"hidden",type:"checkbox",checked:s,onChange:c=>{const y=c.target.checked;U.setAppSetting({shouldUseMarkdownParser:y})}}),e("span",{className:"tip-text",children:"\u652F\u6301\u5217\u8868\u3001\u52A0\u7C97\u3001\u4EE3\u7801\u5757"})]})]}),r("div",{className:"section-container hidden",children:[e("p",{className:"title-text",children:"\u5176\u4ED6"}),r("div",{className:"btn-container",children:[e("button",{className:"btn export-btn",onClick:async()=>{await M.fetchAllMemos();const c=M.getState().memos.map(h=>F(D({},h),{tags:h.tags.map(m=>m.text)})),y=JSON.stringify(c),N=document.createElement("a");N.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(y)),N.setAttribute("download","data.json"),N.style.display="none",document.body.appendChild(N),N.click(),document.body.removeChild(N)},children:"\u5BFC\u51FA\u6570\u636E(JSON)"}),e("button",{className:"btn clean-btn",onClick:async()=>{await M.fetchAllMemos();for(const c of M.getState().memos)await M.updateMemo(c.id,me(c.content))},children:"Memo Clean"})]})]})]})]})};function Ct(){Q({className:"preferences-dialog",useAppContext:!0},xt)}const St=({visibility:a})=>{const t=()=>{Ct()},n=()=>{ve()},s=()=>{B.doSignOut(),location.reload()};return r("div",{className:"menu-btns-popup "+(a?"":"hidden"),children:[r("button",{className:"text-btn action-btn",onClick:lt,children:[e("span",{className:"icon",children:"\u{1F920}"})," \u6211\u7684\u8D26\u53F7"]}),r("button",{className:"text-btn action-btn",onClick:t,children:[e("span",{className:"icon",children:"\u2699\uFE0F"})," \u504F\u597D\u8BBE\u7F6E"]}),r("button",{className:"text-btn action-btn",onClick:n,children:[e("span",{className:"icon",children:"\u{1F600}"})," \u5173\u4E8E"]}),r("button",{className:"text-btn action-btn",onClick:s,children:[e("span",{className:"icon",children:"\u{1F44B}"})," \u9000\u51FA"]})]})};function Z(a=!1){const[t,n]=d.exports.useState(a),s=d.exports.useCallback(o=>{n(o!==void 0?o:u=>!u)},[]);return[t,s]}function he(){const[a,t]=d.exports.useState({isLoading:!0,isFailed:!1,isSucceed:!1});return F(D({},a),{setLoading:()=>{t(F(D({},a),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{t(F(D({},a),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{t(F(D({},a),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const bt=({destroy:a,imgUrl:t})=>{const n=d.exports.useRef(null),[s,o]=d.exports.useState(-1);d.exports.useEffect(()=>{v.getImageSize(t).then(({width:f})=>{o(f!==0?80:0)})},[]);const u=()=>{a()},i=()=>{s>30&&o(s-10)},l=()=>{o(s+10)};return r(L,{children:[e("button",{className:"text-btn close-btn",onClick:u,children:e("img",{className:"icon-img",src:"/icons/close.svg"})}),r("div",{className:"img-container",children:[e("img",{className:s<=0?"hidden":"",ref:n,width:s+"%",src:t}),e("span",{className:"loading-text "+(s===-1?"":"hidden"),children:"\u56FE\u7247\u52A0\u8F7D\u4E2D..."}),e("span",{className:"loading-text "+(s===0?"":"hidden"),children:"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5"})]}),r("div",{className:"action-btns-container",children:[e("button",{className:"text-btn",onClick:i,children:"\u2796"}),e("button",{className:"text-btn",onClick:l,children:"\u2795"}),e("button",{className:"text-btn",onClick:()=>o(80),children:"\u2B55"})]})]})};function De(a){Q({className:"preview-image-dialog"},bt,{imgUrl:a})}const Et=a=>{const{children:t,when:n}=a;return n?e(L,{children:t}):null},G=Et;const pe=a=>{const{className:t,imgUrl:n}=a,s=()=>{De(n)};return e("div",{className:"image-container "+t,onClick:s,children:e("img",{src:n,decoding:"async",loading:"lazy"})})};const Mt=a=>{var p;const{memoId:t,destroy:n}=a,[s,o]=d.exports.useState(),[u,i]=d.exports.useState([]),[l,f]=d.exports.useState([]);d.exports.useEffect(()=>{(async()=>{var N;const y=await M.getMemoById(t);y&&(f(Array.from((N=y.content.match(j))!=null?N:[])),o(F(D({},y),{formattedContent:V(y.content),createdAtStr:v.getDateTimeString(y.createdAt)})))})()},[]),d.exports.useEffect(()=>{(async()=>{if(!s)return;const y=[],N=[...s.content.matchAll(Me)];for(const h of N)if(h&&h.length===3){const m=h[2],g=await M.getMemoById(m);g&&(y.push(F(D({},g),{formattedContent:V(g.content),createdAtStr:v.getDateTimeString(g.createdAt)})),i([...y]))}})()},[s]);const x=async c=>{var N;const y=c.target;if(y.className==="memo-link-text"){const h=(N=y.dataset)==null?void 0:N.value;h&&await M.getMemoById(h)&&(n(),ee(h))}},C=c=>{n(),ee(c)};return r(L,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[e("span",{className:"icon-text",children:"\u{1F4E6}"}),"Memo Story"]}),e("button",{className:"text-btn close-btn",onClick:n,children:e("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("div",{className:"memo-container current",children:[e("div",{className:"memo-header-container",children:e("p",{className:"time-text",children:s==null?void 0:s.createdAtStr})}),e("div",{className:"memo-content-text",onClick:x,dangerouslySetInnerHTML:{__html:(p=s==null?void 0:s.formattedContent)!=null?p:""}}),e(G,{when:l.length>0,children:e("div",{className:"images-wrapper",children:l.map((c,y)=>e(pe,{className:"memo-img",imgUrl:c},y))})})]}),r("p",{className:"normal-text "+(u.length===0?"hidden":""),children:["\u94FE\u63A5\u4E86 ",u.length," \u4E2A Memo"]}),e("div",{className:"down-memos-wrapper "+(u.length!==0?"":"hidden"),children:u.map(c=>r("div",{className:"memo-container",children:[e("div",{className:"memo-header-container",children:e("p",{className:"time-text",onClick:()=>{C(c.id)},children:c.createdAtStr})}),e("div",{className:"memo-content-text",onClick:x,dangerouslySetInnerHTML:{__html:c.formattedContent}})]},c.id))})]})]})};function ee(a){Q({className:"memo-story-dialog"},Mt,{memoId:a})}const vt=a=>{var y;const{memo:t,destroy:n}=a,[s,o]=d.exports.useState(""),u=d.exports.useRef(null),{user:i}=B.getState(),l=F(D({},t),{formattedContent:V(t.content),createdAtStr:v.getDateTimeString(t.createdAt)}),f=Array.from((y=l.content.match(j))!=null?y:[]),[x,C]=d.exports.useState(f.length);d.exports.useEffect(()=>{setTimeout(()=>{if(x===0){const N=v.getOSVersion();(N==="MacOS"||N==="Unknown")&&window.scrollTo(0,0),html2canvas(u.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:U.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(h=>{o(h.toDataURL())})}},be+100)},[x]);const p=()=>{n()},c=N=>{N.type==="error"&&(w.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),N.target.remove()),C(x-1)};return r(L,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[e("span",{className:"icon-text",children:"\u{1F970}"}),"\u5206\u4EAB Memo \u56FE\u7247"]}),e("button",{className:"text-btn close-btn",onClick:p,children:e("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[e("div",{className:`tip-words-container ${s?"finished":"genarating"}`,children:e("p",{className:"tip-text",children:s?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D..."})}),e("img",{className:"memo-img",src:s}),r("div",{className:"memo-container",ref:u,children:[e("span",{className:"time-text",children:l.createdAtStr}),e("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:l.formattedContent}}),e(G,{when:f.length>0,children:e("div",{className:"images-container",children:f.map((N,h)=>e("img",{crossOrigin:"anonymous",src:N,onLoad:c,onError:c,decoding:"async"},h))})}),e("div",{className:"watermark-container",children:r("span",{className:"normal-text",children:["by ",e("span",{className:"name-text",children:i==null?void 0:i.username})]})})]})]})]})};function Dt(a){Q({className:"share-memo-image-dialog"},vt,{memo:a})}const wt=a=>{var y;const{memo:t}=a,n=F(D({},t),{formattedContent:V(t.content),createdAtStr:v.getDateTimeString(t.createdAt)}),[s,o]=Z(!1),u=Array.from((y=n.content.match(j))!=null?y:[]),i=()=>{ee(n.id)},l=()=>{U.setMarkMemoId(n.id)},f=()=>{U.setEditMemoId(n.id)},x=async()=>{if(s){try{await M.hideMemoById(n.id),await M.fetchMoreMemos()}catch(N){w.error(N.message)}U.getState().editMemoId===n.id&&U.setEditMemoId("")}else o()},C=()=>{s&&o(!1)},p=()=>{Dt(n)},c=async N=>{var m;const h=N.target;if(h.className==="memo-link-text"){const g=(m=h.dataset)==null?void 0:m.value;g&&await M.getMemoById(g)&&ee(g)}else h.className==="todo-block"};return r("div",{className:`memo-wrapper ${"memos-"+n.id}`,onMouseLeave:C,children:[r("div",{className:"memo-top-wrapper",children:[e("span",{className:"time-text",onClick:i,children:n.createdAtStr}),r("div",{className:"btns-container",children:[e("span",{className:"text-btn more-action-btn",children:e("img",{className:"icon-img",src:"/icons/more.svg"})}),e("div",{className:"more-action-btns-wrapper",children:r("div",{className:"more-action-btns-container",children:[e("span",{className:"text-btn",onClick:l,children:"Mark"}),e("span",{className:"text-btn",onClick:p,children:"\u5206\u4EAB"}),e("span",{className:"text-btn",onClick:f,children:"\u7F16\u8F91"}),e("span",{className:`text-btn delete-btn ${s?"final-confirm":""}`,onClick:x,children:s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]}),e("div",{className:"memo-content-text",onClick:c,dangerouslySetInnerHTML:{__html:n.formattedContent}}),e(G,{when:u.length>0,children:e("div",{className:"images-wrapper",children:u.map((N,h)=>e(pe,{className:"memo-img",imgUrl:N},h))})})]})};function V(a){var u;const t=document.createElement("div");t.innerHTML=Nt(a).split("<br>").map(i=>i!==""?`<p>${i}</p>`:"<br>").join(""),a=t.innerHTML;const{shouldUseMarkdownParser:n,shouldSplitMemoWord:s,shouldHideImageUrl:o}=U.getState();n&&(a=yt(a)),o&&(a=a.replace(j,"")),t.innerHTML=a;for(const i of t.querySelectorAll("p"))i.textContent===""&&((u=i.firstElementChild)==null?void 0:u.tagName)!=="BR"&&i.remove();return a=t.innerHTML,a=a.replace(J,"<span class='tag-span'>#$1</span>").replace(Ee,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(Me,"<span class='memo-link-text' data-value='$2'>$1</span>"),s&&(a=a.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5]?)/g,"$1 $2 $3")),a}var Tt=d.exports.memo(wt);const Ft=a=>{var o;const{memo:t}=a,n=F(D({},t),{formattedContent:V(t.content),createdAtStr:v.getDateTimeString(t.createdAt),timeStr:v.getTimeString(t.createdAt)}),s=Array.from((o=n.content.match(j))!=null?o:[]);return r("div",{className:"daily-memo-wrapper",children:[e("div",{className:"time-wrapper",children:e("span",{className:"normal-text",children:n.timeStr})}),r("div",{className:"memo-content-container",children:[e("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:n.formattedContent}}),e(G,{when:s.length>0,children:e("div",{className:"images-container",children:s.map((u,i)=>e("img",{crossOrigin:"anonymous",src:u,decoding:"async"},i))})})]})]})};const kt=a=>{const{className:t,datestamp:n,handleDateStampChange:s}=a,[o,u]=d.exports.useState(ge(n));d.exports.useEffect(()=>{u(ge(n))},[n]);const i=new Date(o),l=i.getDay()===0?7:i.getDay(),f=[];for(let c=1;c<l;c++)f.push({date:0,datestamp:i.getTime()-H*(7-c)});const x=At(o);for(let c=1;c<=x;c++)f.push({date:c,datestamp:i.getTime()+H*(c-1)});const C=c=>{s(c)},p=c=>{const y=i.getFullYear(),N=i.getMonth()+1;let h=0;N===1&&c===-1?h=new Date(`${y-1}/12/1`).getTime():N===12&&c===1?h=new Date(`${y+1}/1/1`).getTime():h=new Date(`${y}/${N+c}/1`).getTime(),u(ge(h))};return r("div",{className:`date-picker-wrapper ${t}`,children:[r("div",{className:"date-picker-header",children:[e("span",{className:"btn-text",onClick:()=>p(-1),children:e("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),r("span",{className:"normal-text",children:[i.getFullYear()," \u5E74 ",i.getMonth()+1," \u6708"]}),e("span",{className:"btn-text",onClick:()=>p(1),children:e("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),r("div",{className:"date-picker-day-container",children:[r("div",{className:"date-picker-day-header",children:[e("span",{className:"day-item",children:"\u5468\u4E00"}),e("span",{className:"day-item",children:"\u5468\u4E8C"}),e("span",{className:"day-item",children:"\u5468\u4E09"}),e("span",{className:"day-item",children:"\u5468\u56DB"}),e("span",{className:"day-item",children:"\u5468\u4E94"}),e("span",{className:"day-item",children:"\u5468\u516D"}),e("span",{className:"day-item",children:"\u5468\u65E5"})]}),f.map(c=>c.date===0?e("span",{className:"day-item null",children:""},c.datestamp):e("span",{className:`day-item ${c.datestamp===n?"current":""}`,onClick:()=>C(c.datestamp),children:c.date},c.datestamp))]})]})};function At(a){const t=new Date(a),n=new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`);return((n.getMonth()===11?new Date(`${n.getFullYear()+1}/1`):new Date(`${n.getFullYear()}/${n.getMonth()+2}/1`)).getTime()-n.getTime())/H}function ge(a){const t=new Date(a);return new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`).getTime()}const Bt=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],It=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],_t=a=>{const t=he(),[n,s]=d.exports.useState([]),[o,u]=d.exports.useState(v.getDateStampByDate(v.getDateString(a.currentDateStamp))),[i,l]=Z(!1),f=d.exports.useRef(null),x=new Date(o);d.exports.useEffect(()=>{const c=()=>{const h=M.getState().memos.filter(m=>v.getTimeStampByDate(m.createdAt)>=o&&v.getTimeStampByDate(m.createdAt)<o+H).sort((m,g)=>v.getTimeStampByDate(m.createdAt)-v.getTimeStampByDate(g.createdAt));s(h),t.setFinish()},{memos:y}=M.getState(),N=y.slice(-1).pop();N&&v.getTimeStampByDate(N.createdAt)>=o?(t.setLoading(),M.fetchAllMemos().then(()=>{c()}).catch(h=>{w.error(h.message)})):c()},[o]);const C=()=>{l(!1),setTimeout(()=>{const c=v.getOSVersion();(c==="MacOS"||c==="Unknown")&&window.scrollTo(0,0),html2canvas(f.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:U.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(y=>{De(y.toDataURL())})},0)},p=c=>{u(c),l(!1)};return r(L,{children:[e("div",{className:"dialog-header-container",children:r("div",{className:"btns-wrapper",children:[r("div",{className:"btns-container",children:[e("span",{className:"btn-text",onClick:()=>u(o-H),children:e("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),e("span",{className:"btn-text",onClick:()=>u(o+H),children:e("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),r("div",{className:"btns-container",children:[e("span",{className:"btn-text",onClick:C,children:e("img",{className:"icon-img",src:"/icons/share.svg"})}),e("span",{className:"btn-text",onClick:()=>a.destroy(),children:e("img",{className:"icon-img",src:"/icons/close.svg"})})]})]})}),r("div",{className:"dialog-content-container",ref:f,children:[r("div",{className:"date-card-container",onClick:()=>l(),children:[e("div",{className:"year-text",children:x.getFullYear()}),r("div",{className:"date-container",children:[e("div",{className:"month-text",children:Bt[x.getMonth()]}),e("div",{className:"date-text",children:x.getDate()}),e("div",{className:"day-text",children:It[x.getDay()]})]})]}),e(kt,{className:`date-picker ${i?"":"hide"}`,datestamp:o,handleDateStampChange:p}),t.isLoading?e("div",{className:"tip-container",children:e("p",{className:"tip-text",children:"\u52AA\u529B\u52A0\u8F7D\u4E2D..."})}):n.length===0?e("div",{className:"tip-container",children:e("p",{className:"tip-text",children:"\u7A7A\u7A7A\u5982\u4E5F"})}):e("div",{className:"dailymemos-wrapper",children:n.map(c=>e(Ft,{memo:c},`${c.id}-${c.updatedAt}`))})]})]})};function Lt(a=Date.now()){Q({className:"daily-memo-diary-dialog"},_t,{currentDateStamp:a})}const Ot=()=>{const a=z(),{userState:{user:t},memoState:{memos:n}}=d.exports.useContext($),[s,o]=d.exports.useState({memosAmount:0,tagsAmount:0}),[u,i]=d.exports.useState(!1),l=t?t.username:"Memos",f=t?Math.ceil((Date.now()-v.getTimeStampByDate(t.createdAt))/1e3/3600/24):0;d.exports.useEffect(()=>{!B.getState().user||M.getMyDataAmount().then(p=>{o(p)}).catch(p=>{w.error(p.message)})},[n]);const x=d.exports.useCallback(p=>{p.stopPropagation();const c=!u;if(c){const y=()=>{i(!1),document.body.removeEventListener("click",y)};document.body.addEventListener("click",y)}i(c)},[u]),C=d.exports.useCallback(()=>{a.push("/"),I.clearQuery()},[]);return r("div",{className:"user-banner-container",children:[r("div",{className:"userinfo-header-container",children:[e("p",{className:"username-text",onClick:C,children:l}),e("button",{className:"action-btn menu-popup-btn",onClick:x}),e(St,{visibility:u})]}),r("div",{className:"status-text-container",children:[r("div",{className:"status-text memos-text",children:[e("span",{className:"amount-text",children:s.memosAmount}),e("span",{className:"type-text",children:"MEMO"})]}),r("div",{className:"status-text tags-text",children:[e("span",{className:"amount-text",children:s.tagsAmount}),e("span",{className:"type-text",children:"TAG"})]}),r("div",{className:"status-text duration-text",onClick:()=>Lt(),children:[e("span",{className:"amount-text",children:f}),e("span",{className:"type-text",children:"DAY"})]})]})]})};const Ut=()=>{const{locationState:{query:a},memoState:{memos:t}}=d.exports.useContext($),[n,s]=d.exports.useState([]),[o,u]=d.exports.useState(a.tag),i=he();return d.exports.useEffect(()=>{!B.getState().user||M.getMyTags().then(l=>{const f=l.sort((C,p)=>v.getTimeStampByDate(p.createdAt)-v.getTimeStampByDate(C.createdAt)).sort((C,p)=>p.level-C.level),x={subTags:[]};for(const C of f){const p=C.text.split("/");let c=x,y="";for(let N=0;N<p.length;N++){const h=p[N];N===0?y+=h:y+="/"+h;let m=null;for(const g of c.subTags)if(g.text===y){m=g;break}m?m.level+=C.level:(m={id:"",key:h,text:y,level:C.level,subTags:[],deep:N},c.subTags.push(m)),c.subTags.sort((g,S)=>S.level-g.level),y===C.text&&(m.id=C.id),c=m}}x.subTags.sort((C,p)=>p.level-C.level),s(x.subTags),i.setFinish()}).catch(l=>{i.setError(),w.error(l)})},[t]),d.exports.useEffect(()=>{u(a.tag);const l=document.querySelector(le);l==null||l.classList.remove(ue)},[a]),r("div",{className:"tags-wrapper",children:[e("p",{className:"title-text",children:"\u5E38\u7528\u6807\u7B7E"}),e("div",{className:"tags-container",children:i.isLoading?e(L,{}):r(L,{children:[n.map((l,f)=>e(we,{tag:l,tagQuery:o},l.id+"-"+f)),e(G,{when:n.length<5,children:r("p",{className:"tag-tip-container",children:["\u8F93\u5165",e("span",{className:"code-text",children:"# Tag "}),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~"]})})]})})]})},we=a=>{const t=z(),{tag:n,tagQuery:s}=a,o=s===n.text,u=n.subTags.length>0,[i,l]=Z(s.includes(n.text)&&!o),f=n.id!=="";d.exports.useEffect(()=>{l(s.indexOf(n.text)===0&&!o)},[s,n]);const x=()=>{const c=o?"":n.text;c&&(v.copyTextToClipboard(`# ${c} `),M.polishTag(n.id).catch(()=>{})),t.push("/"),I.setTagQuery(c)},C=c=>{f&&(c.stopPropagation(),Rt(n))},p=c=>{c.stopPropagation(),l()};return r(L,{children:[r("div",{className:`tag-item-container ${o?"active":""}`,onClick:x,children:[r("div",{className:"tag-text-container",children:[r("div",{className:`icon-container ${f?"rename-able":""}`,onClick:C,children:[e("span",{className:"icon-text",children:"#"}),f?e("span",{className:"rename-btn",children:o?e("img",{className:"icon-img",src:"/icons/edit-white.svg"}):e("img",{className:"icon-img",src:"/icons/edit.svg"})}):null]}),e("span",{className:"tag-text",children:n.key})]}),e("div",{className:"btns-container",children:u?e("span",{className:`action-btn toggle-btn ${i?"shown":""}`,onClick:p,children:o?e("img",{className:"icon-img",src:"/icons/arrow-right-white.svg"}):e("img",{className:"icon-img",src:"/icons/arrow-right.svg"})}):null})]}),u?e("div",{className:`subtags-container ${i?"":"hidden"}`,children:n.subTags.map((c,y)=>e(we,{tag:c,tagQuery:s},c.id+"-"+y))}):null]})},Pt=a=>{const{destroy:t,tag:n}=a,s=d.exports.useRef(null),o=()=>{t()},u=()=>{var l;const i=(l=s.current)==null?void 0:l.value;if(!i||i===n.text){t();return}M.updateTagText(n.id,i).then(()=>{M.clearMemos(),M.fetchAllMemos(),t()}).catch(()=>{})};return r(L,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[e("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"}),"\u6807\u7B7E\u91CD\u547D\u540D"]}),e("button",{className:"text-btn close-btn",onClick:o,children:e("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("p",{className:"tag-text",children:["\u65E7\uFF1A",n.text]}),e("input",{className:"text-input",type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E",ref:s}),r("div",{className:"btns-container",children:[e("span",{className:"btn-text cancel-btn",onClick:o,children:"\u53D6\u6D88"}),e("span",{className:"btn-text confirm-btn",onClick:u,children:"\u786E\u5B9A"})]})]})]})};function Rt(a){Q({className:"rename-tag-dialog"},Pt,{tag:a})}const Te={width:12,height:7},$t=()=>{const a=v.getDateStampByDate(Date.now()),t=new Date(a).getDay()||7,n=(Te.width-1)*Te.height+t,s=a-n*H,o=new Array(7-t).fill(0),u=()=>{const g=[];for(let S=1;S<=n;S++)g.push({timestamp:s+H*S,count:0});return g},{memoState:{memos:i}}=d.exports.useContext($),[l,f]=d.exports.useState(u()),[x,C]=d.exports.useState(null),[p,c]=d.exports.useState(null),y=d.exports.useRef(null);d.exports.useEffect(()=>{if(!B.getState().user)return;const g=u();M.getMemosStat().then(S=>{for(const b of S){const A=(v.getDateStampByDate(b.timestamp)-s)/(1e3*3600*24)-1;A>=0&&(g[A].count+=1)}f([...g])}).catch(S=>{w.error(S.message)})},[i.length]);const N=d.exports.useCallback((g,S)=>{C(S);const b=g.target;y.current.style.left=b.offsetLeft+"px",y.current.style.top=b.offsetTop+"px"},[]),h=d.exports.useCallback(()=>{C(null)},[]),m=d.exports.useCallback(g=>{I.getState().query.from===g.timestamp?(I.setFromAndToQuery(0,0),c(null)):g.count>0&&(I.setFromAndToQuery(g.timestamp,g.timestamp+H),c(g))},[]);return r("div",{className:"usage-heat-map-wrapper",children:[r("div",{className:"day-tip-text-container",children:[e("span",{className:"tip-text",children:"Mon"}),e("span",{className:"tip-text"}),e("span",{className:"tip-text",children:"Wed"}),e("span",{className:"tip-text"}),e("span",{className:"tip-text",children:"Fri"}),e("span",{className:"tip-text"}),e("span",{className:"tip-text",children:"Sun"})]}),r("div",{ref:y,className:"usage-detail-container pop-up "+(x?"":"hidden"),children:[x==null?void 0:x.count," memos on ",e("span",{className:"date-text",children:new Date(x==null?void 0:x.timestamp).toDateString()})]}),r("div",{className:"usage-heat-map",children:[l.map((g,S)=>{const b=g.count,A=b<=0?"":b<=1?"stat-day-L1-bg":b<=2?"stat-day-L2-bg":b<=4?"stat-day-L3-bg":"stat-day-L4-bg";return e("span",{className:"stat-container "+A+(p===g?" current":" "),onMouseEnter:P=>N(P,g),onMouseLeave:h,onClick:()=>m(g)},S)}),o.map((g,S)=>e("span",{className:"stat-container null"},S))]})]})};const Ht=()=>{const a=Ne(),t=d.exports.useCallback(n=>{if(n.stopPropagation(),n.target.className==="sidebar-wrapper"){const o=document.querySelector(le);o==null||o.classList.remove(ue)}},[]);return r("div",{className:"sidebar-wrapper",onClick:t,children:[e(Ot,{}),e($t,{}),e("div",{className:"nav-btn-container hidden",children:r(xe,{className:"nav-btn",exact:!0,to:"/",children:[e("span",{className:"icon-text",children:"\u{1F60A}"}),e("span",{className:"btn-text",children:"MEMO"})]})}),e(Ut,{}),e("div",{className:"nav-btn-container recycle-btn",children:r(xe,{className:"nav-btn",exact:!0,to:"/trash",children:[e("img",{src:a.pathname==="/trash"?"/icons/trash-white.svg":"/icons/trash.svg",className:"icon-img"}),e("span",{className:"btn-text",children:"\u56DE\u6536\u7AD9"})]})})]})};function Qt(){const[a,t]=d.exports.useState(!1);return d.exports.useCallback(()=>{t(s=>!s)},[])}const Gt=d.exports.forwardRef((a,t)=>{var g,S;const{className:n,initialContent:s,placeholder:o,showConfirmBtn:u,showCancelBtn:i,showTools:l,onConfirmBtnClick:f,onCancelBtnClick:x,onContentChange:C}=a,p=d.exports.useRef(null),c=Qt();d.exports.useEffect(()=>{s&&(p.current.value=s)},[]),d.exports.useEffect(()=>{var b;p.current&&(p.current.style.height="auto",p.current.style.height=((b=p.current.scrollHeight)!=null?b:0)+"px")},[(g=p.current)==null?void 0:g.value]),d.exports.useImperativeHandle(t,()=>({focus:()=>{p.current.focus()},insertText:b=>{p.current.value&&(b=`
`+b),p.current.value+=b,C(p.current.value),c()},setContent:b=>{p.current.value=me(b),c()},getContent:()=>{var b,A;return(A=(b=p.current)==null?void 0:b.value)!=null?A:""}}),[]);const y=d.exports.useCallback(()=>{C(p.current.value),c()},[]),N=d.exports.useCallback(b=>{b.stopPropagation(),b.code==="Enter"&&(b.metaKey||b.ctrlKey)&&h(),c()},[]),h=d.exports.useCallback(()=>{f(p.current.value),p.current.value="",c()},[]),m=d.exports.useCallback(()=>{x()},[]);return r("div",{className:"common-editor-wrapper "+n,children:[e("textarea",{className:"common-editor-inputer",rows:1,placeholder:o,ref:p,onInput:y,onKeyDown:N}),r("div",{className:"common-tools-wrapper",children:[e(G,{when:l,children:e("div",{className:"common-tools-container"})}),r("div",{className:"btns-right-container",children:[e(G,{when:i,children:e("button",{className:"action-btn cancel-btn",onClick:m,children:"\u64A4\u9500\u4FEE\u6539"})}),e(G,{when:u,children:r("button",{className:"action-btn confirm-btn",disabled:((S=p.current)==null?void 0:S.value)==="",onClick:h,children:["\u8BB0\u4E0B",e("span",{className:"icon-text",children:"\u270D\uFE0F"})]})})]})]})]})});const jt=()=>{const{globalState:a}=d.exports.useContext($),t=d.exports.useRef(null);d.exports.useEffect(()=>{var l;if(a.markMemoId){const f=`Mark: [@MEMO](${a.markMemoId})`;(l=t.current)==null||l.insertText(f)}a.editMemoId&&M.getMemoById(a.editMemoId).then(f=>{var x,C,p;f&&((C=t.current)==null||C.setContent((x=f.content)!=null?x:""),(p=t.current)==null||p.focus())})},[a]);const n=d.exports.useCallback(async l=>{var c,y;if(l===""){w.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}const{editMemoId:f}=U.getState(),{query:x}=I.getState();l=me(l.replaceAll("&nbsp;"," "));const C=v.dedupe(Array.from((c=l.match(J))!=null?c:[])).map(N=>N.replace(J,"$1").trim()),p=[];try{for(const N of C){const h=await M.createTag(N);p.push(h)}if(f){const N=await M.getMemoById(f);if(N&&N.content!==l){const h=(y=N.tags)!=null?y:[],m=h.map(S=>S.text);p.push(...h);for(let S=0;S<p.length;){const b=p[S],A=b.text;C.includes(A)?(S++,m.includes(A)||await M.createMemoTag(N.id,b.id)):(p.splice(S,1),await M.removeMemoTag(N.id,b.id))}const g=await M.updateMemo(N.id,l);g.tags=p,g.updatedAt=v.getDateTimeString(Date.now()),M.editMemo(g)}U.setEditMemoId("")}else{const N=await M.createMemo(l);N.tags=p;for(const m of p)await M.createMemoTag(N.id,m.id);const h=x.tag;h!==""&&!C.includes(h)&&I.setTagQuery(""),M.pushMemo(N)}}catch(N){w.error(N.message)}fe("")},[]),s=d.exports.useCallback(()=>{var l;U.setEditMemoId(""),(l=t.current)==null||l.setContent(""),fe("")},[]),o=d.exports.useCallback(l=>{const f=document.createElement("div");f.innerHTML=l,f.innerText.trim()===""&&(l=""),fe(l)},[]),{editMemoId:u}=a,i=d.exports.useMemo(()=>({className:"memo-editor",initialContent:Yt(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,showCancelBtn:u!=="",showTools:!0,onConfirmBtnClick:n,onCancelBtnClick:s,onContentChange:o}),[u]);return r("div",{className:"memo-editor-wrapper "+(u?"edit-ing":""),children:[e("p",{className:"tip-text "+(u?"":"hidden"),children:"\u6B63\u5728\u4FEE\u6539\u4E2D..."}),e(Gt,D({ref:t},i))]})};function Yt(){var a;return(a=Y.get(["editorContentCache"]).editorContentCache)!=null?a:""}function fe(a){Y.set({editorContentCache:a})}const qt=()=>{const{locationState:{query:{text:a,type:t}}}=d.exports.useContext($),n=d.exports.useRef(null);d.exports.useEffect(()=>{var i;(i=n.current)==null||i.focus()},[]);const s=i=>{const{type:l}=I.getState().query;i===l&&(i=""),I.setMemoTypeQuery(i)};return r("div",{className:"search-bar-container",children:[r("div",{className:"search-bar-inputer",children:[e("img",{className:"icon-img",src:"/icons/search.svg"}),e("input",{className:"text-input",type:"text",placeholder:"",ref:n,value:a,onChange:i=>{const l=i.currentTarget.value;I.setTextQuery(l)},onKeyPress:i=>{i.code==="Enter"}})]}),e("div",{className:"quickly-action-wrapper",children:r("div",{className:"quickly-action-container",children:[e("p",{className:"title-text",children:"QUICKLY FILTER"}),r("div",{className:"section-container types-container",children:[e("span",{className:"section-text",children:"Type:"}),de.map((i,l)=>r("div",{children:[e("span",{className:`type-item ${t===i.type?"selected":""}`,onClick:()=>{s(i.type)},children:i.text}),l+1<de.length?e("span",{className:"split-text",children:"/"}):null]},i.type))]})]})})]})};const Vt=()=>{const a=d.exports.useCallback(()=>{I.clearQuery()},[]),t=d.exports.useCallback(n=>{n.stopPropagation();const s=document.querySelector(le);s&&s.classList.add(ue)},[]);return r("div",{className:"memos-header-container",children:[r("div",{className:"title-text",onClick:a,children:[e("button",{className:"action-btn",onClick:t,children:e("img",{className:"icon-img",src:"/icons/fold.svg",alt:"fold"})}),"MEMO"]}),e(qt,{})]})};function Kt(a,t,n=[]){const s=d.exports.useRef(),o=d.exports.useCallback(()=>{s.current&&clearTimeout(s.current)},[]);return d.exports.useCallback((...i)=>{o(),s.current=window.setTimeout(()=>{a(...i)},t)},n)}const Wt=a=>{for(const t of de)if(t.type===a)return t.text;return""},zt=()=>{const{locationState:{query:a},memoState:{memos:t}}=d.exports.useContext($),[n,s]=d.exports.useState(!1),[o,u]=d.exports.useState(!1),i=d.exports.useRef(null),l=a.tag,f={from:a.from,to:a.to},x=a.type,C=a.text,p=Boolean(l||f.from!==0&&f.from<f.to||x||C),c=t.filter(m=>{let g=!0;const S=[];for(const b of m.tags){const A=b.text.split("/");let P="";for(let R=0;R<A.length;R++)R===0?P+=A[R]:P+="/"+A[R],S.push(P)}return l!==""&&!S.includes(l)&&(g=!1),f.from!==0&&f.from<f.to&&(v.getTimeStampByDate(m.createdAt)<f.from||v.getTimeStampByDate(m.createdAt)>f.to)&&(g=!1),x!==""&&(x==="NOT_TAGGED"?m.content.match(J)!==null&&(g=!1):x==="LINKED"?m.content.match(Ee)===null&&(g=!1):x==="IMAGED"&&m.content.match(j)===null&&(g=!1)),C!==""&&!m.content.includes(C)&&(g=!1),g});d.exports.useEffect(()=>{var m;(m=i.current)==null||m.scrollTo({top:0}),!o&&p&&(s(!0),M.fetchAllMemos().then(g=>{g!==!1&&(u(!0),s(!1))}))},[o,p,a]);const y=async()=>{if(!(n||o)){s(!0);try{const m=await M.fetchMoreMemos();Array.isArray(m)&&m.length===0&&u(!0)}catch(m){w.error(m.message)}s(!1)}},N=d.exports.useCallback(m=>{const g=m.target;if(g.tagName==="SPAN"&&g.className==="tag-span"){const S=g.innerText.slice(1);I.getState().query.tag===S?I.setTagQuery(""):I.setTagQuery(S)}},[]),h=Kt(()=>{if(n||o)return;const{offsetHeight:m,scrollTop:g,scrollHeight:S}=i.current;m+g+10>S&&y()},100,[n,o]);return r("div",{className:`memolist-wrapper ${o?"completed":""}`,onClick:N,onScroll:h,ref:i,children:[e(Xt,{showFilter:p,tagQuery:l,duration:f,memoType:x,textQuery:C}),c.map(m=>e(Tt,{memo:m},`${m.id}-${m.updatedAt}`)),p?e("div",{className:"status-text-container",children:e("p",{className:"status-text",children:n?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":o&&c.length===0?"\u7A7A\u7A7A\u5982\u4E5F":""})}):e("div",{className:`status-text-container ${o?"completed":""} ${n||o?"":"invisible"}`,children:e("p",{className:"status-text",children:o?"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}":"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})})]})},Xt=a=>{const{showFilter:t,tagQuery:n,duration:s,memoType:o,textQuery:u}=a;return r("div",{className:`filter-query-container ${t?"":"hidden"}`,children:[e("span",{className:"tip-text",children:"\u7B5B\u9009\uFF1A"}),r("div",{className:"filter-item-container "+(s.from!==0&&s.from<s.to?"":"hidden"),onClick:()=>{I.setFromAndToQuery(0,0)},children:[e("span",{className:"icon-text",children:"\u{1F5D3}\uFE0F"})," ",v.getDateString(s.from)," \u81F3 ",v.getDateString(s.to)]}),r("div",{className:"filter-item-container "+(n?"":"hidden"),onClick:()=>{I.setTagQuery("")},children:[e("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"})," ",n]}),r("div",{className:"filter-item-container "+(o?"":"hidden"),onClick:()=>{I.setMemoTypeQuery("")},children:[e("span",{className:"icon-text",children:"\u{1F4E6}"})," ",Wt(o)]}),r("div",{className:"filter-item-container "+(u?"":"hidden"),onClick:()=>{I.setTextQuery("")},children:[e("span",{className:"icon-text",children:"\u{1F50D}"})," ",u]})]})};function Jt(){return r(L,{children:[e(Vt,{}),e(jt,{}),e(zt,{})]})}const Zt=a=>{var C,p;const{memo:t,handleDeletedMemoAction:n}=a,s=F(D({},t),{formattedContent:V(t.content),createdAtStr:v.getDateTimeString(t.createdAt),deletedAtStr:v.getDateTimeString((C=t.deletedAt)!=null?C:Date.now())}),[o,u]=Z(!1),i=Array.from((p=s.content.match(j))!=null?p:[]),l=async()=>{if(o)try{await M.deleteMemoById(s.id),n(s.id)}catch(c){w.error(c.message)}else u()},f=async()=>{try{await M.restoreMemoById(s.id),n(s.id),w.info("\u6062\u590D\u6210\u529F")}catch(c){w.error(c.message)}},x=()=>{o&&u(!1)};return r("div",{className:`memo-wrapper ${"memos-"+s.id}`,onMouseLeave:x,children:[r("div",{className:"memo-top-wrapper",children:[r("span",{className:"time-text",children:["\u5220\u9664\u4E8E ",s.deletedAtStr]}),r("div",{className:"btns-container",children:[e("span",{className:"text-btn more-action-btn",children:e("img",{className:"icon-img",src:"/icons/more.svg"})}),e("div",{className:"more-action-btns-wrapper",children:r("div",{className:"more-action-btns-container",children:[e("span",{className:`text-btn delete-btn ${o?"final-confirm":""}`,onClick:l,children:o?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5B8C\u5168\u5220\u9664"}),e("span",{className:"text-btn restore-btn",onClick:f,children:"\u6062\u590D"})]})})]})]}),e("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:s.formattedContent}}),e(G,{when:i.length>0,children:e("div",{className:"images-wrapper",children:i.map((c,y)=>e(pe,{className:"memo-img",imgUrl:c},y))})})]})};const ea=()=>{const[a,t]=d.exports.useState([]);d.exports.useEffect(()=>{M.fetchDeletedMemos().then(s=>{s!==!1&&t(s)})},[]);const n=d.exports.useCallback(s=>{t(a.filter(o=>o.id!==s))},[a]);return r("div",{className:"memo-trash-wrapper",children:[e("div",{className:"header-container",children:e("p",{className:"title-text",children:"\u56DE\u6536\u7AD9"})}),a.map(s=>e(Zt,{memo:s,handleDeletedMemoAction:n},`${s.id}-${s.updatedAt}`))]})};function ta(){const a=he(),t=z(),n=Ne();return d.exports.useEffect(()=>{B.doSignIn().catch(()=>{}).finally(()=>{B.getState().user?(M.fetchMoreMemos(),a.setFinish()):t.replace("/signin")})},[]),d.exports.useEffect(()=>{I.clearQuery()},[n.pathname]),e(L,{children:a.isLoading?e(L,{}):r("div",{id:"page-container",children:[e(Ht,{}),e("div",{className:"content-wrapper",children:r(Ce,{children:[e(X,{exact:!0,path:"/trash",children:e(ea,{})}),e(X,{exact:!0,path:"/",children:e(Jt,{})})]})})]})})}const aa=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function Fe(a,t){return t.minLength!==void 0&&a.length<t.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:t.maxLength!==void 0&&a.length>t.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:t.noSpace&&a.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:t.noChinese&&aa.test(a)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const ke={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},na=()=>{const a=z(),[t,n]=d.exports.useState(""),[s,o]=d.exports.useState(""),u=d.exports.useRef(null);d.exports.useEffect(()=>{const C=p=>{var c;p.key==="Enter"&&((c=u.current)==null||c.click())};return document.body.addEventListener("keypress",C),()=>{document.body.removeEventListener("keypress",C)}},[]);const i=C=>{const p=C.target.value;n(p)},l=C=>{const p=C.target.value;o(p)},f=()=>{ve()},x=async()=>{const C=Fe(t,ke);if(!C.result){w.error("\u7528\u6237\u540D "+C.reason);return}const p=Fe(s,ke);if(!p.result){w.error("\u5BC6\u7801 "+p.reason);return}try{const c=T.signin,{succeed:y,message:N}=await c(t,s);if(!y&&N){w.error("\u{1F61F} "+N);return}await B.doSignIn()?(M.fetchMoreMemos().catch(()=>{}),a.replace("/")):w.error("\u{1F61F} \u4E0D\u77E5\u9053\u53D1\u751F\u4E86\u4EC0\u4E48\u9519\u8BEF")}catch(c){console.error(c),w.error("\u{1F61F} "+c.message)}};return e("div",{className:"page-wrapper signin",children:r("div",{className:"page-container",children:[e("div",{className:"page-header-container",children:r("p",{className:"title-text",children:[e("span",{className:"icon-text",children:"\u{1F44B}"})," \u8D26\u53F7\u6CE8\u518C / \u767B\u5F55"]})}),r("div",{className:"page-content-container",children:[r("label",{className:"form-label input-form-label",children:[e("input",{type:"text",value:t,onChange:i}),e("span",{className:"normal-text "+(t===""?"":"not-null"),children:"\u8D26\u53F7"})]}),r("label",{className:"form-label input-form-label",children:[e("input",{type:"password",value:s,onChange:l}),e("span",{className:"normal-text "+(s===""?"":"not-null"),children:"\u5BC6\u7801"})]})]}),r("div",{className:"page-footer-container",children:[e("div",{className:"btns-container",children:e("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"Sign In with GitHub"})}),r("div",{className:"btns-container",children:[e("button",{className:"text-btn signup-btn disabled",onClick:()=>w.info("\u6CE8\u518C\u5DF2\u5173\u95ED"),children:"\u6CE8\u518C"}),e("span",{className:"split-text",children:"/"}),e("button",{className:"text-btn signin-btn",ref:u,onClick:x,children:"\u767B\u5F55"})]})]}),r("p",{className:"tip-text",children:["\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\uFF0C\u53EF\u8F93\u5165 ",e("code",{children:"guest, 123456"})," \u8FDB\u884C\u4F53\u9A8C\u3002",e("br",{}),r("span",{className:"text-btn",onClick:f,children:[e("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E\u672C\u7AD9"]})]})]})})};function sa(){const{globalState:{showDarkMode:a}}=d.exports.useContext($);return d.exports.useEffect(()=>{a?document.body.classList.add("dark"):document.body.classList.remove("dark")},[a]),e(Re,{children:r(Ce,{children:[e(X,{exact:!0,path:"/signin",children:e(na,{})}),e(X,{path:"*",children:e(ta,{})})]})})}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(a,t){return Object.prototype.toString.call(a).toLowerCase()==="[object regexp]"?this.replace(a,t):this.replace(new RegExp(a,"g"),t)})})();K.render(e($e.StrictMode,{children:e(Se,{store:k,context:$,children:e(sa,{})})}),document.getElementById("root"));
