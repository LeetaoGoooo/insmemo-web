var Ae=Object.defineProperty,Be=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var ge=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var ce=(a,e,n)=>e in a?Ae(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n,w=(a,e)=>{for(var n in e||(e={}))Le.call(e,n)&&ce(a,n,e[n]);if(ge)for(var n of ge(e))_e.call(e,n)&&ce(a,n,e[n]);return a},F=(a,e)=>Be(a,Ie(e));var L=(a,e,n)=>(ce(a,typeof e!="symbol"?e+"":e,n),n);import{j as ie,r as m,R as Y,a as Oe}from"./vendor.11819a74.js";const Ue=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}};Ue();const t=ie.exports.jsx,r=ie.exports.jsxs,O=ie.exports.Fragment,fe=a=>{const{children:e,store:n,context:s}=a,[o,i]=m.exports.useState(n.getState());return m.exports.useEffect(()=>{const c=n.subscribe(h=>{i(h)});return()=>{c()}},[]),t(s.Provider,{value:o,children:e})};function Pe(a){const e=Object.keys(a),n={};for(const s of e)typeof a[s]=="function"&&(n[s]=a[s]);return(s={},o)=>{let i=!1;const c={};for(const h of e){const g=s[h],f=n[h](g,o);c[h]=f,i=i||f!==g}return i?c:s}}function Re(a,e){const n=[];let s=a;return{dispatch:h=>{const g=e(s,h),f=s;s=g;for(const C of n)C(s,f)},getState:()=>s,subscribe:h=>{let g=!0;return n.push(h),()=>{if(!g)return;const f=n.indexOf(h);n.splice(f,1),g=!1}}}}function $e(a,e){switch(e.type){case"SET_MARK_MEMO_ID":return e.payload.markMemoId===a.markMemoId?a:F(w({},a),{markMemoId:e.payload.markMemoId});case"SET_EDIT_MEMO_ID":return e.payload.editMemoId===a.editMemoId?a:F(w({},a),{editMemoId:e.payload.editMemoId});case"SET_MOBILE_VIEW":return e.payload.isMobileView===a.isMobileView?a:F(w({},a),{isMobileView:e.payload.isMobileView});case"SET_APP_SETTING":return w(w({},a),e.payload);default:return a}}const He={markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,showDarkMode:!1,isMobileView:!1};function Ge(a,e){switch(e.type){case"SET_LOCATION":return e.payload;case"SET_PATHNAME":return e.payload.pathname===a.pathname?a:F(w({},a),{pathname:e.payload.pathname});case"SET_TAG_QUERY":return e.payload.tag===a.query.tag?a:F(w({},a),{query:F(w({},a.query),{tag:e.payload.tag})});case"SET_FROM_TO_QUERY":return e.payload.from===a.query.from&&e.payload.to===a.query.to?a:F(w({},a),{query:F(w({},a.query),{from:e.payload.from,to:e.payload.to})});case"SET_TYPE":return e.payload.type===a.query.type?a:F(w({},a),{query:F(w({},a.query),{type:e.payload.type})});case"SET_TEXT":return e.payload.text===a.query.text?a:F(w({},a),{query:F(w({},a.query),{text:e.payload.text})});case"SET_HASH":return e.payload.hash===a.hash?a:F(w({},a),{hash:e.payload.hash});default:return a}}const Ve={pathname:"/",hash:"",query:{tag:"",from:0,to:0,type:"",text:""}};var b;(function(a){function e(){return Date.now()}a.getNowTimeStamp=e;function n(){const d=navigator.appVersion;let l="Unknown";return d.indexOf("Win")!=-1?l="Windows":d.indexOf("Mac")!=-1?l="MacOS":d.indexOf("Linux")!=-1&&(l="Linux"),l}a.getOSVersion=n;function s(d){return typeof d=="string"&&(d=d.replaceAll("-","/")),new Date(d).getTime()}a.getTimeStampByDate=s;function o(d){const l=new Date(s(d));return new Date(l.getFullYear(),l.getMonth(),l.getDate()).getTime()}a.getDateStampByDate=o;function i(d){const l=new Date(s(d)),y=l.getFullYear(),x=l.getMonth()+1,E=l.getDate();return`${y}/${x}/${E}`}a.getDateString=i;function c(d){const l=new Date(s(d)),y=l.getHours(),x=l.getMinutes(),E=y<10?"0"+y:y,k=x<10?"0"+x:x;return`${E}:${k}`}a.getTimeString=c;function h(d){const l=new Date(s(d)),y=l.getFullYear(),x=l.getMonth()+1,E=l.getDate(),k=l.getHours(),P=l.getMinutes(),R=l.getSeconds(),te=x<10?"0"+x:x,ae=E<10?"0"+E:E,ne=k<10?"0"+k:k,se=P<10?"0"+P:P,oe=R<10?"0"+R:R;return`${y}/${te}/${ae} ${ne}:${se}:${oe}`}a.getDateTimeString=h;function g(d){return Array.from(new Set(d))}a.dedupe=g;function f(d){const l=new Set,y=[];for(const x of d)l.has(x.id)||(l.add(x.id),y.push(x));return y}a.dedupeObjectWithId=f;function C(d,l){let y=null;return()=>{y&&clearTimeout(y),y=setTimeout(d,l)}}a.debounce=C;function p(d,l){let y=!0;return()=>{if(!y)return!1;y=!1,setTimeout(()=>{d(),y=!0},l)}}a.throttle=p;function u(d){const l=[],y=Object.keys(d),x=Object.values(d);for(let E=0;E<y.length;++E)x[E]&&l.push(`${y[E]}=${x[E]}`);return l.join("&")}a.iterObjectToParamsString=u;async function N(d){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(d)}catch(l){console.warn("Copy to clipboard failed.",l)}else console.warn("Copy to clipboard failed, methods not supports.")}a.copyTextToClipboard=N;function S(d){return new Promise((l,y)=>{const x=new Image;x.onload=()=>{const{width:E,height:k}=x;E>0&&k>0?l({width:E,height:k}):l({width:0,height:0})},x.onerror=()=>{l({width:0,height:0})},x.className="hidden",x.src=d,document.body.appendChild(x),x.remove()})}a.getImageSize=S})(b||(b={}));function Qe(a,e){switch(e.type){case"SET_MEMOS":return{memos:[...b.dedupeObjectWithId(e.payload.memos.sort((s,o)=>b.getTimeStampByDate(o.createdAt)-b.getTimeStampByDate(s.createdAt)))]};case"PUSH_MEMO":return{memos:b.dedupeObjectWithId([e.payload.memo,...a.memos].sort((s,o)=>b.getTimeStampByDate(o.createdAt)-b.getTimeStampByDate(s.createdAt)))};case"PUSH_MEMOS":return{memos:b.dedupeObjectWithId([...e.payload.memos,...a.memos].sort((s,o)=>b.getTimeStampByDate(o.createdAt)-b.getTimeStampByDate(s.createdAt)))};case"DELETE_MEMO_BY_ID":return{memos:[...a.memos].filter(n=>n.id!==e.payload.id)};case"EDIT_MEMO":return{memos:a.memos.map(s=>s.id===e.payload.id?w(w({},s),e.payload):s)};default:return a}}const qe={memos:[]};function je(a,e){switch(e.type){case"SIGN_IN":return{user:e.payload.user};case"SIGN_OUT":return{user:null};default:return a}}const We={user:null},v=Re({globalState:He,locationState:Ve,memoState:qe,userState:We},Pe({globalState:$e,locationState:Ge,memoState:Qe,userState:je})),$=m.exports.createContext(v.getState());var W;(function(a){function e(o){const i={};for(const c of o)try{const h=localStorage.getItem(c);if(h!==null){const g=JSON.parse(h);i[c]=g}}catch(h){console.error("Get storage failed in ",c,h)}return i}a.get=e;function n(o){for(const i in o)try{const c=JSON.stringify(o[i]);localStorage.setItem(i,c)}catch(c){console.error("Save storage failed in ",i,c)}}a.set=n;function s(){var i;const o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o),(i=o.contentWindow)==null||i.localStorage.setItem("t",Date.now().toString()),o.remove()}a.emitStorageChangedEvent=s})(W||(W={}));class Ye{constructor(){L(this,"getState",()=>v.getState().globalState);L(this,"setEditMemoId",e=>{v.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:e}})});L(this,"setMarkMemoId",e=>{v.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:e}})});L(this,"setIsMobileView",e=>{v.dispatch({type:"SET_MOBILE_VIEW",payload:{isMobileView:e}})});L(this,"setAppSetting",e=>{v.dispatch({type:"SET_APP_SETTING",payload:e}),W.set(e)});var s,o,i,c;const e=W.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser","showDarkMode"]),n={shouldSplitMemoWord:(s=e.shouldSplitMemoWord)!=null?s:!0,shouldHideImageUrl:(o=e.shouldHideImageUrl)!=null?o:!0,shouldUseMarkdownParser:(i=e.shouldUseMarkdownParser)!=null?i:!0,showDarkMode:(c=e.showDarkMode)!=null?c:!1};this.setAppSetting(n)}}const U=new Ye,H=(a="replace")=>{const{query:e,pathname:n,hash:s}=v.getState().locationState;let o=b.iterObjectToParamsString(e);o?o="?"+o:o="",a==="replace"?window.history.replaceState(null,"",n+s+o):window.history.pushState(null,"",n+s+o)};class Ke{constructor(){L(this,"updateStateWithLocation",()=>{var c,h,g,f,C;const{pathname:e,search:n,hash:s}=window.location,o=new URLSearchParams(n),i={pathname:"/",hash:"",query:{tag:"",from:0,to:0,text:"",type:""}};i.query={tag:(c=o.get("tag"))!=null?c:"",from:parseInt((h=o.get("from"))!=null?h:"0"),to:parseInt((g=o.get("to"))!=null?g:"0"),type:(f=o.get("type"))!=null?f:"",text:(C=o.get("text"))!=null?C:""},i.hash=s,i.pathname=this.getValidPathname(e),v.dispatch({type:"SET_LOCATION",payload:i})});L(this,"getState",()=>v.getState().locationState);L(this,"clearQuery",()=>{v.dispatch({type:"SET_TAG_QUERY",payload:{tag:""}}),v.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:0,to:0}}),H()});L(this,"setHash",e=>{v.dispatch({type:"SET_HASH",payload:{hash:e}}),H()});L(this,"setPathname",e=>{v.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H()});L(this,"pushHistory",e=>{v.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H("push")});L(this,"replaceHistory",e=>{v.dispatch({type:"SET_PATHNAME",payload:{pathname:e}}),H("replace")});L(this,"setMemoTypeQuery",(e="")=>{v.dispatch({type:"SET_TYPE",payload:{type:e}}),H()});L(this,"setTextQuery",e=>{v.dispatch({type:"SET_TEXT",payload:{text:e}}),H()});L(this,"setTagQuery",e=>{v.dispatch({type:"SET_TAG_QUERY",payload:{tag:e}}),H()});L(this,"setFromAndToQuery",(e,n)=>{v.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:e,to:n}}),H()});L(this,"getValidPathname",e=>["/","/signin","/trash"].includes(e)?e:"/");this.updateStateWithLocation(),window.onpopstate=()=>{this.updateStateWithLocation()}}}const B=new Ke;var A;(function(a){async function e(M){const K=await(await fetch(M,{method:"GET"})).json();if(!K.succeed)throw K;return K}a.get=e;async function n(M,_){const re=await(await fetch(M,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)})).json();if(!re.succeed)throw re;return re}a.post=n;function s(){return e("/api/user/me")}a.getUserInfo=s;function o(M,_){return n("/api/user/signin",{username:M,password:_})}a.signin=o;function i(M,_){return n("/api/user/signup",{username:M,password:_})}a.signup=i;function c(){return n("/api/user/signout")}a.signout=c;function h(M){return e("/api/user/checkusername?username="+M)}a.checkUsernameUsable=h;function g(M){return n("/api/user/checkpassword",{password:M})}a.checkPasswordValid=g;function f(M="",_=""){return n("/api/user/update",{username:M,password:_})}a.updateUserinfo=f;function C(M=0,_=20){return e(`/api/memo/all?offset=${M}&amount=${_}`)}a.getMyMemos=C;function p(){return e("/api/memo/trash")}a.getMyDeletedMemos=p;function u(M){return n("/api/memo/new",{content:M})}a.createMemo=u;function N(M){return e("/api/memo/?id="+M)}a.getMemoById=N;function S(M){return n("/api/memo/hide",{memoId:M})}a.hideMemo=S;function d(M){return n("/api/memo/restore",{memoId:M})}a.restoreMemo=d;function l(M){return n("/api/memo/delete",{memoId:M})}a.deleteMemo=l;function y(M,_){return n("/api/memo/update",{memoId:M,content:_})}a.updateMemo=y;function x(){return e("/api/memo/count")}a.getMemosCount=x;function E(M){return e("/api/memo/linkeds?memoId="+M)}a.getLinkedMemos=E;function k(M){return n("/api/tag/new",{text:M})}a.createTag=k;function P(M,_){return n("/api/tag/link",{memoId:M,tagId:_})}a.createMemoTag=P;function R(M,_){return n("/api/tag/rmlink",{memoId:M,tagId:_})}a.removeMemoTag=R;function te(M){return e("/api/tag/memo?id="+M)}a.getTagsByMemoId=te;function ae(){return e("/api/tag/all")}a.getMyTags=ae;function ne(M){return n("/api/tag/delete",{tagId:M})}a.deleteTagById=ne;function se(M){return n("/api/tag/polish",{tagId:M})}a.polishTag=se;function oe(M,_){return n("/api/tag/update",{id:M,text:_})}a.updateTagText=oe;function ve(){return e("/api/user/amount")}a.getMyDataAmount=ve;function Te(M){return e("/api/base/srctype?url="+M)}a.getUrlContentType=Te;function ke(){return e("/api/memo/stat")}a.getMemosStat=ke;function Fe(){return n("/api/user/updategh",{githubName:""})}a.removeGithubName=Fe})(A||(A={}));const z="#page-container",X="mobile-show-sidebar",ze=20,ye=200,Xe=400,G=3600*24*1e3,J=/#\s(.+?)\s/g,Ne=/(https?:\/\/[^\s<\\*>']+)/g,q=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,le=/\[@(.+?)\]\((.+?)\)/g,ue=[{type:"CONNECTED",text:"\u6709\u8FDE\u63A5"},{type:"NOT_TAGGED",text:"\u65E0\u6807\u7B7E"},{type:"LINKED",text:"\u6709\u8D85\u94FE\u63A5"},{type:"IMAGED",text:"\u6709\u56FE\u7247"}];class Je{getState(){return v.getState().userState}async doSignIn(){const{data:e}=await A.getUserInfo();return e?v.dispatch({type:"SIGN_IN",payload:{user:e}}):I.doSignOut(),e}async doSignOut(){A.signout().catch(()=>{}).finally(()=>{v.dispatch({type:"SIGN_OUT",payload:{user:null}})})}async checkUsernameUsable(e){const{data:n}=await A.checkUsernameUsable(e);return n}async updateUsername(e){await A.updateUserinfo(e)}async removeGithubName(){await A.removeGithubName()}async checkPasswordValid(e){const{data:n}=await A.checkPasswordValid(e);return n}async updatePassword(e){await A.updateUserinfo("",e)}}const I=new Je;class Ze{constructor(){L(this,"isFetching",!1)}getState(){return v.getState().memoState}async fetchMoreMemos(){if(!I.getState().user||this.isFetching)return!1;this.isFetching=!0;const{data:e}=await A.getMyMemos(this.getState().memos.length,ze),n=e.map(s=>w({},s));return v.dispatch({type:"PUSH_MEMOS",payload:{memos:n}}),this.isFetching=!1,n}async fetchAllMemos(){if(!I.getState().user)return!1;this.isFetching=!0;const{data:{memosAmount:e}}=await A.getMyDataAmount(),{data:n}=await A.getMyMemos(0,e),s=n.map(o=>w({},o));return s.length>0&&v.dispatch({type:"SET_MEMOS",payload:{memos:s}}),this.isFetching=!1,n}async fetchDeletedMemos(){if(!I.getState().user)return!1;const{data:e}=await A.getMyDeletedMemos();return e}pushMemo(e){v.dispatch({type:"PUSH_MEMO",payload:{memo:w({},e)}})}async getMemoById(e){for(const s of this.getState().memos)if(s.id===e)return s;const{data:n}=await A.getMemoById(e);return n}async hideMemoById(e){await A.hideMemo(e),v.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:e}})}async restoreMemoById(e){await A.restoreMemo(e),D.clearMemos(),D.fetchMoreMemos()}async deleteMemoById(e){await A.deleteMemo(e)}editMemo(e){v.dispatch({type:"EDIT_MEMO",payload:e})}clearMemos(){v.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(e){const{data:n}=await A.createMemo(e);return n}async updateMemo(e,n){const{data:s}=await A.updateMemo(e,n);return s}async createTag(e){const{data:n}=await A.createTag(e);return n}async removeMemoTag(e,n){await A.removeMemoTag(e,n)}async createMemoTag(e,n){await A.createMemoTag(e,n)}async getMyDataAmount(){const{data:e}=await A.getMyDataAmount();return e}async getMemosStat(){const{data:e}=await A.getMemosStat();return e}async getLinkedMemos(e){const{data:n}=await A.getLinkedMemos(e);return n}async getMyTags(){if(!I.getState().user)return[];const{data:e}=await A.getMyTags();return e}async polishTag(e){await A.polishTag(e)}async updateTagText(e,n){await A.updateTagText(e,n)}}const D=new Ze;const et=a=>{const{destory:e,duration:n}=a;return m.exports.useEffect(()=>{n>0&&setTimeout(()=>{e()},n)},[]),t("div",{className:"toast-container",onClick:e,children:t("p",{className:"content-text",children:a.content})})},T=(()=>{const a=document.createElement("div");a.className="toast-list-container",document.body.appendChild(a);let e=0;const n=[],s=c=>{const h=document.createElement("div");h.className=`toast-wrapper ${c.type}`,a.appendChild(h),e++,n.push(h),setTimeout(()=>{h.classList.add("showup")},0);const g={destory:()=>{h.classList.add("destory"),setTimeout(()=>{if(!!h.parentElement&&(e--,e===0)){for(const f of n)Y.unmountComponentAtNode(f),f.remove();n.splice(0,n.length)}},Xe)}};return Y.render(t(et,F(w({},c),{destory:g.destory})),h),g};return{info:(c,h=3e3)=>s({type:"normal",content:c,duration:h}),error:(c,h=3e3)=>s({type:"error",content:c,duration:h})}})();const tt=a=>{const{children:e,className:n,clickSpaceDestroy:s,destroy:o}=a,i=()=>{s&&o()};return t("div",{className:`dialog-wrapper ${n}`,onClick:i,children:t("div",{className:"dialog-container",onClick:c=>c.stopPropagation(),children:e})})};function V(a,e,n){const s=document.createElement("div");document.body.append(s),setTimeout(()=>{var h;(h=s.firstElementChild)==null||h.classList.add("showup")},0);const o={destroy:()=>{var h,g;(h=s.firstElementChild)==null||h.classList.remove("showup"),(g=s.firstElementChild)==null||g.classList.add("showoff"),setTimeout(()=>{s.remove(),Y.unmountComponentAtNode(s)},ye)}},i=F(w({},n),{destroy:o.destroy});let c=t(tt,F(w({destroy:o.destroy,clickSpaceDestroy:!0},a),{children:t(e,w({},i))}));return a.useAppContext&&(c=t(fe,{store:v,context:$,children:c})),Y.render(c,s),o}const at=({destroy:a})=>{const{userState:e}=m.exports.useContext($),n=e.user,[s,o]=m.exports.useState(n.username),[i,c]=m.exports.useState(!1),[h,g]=m.exports.useState(!1),f=()=>{a()},C=d=>{const l=d.target.value;o(l)},p=async()=>{if(n.username==="guest"){T.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u7528\u6237\u540D");return}if(s===n.username){c(!1);return}try{if(!await I.checkUsernameUsable(s)){T.error("\u7528\u6237\u540D\u65E0\u6CD5\u4F7F\u7528");return}await I.updateUsername(s),await I.doSignIn(),c(!1),T.info("\u4FEE\u6539\u6210\u529F~")}catch(d){T.error(d.message)}},u=()=>{if(n.username==="guest"){T.info("\u{1F232} \u4E0D\u8981\u4FEE\u6539\u6211\u7684\u5BC6\u7801");return}st()},N=async()=>{if(h){try{await I.removeGithubName(),await I.doSignIn()}catch(d){T.error(d.message)}g(!1)}else g(!0)},S=d=>{d.preventDefault()};return r(O,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F920}"}),"\u6211\u7684\u8D26\u53F7"]}),t("button",{className:"text-btn close-btn",onClick:f,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("div",{className:"section-container account-section-container",children:[t("p",{className:"title-text",children:"\u57FA\u672C\u4FE1\u606F"}),r("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"ID\uFF1A"}),t("span",{className:"normal-text",children:n.id})]}),r("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"\u521B\u5EFA\u65F6\u95F4\uFF1A"}),t("span",{className:"normal-text",children:b.getDateString(n.createdAt)})]}),r("label",{className:"form-label input-form-label username-label",children:[t("span",{className:"normal-text",children:"\u8D26\u53F7\uFF1A"}),t("input",{type:"text",readOnly:!i,value:s,onClick:()=>{c(!0)},onChange:C}),r("div",{className:"btns-container",onClick:S,children:[t("span",{className:"text-btn confirm-btn "+(i?"":"hidden"),onClick:p,children:"\u4FDD\u5B58"}),t("span",{className:"text-btn cancel-btn "+(i?"":"hidden"),onClick:()=>{o(n.username),c(!1)},children:"\u64A4\u9500"})]})]}),r("label",{className:"form-label password-label",children:[t("span",{className:"normal-text",children:"\u5BC6\u7801\uFF1A"}),t("span",{className:"text-btn",onClick:u,children:"\u4FEE\u6539\u5BC6\u7801"})]})]}),r("div",{className:"section-container account-section-container",children:[t("p",{className:"title-text",children:"\u5173\u8054\u8D26\u53F7"}),r("label",{className:"form-label input-form-label",children:[t("span",{className:"normal-text",children:"GitHub\uFF1A"}),n.githubName?r(O,{children:[t("a",{className:"value-text",href:"https://github.com/"+n.githubName,children:n.githubName}),t("span",{className:`btn-text unbind-btn ${h?"final-confirm":""}`,onMouseLeave:()=>g(!1),onClick:N,children:h?"\u786E\u5B9A\u53D6\u6D88\u7ED1\u5B9A\uFF01":"\u53D6\u6D88\u7ED1\u5B9A"})]}):r(O,{children:[t("span",{className:"value-text",children:"\u65E0"}),t("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"\u524D\u5F80\u7ED1\u5B9A"})]})]})]})]})]})},nt=({destroy:a})=>{const[e,n]=m.exports.useState(""),[s,o]=m.exports.useState(""),[i,c]=m.exports.useState("");m.exports.useEffect(()=>{},[]);const h=()=>{a()},g=u=>{const N=u.target.value;n(N)},f=u=>{const N=u.target.value;o(N)},C=u=>{const N=u.target.value;c(N)},p=async()=>{if(e===""||s===""||i===""){T.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(s!==i){T.error("\u65B0\u5BC6\u7801\u4E24\u6B21\u8F93\u5165\u4E0D\u4E00\u81F4"),c("");return}try{if(!await I.checkPasswordValid(e)){T.error("\u65E7\u5BC6\u7801\u4E0D\u5339\u914D"),n("");return}await I.updatePassword(s),T.info("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF01"),h()}catch(u){T.error(u)}};return r(O,{children:[r("div",{className:"dialog-header-container",children:[t("p",{className:"title-text",children:"\u4FEE\u6539\u5BC6\u7801"}),t("button",{className:"text-btn close-btn",onClick:h,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[t("p",{className:"tip-text",children:"\u5982\u679C\u662F GitHub \u767B\u5F55\uFF0C\u5219\u521D\u59CB\u5BC6\u7801\u4E3A\u7528\u6237\u540D"}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:e,onChange:g}),t("span",{className:"normal-text "+(e===""?"":"not-null"),children:"\u65E7\u5BC6\u7801"})]}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:s,onChange:f}),t("span",{className:"normal-text "+(s===""?"":"not-null"),children:"\u65B0\u5BC6\u7801"})]}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:i,onChange:C}),t("span",{className:"normal-text "+(i===""?"":"not-null"),children:"\u518D\u6B21\u8F93\u5165\u65B0\u5BC6\u7801"})]}),r("div",{className:"btns-container",children:[t("span",{className:"text-btn cancel-btn",onClick:h,children:"\u53D6\u6D88"}),t("span",{className:"text-btn confirm-btn",onClick:p,children:"\u4FDD\u5B58"})]})]})]})};function st(){V({className:"change-password-dialog"},nt)}function ot(){V({className:"my-account-dialog",useAppContext:!0},at)}const rt=({destroy:a})=>r(O,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E ",t("b",{children:"Memos"})]}),t("button",{className:"text-btn close-btn",onClick:()=>{a()},children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[t("p",{children:"\u4E00\u4E2A\u788E\u7247\u5316\u77E5\u8BC6\u8BB0\u5F55\u5DE5\u5177\u3002"}),t("br",{}),t("i",{children:"\u4E3A\u4F55\u505A\u8FD9\u4E2A\uFF1F"}),r("ul",{children:[t("li",{children:"\u7528\u4E8E\u8BB0\u5F55\uFF1A\u{1F4C5}\u6BCF\u65E5/\u5468\u8BA1\u5212\u3001\u{1F4A1}\u7A81\u53D1\u5947\u60F3\u3001\u{1F4D5}\u8BFB\u540E\u611F..."}),t("li",{children:"\u4EE3\u66FF\u4E86\u6211\u5728\u5FAE\u4FE1\u4E0A\u7ECF\u5E38\u4F7F\u7528\u7684\u201C\u6587\u4EF6\u4F20\u8F93\u52A9\u624B\u201D\uFF1B"}),t("li",{children:"\u6253\u9020\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684\u8F7B\u91CF\u5316\u201C\u5361\u7247\u201D\u7B14\u8BB0\u7C3F\uFF1B"})]}),t("br",{}),t("i",{children:"\u6709\u4F55\u7279\u70B9\u5462\uFF1F"}),r("ul",{children:[r("li",{children:["\u2728"," ",t("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer",children:"\u5F00\u6E90\u9879\u76EE"})]}),t("li",{children:"\u{1F60B} \u7CBE\u7F8E\u4E14\u7EC6\u8282\u7684\u89C6\u89C9\u6837\u5F0F\uFF1B"}),t("li",{children:"\u{1F4D1} \u4F53\u9A8C\u4F18\u826F\u7684\u4EA4\u4E92\u903B\u8F91\uFF1B"})]}),t("br",{}),t("p",{children:"Enjoy it and have fun~ "}),t("hr",{}),r("p",{className:"normal-text",children:["Last updated on ",t("span",{className:"pre-text",children:"2021/10/15 16:18:56"})," \u{1F389}"]})]})]});function Ce(){V({className:"about-site-dialog"},rt)}const ct=({destroy:a})=>{const{globalState:{shouldHideImageUrl:e,shouldSplitMemoWord:n,shouldUseMarkdownParser:s,showDarkMode:o}}=m.exports.useContext($);return m.exports.useEffect(()=>{},[]),r(O,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u2699\uFE0F"}),"\u504F\u597D\u8BBE\u7F6E"]}),t("button",{className:"text-btn close-btn",onClick:()=>{a()},children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("div",{className:"section-container preferences-section-container",children:[t("p",{className:"title-text",children:"\u5E38\u89C4"}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"\u6DF1\u8272\u6A21\u5F0F"}),t("img",{className:"icon-img",src:o?"/icons/check-active.svg":"/icons/check.svg"}),t("input",{className:"hidden",type:"checkbox",checked:o,onChange:p=>{const u=p.target.checked;U.setAppSetting({showDarkMode:u})}})]})]}),r("div",{className:"section-container preferences-section-container",children:[t("p",{className:"title-text",children:"Memo \u663E\u793A\u76F8\u5173"}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"\u4E2D\u82F1\u6587\u5185\u5BB9\u81EA\u52A8\u95F4\u9694"}),t("img",{className:"icon-img",src:n?"/icons/check-active.svg":"/icons/check.svg"}),t("input",{className:"hidden",type:"checkbox",checked:n,onChange:p=>{const u=p.target.checked;U.setAppSetting({shouldSplitMemoWord:u})}})]}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"\u9690\u85CF\u56FE\u7247\u94FE\u63A5\u5730\u5740"}),t("img",{className:"icon-img",src:e?"/icons/check-active.svg":"/icons/check.svg"}),t("input",{className:"hidden",type:"checkbox",checked:e,onChange:p=>{const u=p.target.checked;U.setAppSetting({shouldHideImageUrl:u})}})]}),r("label",{className:"form-label checkbox-form-label",children:[t("span",{className:"normal-text",children:"markdown \u683C\u5F0F\u89E3\u6790"}),t("img",{className:"icon-img",src:s?"/icons/check-active.svg":"/icons/check.svg"}),t("input",{className:"hidden",type:"checkbox",checked:s,onChange:p=>{const u=p.target.checked;U.setAppSetting({shouldUseMarkdownParser:u})}}),t("span",{className:"tip-text",children:"\u652F\u6301\u5217\u8868\u3001\u52A0\u7C97/\u659C\u4F53\u3001\u4EE3\u7801\u5757"})]})]}),r("div",{className:"section-container hidden",children:[t("p",{className:"title-text",children:"\u5176\u4ED6"}),t("div",{className:"btn-container",children:t("button",{className:"btn export-btn",onClick:async()=>{await D.fetchAllMemos();const p=D.getState().memos.map(S=>F(w({},S),{tags:S.tags.map(d=>d.text)})),u=JSON.stringify(p),N=document.createElement("a");N.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(u)),N.setAttribute("download","data.json"),N.style.display="none",document.body.appendChild(N),N.click(),document.body.removeChild(N)},children:"\u5BFC\u51FA\u6570\u636E(JSON)"})})]})]})]})};function it(){V({className:"preferences-dialog",useAppContext:!0},ct)}const lt=()=>r("div",{className:"menu-btns-popup",onClick:c=>{c.stopPropagation()},children:[r("button",{className:"text-btn action-btn",onClick:()=>{ot()},children:[t("span",{className:"icon",children:"\u{1F920}"})," \u6211\u7684\u8D26\u53F7"]}),r("button",{className:"text-btn action-btn",onClick:()=>{it()},children:[t("span",{className:"icon",children:"\u2699\uFE0F"})," \u504F\u597D\u8BBE\u7F6E"]}),r("button",{className:"text-btn action-btn",onClick:()=>{B.pushHistory("/trash")},children:[t("span",{className:"icon",children:"\u{1F5D1}\uFE0F"})," \u56DE\u6536\u7AD9"]}),r("button",{className:"text-btn action-btn",onClick:()=>{Ce()},children:[t("span",{className:"icon",children:"\u{1F600}"})," \u5173\u4E8E"]}),r("button",{className:"text-btn action-btn",onClick:async()=>{await I.doSignOut(),B.replaceHistory("/signin")},children:[t("span",{className:"icon",children:"\u{1F44B}"})," \u9000\u51FA"]})]});function Z(a=!1){const[e,n]=m.exports.useState(a),s=m.exports.useCallback(o=>{n(o!==void 0?o:i=>!i)},[]);return[e,s]}function ee(){const[a,e]=m.exports.useState({isLoading:!0,isFailed:!1,isSucceed:!1});return F(w({},a),{setLoading:()=>{e(F(w({},a),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{e(F(w({},a),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{e(F(w({},a),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const ut=({destroy:a,imgUrl:e})=>{const n=m.exports.useRef(null),[s,o]=m.exports.useState(-1);m.exports.useEffect(()=>{b.getImageSize(e).then(({width:g})=>{o(g!==0?80:0)})},[]);const i=()=>{a()},c=()=>{s>30&&o(s-10)},h=()=>{o(s+10)};return r(O,{children:[t("button",{className:"text-btn close-btn",onClick:i,children:t("img",{className:"icon-img",src:"/icons/close.svg"})}),r("div",{className:"img-container",children:[t("img",{className:s<=0?"hidden":"",ref:n,width:s+"%",src:e}),t("span",{className:"loading-text "+(s===-1?"":"hidden"),children:"\u56FE\u7247\u52A0\u8F7D\u4E2D..."}),t("span",{className:"loading-text "+(s===0?"":"hidden"),children:"\u{1F61F} \u56FE\u7247\u52A0\u8F7D\u5931\u8D25\uFF0C\u53EF\u80FD\u662F\u65E0\u6548\u7684\u94FE\u63A5"})]}),r("div",{className:"action-btns-container",children:[t("button",{className:"text-btn",onClick:c,children:"\u2796"}),t("button",{className:"text-btn",onClick:h,children:"\u2795"}),t("button",{className:"text-btn",onClick:()=>o(80),children:"\u2B55"})]})]})};function xe(a){V({className:"preview-image-dialog"},ut,{imgUrl:a})}const dt=/```([\s\S]*?)```/g,mt=/\*\*(.+?)\*\*/g,ht=/\*(.+?)\*/g,pt=/\[ \] /g,gt=/\[x\] /g,ft=/[*] /g,yt=/(\d+)\. /g,Nt=a=>a.replace(dt,"<pre lang=''>$1</pre>").replace(mt,"<strong>$1</strong>").replace(ht,"<em>$1</em>").replace(ft,"<span class='counter-block'>-</span>").replace(yt,"<span class='counter-block'>$1.</span>").replace(pt,"<span class='todo-block' data-type='todo'>\u2B1C</span>").replace(gt,"<span class='todo-block' data-type='done'>\u2714\uFE0F</span>"),de=a=>{const e=document.createElement("div");e.className="memo-content-text",e.innerHTML=a,document.body.appendChild(e);const n=e.innerText;return e.remove(),n},Ct=a=>a.replace(/\n/g,"<br>"),xt=a=>{const{children:e,when:n}=a;return n?t(O,{children:e}):null},Q=xt;const me=a=>{const{className:e,imgUrl:n}=a,s=()=>{xe(n)};return t("div",{className:"image-container "+e,onClick:s,children:t("img",{src:n,decoding:"async",loading:"lazy"})})};const St=a=>{var C,p;const[e,n]=m.exports.useState(F(w({},a.memo),{formattedContent:j(a.memo.content),createdAtStr:b.getDateTimeString(a.memo.createdAt)})),[s,o]=m.exports.useState([]),[i,c]=m.exports.useState([]),h=Array.from((C=e==null?void 0:e.content.match(q))!=null?C:[]);m.exports.useEffect(()=>{(async()=>{try{const N=[],S=[...e.content.matchAll(le)];for(const l of S)if(l&&l.length===3){const y=l[2];await D.getMemoById(y)&&N.push(y)}o([...N]);const d=await D.getLinkedMemos(e.id);c(d.map(l=>F(w({},l),{formattedContent:j(l.content),createdAtStr:b.getDateTimeString(l.createdAt),dateStr:b.getDateString(l.createdAt)})))}catch(N){}})()},[e]);const g=m.exports.useCallback(async u=>{var S;const N=u.target;if(N.className==="memo-link-text"){const d=(S=N.dataset)==null?void 0:S.value,l=await D.getMemoById(d!=null?d:"");if(l){const y=F(w({},l),{formattedContent:j(l.content),createdAtStr:b.getDateTimeString(l.createdAt)});n(y)}else T.error("Not Found"),N.classList.remove("memo-link-text")}},[]),f=m.exports.useCallback(u=>{n(u)},[]);return r(O,{children:[r("div",{className:"memo-card-container",children:[r("div",{className:"header-container",children:[t("p",{className:"time-text",children:e==null?void 0:e.createdAtStr}),t("div",{className:"btns-container",children:t("button",{className:"text-btn close-btn",onClick:a.destroy,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})})]}),r("div",{className:"memo-container",children:[t("div",{className:"memo-content-text",onClick:g,dangerouslySetInnerHTML:{__html:(p=e==null?void 0:e.formattedContent)!=null?p:""}}),t(Q,{when:h.length>0,children:t("div",{className:"images-wrapper",children:h.map((u,N)=>t(me,{className:"memo-img",imgUrl:u},N))})})]}),r("p",{className:"normal-text "+(s.length===0?"hidden":""),children:["\u5173\u8054\u4E86 ",s.length," \u4E2A MEMO"]}),t("div",{className:"layer-container"}),s.map((u,N)=>N<4?t("div",{className:"background-layer-container",style:{bottom:(N+1)*-3+"px",left:(N+1)*5+"px",width:`calc(100% - ${(N+1)*10}px)`,zIndex:-N-1}},N):null)]}),i.length>0?r("div",{className:"linked-memos-wrapper",children:[r("p",{className:"normal-text",children:[i.length," \u6761\u94FE\u63A5\u81F3\u6B64\u7684 MEMO"]}),i.map(u=>{const N=de(u.formattedContent).replaceAll(`
`," ");return r("div",{className:"linked-memo-container",onClick:()=>f(u),children:[r("span",{className:"time-text",children:[u.dateStr,": "]}),N]},u.id)})]}):null]})};function Se(a){V({className:"memo-card-dialog"},St,{memo:a})}const Et=a=>{var N;const{memo:e,destroy:n}=a,[s,o]=m.exports.useState(""),i=m.exports.useRef(null),{user:c}=I.getState(),h=F(w({},e),{formattedContent:j(e.content),createdAtStr:b.getDateTimeString(e.createdAt)}),g=Array.from((N=h.content.match(q))!=null?N:[]),[f,C]=m.exports.useState(g.length);m.exports.useEffect(()=>{setTimeout(()=>{if(f===0){const S=b.getOSVersion();(S==="MacOS"||S==="Unknown")&&window.scrollTo(0,0),html2canvas(i.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:U.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(d=>{o(d.toDataURL())})}},ye+100)},[f]);const p=()=>{n()},u=S=>{S.type==="error"&&(T.error("\u6709\u4E2A\u56FE\u7247\u52A0\u8F7D\u5931\u8D25\u4E86\u{1F61F}"),S.target.remove()),C(f-1)};return r(O,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F970}"}),"\u5206\u4EAB Memo \u56FE\u7247"]}),t("button",{className:"text-btn close-btn",onClick:p,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[t("div",{className:`tip-words-container ${s?"finished":"genarating"}`,children:t("p",{className:"tip-text",children:s?"\u53F3\u952E\u6216\u957F\u6309\u5373\u53EF\u4FDD\u5B58\u56FE\u7247 \u{1F447}":"\u56FE\u7247\u751F\u6210\u4E2D..."})}),t("img",{className:"memo-img",src:s}),r("div",{className:"memo-container",ref:i,children:[t("span",{className:"time-text",children:h.createdAtStr}),t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:h.formattedContent}}),t(Q,{when:g.length>0,children:t("div",{className:"images-container",children:g.map((S,d)=>t("img",{crossOrigin:"anonymous",src:S,onLoad:u,onError:u,decoding:"async"},d))})}),t("div",{className:"watermark-container",children:r("span",{className:"normal-text",children:["by ",t("span",{className:"name-text",children:c==null?void 0:c.username})]})})]})]})]})};function bt(a){V({className:"share-memo-image-dialog"},Et,{memo:a})}const Mt=a=>{var N;const{memo:e}=a,n=F(w({},e),{formattedContent:j(e.content),createdAtStr:b.getDateTimeString(e.createdAt)}),[s,o]=Z(!1),i=Array.from((N=n.content.match(q))!=null?N:[]),c=()=>{Se(n)},h=()=>{U.setMarkMemoId(n.id)},g=()=>{U.setEditMemoId(n.id)},f=async()=>{if(s){try{await D.hideMemoById(n.id),await D.fetchMoreMemos()}catch(S){T.error(S.message)}U.getState().editMemoId===n.id&&U.setEditMemoId("")}else o()},C=()=>{s&&o(!1)},p=()=>{bt(n)},u=async S=>{var l;const d=S.target;if(d.className==="memo-link-text"){const y=(l=d.dataset)==null?void 0:l.value,x=await D.getMemoById(y!=null?y:"");x?Se(x):(T.error("Not Found"),d.classList.remove("memo-link-text"))}else d.className==="todo-block"};return r("div",{className:`memo-wrapper ${"memos-"+n.id}`,onMouseLeave:C,children:[r("div",{className:"memo-top-wrapper",children:[t("span",{className:"time-text",onClick:c,children:n.createdAtStr}),r("div",{className:"btns-container",children:[t("span",{className:"text-btn more-action-btn",children:t("img",{className:"icon-img",src:"/icons/more.svg"})}),t("div",{className:"more-action-btns-wrapper",children:r("div",{className:"more-action-btns-container",children:[t("span",{className:"text-btn",onClick:c,children:"\u67E5\u770B\u8BE6\u60C5"}),t("span",{className:"text-btn",onClick:h,children:"Mark"}),t("span",{className:"text-btn",onClick:p,children:"\u5206\u4EAB"}),t("span",{className:"text-btn",onClick:g,children:"\u7F16\u8F91"}),t("span",{className:`text-btn delete-btn ${s?"final-confirm":""}`,onClick:f,children:s?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5220\u9664"})]})})]})]}),t("div",{className:"memo-content-text",onClick:u,dangerouslySetInnerHTML:{__html:n.formattedContent}}),t(Q,{when:i.length>0,children:t("div",{className:"images-wrapper",children:i.map((S,d)=>t(me,{className:"memo-img",imgUrl:S},d))})})]})};function j(a){var i;const e=document.createElement("div");e.innerHTML=Ct(a).split("<br>").map(c=>c!==""?`<p>${c}</p>`:"<br>").join(""),a=e.innerHTML;const{shouldUseMarkdownParser:n,shouldSplitMemoWord:s,shouldHideImageUrl:o}=U.getState();n&&(a=Nt(a)),o&&(a=a.replace(q,"")),e.innerHTML=a;for(const c of e.querySelectorAll("p"))c.textContent===""&&((i=c.firstElementChild)==null?void 0:i.tagName)!=="BR"&&c.remove();return a=e.innerHTML,a=a.replace(J,"<span class='tag-span'>#$1</span>").replace(Ne,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(le,"<span class='memo-link-text' data-value='$2'>$1</span>"),s&&(a=a.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5]?)/g,"$1 $2 $3")),a}var wt=m.exports.memo(Mt);const Dt=a=>{var o;const{memo:e}=a,n=F(w({},e),{formattedContent:j(e.content),createdAtStr:b.getDateTimeString(e.createdAt),timeStr:b.getTimeString(e.createdAt)}),s=Array.from((o=n.content.match(q))!=null?o:[]);return r("div",{className:"daily-memo-wrapper",children:[t("div",{className:"time-wrapper",children:t("span",{className:"normal-text",children:n.timeStr})}),r("div",{className:"memo-content-container",children:[t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:n.formattedContent}}),t(Q,{when:s.length>0,children:t("div",{className:"images-container",children:s.map((i,c)=>t("img",{crossOrigin:"anonymous",src:i,decoding:"async"},c))})})]})]})};const vt=a=>{const{className:e,datestamp:n,handleDateStampChange:s}=a,[o,i]=m.exports.useState(he(n));m.exports.useEffect(()=>{i(he(n))},[n]);const c=new Date(o),h=c.getDay()===0?7:c.getDay(),g=[];for(let u=1;u<h;u++)g.push({date:0,datestamp:c.getTime()-G*(7-u)});const f=Tt(o);for(let u=1;u<=f;u++)g.push({date:u,datestamp:c.getTime()+G*(u-1)});const C=u=>{s(u)},p=u=>{const N=c.getFullYear(),S=c.getMonth()+1;let d=0;S===1&&u===-1?d=new Date(`${N-1}/12/1`).getTime():S===12&&u===1?d=new Date(`${N+1}/1/1`).getTime():d=new Date(`${N}/${S+u}/1`).getTime(),i(he(d))};return r("div",{className:`date-picker-wrapper ${e}`,children:[r("div",{className:"date-picker-header",children:[t("span",{className:"btn-text",onClick:()=>p(-1),children:t("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),r("span",{className:"normal-text",children:[c.getFullYear()," \u5E74 ",c.getMonth()+1," \u6708"]}),t("span",{className:"btn-text",onClick:()=>p(1),children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),r("div",{className:"date-picker-day-container",children:[r("div",{className:"date-picker-day-header",children:[t("span",{className:"day-item",children:"\u5468\u4E00"}),t("span",{className:"day-item",children:"\u5468\u4E8C"}),t("span",{className:"day-item",children:"\u5468\u4E09"}),t("span",{className:"day-item",children:"\u5468\u56DB"}),t("span",{className:"day-item",children:"\u5468\u4E94"}),t("span",{className:"day-item",children:"\u5468\u516D"}),t("span",{className:"day-item",children:"\u5468\u65E5"})]}),g.map(u=>u.date===0?t("span",{className:"day-item null",children:""},u.datestamp):t("span",{className:`day-item ${u.datestamp===n?"current":""}`,onClick:()=>C(u.datestamp),children:u.date},u.datestamp))]})]})};function Tt(a){const e=new Date(a),n=new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`);return((n.getMonth()===11?new Date(`${n.getFullYear()+1}/1`):new Date(`${n.getFullYear()}/${n.getMonth()+2}/1`)).getTime()-n.getTime())/G}function he(a){const e=new Date(a);return new Date(`${e.getFullYear()}/${e.getMonth()+1}/1`).getTime()}const kt=["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],Ft=["\u5468\u65E5","\u5468\u4E00","\u5468\u4E8C","\u5468\u4E09","\u5468\u56DB","\u5468\u4E94","\u5468\u516D"],At=a=>{const e=ee(),[n,s]=m.exports.useState([]),[o,i]=m.exports.useState(b.getDateStampByDate(b.getDateString(a.currentDateStamp))),[c,h]=Z(!1),g=m.exports.useRef(null),f=new Date(o);m.exports.useEffect(()=>{const u=()=>{const d=D.getState().memos.filter(l=>b.getTimeStampByDate(l.createdAt)>=o&&b.getTimeStampByDate(l.createdAt)<o+G).sort((l,y)=>b.getTimeStampByDate(l.createdAt)-b.getTimeStampByDate(y.createdAt));s(d),e.setFinish()},{memos:N}=D.getState(),S=N.slice(-1).pop();S&&b.getTimeStampByDate(S.createdAt)>=o?(e.setLoading(),D.fetchAllMemos().then(()=>{u()}).catch(d=>{T.error(d.message)})):u()},[o]);const C=()=>{h(!1),setTimeout(()=>{const u=b.getOSVersion();(u==="MacOS"||u==="Unknown")&&window.scrollTo(0,0),html2canvas(g.current,{scale:window.devicePixelRatio*2,allowTaint:!0,useCORS:!0,backgroundColor:U.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then(N=>{xe(N.toDataURL())})},0)},p=u=>{i(u),h(!1)};return r(O,{children:[t("div",{className:"dialog-header-container",children:r("div",{className:"btns-wrapper",children:[r("div",{className:"btns-container",children:[t("span",{className:"btn-text",onClick:()=>i(o-G),children:t("img",{className:"icon-img",src:"/icons/arrow-left.svg"})}),t("span",{className:"btn-text",onClick:()=>i(o+G),children:t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})})]}),r("div",{className:"btns-container",children:[t("span",{className:"btn-text",onClick:C,children:t("img",{className:"icon-img",src:"/icons/share.svg"})}),t("span",{className:"btn-text",onClick:()=>a.destroy(),children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]})]})}),r("div",{className:"dialog-content-container",ref:g,children:[r("div",{className:"date-card-container",onClick:()=>h(),children:[t("div",{className:"year-text",children:f.getFullYear()}),r("div",{className:"date-container",children:[t("div",{className:"month-text",children:kt[f.getMonth()]}),t("div",{className:"date-text",children:f.getDate()}),t("div",{className:"day-text",children:Ft[f.getDay()]})]})]}),t(vt,{className:`date-picker ${c?"":"hide"}`,datestamp:o,handleDateStampChange:p}),e.isLoading?t("div",{className:"tip-container",children:t("p",{className:"tip-text",children:"\u52AA\u529B\u52A0\u8F7D\u4E2D..."})}):n.length===0?t("div",{className:"tip-container",children:t("p",{className:"tip-text",children:"\u7A7A\u7A7A\u5982\u4E5F"})}):t("div",{className:"dailymemos-wrapper",children:n.map(u=>t(Dt,{memo:u},`${u.id}-${u.updatedAt}`))})]})]})};function Bt(a=Date.now()){V({className:"daily-memo-diary-dialog"},At,{currentDateStamp:a})}const It=()=>{const{userState:{user:a},memoState:{memos:e}}=m.exports.useContext($),[n,s]=m.exports.useState({memosAmount:0,tagsAmount:0}),o=a?a.username:"Memos",i=a?Math.ceil((Date.now()-b.getTimeStampByDate(a.createdAt))/1e3/3600/24):0;m.exports.useEffect(()=>{!I.getState().user||D.getMyDataAmount().then(g=>{s(g)}).catch(g=>{T.error(g.message)})},[e]);const c=m.exports.useCallback(()=>{B.pushHistory("/"),B.clearQuery()},[]);return r("div",{className:"user-banner-container",children:[r("div",{className:"userinfo-header-container",children:[t("p",{className:"username-text",onClick:c,children:o}),t("span",{className:"action-btn menu-popup-btn",onMouseEnter:()=>{const g=document.querySelector(".sidebar-wrapper"),f=document.querySelector(".menu-btns-popup");f.style.top=54-g.scrollTop+"px"},children:t("img",{src:"/icons/more.svg",className:"icon-img"})}),t(lt,{})]}),r("div",{className:"status-text-container",children:[r("div",{className:"status-text memos-text",children:[t("span",{className:"amount-text",children:n.memosAmount}),t("span",{className:"type-text",children:"MEMO"})]}),r("div",{className:"status-text tags-text",children:[t("span",{className:"amount-text",children:n.tagsAmount}),t("span",{className:"type-text",children:"TAG"})]}),r("div",{className:"status-text duration-text",onClick:()=>Bt(),children:[t("span",{className:"amount-text",children:i}),t("span",{className:"type-text",children:"DAY"})]})]})]})};const Lt=()=>{const{locationState:{query:a},memoState:{memos:e}}=m.exports.useContext($),[n,s]=m.exports.useState([]),[o,i]=m.exports.useState(a.tag),c=ee();return m.exports.useEffect(()=>{!I.getState().user||D.getMyTags().then(h=>{const g=h.sort((C,p)=>b.getTimeStampByDate(p.createdAt)-b.getTimeStampByDate(C.createdAt)).sort((C,p)=>p.level-C.level),f={subTags:[]};for(const C of g){const p=C.text.split("/");let u=f,N="";for(let S=0;S<p.length;S++){const d=p[S];S===0?N+=d:N+="/"+d;let l=null;for(const y of u.subTags)if(y.text===N){l=y;break}l?l.level+=C.level:(l={id:"",key:d,text:N,level:C.level,subTags:[],deep:S},u.subTags.push(l)),u.subTags.sort((y,x)=>x.level-y.level),N===C.text&&(l.id=C.id),u=l}}f.subTags.sort((C,p)=>p.level-C.level),s(f.subTags),c.setFinish()}).catch(h=>{c.setError(),T.error(h)})},[e]),m.exports.useEffect(()=>{i(a.tag)},[a]),r("div",{className:"tags-wrapper",children:[t("p",{className:"title-text",children:"\u5E38\u7528\u6807\u7B7E"}),t("div",{className:"tags-container",children:c.isLoading?t(O,{}):r(O,{children:[n.map((h,g)=>t(Ee,{tag:h,tagQuery:o},h.id+"-"+g)),t(Q,{when:n.length<5,children:r("p",{className:"tag-tip-container",children:["\u8F93\u5165",t("span",{className:"code-text",children:"# Tag "}),"\u6765\u521B\u5EFA\u6807\u7B7E\u5427~"]})})]})})]})},Ee=a=>{const{tag:e,tagQuery:n}=a,s=n===e.text,o=e.subTags.length>0,[i,c]=Z(n.includes(e.text)&&!s),h=e.id!=="";m.exports.useEffect(()=>{c(n.indexOf(e.text)===0&&!s)},[n,e]);const g=()=>{const p=s?"":e.text;p&&(b.copyTextToClipboard(`# ${p} `),D.polishTag(e.id).catch(()=>{})),B.pushHistory("/"),B.setTagQuery(p)},f=p=>{h&&(p.stopPropagation(),Ot(e))},C=p=>{p.stopPropagation(),c()};return r(O,{children:[r("div",{className:`tag-item-container ${s?"active":""}`,onClick:g,children:[r("div",{className:"tag-text-container",children:[r("div",{className:`icon-container ${h?"rename-able":""}`,onClick:f,children:[t("span",{className:"icon-text",children:"#"}),h?t("span",{className:"rename-btn",children:s?t("img",{className:"icon-img",src:"/icons/edit-white.svg"}):t("img",{className:"icon-img",src:"/icons/edit.svg"})}):null]}),t("span",{className:"tag-text",children:e.key})]}),t("div",{className:"btns-container",children:o?t("span",{className:`action-btn toggle-btn ${i?"shown":""}`,onClick:C,children:s?t("img",{className:"icon-img",src:"/icons/arrow-right-white.svg"}):t("img",{className:"icon-img",src:"/icons/arrow-right.svg"})}):null})]}),o?t("div",{className:`subtags-container ${i?"":"hidden"}`,children:e.subTags.map((p,u)=>t(Ee,{tag:p,tagQuery:n},p.id+"-"+u))}):null]})},_t=a=>{const{destroy:e,tag:n}=a,s=m.exports.useRef(null),o=()=>{e()},i=()=>{var h;const c=(h=s.current)==null?void 0:h.value;if(!c||c===n.text){e();return}D.updateTagText(n.id,c).then(()=>{D.clearMemos(),D.fetchAllMemos(),e()}).catch(()=>{})};return r(O,{children:[r("div",{className:"dialog-header-container",children:[r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"}),"\u6807\u7B7E\u91CD\u547D\u540D"]}),t("button",{className:"text-btn close-btn",onClick:o,children:t("img",{className:"icon-img",src:"/icons/close.svg"})})]}),r("div",{className:"dialog-content-container",children:[r("p",{className:"tag-text",children:["\u65E7\uFF1A",n.text]}),t("input",{className:"text-input",type:"text",placeholder:"\u8F93\u5165\u65B0\u6807\u7B7E",ref:s}),r("div",{className:"btns-container",children:[t("span",{className:"btn-text cancel-btn",onClick:o,children:"\u53D6\u6D88"}),t("span",{className:"btn-text confirm-btn",onClick:i,children:"\u786E\u5B9A"})]})]})]})};function Ot(a){V({className:"rename-tag-dialog"},_t,{tag:a})}const be={width:12,height:7},Ut=(a,e)=>{const n=[];for(let s=1;s<=a;s++)n.push({timestamp:e+G*s,count:0});return n},Pt=()=>{const a=b.getDateStampByDate(Date.now()),e=new Date(a).getDay()||7,n=new Array(7-e).fill(0),{memoState:{memos:s}}=m.exports.useContext($),[o,i]=m.exports.useState([]),[c,h]=m.exports.useState(null),[g,f]=m.exports.useState(null),C=m.exports.useRef(null),p=m.exports.useRef(null);m.exports.useEffect(()=>{if(!I.getState().user)return;const d=b.getDateStampByDate(Date.now()),l=new Date(d).getDay()||7,y=(be.width-1)*be.height+l,x=d-y*G,E=Ut(y,x);D.getMemosStat().then(k=>{for(const P of k){const R=(b.getDateStampByDate(P.timestamp)-x)/(1e3*3600*24)-1;R>=0&&(E[R].count+=1)}i([...E])}).catch(k=>{T.error(k.message)})},[s.length]);const u=m.exports.useCallback((d,l)=>{var P,R;h(l);const{isMobileView:y}=U.getState(),x=d.target,E=document.querySelector(".sidebar-wrapper");p.current.style.left=x.offsetLeft-((R=(P=C.current)==null?void 0:P.offsetLeft)!=null?R:0)+"px";let k=x.offsetTop;y||(k-=E.scrollTop),p.current.style.top=k+"px"},[]),N=m.exports.useCallback(()=>{h(null)},[]),S=m.exports.useCallback(d=>{B.getState().query.from===d.timestamp?(B.setFromAndToQuery(0,0),f(null)):d.count>0&&(B.setFromAndToQuery(d.timestamp,d.timestamp+G),f(d))},[]);return r("div",{className:"usage-heat-map-wrapper",ref:C,children:[r("div",{className:"day-tip-text-container",children:[t("span",{className:"tip-text",children:"Mon"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Wed"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Fri"}),t("span",{className:"tip-text"}),t("span",{className:"tip-text",children:"Sun"})]}),r("div",{ref:p,className:"usage-detail-container pop-up "+(c?"":"hidden"),children:[c==null?void 0:c.count," memos on ",t("span",{className:"date-text",children:new Date(c==null?void 0:c.timestamp).toDateString()})]}),r("div",{className:"usage-heat-map",children:[o.map((d,l)=>{const y=d.count,x=y<=0?"":y<=1?"stat-day-L1-bg":y<=2?"stat-day-L2-bg":y<=4?"stat-day-L3-bg":"stat-day-L4-bg";return t("span",{className:"stat-container "+x+(g===d?" current":" "),onMouseEnter:E=>u(E,d),onMouseLeave:N,onClick:()=>S(d)},l)}),n.map((d,l)=>t("span",{className:"stat-container null"},l))]})]})};const Rt=()=>{const{locationState:a}=m.exports.useContext($);m.exports.useEffect(()=>{const n=document.querySelector(z);n==null||n.classList.remove(X)},[a]);const e=m.exports.useCallback(n=>{if(n.stopPropagation(),n.target.className==="sidebar-wrapper"){const o=document.querySelector(z);o==null||o.classList.remove(X)}},[]);return r("aside",{className:"sidebar-wrapper",onClick:e,children:[t(It,{}),t(Pt,{}),t(Lt,{})]})};function $t(){const{locationState:{pathname:a}}=m.exports.useContext($),e=ee();return m.exports.useEffect(()=>{I.doSignIn().catch(()=>{}).finally(async()=>{I.getState().user?(await D.fetchMoreMemos().catch(()=>{}),e.setFinish()):B.replaceHistory("/signin")})},[]),m.exports.useEffect(()=>{a!=="/"&&B.clearQuery()},[a]),t(O,{children:e.isLoading?null:r("section",{id:"page-container",children:[t(Rt,{}),t("main",{className:"content-wrapper",children:oa(a)})]})})}const Ht=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function Me(a,e){return e.minLength!==void 0&&a.length<e.minLength?{result:!1,reason:"\u957F\u5EA6\u8FC7\u77ED"}:e.maxLength!==void 0&&a.length>e.maxLength?{result:!1,reason:"\u957F\u5EA6\u8D85\u51FA"}:e.noSpace&&a.includes(" ")?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u7A7A\u683C"}:e.noChinese&&Ht.test(a)?{result:!1,reason:"\u4E0D\u5E94\u542B\u6709\u4E2D\u6587\u5B57\u7B26"}:{result:!0}}const we={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},Gt=()=>{const[a,e]=m.exports.useState(""),[n,s]=m.exports.useState(""),o=m.exports.useRef(null);m.exports.useEffect(()=>{const f=C=>{var p;C.key==="Enter"&&((p=o.current)==null||p.click())};return document.body.addEventListener("keypress",f),()=>{document.body.removeEventListener("keypress",f)}},[]);const i=f=>{const C=f.target.value;e(C)},c=f=>{const C=f.target.value;s(C)},h=()=>{Ce()},g=async()=>{const f=Me(a,we);if(!f.result){T.error("\u7528\u6237\u540D "+f.reason);return}const C=Me(n,we);if(!C.result){T.error("\u5BC6\u7801 "+C.reason);return}try{const p=A.signin,{succeed:u,message:N}=await p(a,n);if(!u&&N){T.error("\u{1F61F} "+N);return}await I.doSignIn()?(D.clearMemos(),D.fetchMoreMemos().catch(()=>{}),B.replaceHistory("/")):T.error("\u{1F61F} \u4E0D\u77E5\u9053\u53D1\u751F\u4E86\u4EC0\u4E48\u9519\u8BEF")}catch(p){console.error(p),T.error("\u{1F61F} "+p.message)}};return t("div",{className:"page-wrapper signin",children:r("div",{className:"page-container",children:[t("div",{className:"page-header-container",children:r("p",{className:"title-text",children:[t("span",{className:"icon-text",children:"\u{1F44B}"})," \u8D26\u53F7\u6CE8\u518C / \u767B\u5F55"]})}),r("div",{className:"page-content-container",children:[r("label",{className:"form-label input-form-label",children:[t("input",{type:"text",value:a,onChange:i}),t("span",{className:"normal-text "+(a===""?"":"not-null"),children:"\u8D26\u53F7"})]}),r("label",{className:"form-label input-form-label",children:[t("input",{type:"password",value:n,onChange:c}),t("span",{className:"normal-text "+(n===""?"":"not-null"),children:"\u5BC6\u7801"})]})]}),r("div",{className:"page-footer-container",children:[t("div",{className:"btns-container",children:t("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist",children:"Sign In with GitHub"})}),r("div",{className:"btns-container",children:[t("button",{className:"text-btn signup-btn disabled",onClick:()=>T.info("\u6CE8\u518C\u5DF2\u5173\u95ED"),children:"\u6CE8\u518C"}),t("span",{className:"split-text",children:"/"}),t("button",{className:"text-btn signin-btn",ref:o,onClick:g,children:"\u767B\u5F55"})]})]}),r("p",{className:"tip-text",children:["\u4EC5\u7528\u4E8E\u4F5C\u54C1\u5C55\u793A\uFF0C\u53EF\u8F93\u5165 ",t("code",{children:"guest, 123456"})," \u8FDB\u884C\u4F53\u9A8C\u3002",t("br",{}),r("span",{className:"text-btn",onClick:h,children:[t("span",{className:"icon-text",children:"\u{1F600}"}),"\u5173\u4E8E\u672C\u7AD9"]})]})]})})},Vt={"/signin":t(Gt,{}),"*":t($t,{})};function Qt(){const[a,e]=m.exports.useState(!1);return m.exports.useCallback(()=>{e(s=>!s)},[])}const qt=m.exports.forwardRef((a,e)=>{var y,x;const{className:n,initialContent:s,placeholder:o,showConfirmBtn:i,showCancelBtn:c,showTools:h,onConfirmBtnClick:g,onCancelBtnClick:f,onContentChange:C}=a,p=m.exports.useRef(null),u=Qt();m.exports.useEffect(()=>{s&&(p.current.value=s,u())},[]),m.exports.useEffect(()=>{var E;p.current&&(p.current.style.height="auto",p.current.style.height=((E=p.current.scrollHeight)!=null?E:0)+"px")},[(y=p.current)==null?void 0:y.value]),m.exports.useImperativeHandle(e,()=>({focus:()=>{p.current.focus()},insertText:E=>{const k=p.current.value;p.current.value=k+E,C(p.current.value),u()},setContent:E=>{p.current.value=de(E),u()},getContent:()=>{var E,k;return(k=(E=p.current)==null?void 0:E.value)!=null?k:""}}),[]);const N=m.exports.useCallback(()=>{C(p.current.value),u()},[]),S=m.exports.useCallback(E=>{E.stopPropagation(),E.code==="Enter"&&(E.metaKey||E.ctrlKey)&&d(),u()},[]),d=m.exports.useCallback(()=>{g(p.current.value),p.current.value="",u()},[]),l=m.exports.useCallback(()=>{f()},[]);return r("div",{className:"common-editor-wrapper "+n,children:[t("textarea",{className:"common-editor-inputer",rows:1,placeholder:o,ref:p,onInput:N,onKeyDown:S}),r("div",{className:"common-tools-wrapper",children:[t(Q,{when:h,children:t("div",{className:"common-tools-container"})}),r("div",{className:"btns-right-container",children:[t(Q,{when:c,children:t("button",{className:"action-btn cancel-btn",onClick:l,children:"\u64A4\u9500\u4FEE\u6539"})}),t(Q,{when:i,children:r("button",{className:"action-btn confirm-btn",disabled:!((x=p.current)==null?void 0:x.value),onClick:d,children:["\u8BB0\u4E0B",t("span",{className:"icon-text",children:"\u270D\uFE0F"})]})})]})]})]})});const jt=()=>{const{globalState:a}=m.exports.useContext($),e=m.exports.useRef(null),n=m.exports.useRef(a);m.exports.useEffect(()=>{var g,f;if(a.markMemoId){const p=`${((g=e.current)==null?void 0:g.getContent())?`
`:""}Mark: [@MEMO](${a.markMemoId})`;(f=e.current)==null||f.insertText(p),U.setMarkMemoId("")}n.current.editMemoId!==a.editMemoId&&a.editMemoId&&D.getMemoById(a.editMemoId).then(C=>{var p,u,N;C&&((u=e.current)==null||u.setContent((p=C.content)!=null?p:""),(N=e.current)==null||N.focus())}),n.current=a},[a.markMemoId,a.editMemoId]);const s=m.exports.useCallback(async g=>{var N,S;if(g===""){T.error("\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u5440");return}const{editMemoId:f}=U.getState(),{query:C}=B.getState();g=de(g.replaceAll("&nbsp;"," "));const p=b.dedupe(Array.from((N=g.match(J))!=null?N:[])).map(d=>d.replace(J,"$1").trim()),u=[];try{for(const d of p){const l=await D.createTag(d);u.push(l)}if(f){const d=await D.getMemoById(f);if(d&&d.content!==g){const l=(S=d.tags)!=null?S:[],y=l.map(E=>E.text);u.push(...l);for(let E=0;E<u.length;){const k=u[E],P=k.text;p.includes(P)?(E++,y.includes(P)||await D.createMemoTag(d.id,k.id)):(u.splice(E,1),await D.removeMemoTag(d.id,k.id))}const x=await D.updateMemo(d.id,g);x.tags=u,x.updatedAt=b.getDateTimeString(Date.now()),D.editMemo(x)}U.setEditMemoId("")}else{const d=await D.createMemo(g);d.tags=u;for(const y of u)await D.createMemoTag(d.id,y.id);const l=C.tag;l!==""&&!p.includes(l)&&B.setTagQuery(""),D.pushMemo(d)}}catch(d){T.error(d.message)}pe("")},[]),o=m.exports.useCallback(()=>{var g;U.setEditMemoId(""),(g=e.current)==null||g.setContent(""),pe("")},[]),i=m.exports.useCallback(g=>{const f=document.createElement("div");f.innerHTML=g,f.innerText.trim()===""&&(g=""),pe(g)},[]),{editMemoId:c}=a,h=m.exports.useMemo(()=>({className:"memo-editor",initialContent:Wt(),placeholder:"\u73B0\u5728\u7684\u60F3\u6CD5\u662F...",showConfirmBtn:!0,showCancelBtn:c!=="",showTools:!0,onConfirmBtnClick:s,onCancelBtnClick:o,onContentChange:i}),[c]);return r("div",{className:"memo-editor-wrapper "+(c?"edit-ing":""),children:[t("p",{className:"tip-text "+(c?"":"hidden"),children:"\u6B63\u5728\u4FEE\u6539\u4E2D..."}),t(qt,w({ref:e},h))]})};function Wt(){var a;return(a=W.get(["editorContentCache"]).editorContentCache)!=null?a:""}function pe(a){W.set({editorContentCache:a})}const Yt=()=>{const{locationState:{query:{text:a,type:e}}}=m.exports.useContext($),n=m.exports.useRef(null),s=i=>{const{type:c}=B.getState().query;i===c&&(i=""),B.setMemoTypeQuery(i)};return r("div",{className:"search-bar-container",children:[r("div",{className:"search-bar-inputer",children:[t("img",{className:"icon-img",src:"/icons/search.svg"}),t("input",{className:"text-input",type:"text",placeholder:"",ref:n,value:a,onChange:i=>{const c=i.currentTarget.value;B.setTextQuery(c)}})]}),t("div",{className:"quickly-action-wrapper",children:r("div",{className:"quickly-action-container",children:[t("p",{className:"title-text",children:"QUICKLY FILTER"}),r("div",{className:"section-container types-container",children:[t("span",{className:"section-text",children:"\u7C7B\u578B:"}),ue.map((i,c)=>r("div",{children:[t("span",{className:`type-item ${e===i.type?"selected":""}`,onClick:()=>{s(i.type)},children:i.text}),c+1<ue.length?t("span",{className:"split-text",children:"/"}):null]},i.type))]})]})})]})};const Kt=()=>{const a=m.exports.useCallback(()=>{B.clearQuery()},[]),e=m.exports.useCallback(n=>{n.stopPropagation();const s=document.querySelector(z);s&&s.classList.add(X)},[]);return r("div",{className:"memos-header-container",children:[r("div",{className:"title-text",onClick:a,children:[t("button",{className:"action-btn",onClick:e,children:t("img",{className:"icon-img",src:"/icons/fold.svg",alt:"fold"})}),t("span",{className:"normal-text",children:"MEMO"})]}),t(Yt,{})]})};function zt(a,e,n=[]){const s=m.exports.useRef(),o=m.exports.useCallback(()=>{s.current&&clearTimeout(s.current)},[]);return m.exports.useCallback((...c)=>{o(),s.current=window.setTimeout(()=>{a(...c)},e)},n)}const Xt=a=>{for(const e of ue)if(e.type===a)return e.text;return""},Jt=()=>{const{locationState:{query:a},memoState:{memos:e}}=m.exports.useContext($),[n,s]=m.exports.useState(!1),[o,i]=m.exports.useState(!1),c=m.exports.useRef(null),h=a.tag,g={from:a.from,to:a.to},f=a.type,C=a.text,p=Boolean(h||g.from!==0&&g.from<g.to||f||C),u=p?e.filter(l=>{let y=!0;const x=[];for(const E of l.tags){const k=E.text.split("/");let P="";for(let R=0;R<k.length;R++)R===0?P+=k[R]:P+="/"+k[R],x.push(P)}return h!==""&&!x.includes(h)&&(y=!1),g.from!==0&&g.from<g.to&&(b.getTimeStampByDate(l.createdAt)<g.from||b.getTimeStampByDate(l.createdAt)>g.to)&&(y=!1),f!==""&&(f==="NOT_TAGGED"?l.content.match(J)!==null&&(y=!1):f==="LINKED"?l.content.match(Ne)===null&&(y=!1):f==="IMAGED"?l.content.match(q)===null&&(y=!1):f==="CONNECTED"&&l.content.match(le)===null&&(y=!1)),C!==""&&!l.content.includes(C)&&(y=!1),y}):e;m.exports.useEffect(()=>{var l;(l=c.current)==null||l.scrollTo({top:0}),!o&&p&&(s(!0),D.fetchAllMemos().then(y=>{y!==!1&&(i(!0),s(!1))}))},[o,p,a]);const N=async()=>{if(!(n||o)){s(!0);try{const l=await D.fetchMoreMemos();Array.isArray(l)&&l.length===0&&i(!0)}catch(l){T.error(l.message)}s(!1)}},S=m.exports.useCallback(l=>{const y=l.target;if(y.tagName==="SPAN"&&y.className==="tag-span"){const x=y.innerText.slice(1);B.getState().query.tag===x?B.setTagQuery(""):B.setTagQuery(x)}},[]),d=zt(()=>{if(n||o)return;const{offsetHeight:l,scrollTop:y,scrollHeight:x}=c.current;l+y+10>x&&N()},100,[n,o]);return r("div",{className:`memolist-wrapper ${o?"completed":""}`,onClick:S,onScroll:d,ref:c,children:[t(Zt,{showFilter:p,tagQuery:h,duration:g,memoType:f,textQuery:C}),u.map(l=>t(wt,{memo:l},`${l.id}-${l.updatedAt}`)),p?t("div",{className:"status-text-container",children:t("p",{className:"status-text",children:n?"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D...":o&&u.length===0?"\u7A7A\u7A7A\u5982\u4E5F":""})}):t("div",{className:`status-text-container ${o?"completed":""} ${n||o?"":"invisible"}`,children:t("p",{className:"status-text",children:o?"\u6240\u6709\u6570\u636E\u52A0\u8F7D\u5B8C\u5566 \u{1F389}":"\u52AA\u529B\u8BF7\u6C42\u6570\u636E\u4E2D..."})})]})},Zt=a=>{const{showFilter:e,tagQuery:n,duration:s,memoType:o,textQuery:i}=a;return r("div",{className:`filter-query-container ${e?"":"hidden"}`,children:[t("span",{className:"tip-text",children:"\u7B5B\u9009\uFF1A"}),r("div",{className:"filter-item-container "+(s.from!==0&&s.from<s.to?"":"hidden"),onClick:()=>{B.setFromAndToQuery(0,0)},children:[t("span",{className:"icon-text",children:"\u{1F5D3}\uFE0F"})," ",b.getDateString(s.from)," \u81F3 ",b.getDateString(s.to)]}),r("div",{className:"filter-item-container "+(n?"":"hidden"),onClick:()=>{B.setTagQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F3F7}\uFE0F"})," ",n]}),r("div",{className:"filter-item-container "+(o?"":"hidden"),onClick:()=>{B.setMemoTypeQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F4E6}"})," ",Xt(o)]}),r("div",{className:"filter-item-container "+(i?"":"hidden"),onClick:()=>{B.setTextQuery("")},children:[t("span",{className:"icon-text",children:"\u{1F50D}"})," ",i]})]})};function ea(){return r(O,{children:[t(Kt,{}),t(jt,{}),t(Jt,{})]})}const ta=a=>{var C,p;const{memo:e,handleDeletedMemoAction:n}=a,s=F(w({},e),{formattedContent:j(e.content),createdAtStr:b.getDateTimeString(e.createdAt),deletedAtStr:b.getDateTimeString((C=e.deletedAt)!=null?C:Date.now())}),[o,i]=Z(!1),c=Array.from((p=s.content.match(q))!=null?p:[]),h=async()=>{if(o)try{await D.deleteMemoById(s.id),n(s.id)}catch(u){T.error(u.message)}else i()},g=async()=>{try{await D.restoreMemoById(s.id),n(s.id),T.info("\u6062\u590D\u6210\u529F")}catch(u){T.error(u.message)}},f=()=>{o&&i(!1)};return r("div",{className:`memo-wrapper ${"memos-"+s.id}`,onMouseLeave:f,children:[r("div",{className:"memo-top-wrapper",children:[r("span",{className:"time-text",children:["\u5220\u9664\u4E8E ",s.deletedAtStr]}),r("div",{className:"btns-container",children:[t("span",{className:"text-btn more-action-btn",children:t("img",{className:"icon-img",src:"/icons/more.svg"})}),t("div",{className:"more-action-btns-wrapper",children:r("div",{className:"more-action-btns-container",children:[t("span",{className:"text-btn restore-btn",onClick:g,children:"\u6062\u590D"}),t("span",{className:`text-btn delete-btn ${o?"final-confirm":""}`,onClick:h,children:o?"\u786E\u5B9A\u5220\u9664\uFF01":"\u5B8C\u5168\u5220\u9664"})]})})]})]}),t("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:s.formattedContent}}),t(Q,{when:c.length>0,children:t("div",{className:"images-wrapper",children:c.map((u,N)=>t(me,{className:"memo-img",imgUrl:u},N))})})]})};const aa=()=>{const a=ee(),[e,n]=m.exports.useState([]);m.exports.useEffect(()=>{D.fetchDeletedMemos().then(i=>{i!==!1&&n(i),a.setFinish()})},[]);const s=m.exports.useCallback(i=>{n(e.filter(c=>c.id!==i))},[e]),o=m.exports.useCallback(i=>{i.stopPropagation();const c=document.querySelector(z);c&&c.classList.add(X)},[]);return r("div",{className:"memo-trash-wrapper",children:[t("div",{className:"header-container",children:r("div",{className:"title-text",children:[t("button",{className:"action-btn",onClick:o,children:t("img",{className:"icon-img",src:"/icons/fold.svg",alt:"fold"})}),t("span",{className:"normal-text",children:"\u56DE\u6536\u7AD9"})]})}),a.isLoading?null:e.length===0?t("div",{className:"empty-container",children:t("p",{className:"empty-text",children:"No Zettels."})}):e.map(i=>t(ta,{memo:i,handleDeletedMemoAction:s},`${i.id}-${i.updatedAt}`))]})},na={"/trash":t(aa,{}),"*":t(ea,{})},De=a=>e=>{for(const n of Object.keys(a))if(n===e)return a[n];return a["*"]},sa=De(Vt),oa=De(na);function ra(){const{locationState:{pathname:a},globalState:{showDarkMode:e}}=m.exports.useContext($);return m.exports.useEffect(()=>{e?document.body.classList.add("dark"):document.body.classList.remove("dark"),U.setIsMobileView(document.body.clientWidth<=875);const n=()=>{U.setIsMobileView(document.body.clientWidth<=875)};return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[e]),t(O,{children:sa(a)})}(()=>{String.prototype.replaceAll||(String.prototype.replaceAll=function(a,e){return Object.prototype.toString.call(a).toLowerCase()==="[object regexp]"?this.replace(a,e):this.replace(new RegExp(a,"g"),e)})})();Y.render(t(Oe.StrictMode,{children:t(fe,{store:v,context:$,children:t(ra,{})})}),document.getElementById("root"));
