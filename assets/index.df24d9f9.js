var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,c=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,o=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&c(e,a,t[a]);if(n)for(var a of n(t))r.call(t,a)&&c(e,a,t[a]);return e},l=(e,n)=>t(e,a(n)),m=(e,t,a)=>(c(e,"symbol"!=typeof t?t+"":t,a),a);import{r as i,R as u,a as d}from"./vendor.4f50e650.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const p=e=>{const{children:t,store:a,context:n}=e,[s,r]=i.exports.useState(a.getState());return i.exports.useEffect((()=>{const e=a.subscribe((e=>{r(e)}));return()=>{e()}}),[]),u.createElement(n.Provider,{value:s},t)};const g=function(e,t){const a=[];let n=e;return{dispatch:e=>{const s=t(n,e),r=n;n=s;for(const t of a)t(n,r)},getState:()=>n,subscribe:e=>{let t=!0;return a.push(e),()=>{if(!t)return;const n=a.indexOf(e);a.splice(n,1),t=!1}}}}({globalState:{markMemoId:"",editMemoId:"",shouldSplitMemoWord:!0,shouldHideImageUrl:!0,shouldUseMarkdownParser:!0,showDarkMode:!1},locationState:{hash:"",query:{tag:"",from:0,to:0,type:"",text:""}},memoState:{memos:[]},userState:{user:null}},function(e){const t=Object.keys(e),a={};for(const n of t)"function"==typeof e[n]&&(a[n]=e[n]);return(e={},n)=>{let s=!1;const r={};for(const c of t){const t=e[c],o=a[c](t,n);r[c]=o,s=s||o!==t}return s?r:e}}({globalState:function(e,t){switch(t.type){case"SET_MARK_MEMO_ID":return l(o({},e),{markMemoId:t.payload.markMemoId});case"SET_EDIT_MEMO_ID":return l(o({},e),{editMemoId:t.payload.editMemoId});case"SET_APP_SETTING":return o(o({},e),t.payload);default:return e}},locationState:function(e,t){switch(t.type){case"SET_TAG_QUERY":return l(o({},e),{query:l(o({},e.query),{tag:t.payload.tag})});case"SET_FROM_TO_QUERY":return l(o({},e),{query:l(o({},e.query),{from:t.payload.from,to:t.payload.to})});case"SET_TYPE":return l(o({},e),{query:l(o({},e.query),{type:t.payload.type})});case"SET_TEXT":return l(o({},e),{query:l(o({},e.query),{text:t.payload.text})});case"SET_HASH":return l(o({},e),{hash:t.payload.hash});default:return e}},memoState:function(e,t){switch(t.type){case"SET_MEMOS":return{memos:[...t.payload.memos]};case"PUSH_MEMO":return{memos:[t.payload.memo,...e.memos].sort(((e,t)=>t.createdAt-e.createdAt))};case"PUSH_MEMOS":return{memos:[...t.payload.memos,...e.memos].sort(((e,t)=>t.createdAt-e.createdAt))};case"DELETE_MEMO_BY_ID":return{memos:[...e.memos].filter((e=>e.id!==t.payload.id))};case"EDIT_MEMO":return{memos:e.memos.map((e=>e.id===t.payload.id?o(o({},e),t.payload):e))};default:return e}},userState:function(e,t){switch(t.type){case"SIGN_IN":return{user:t.payload.user};case"SIGN_OUT":return{user:null};default:return e}}})),E=i.exports.createContext(g.getState());var h,f;(f=h||(h={})).get=function(e){const t={};for(const n of e)try{const e=localStorage.getItem(n);if(null!==e){const a=JSON.parse(e);t[n]=a}}catch(a){console.error("Get storage failed in ",n,a)}return t},f.set=function(e){for(const a in e)try{const t=JSON.stringify(e[a]);localStorage.setItem(a,t)}catch(t){console.error("Save storage failed in ",a,t)}},f.emitStorageChangedEvent=function(){var e;const t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t),null==(e=t.contentWindow)||e.localStorage.setItem("t",Date.now().toString()),t.remove()};const y=new class{constructor(){var e,t,a,n;m(this,"getState",(()=>g.getState().globalState)),m(this,"setEditMemoId",(e=>{g.dispatch({type:"SET_EDIT_MEMO_ID",payload:{editMemoId:e}})})),m(this,"setMarkMemoId",(e=>{g.dispatch({type:"SET_MARK_MEMO_ID",payload:{markMemoId:e}})})),m(this,"setAppSetting",(e=>{g.dispatch({type:"SET_APP_SETTING",payload:e}),h.set(e)}));const s=h.get(["shouldSplitMemoWord","shouldHideImageUrl","shouldUseMarkdownParser","showDarkMode"]),r={shouldSplitMemoWord:null==(e=s.shouldSplitMemoWord)||e,shouldHideImageUrl:null==(t=s.shouldHideImageUrl)||t,shouldUseMarkdownParser:null==(a=s.shouldUseMarkdownParser)||a,showDarkMode:null!=(n=s.showDarkMode)&&n};this.setAppSetting(r)}};var N,x;(x=N||(N={})).getNowTimeStamp=function(){return Date.now()},x.getOSVersion=function(){const e=navigator.appVersion;let t="Unknown";return-1!=e.indexOf("Win")?t="Windows":-1!=e.indexOf("Mac")?t="MacOS":-1!=e.indexOf("Linux")&&(t="Linux"),t},x.getTimeStampByDate=function(e){const t=new Date(e);return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()},x.getDateString=function(e){const t=new Date(e);return`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`},x.getTimeString=function(e){const t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,s=t.getDate(),r=t.getHours(),c=t.getMinutes(),o=t.getSeconds();return`${a}-${n<10?"0"+n:n}-${s<10?"0"+s:s} ${r<10?"0"+r:r}:${c<10?"0"+c:c}:${o<10?"0"+o:o}`},x.getTimeStampString=function(e){const t=new Date(e),a=t.getHours(),n=t.getMinutes();return`${a<10?"0"+a:a}:${n<10?"0"+n:n}`},x.dedupe=function(e){return Array.from(new Set(e))},x.dedupeObjectWithId=function(e){const t=new Set,a=[];for(const n of e)t.has(n.id)||(t.add(n.id),a.push(n));return a},x.debounce=function(e,t){let a=null;return()=>{a?(clearTimeout(a),a=setTimeout(e,t)):a=setTimeout(e,t)}},x.throttle=function(e,t){let a=!0;return()=>{if(!a)return!1;a=!1,setTimeout((()=>{e(),a=!0}),t)}},x.iterObjectToParamsString=function(e){const t=[],a=Object.keys(e),n=Object.values(e);for(let s=0;s<a.length;++s)n[s]&&t.push(`${a[s]}=${n[s]}`);return t.join("&")},x.copyTextToClipboard=async function(e){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(e)}catch(t){console.warn("Copy to clipboard failed.",t)}else console.warn("Copy to clipboard failed, methods not supports.")},x.parseHTMLToRawString=function(e){const t=document.createElement("div");return t.innerHTML=e,t.innerText},x.getImageSize=function(e){return new Promise(((t,a)=>{const n=new Image;n.onload=()=>{const{width:e,height:a}=n;t(e>0&&a>0?{width:e,height:a}:{width:0,height:0})},n.onerror=()=>{t({width:0,height:0})},n.className="hidden",n.src=e,document.body.appendChild(n),n.remove()}))};const b=()=>{let e=N.iterObjectToParamsString(g.getState().locationState.query);e=e?"?"+e:"",history.replaceState(null,"","/"+e)};const v=new class{constructor(){m(this,"initLocation",(()=>{var e,t,a,n,s;const r=new URLSearchParams(window.location.search);this.setTagQuery(null!=(e=r.get("tag"))?e:""),this.setFromAndToQuery(parseInt(null!=(t=r.get("from"))?t:"0"),parseInt(null!=(a=r.get("to"))?a:"0")),this.setMemoTypeQuery(null!=(n=r.get("type"))?n:""),this.setTextQuery(null!=(s=r.get("text"))?s:"")})),m(this,"getState",(()=>g.getState().locationState)),m(this,"clearQuery",(()=>{g.dispatch({type:"SET_TAG_QUERY",payload:{tag:""}}),g.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:0,to:0}}),b()})),m(this,"setHash",(e=>{g.dispatch({type:"SET_HASH",payload:{hash:e}}),b()})),m(this,"setMemoTypeQuery",((e="")=>{g.dispatch({type:"SET_TYPE",payload:{type:e}}),b()})),m(this,"setTextQuery",(e=>{g.dispatch({type:"SET_TEXT",payload:{text:e}}),b()})),m(this,"setTagQuery",(e=>{g.dispatch({type:"SET_TAG_QUERY",payload:{tag:e}}),b()})),m(this,"setFromAndToQuery",((e,t)=>{g.dispatch({type:"SET_FROM_TO_QUERY",payload:{from:e,to:t}}),b()})),this.initLocation()}};var w;!function(e){async function t(e){const t=await fetch(e,{method:"GET"}),a=await t.json();if(!a.succeed)throw a;return a}async function a(e,t){const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await a.json();if(!n.succeed)throw n;return n}e.get=t,e.post=a,e.getUserInfo=function(){return t("/api/user/me")},e.signin=function(e,t){return a("/api/user/signin",{username:e,password:t})},e.signup=function(e,t){return a("/api/user/signup",{username:e,password:t})},e.signout=function(){return a("/api/user/signout")},e.checkUsernameUsable=function(e){return t("/api/user/checkusername?username="+e)},e.checkPasswordValid=function(e){return a("/api/user/checkpassword",{password:e})},e.updateUserinfo=function(e="",t=""){return a("/api/user/update",{username:e,password:t})},e.getMyMemos=function(e=0,a=20){return t(`/api/memo/all?offset=${e}&amount=${a}`)},e.createMemo=function(e){return a("/api/memo/new",{content:e})},e.getMemoById=function(e){return t("/api/memo/?id="+e)},e.deleteMemo=function(e){return a("/api/memo/delete",{memoId:e})},e.updateMemo=function(e,t){return a("/api/memo/update",{memoId:e,content:t})},e.getMemosCount=function(){return t("/api/memo/count")},e.createTag=function(e){return a("/api/tag/new",{text:e})},e.createMemoTag=function(e,t){return a("/api/tag/link",{memoId:e,tagId:t})},e.removeMemoTag=function(e,t){return a("/api/tag/rmlink",{memoId:e,tagId:t})},e.getTagsByMemoId=function(e){return t("/api/tag/memo?id="+e)},e.getMyTags=function(){return t("/api/tag/all")},e.deleteTagById=function(e){return a("/api/tag/delete",{tagId:e})},e.polishTag=function(e){return a("/api/tag/polish",{tagId:e})},e.updateTagText=function(e,t){return a("/api/tag/update",{id:e,text:t})},e.getMyDataAmount=function(){return t("/api/user/amount")},e.getUrlContentType=function(e){return t("/api/base/srctype?url="+e)},e.getMemosStat=function(){return t("/api/memo/stat")},e.removeGithubName=function(){return a("/api/user/updategh",{githubName:""})}}(w||(w={}));const S=/#\s(.+?)\s/g,M=/(https?:\/\/[^\s<\\*>']+)/g,k=/(https?:\/\/[^\s<\\*>']+\.(jpeg|jpg|gif|png|svg))/g,T=/\[@(.+?)\]\((.+?)\)/g,C=[{type:"NOT_TAGGED",text:"无标签"},{type:"LINKED",text:"有链接"},{type:"IMAGED",text:"有图片"}];const A=new class{getState(){return g.getState().userState}async doSignIn(){const{data:e}=await w.getUserInfo();return e?g.dispatch({type:"SIGN_IN",payload:{user:e}}):A.doSignOut(),e}async doSignOut(){w.signout().catch((()=>{})),g.dispatch({type:"SIGN_OUT",payload:{user:null}})}async checkUsernameUsable(e){const{data:t}=await w.checkUsernameUsable(e);return t}async updateUsername(e){await w.updateUserinfo(e)}async removeGithubName(){await w.removeGithubName()}async checkPasswordValid(e){const{data:t}=await w.checkPasswordValid(e);return t}async updatePassword(e){await w.updateUserinfo("",e)}};const D=new class{constructor(){m(this,"isFetching",!1)}getState(){return g.getState().memoState}async fetchMoreMemos(){if(!A.getState().user||this.isFetching)return!1;this.isFetching=!0;const{data:e}=await w.getMyMemos(this.getState().memos.length,20),t=e.map((e=>({id:e.id,content:e.content,tags:e.tags,createdAt:new Date(e.createdAt).getTime(),updatedAt:new Date(e.updatedAt).getTime()})));return g.dispatch({type:"PUSH_MEMOS",payload:{memos:t}}),this.isFetching=!1,t}async fetchAllMemos(){if(!A.getState().user||this.isFetching)return!1;this.isFetching=!0;const{data:{memosAmount:e}}=await w.getMyDataAmount(),{data:t}=await w.getMyMemos(this.getState().memos.length,e),a=t.map((e=>({id:e.id,content:e.content,tags:e.tags,createdAt:new Date(e.createdAt).getTime(),updatedAt:new Date(e.updatedAt).getTime()})));a.length>0&&g.dispatch({type:"PUSH_MEMOS",payload:{memos:a}}),this.isFetching=!1}pushMemo(e){g.dispatch({type:"PUSH_MEMO",payload:{memo:{id:e.id,content:e.content,tags:e.tags,createdAt:new Date(e.createdAt).getTime(),updatedAt:new Date(e.updatedAt).getTime()}}})}async getMemoById(e){for(const a of this.getState().memos)if(a.id===e)return a;const{data:t}=await w.getMemoById(e);return t}async deleteMemoById(e){await w.deleteMemo(e),g.dispatch({type:"DELETE_MEMO_BY_ID",payload:{id:e}})}editMemo(e){g.dispatch({type:"EDIT_MEMO",payload:e})}clearMemos(){g.dispatch({type:"SET_MEMOS",payload:{memos:[]}})}async createMemo(e){const{data:t}=await w.createMemo(e);return t}async updateMemo(e,t){const{data:a}=await w.updateMemo(e,t);return a}async createTag(e){const{data:t}=await w.createTag(e);return t}async removeMemoTag(e,t){await w.removeMemoTag(e,t)}async createMemoTag(e,t){await w.createMemoTag(e,t)}async getMyDataAmount(){const{data:e}=await w.getMyDataAmount();return e}async getMemosStat(){const{data:e}=await w.getMemosStat();return e}async getMyTags(){if(!A.getState().user)return[];const{data:e}=await w.getMyTags();return e}async polishTag(e){await w.polishTag(e)}async updateTagText(e,t){await w.updateTagText(e,t)}},I=()=>{const{userState:{user:e}}=i.exports.useContext(E),t=e?e.username:"Memos",a=i.exports.useCallback((()=>{v.clearQuery()}),[]),n=i.exports.useCallback((()=>{const e=document.querySelector("div#page-container");e&&e.classList.add("mobile-show-sidebar")}),[]);return u.createElement("div",{className:"mobile-header-container"},u.createElement("p",{className:"username-text",onClick:a},t),u.createElement("div",{className:"btns-container"},u.createElement("button",{className:"action-btn show-sidebar",onClick:n},u.createElement("img",{className:"icon-img",src:"/icons/fold.svg",alt:"fold"}))))};const L=e=>{const{destory:t,duration:a}=e;return i.exports.useEffect((()=>{a>0&&setTimeout((()=>{t()}),a)}),[]),u.createElement("div",{className:"toast-container",onClick:t},u.createElement("p",{className:"content-text"},e.content))},_=(()=>{const e=document.createElement("div");e.className="toast-list-container",document.body.appendChild(e);let t=0;const a=[],n=n=>{const s=document.createElement("div");s.className=`toast-wrapper ${n.type}`,e.appendChild(s),t++,a.push(s),setTimeout((()=>{s.classList.add("showup")}),0);const r={destory:()=>{s.classList.add("destory"),setTimeout((()=>{if(s.parentElement&&(t--,0===t)){for(const e of a)d.unmountComponentAtNode(e),e.remove();a.splice(0,a.length)}}),400)}};return d.render(u.createElement(L,l(o({},n),{destory:r.destory})),s),r};return{info:(e,t=3e3)=>n({type:"normal",content:e,duration:t}),error:(e,t=3e3)=>n({type:"error",content:e,duration:t})}})(),O=e=>{const{children:t,when:a}=e;return a?u.createElement(u.Fragment,null,t):null};const F={className:"",content:"",placeholder:"",showConfirmBtn:!0,showCancelBtn:!1,showTools:!1};var U=i.exports.forwardRef(((e=F)=>{const{className:t,content:a,placeholder:n,showConfirmBtn:s,showCancelBtn:r,showTools:c,handleConfirmBtnClick:o,handleCancelBtnClick:l,handleContentChange:m}=e,[d,p]=i.exports.useState(a),g=i.exports.useRef(null);i.exports.useEffect((()=>{d&&g.current&&(g.current.innerHTML=d)}),[]),i.exports.useImperativeHandle(e.editorRef,(()=>({focus:()=>{var e;null==(e=g.current)||e.focus()},insertText:e=>{const t=d+e;p(t),g.current&&(g.current.innerHTML=t),m&&m(t)},setContent:e=>{const t=e;p(t),g.current&&(g.current.innerHTML=t)},getContent:()=>d})));const E=i.exports.useCallback((e=>{const t=e.clipboardData.getData("text"),a=window.getSelection();a&&a.rangeCount&&(a.deleteFromDocument(),a.getRangeAt(0).insertNode(document.createTextNode(t)),e.preventDefault(),p(t),m&&m(t))}),[]),h=i.exports.useCallback((e=>{const t=e.currentTarget.innerHTML;p(t),m&&m(t)}),[]),f=i.exports.useCallback((e=>{if(e.stopPropagation(),"Tab"===e.key){e.preventDefault();const t=window.getSelection();if(!t||!t.rangeCount)return;t.deleteFromDocument();const a=t.getRangeAt(0),n=document.createTextNode("    ");a.insertNode(n),a.setEndAfter(n),a.setStartAfter(n),t.removeAllRanges(),t.addRange(a)}else if("Backspace"===e.key)g.current&&"<br>"===g.current.innerHTML&&(g.current.innerHTML="",p(""));else if("Enter"===e.key){e.preventDefault();const t=window.getSelection();if(!t||!t.rangeCount)return;t.deleteFromDocument();const a=t.getRangeAt(0),n=document.createElement("p"),s=document.createElement("br");n.appendChild(s),a.insertNode(n),a.setEndAfter(s),a.setStartAfter(s),t.removeAllRanges(),t.addRange(a)}}),[]),y=i.exports.useCallback((()=>{o&&(o(d),g.current&&(g.current.innerHTML=""),p(""))}),[d]),N=i.exports.useCallback((()=>{l&&l()}),[]);return u.createElement("div",{className:"common-editor-wrapper "+t},u.createElement("div",{className:"common-editor-inputer",contentEditable:!0,ref:g,onPaste:E,onInput:h,onKeyDown:f}),u.createElement("p",{className:""===d?"common-editor-placeholder":"hidden"},n),u.createElement("div",{className:"common-tools-wrapper"},u.createElement(O,{when:c},u.createElement("div",{className:"common-tools-container"})),u.createElement("div",{className:"btns-right-container"},u.createElement(O,{when:r},u.createElement("button",{className:"action-btn cancel-btn",disabled:0===d.length,onClick:N},"撤销修改")),u.createElement(O,{when:s},u.createElement("button",{className:"action-btn confirm-btn",disabled:0===d.length,onClick:y},"记下",u.createElement("span",{className:"icon-text"},"✍️"))))))}));const $=()=>{const{globalState:e,locationState:{query:t}}=i.exports.useContext(E),a=u.useRef(null),[n,s]=i.exports.useState(e.editMemoId);i.exports.useEffect((()=>{var t;if(e.markMemoId){const n=`Mark: [@MEMO](${e.markMemoId})`;null==(t=a.current)||t.insertText(`<p>${n}</p>`)}e.editMemoId!==n&&(s(e.editMemoId),e.editMemoId&&D.getMemoById(e.editMemoId).then((e=>{var t,n,s;e&&(null==(n=a.current)||n.setContent(null!=(t=e.content)?t:""),null==(s=a.current)||s.focus())})))}),[e]);const r=async e=>{var a,s;if(""===e)return void _.error("内容不能为空呀");e=e.replaceAll("&nbsp;"," ");const r=N.dedupe(Array.from(null!=(a=e.match(S))?a:[])).map((e=>e.replace(S,"$1").trim())),c=[];try{for(const e of r){if(e.length>36)throw new Error("标签太长了");const t=await D.createTag(e);c.push(t)}if(n){const t=await D.getMemoById(n);if(t&&t.content!==e){const a=null!=(s=t.tags)?s:[],n=a.map((e=>e.text));c.push(...a);for(let e=0;e<c.length;){const a=c[e],s=a.text;r.includes(s)?(e++,n.includes(s)||await D.createMemoTag(t.id,a.id)):(c.splice(e,1),await D.removeMemoTag(t.id,a.id))}const o=await D.updateMemo(t.id,e);t.content=o.content,t.tags=c,t.updatedAt=Date.now(),D.editMemo(t)}y.setEditMemoId("")}else{const a=await D.createMemo(e);a.tags=c;for(const e of c)await D.createMemoTag(a.id,e.id);const n=t.tag;""===n||r.includes(n)||v.setTagQuery(""),D.pushMemo(a)}}catch(o){_.error(o.message)}H("")},c=i.exports.useCallback((()=>{var e;y.setEditMemoId(""),null==(e=a.current)||e.setContent(""),H("")}),[]),l=i.exports.useCallback((async e=>{const t=document.createElement("div");t.innerHTML=e,""===t.innerText.trim()&&(e=""),H(e)}),[n]),m=i.exports.useMemo((()=>{return{className:"memo-editor",content:null!=(e=h.get(["editorContentCache"]).editorContentCache)?e:"",placeholder:"现在的想法是...",showConfirmBtn:!0,handleConfirmBtnClick:r,showCancelBtn:""!==n,handleCancelBtnClick:c,showTools:!0,handleContentChange:l,editorRef:a};var e}),[n]);return u.createElement("div",{className:"memo-editor-wrapper "+(n?"edit-ing":"")},u.createElement("p",{className:"tip-text "+(n?"":"hidden")},"正在修改中..."),u.createElement(U,o({},m)))};function H(e){h.set({editorContentCache:e})}const P=/```([\s\S]*?)```/g,R=/[*] /g,Q=/(\d+)\. /g;function B(e=!1){const[t,a]=i.exports.useState(e);return[t,i.exports.useCallback((e=>{a(void 0!==e?e:e=>!e)}),[])]}const j=e=>{const{children:t,className:a,clickSpaceDestroy:n,destroy:s}=e;return u.createElement("div",{className:`dialog-wrapper ${a}`,onClick:()=>{n&&s()}},u.createElement("div",{className:"dialog-container",onClick:e=>e.stopPropagation()},t))};function Y(e,t,a){const n=document.createElement("div");document.body.append(n),setTimeout((()=>{var e;null==(e=n.firstElementChild)||e.classList.add("showup")}),0);const s={destroy:()=>{var e,t;null==(e=n.firstElementChild)||e.classList.remove("showup"),null==(t=n.firstElementChild)||t.classList.add("showoff"),setTimeout((()=>{n.remove(),d.unmountComponentAtNode(n)}),200)}},r=l(o({},a),{destroy:s.destroy});let c=u.createElement(j,o({destroy:s.destroy,clickSpaceDestroy:!0},e),u.createElement(t,o({},r)));return e.useAppContext&&(c=u.createElement(p,{store:g,context:E},c)),d.render(c,n),s}const G=({destroy:e,imgUrl:t})=>{const a=i.exports.useRef(null),[n,s]=i.exports.useState(-1);i.exports.useEffect((()=>{N.getImageSize(t).then((({width:e})=>{s(0!==e?80:0)}))}),[]);return u.createElement(u.Fragment,null,u.createElement("button",{className:"text-btn close-btn",onClick:()=>{e()}},u.createElement("img",{className:"icon-img",src:"/icons/close.svg"})),u.createElement("div",{className:"img-container"},u.createElement("img",{className:n<=0?"hidden":"",ref:a,width:n+"%",src:t}),u.createElement("span",{className:"loading-text "+(-1===n?"":"hidden")},"图片加载中..."),u.createElement("span",{className:"loading-text "+(0===n?"":"hidden")},"😟 图片加载失败，可能是无效的链接")),u.createElement("div",{className:"action-btns-container"},u.createElement("button",{className:"text-btn",onClick:()=>{n>30&&s(n-10)}},"➖"),u.createElement("button",{className:"text-btn",onClick:()=>{s(n+10)}},"➕"),u.createElement("button",{className:"text-btn",onClick:()=>s(80)},"⭕")))};function q(e){Y({className:"preview-image-dialog"},G,{imgUrl:e})}const W=e=>{const{className:t,imgUrl:a}=e;return u.createElement("div",{className:"image-container "+t,onClick:()=>{q(a)}},u.createElement("img",{src:a,decoding:"async",loading:"lazy"}))};function K(){const[e,t]=i.exports.useState({isLoading:!0,isFailed:!1,isSucceed:!1});return l(o({},e),{setLoading:()=>{t(l(o({},e),{isLoading:!0,isFailed:!1,isSucceed:!1}))},setFinish:()=>{t(l(o({},e),{isLoading:!1,isFailed:!1,isSucceed:!0}))},setError:()=>{t(l(o({},e),{isLoading:!1,isFailed:!0,isSucceed:!1}))}})}const V=e=>{var t;const{memo:a}=e,n=l(o({},a),{formattedContent:ce(a.content),createdAtStr:N.getTimeString(a.createdAt),timeStr:N.getTimeStampString(a.createdAt)}),s=Array.from(null!=(t=n.content.match(k))?t:[]);return u.createElement("div",{className:"daily-memo-wrapper"},u.createElement("div",{className:"time-wrapper"},u.createElement("span",{className:"normal-text"},n.timeStr)),u.createElement("div",{className:"memo-content-container"},u.createElement("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:n.formattedContent}}),u.createElement(O,{when:s.length>0},u.createElement("div",{className:"images-container"},s.map(((e,t)=>u.createElement("img",{key:t,crossOrigin:"anonymous",src:e,decoding:"async"})))))))};const X=e=>{const{className:t,datestamp:a,handleDateStampChange:n}=e,[s,r]=i.exports.useState(z(a));i.exports.useEffect((()=>{r(z(a))}),[a]);const c=new Date(s),o=0===c.getDay()?7:c.getDay(),l=[];for(let i=1;i<o;i++)l.push({date:0,datestamp:c.getTime()-864e5*(7-i)});const m=function(e){const t=new Date(e),a=new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`);return((11===a.getMonth()?new Date(`${a.getFullYear()+1}/1`):new Date(`${a.getFullYear()}/${a.getMonth()+2}/1`)).getTime()-a.getTime())/864e5}(s);for(let i=1;i<=m;i++)l.push({date:i,datestamp:c.getTime()+864e5*(i-1)});const d=e=>{const t=c.getFullYear(),a=c.getMonth()+1;let n=0;n=1===a&&-1===e?new Date(t-1+"/12/1").getTime():12===a&&1===e?new Date(`${t+1}/1/1`).getTime():new Date(`${t}/${a+e}/1`).getTime(),r(z(n))};return u.createElement("div",{className:`date-picker-wrapper ${t}`},u.createElement("div",{className:"date-picker-header"},u.createElement("span",{className:"btn-text",onClick:()=>d(-1)},u.createElement("img",{className:"icon-img",src:"/icons/arrow-left.svg"})),u.createElement("span",{className:"normal-text"},c.getFullYear()," 年 ",c.getMonth()+1," 月"),u.createElement("span",{className:"btn-text",onClick:()=>d(1)},u.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"}))),u.createElement("div",{className:"date-picker-day-container"},u.createElement("div",{className:"date-picker-day-header"},u.createElement("span",{className:"day-item"},"周一"),u.createElement("span",{className:"day-item"},"周二"),u.createElement("span",{className:"day-item"},"周三"),u.createElement("span",{className:"day-item"},"周四"),u.createElement("span",{className:"day-item"},"周五"),u.createElement("span",{className:"day-item"},"周六"),u.createElement("span",{className:"day-item"},"周日")),l.map((e=>0===e.date?u.createElement("span",{key:e.datestamp,className:"day-item null"},""):u.createElement("span",{key:e.datestamp,className:"day-item "+(e.datestamp===a?"current":""),onClick:()=>{return t=e.datestamp,void n(t);var t}},e.date)))))};function z(e){const t=new Date(e);return new Date(`${t.getFullYear()}/${t.getMonth()+1}/1`).getTime()}const J=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],Z=["周日","周一","周二","周三","周四","周五","周六"],ee=e=>{const t=K(),[a,n]=i.exports.useState([]),[s,r]=i.exports.useState(N.getTimeStampByDate(N.getDateString(e.currentDateStamp))),[c,o]=B(!1),l=i.exports.useRef(null),m=new Date(s);i.exports.useEffect((()=>{const e=()=>{const e=D.getState().memos.filter((e=>e.createdAt>=s&&e.createdAt<s+864e5)).sort(((e,t)=>e.createdAt-t.createdAt));n(e),t.setFinish()},{memos:a}=D.getState(),r=a.slice(-1).pop();r&&r.createdAt>=s?(t.setLoading(),D.fetchAllMemos().then((()=>{e()})).catch((e=>{_.error(e.message)}))):e()}),[s]);return u.createElement(u.Fragment,null,u.createElement("div",{className:"dialog-header-container"},u.createElement("div",{className:"btns-wrapper"},u.createElement("div",{className:"btns-container"},u.createElement("span",{className:"btn-text",onClick:()=>r(s-864e5)},u.createElement("img",{className:"icon-img",src:"/icons/arrow-left.svg"})),u.createElement("span",{className:"btn-text",onClick:()=>r(s+864e5)},u.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"}))),u.createElement("div",{className:"btns-container"},u.createElement("span",{className:"btn-text",onClick:()=>{o(!1),setTimeout((()=>{const e=N.getOSVersion();"MacOS"!==e&&"Unknown"!==e||window.scrollTo(0,0),l.current&&html2canvas(l.current,{scale:2*window.devicePixelRatio,allowTaint:!0,useCORS:!0,backgroundColor:y.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then((e=>{q(e.toDataURL())}))}),0)}},u.createElement("img",{className:"icon-img",src:"/icons/share.svg"})),u.createElement("span",{className:"btn-text",onClick:()=>e.destroy()},u.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))))),u.createElement("div",{className:"dialog-content-container",ref:l},u.createElement("div",{className:"date-card-container",onClick:()=>o()},u.createElement("div",{className:"year-text"},m.getFullYear()),u.createElement("div",{className:"date-container"},u.createElement("div",{className:"month-text"},J[m.getMonth()]),u.createElement("div",{className:"date-text"},m.getDate()),u.createElement("div",{className:"day-text"},Z[m.getDay()]))),u.createElement(X,{className:"date-picker "+(c?"":"hide"),datestamp:s,handleDateStampChange:e=>{r(e),o(!1)}}),t.isLoading?u.createElement("div",{className:"tip-container"},u.createElement("p",{className:"tip-text"},"努力加载中...")):0===a.length?u.createElement("div",{className:"tip-container"},u.createElement("p",{className:"tip-text"},"空空如也")):u.createElement("div",{className:"dailymemos-wrapper"},a.map((e=>u.createElement(V,{key:`${e.id}-${e.updatedAt}`,memo:e}))))))};function te(e=Date.now()){Y({className:"daily-memo-diary-dialog"},ee,{currentDateStamp:e})}const ae=e=>{var t;const{memo:a,destroy:n}=e,[s,r]=i.exports.useState(""),c=i.exports.useRef(null),{user:m}=A.getState(),d=l(o({},a),{formattedContent:ce(a.content),createdAtStr:N.getTimeString(a.createdAt)}),p=Array.from(null!=(t=d.content.match(k))?t:[]),[g,E]=i.exports.useState(p.length);i.exports.useEffect((()=>{const e=c.current;setTimeout((()=>{if(0===g){const t=N.getOSVersion();"MacOS"!==t&&"Unknown"!==t||window.scrollTo(0,0),e&&html2canvas(e,{scale:2*window.devicePixelRatio,allowTaint:!0,useCORS:!0,backgroundColor:y.getState().showDarkMode?"#2f3437":"white",scrollX:-window.scrollX,scrollY:-window.scrollY}).then((e=>{r(e.toDataURL())}))}}),300)}),[g]);const h=e=>{"error"===e.type&&(_.error("有个图片加载失败了😟"),e.target.remove()),E(g-1)};return u.createElement(u.Fragment,null,u.createElement("div",{className:"dialog-header-container"},u.createElement("p",{className:"title-text"},u.createElement("span",{className:"icon-text"},"🥰"),"分享 Memo 图片"),u.createElement("button",{className:"text-btn close-btn",onClick:()=>{n()}},u.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),u.createElement("div",{className:"dialog-content-container"},u.createElement("div",{className:"tip-words-container "+(s?"finished":"genarating")},u.createElement("p",{className:"tip-text"},s?"右键或长按即可保存图片 👇":"图片生成中...")),u.createElement("img",{className:"memo-img",src:s}),u.createElement("div",{className:"memo-container",ref:c},u.createElement("span",{className:"time-text"},d.createdAtStr),u.createElement("div",{className:"memo-content-text",dangerouslySetInnerHTML:{__html:d.formattedContent}}),u.createElement(O,{when:p.length>0},u.createElement("div",{className:"images-container"},p.map(((e,t)=>u.createElement("img",{key:t,crossOrigin:"anonymous",src:e,onLoad:h,onError:h,decoding:"async"}))))),u.createElement("div",{className:"watermark-container"},u.createElement("span",{className:"normal-text"},"by ",u.createElement("span",{className:"name-text"},null==m?void 0:m.username))))))};function ne(e){Y({className:"gen-memo-image-dialog"},ae,{memo:e})}const se=e=>{var t;const{memoId:a,destroy:n}=e,[s,r]=i.exports.useState(),[c,m]=i.exports.useState([]),[d,p]=i.exports.useState([]);i.exports.useEffect((()=>{(async()=>{var e;const t=await D.getMemoById(a);t&&(p(Array.from(null!=(e=t.content.match(k))?e:[])),r(l(o({},t),{formattedContent:ce(t.content),createdAtStr:N.getTimeString(t.createdAt)})))})()}),[]),i.exports.useEffect((()=>{(async()=>{if(!s)return;const e=[],t=[...s.content.matchAll(T)];for(const a of t)if(a&&3===a.length){const t=a[2],n=await D.getMemoById(t);n&&(e.push(l(o({},n),{formattedContent:ce(n.content),createdAtStr:N.getTimeString(n.createdAt)})),m([...e]))}})()}),[s]);const g=async e=>{var t;const a=e.target;if("memo-link-text"===a.className){const e=null==(t=a.dataset)?void 0:t.value;if(e){await D.getMemoById(e)&&(n(),re(e))}}};return u.createElement(u.Fragment,null,u.createElement("div",{className:"dialog-header-container"},u.createElement("p",{className:"title-text"},u.createElement("span",{className:"icon-text"},"📕"),"Memo Story"),u.createElement("button",{className:"text-btn close-btn",onClick:n},u.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),u.createElement("div",{className:"dialog-content-container"},u.createElement("div",{className:"memo-container current"},u.createElement("div",{className:"memo-header-container"},u.createElement("p",{className:"time-text"},null==s?void 0:s.createdAtStr),u.createElement("span",{className:"action-btn",onClick:()=>{s&&ne(s)}},"Share")),u.createElement("div",{className:"memo-content-text",onClick:g,dangerouslySetInnerHTML:{__html:null!=(t=null==s?void 0:s.formattedContent)?t:""}}),u.createElement(O,{when:d.length>0},u.createElement("div",{className:"images-wrapper"},d.map(((e,t)=>u.createElement(W,{className:"memo-img",key:t,imgUrl:e})))))),u.createElement("p",{className:"normal-text "+(0===c.length?"hidden":"")},"链接了 ",c.length," 个 Memo"),u.createElement("div",{className:"down-memos-wrapper "+(0!==c.length?"":"hidden")},c.map((e=>u.createElement("div",{className:"memo-container",key:e.id},u.createElement("div",{className:"memo-header-container"},u.createElement("p",{className:"time-text"},e.createdAtStr)),u.createElement("div",{className:"memo-content-text",onClick:g,dangerouslySetInnerHTML:{__html:e.formattedContent}})))))))};function re(e){Y({className:"memo-story-dialog"},se,{memoId:e})}function ce(e){var t;const a=document.createElement("div");a.innerHTML=e;const n=document.createElement("p");for(;a.firstChild&&"P"!==a.firstChild.nodeName;){const e=a.firstChild;"#text"===e.nodeName?n.innerHTML+=e.nodeValue:n.innerHTML+=e.outerHTML,e.remove()}""!==n.innerHTML&&(a.prepend(n),e=a.innerHTML);const{shouldUseMarkdownParser:s,shouldSplitMemoWord:r,shouldHideImageUrl:c}=y.getState();s&&(e=e.replace(P,"<pre lang=''>$1</pre>").replace(R,"<span class='counter-text'>•</span>").replace(Q,"<span class='counter-text'>$1.</span>")),r&&(e=e.replace(/([\u4e00-\u9fa5])([A-Za-z0-9?.,;[\]]+)([\u4e00-\u9fa5]?)/g,"$1 $2 $3")),c&&(e=e.replace(k,"")),a.innerHTML=e;for(const o of a.querySelectorAll("p"))""===o.textContent&&"BR"!==(null==(t=o.firstElementChild)?void 0:t.tagName)&&o.remove();return e=(e=a.innerHTML).replace(S,"<span class='tag-span'>#$1</span>").replace(M,"<a class='link' target='_blank' rel='noreferrer' href='$1'>$1</a>").replace(T,"<span class='memo-link-text' data-value='$2'>$1</span>")}var oe=u.memo((e=>{var t;const{memo:a}=e,n=l(o({},a),{formattedContent:ce(a.content),createdAtStr:N.getTimeString(a.createdAt)}),[s,r]=B(!1),c=Array.from(null!=(t=n.content.match(k))?t:[]);return u.createElement("div",{className:"memo-wrapper",onMouseLeave:()=>{s&&r(!1)}},u.createElement("div",{className:"memo-top-wrapper"},u.createElement("span",{className:"time-text",onClick:()=>{te(n.createdAt)}},n.createdAtStr),u.createElement("div",{className:"btns-container"},u.createElement("span",{className:"text-btn more-action-btn"}),u.createElement("div",{className:"more-action-btns-wrapper"},u.createElement("div",{className:"more-action-btns-container"},u.createElement("span",{className:"text-btn",onClick:()=>{y.setMarkMemoId(n.id)}},"Mark"),u.createElement("span",{className:"text-btn",onClick:()=>{ne(n)}},"分享"),u.createElement("span",{className:"text-btn",onClick:()=>{y.setEditMemoId(n.id)}},"编辑"),u.createElement("span",{className:"text-btn delete-btn",onClick:async()=>{if(s){try{await D.deleteMemoById(n.id),await D.fetchMoreMemos()}catch(e){_.error(e.message)}y.getState().editMemoId===n.id&&y.setEditMemoId("")}else r()}},s?"确定删除！":"删除"))))),u.createElement("div",{className:"memo-content-text",onClick:async e=>{var t;const a=e.target;if("memo-link-text"===a.className){const e=null==(t=a.dataset)?void 0:t.value;if(e){await D.getMemoById(e)&&re(e)}}},dangerouslySetInnerHTML:{__html:n.formattedContent}}),u.createElement(O,{when:c.length>0},u.createElement("div",{className:"images-wrapper"},c.map(((e,t)=>u.createElement(W,{className:"memo-img",key:t,imgUrl:e}))))))}));const le=()=>{const{locationState:{query:e},memoState:{memos:t}}=i.exports.useContext(E),[a,n]=i.exports.useState(!1),[s,r]=i.exports.useState(!1),c=i.exports.useRef(null),l=e.tag,m={from:e.from,to:e.to},d=e.type,p=e.text,g=Boolean(l||0!==m.from&&m.from<m.to||d||p),h=t.filter((e=>{let t=!0;const a=[];for(const n of e.tags){const e=n.text.split("/");let t="";for(let n=0;n<e.length;n++)t+=0===n?e[n]:"/"+e[n],a.push(t)}return""===l||a.includes(l)||(t=!1),0!==m.from&&m.from<m.to&&(e.createdAt<m.from||e.createdAt>m.to)&&(t=!1),""!==d&&("NOT_TAGGED"===d?null!==e.content.match(S)&&(t=!1):"LINKED"===d?null===e.content.match(M)&&(t=!1):"IMAGED"===d&&null===e.content.match(k)&&(t=!1)),""===p||e.content.includes(p)||(t=!1),t}));i.exports.useEffect((()=>{var e;null==(e=c.current)||e.scrollTo({top:0}),!s&&g&&(n(!0),D.fetchAllMemos().then((()=>{r(!0),n(!1)})))}),[s,g]);const f=i.exports.useCallback((e=>{const t=e.target;if("SPAN"===t.tagName&&"tag-span"===t.className){const e=t.innerText.slice(1);v.getState().query.tag===e?v.setTagQuery(""):v.setTagQuery(e)}}),[]),y=function(e,t,a=[]){const n=i.exports.useRef(),s=i.exports.useCallback((()=>{n.current&&clearTimeout(n.current)}),[]);return i.exports.useCallback(((...a)=>{s(),n.current=window.setTimeout((()=>{e(...a)}),t)}),a)}((()=>{if(!a&&!s&&c.current){const{offsetHeight:e,scrollTop:t,scrollHeight:o}=c.current;e+t+10>o&&(async()=>{if(!a&&!s){n(!0);try{const e=await D.fetchMoreMemos();Array.isArray(e)&&0===e.length&&r(!0)}catch(e){_.error(e.message)}n(!1)}})()}}),100,[a,s]);return u.createElement("div",{className:"memolist-wrapper "+(s?"completed":""),onClick:f,onScroll:y,ref:c},u.createElement(me,o({},{showFilter:g,tagQuery:l,duration:m,memoType:d,textQuery:p})),h.map((e=>u.createElement(oe,{key:`${e.id}-${e.updatedAt}`,memo:e}))),g?u.createElement("div",{className:"status-text-container"},u.createElement("p",{className:"status-text"},a?"努力请求数据中...":0===h.length?"空空如也":"")):u.createElement("div",{className:`status-text-container ${s?"completed":""} ${a||s?"":"invisible"}`},u.createElement("p",{className:"status-text"},s?"所有数据加载完啦 🎉":"努力请求数据中...")))},me=e=>{const{showFilter:t,tagQuery:a,duration:n,memoType:s,textQuery:r}=e;return u.createElement("div",{className:"filter-query-container "+(t?"":"hidden")},u.createElement("span",{className:"tip-text"},"筛选："),u.createElement("div",{className:"filter-item-container "+(0!==n.from&&n.from<n.to?"":"hidden"),onClick:()=>{v.setFromAndToQuery(0,0)}},u.createElement("span",{className:"icon-text"},"🗓️")," ",N.getDateString(n.from)," 至 ",N.getDateString(n.to)),u.createElement("div",{className:"filter-item-container "+(a?"":"hidden"),onClick:()=>{v.setTagQuery("")}},u.createElement("span",{className:"icon-text"},"🏷️")," ",a),u.createElement("div",{className:"filter-item-container "+(s?"":"hidden"),onClick:()=>{v.setMemoTypeQuery("")}},u.createElement("span",{className:"icon-text"},"📦")," ",(e=>{for(const t of C)if(t.type===e)return t.text;return""})(s)),u.createElement("div",{className:"filter-item-container "+(r?"":"hidden"),onClick:()=>{v.setTextQuery("")}},u.createElement("span",{className:"icon-text"},"🔍")," ",r))};const ie=({destroy:e})=>{const{userState:t}=i.exports.useContext(E),a=t.user,[n,s]=i.exports.useState(a.username),[r,c]=i.exports.useState(!1),[o,l]=i.exports.useState(!1);return u.createElement(u.Fragment,null,u.createElement("div",{className:"dialog-header-container"},u.createElement("p",{className:"title-text"},u.createElement("span",{className:"icon-text"},"🤠"),"我的账号"),u.createElement("button",{className:"text-btn close-btn",onClick:()=>{e()}},u.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),u.createElement("div",{className:"dialog-content-container"},u.createElement("div",{className:"section-container account-section-container"},u.createElement("p",{className:"title-text"},"基本信息"),u.createElement("label",{className:"form-label input-form-label"},u.createElement("span",{className:"normal-text"},"ID："),u.createElement("span",{className:"normal-text"},a.id)),u.createElement("label",{className:"form-label input-form-label"},u.createElement("span",{className:"normal-text"},"创建时间："),u.createElement("span",{className:"normal-text"},N.getDateString(a.createdAt))),u.createElement("label",{className:"form-label input-form-label username-label"},u.createElement("span",{className:"normal-text"},"账号："),u.createElement("input",{type:"text",readOnly:!r,value:n,onClick:()=>{c(!0)},onChange:e=>{const t=e.target.value;s(t)}}),u.createElement("div",{className:"btns-container",onClick:e=>{e.preventDefault()}},u.createElement("span",{className:"text-btn confirm-btn "+(r?"":"hidden"),onClick:async()=>{if("guest"!==a.username)if(n!==a.username)try{if(!(await A.checkUsernameUsable(n)))return void _.error("用户名无法使用");await A.updateUsername(n),await A.doSignIn(),c(!1),_.info("修改成功~")}catch(e){_.error(e.message)}else c(!1);else _.info("🈲 不要修改我的用户名")}},"保存"),u.createElement("span",{className:"text-btn cancel-btn "+(r?"":"hidden"),onClick:()=>{s(a.username),c(!1)}},"撤销"))),u.createElement("label",{className:"form-label password-label"},u.createElement("span",{className:"normal-text"},"密码："),u.createElement("span",{className:"text-btn",onClick:()=>{"guest"!==a.username?Y({className:"change-password-dialog"},ue):_.info("🈲 不要修改我的密码")}},"修改密码"))),u.createElement("div",{className:"section-container account-section-container"},u.createElement("p",{className:"title-text"},"关联账号"),u.createElement("label",{className:"form-label input-form-label"},u.createElement("span",{className:"normal-text"},"GitHub："),a.githubName?u.createElement(u.Fragment,null,u.createElement("a",{className:"value-text",href:"https://github.com/"+a.githubName},a.githubName),u.createElement("span",{className:"btn-text",onMouseLeave:()=>l(!1),onClick:async()=>{if(o){try{await A.removeGithubName(),await A.doSignIn()}catch(e){_.error(e.message)}l(!1)}else l(!0)}},o?"确定取消绑定！":"取消绑定")):u.createElement(u.Fragment,null,u.createElement("span",{className:"value-text"},"无"),u.createElement("a",{className:"link-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist"},"前往绑定"))))))},ue=({destroy:e})=>{const[t,a]=i.exports.useState(""),[n,s]=i.exports.useState(""),[r,c]=i.exports.useState("");i.exports.useEffect((()=>{}),[]);const o=()=>{e()};return u.createElement(u.Fragment,null,u.createElement("div",{className:"dialog-header-container"},u.createElement("p",{className:"title-text"},"修改密码"),u.createElement("button",{className:"text-btn close-btn",onClick:o},u.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),u.createElement("div",{className:"dialog-content-container"},u.createElement("p",{className:"tip-text"},"如果是 GitHub 登录，则初始密码为用户名"),u.createElement("label",{className:"form-label input-form-label"},u.createElement("input",{type:"password",value:t,onChange:e=>{const t=e.target.value;a(t)}}),u.createElement("span",{className:"normal-text "+(""===t?"":"not-null")},"旧密码")),u.createElement("label",{className:"form-label input-form-label"},u.createElement("input",{type:"password",value:n,onChange:e=>{const t=e.target.value;s(t)}}),u.createElement("span",{className:"normal-text "+(""===n?"":"not-null")},"新密码")),u.createElement("label",{className:"form-label input-form-label"},u.createElement("input",{type:"password",value:r,onChange:e=>{const t=e.target.value;c(t)}}),u.createElement("span",{className:"normal-text "+(""===r?"":"not-null")},"再次输入新密码")),u.createElement("div",{className:"btns-container"},u.createElement("span",{className:"text-btn cancel-btn",onClick:o},"取消"),u.createElement("span",{className:"text-btn confirm-btn",onClick:async()=>{if(""!==t&&""!==n&&""!==r){if(n!==r)return _.error("新密码两次输入不一致"),void c("");try{if(!(await A.checkPasswordValid(t)))return _.error("旧密码不匹配"),void a("");await A.updatePassword(n),_.info("密码修改成功！"),o()}catch(e){_.error(e)}}else _.error("密码不能为空")}},"保存"))))};function de(){Y({className:"my-account-dialog",useAppContext:!0},ie)}const pe=({destroy:e})=>u.createElement(u.Fragment,null,u.createElement("div",{className:"dialog-header-container"},u.createElement("p",{className:"title-text"},u.createElement("span",{className:"icon-text"},"😀"),"关于 ",u.createElement("b",null,"Memos")),u.createElement("button",{className:"text-btn close-btn",onClick:()=>{e()}},u.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),u.createElement("div",{className:"dialog-content-container"},u.createElement("p",null,"一个碎片化知识记录工具。"),u.createElement("br",null),u.createElement("i",null,"为何做这个？"),u.createElement("ul",null,u.createElement("li",null,"用于记录：📅每日/周计划、💡突发奇想、📕读后感..."),u.createElement("li",null,"代替了我在微信上经常使用的“文件传输助手”；"),u.createElement("li",null,"打造一个属于自己的轻量化“卡片”笔记簿；")),u.createElement("br",null),u.createElement("i",null,"有何特点呢？"),u.createElement("ul",null,u.createElement("li",null,"✨"," ",u.createElement("a",{target:"_blank",href:"https://github.com/boojack/insmemo-web",rel:"noreferrer"},"开源项目")),u.createElement("li",null,"😋 精美且细节的视觉样式；"),u.createElement("li",null,"📑 体验优良的交互逻辑；")),u.createElement("br",null),u.createElement("p",null,"Enjoy it and have fun~ "),u.createElement("hr",null),u.createElement("p",{className:"normal-text"},"BTW, my personal site:"," ",u.createElement("a",{target:"_blank",href:"https://justsven.top",rel:"noreferrer"},"https://justsven.top")," ","👀"),u.createElement("p",{className:"normal-text"},"Last update at 2021/9/28 11:23:15 🎉")));function ge(){Y({className:"about-site-dialog"},pe)}const Ee=({destroy:e})=>{const{globalState:{shouldHideImageUrl:t,shouldSplitMemoWord:a,shouldUseMarkdownParser:n,showDarkMode:s}}=i.exports.useContext(E);i.exports.useEffect((()=>{}),[]);const r=async()=>{await D.fetchAllMemos();const e=D.getState().memos.map((e=>l(o({},e),{tags:e.tags.map((e=>e.text))}))),t=JSON.stringify(e),a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download","data.json"),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)};return u.createElement(u.Fragment,null,u.createElement("div",{className:"dialog-header-container"},u.createElement("p",{className:"title-text"},u.createElement("span",{className:"icon-text"},"⚙️"),"偏好设置"),u.createElement("button",{className:"text-btn close-btn",onClick:()=>{e()}},u.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),u.createElement("div",{className:"dialog-content-container"},u.createElement("div",{className:"section-container preferences-section-container"},u.createElement("p",{className:"title-text"},"常规"),u.createElement("label",{className:"form-label checkbox-form-label"},u.createElement("span",{className:"normal-text"},"深色模式"),u.createElement("img",{className:"icon-img",src:s?"/icons/check-active.svg":"/icons/check.svg"}),u.createElement("input",{className:"hidden",type:"checkbox",checked:s,onChange:e=>{const t=e.target.checked;y.setAppSetting({showDarkMode:t})}}))),u.createElement("div",{className:"section-container preferences-section-container"},u.createElement("p",{className:"title-text"},"Memo 显示相关"),u.createElement("label",{className:"form-label checkbox-form-label"},u.createElement("span",{className:"normal-text"},"中英文内容自动间隔"),u.createElement("img",{className:"icon-img",src:a?"/icons/check-active.svg":"/icons/check.svg"}),u.createElement("input",{className:"hidden",type:"checkbox",checked:a,onChange:e=>{const t=e.target.checked;y.setAppSetting({shouldSplitMemoWord:t})}})),u.createElement("label",{className:"form-label checkbox-form-label"},u.createElement("span",{className:"normal-text"},"隐藏图片链接地址"),u.createElement("img",{className:"icon-img",src:t?"/icons/check-active.svg":"/icons/check.svg"}),u.createElement("input",{className:"hidden",type:"checkbox",checked:t,onChange:e=>{const t=e.target.checked;y.setAppSetting({shouldHideImageUrl:t})}})),u.createElement("label",{className:"form-label checkbox-form-label"},u.createElement("span",{className:"normal-text"},"markdown 格式解析"),u.createElement("img",{className:"icon-img",src:n?"/icons/check-active.svg":"/icons/check.svg"}),u.createElement("input",{className:"hidden",type:"checkbox",checked:n,onChange:e=>{const t=e.target.checked;y.setAppSetting({shouldUseMarkdownParser:t})}}),u.createElement("span",{className:"tip-text"},"目前支持列表、代码块"))),u.createElement("div",{className:"section-container"},u.createElement("p",{className:"title-text"},"其他"),u.createElement("div",{className:"btn-container"},u.createElement("button",{className:"btn export-btn",onClick:r},"导出数据(JSON)"),u.createElement("button",{className:"btn export-btn",onClick:r},"导入数据(JSON)"),u.createElement("button",{className:"btn clean-btn hidden",onClick:async()=>{await D.fetchAllMemos();for(const e of D.getState().memos)await D.updateMemo(e.id,e.content.replace("&nbsp;"," ").replace(/#(.+?)#/g,"# $1 "))}},"Memo Clean")))))};const he=({destroy:e})=>{const{locationState:{query:{text:t,type:a}}}=i.exports.useContext(E),n=i.exports.useRef(null);i.exports.useEffect((()=>{var e;null==(e=n.current)||e.focus()}),[]);return u.createElement(u.Fragment,null,u.createElement("div",{className:"search-bar-inputer"},u.createElement("img",{className:"icon-img",src:"/icons/search.svg"}),u.createElement("input",{className:"text-input",type:"text",placeholder:"Search for memos",ref:n,value:t,onChange:e=>{const t=e.currentTarget.value;v.setTextQuery(t)},onKeyPress:t=>{"Enter"===t.code&&e()}})),u.createElement("div",{className:"special-type-selector"},u.createElement("p",{className:"title-text"},"QUICKLY FILTER"),u.createElement("div",{className:"section-container types-container"},u.createElement("span",{className:"section-text"},"Type:"),C.map(((e,t)=>u.createElement("div",{key:e.type},u.createElement("span",{className:"type-item "+(a===e.type?"selected":""),onClick:()=>{(e=>{const{type:t}=v.getState().query;e===t&&(e=""),v.setMemoTypeQuery(e)})(e.type)}},e.text),t+1<C.length?u.createElement("span",{className:"split-text"},"/"):null))))))},fe=()=>{const e="search-bar-dialog-wrapper",t=document.querySelector(`.${e}`);t&&t.parentElement?(t.classList.remove("showup"),t.classList.add("showoff"),setTimeout((()=>{t&&t.parentElement&&(t.parentElement.remove(),d.unmountComponentAtNode(t.parentElement))}),200)):Y({className:e,useAppContext:!0},he)};const ye=({visibility:e})=>u.createElement("div",{className:"menu-btns-popup "+(e?"":"hidden")},u.createElement("button",{className:"text-btn action-btn",onClick:de},u.createElement("span",{className:"icon"},"🤠")," 我的账号"),u.createElement("button",{className:"text-btn action-btn",onClick:()=>{Y({className:"preferences-dialog",useAppContext:!0},Ee)}},u.createElement("span",{className:"icon"},"⚙️")," 偏好设置"),u.createElement("button",{className:"text-btn action-btn",onClick:()=>{fe()}},u.createElement("span",{className:"icon"},"🔍")," 搜索"),u.createElement("button",{className:"text-btn action-btn",onClick:()=>{ge()}},u.createElement("span",{className:"icon"},"😀")," 关于"),u.createElement("button",{className:"text-btn action-btn",onClick:()=>{A.doSignOut(),location.reload()}},u.createElement("span",{className:"icon"},"👋")," 退出"));const Ne=()=>{const{userState:{user:e},memoState:{memos:t}}=i.exports.useContext(E),[a,n]=i.exports.useState({memosAmount:0,tagsAmount:0}),[s,r]=i.exports.useState(!1),c=e?e.username:"Memos",o=e?Math.ceil((Date.now()-new Date(e.createdAt).getTime())/1e3/3600/24):0;i.exports.useEffect((()=>{A.getState().user&&D.getMyDataAmount().then((e=>{n(e)})).catch((e=>{_.error(e.message)}))}),[t]);const l=i.exports.useCallback((e=>{e.stopPropagation();const t=!s;if(t){const e=()=>{r(!1),document.body.removeEventListener("click",e)};document.body.addEventListener("click",e)}r(t)}),[s]),m=i.exports.useCallback((()=>{v.clearQuery()}),[]);return u.createElement("div",{className:"user-banner-container"},u.createElement("div",{className:"userinfo-header-container"},u.createElement("p",{className:"username-text",onClick:m},c),u.createElement("button",{className:"action-btn menu-popup-btn",onClick:l}),u.createElement(ye,{visibility:s})),u.createElement("div",{className:"status-text-container"},u.createElement("div",{className:"status-text memos-text"},u.createElement("span",{className:"amount-text"},a.memosAmount),u.createElement("span",{className:"type-text"},"MEMO")),u.createElement("div",{className:"status-text tags-text"},u.createElement("span",{className:"amount-text"},a.tagsAmount),u.createElement("span",{className:"type-text"},"TAG")),u.createElement("div",{className:"status-text duration-text",onClick:()=>te()},u.createElement("span",{className:"amount-text"},o),u.createElement("span",{className:"type-text"},"DAY"))))};const xe=()=>{const{locationState:{query:e},memoState:{memos:t}}=i.exports.useContext(E),[a,n]=i.exports.useState([]),[s,r]=i.exports.useState(e.tag),c=K();return i.exports.useEffect((()=>{A.getState().user&&D.getMyTags().then((e=>{const t=e.sort(((e,t)=>t.createdAt-e.createdAt)).sort(((e,t)=>t.level-e.level)),a={subTags:[]};for(const n of t){const e=n.text.split("/");let t=a,s="";for(let a=0;a<e.length;a++){const r=e[a];s+=0===a?r:"/"+r;let c=null;for(const e of t.subTags)if(e.text===s){c=e;break}c?c.level+=n.level:(c={id:"",key:r,text:s,level:n.level,subTags:[],deep:a},t.subTags.push(c)),t.subTags.sort(((e,t)=>t.level-e.level)),s===n.text&&(c.id=n.id),t=c}}a.subTags.sort(((e,t)=>t.level-e.level)),n(a.subTags),c.setFinish()})).catch((e=>{c.setError(),_.error(e)}))}),[t]),i.exports.useEffect((()=>{r(e.tag);const t=document.querySelector("div#page-container");null==t||t.classList.remove("mobile-show-sidebar")}),[e]),u.createElement("div",{className:"tags-wrapper"},u.createElement("p",{className:"title-text"},"常用标签"),u.createElement("div",{className:"tags-container"},c.isLoading?u.createElement(u.Fragment,null):u.createElement(u.Fragment,null,a.map(((e,t)=>u.createElement(be,{key:e.id+"-"+t,tag:e,tagQuery:s}))),u.createElement(O,{when:a.length<5},u.createElement("p",{className:"tag-tip-container"},"输入",u.createElement("span",{className:"code-text"},"# Tag "),"来创建标签吧~")))))},be=e=>{const{tag:t,tagQuery:a}=e,n=a===t.text,s=t.subTags.length>0,[r,c]=B(a.includes(t.text)&&!n),o=""!==t.id;i.exports.useEffect((()=>{r||c(a.includes(t.text)&&!n)}),[a,t]);return u.createElement(u.Fragment,null,u.createElement("div",{className:"tag-item-container "+(n?"active":""),onClick:()=>{const e=n?"":t.text;e&&(N.copyTextToClipboard(`# ${e} `),D.polishTag(t.id).catch((()=>{}))),v.setTagQuery(e)}},u.createElement("span",{className:"tag-text"},u.createElement("span",{className:"icon-text"},"#"),t.key),u.createElement("div",{className:"btns-container"},o?u.createElement("span",{className:"action-btn rename-btn",onClick:e=>{e.stopPropagation(),o&&function(e){Y({className:"rename-tag-dialog"},ve,{tag:e})}(t)}},n?u.createElement("img",{className:"icon-img",src:"/icons/edit-white.svg"}):u.createElement("img",{className:"icon-img",src:"/icons/edit.svg"})):null,s?u.createElement("span",{className:"action-btn toggle-btn "+(r?"shown":""),onClick:e=>{e.stopPropagation(),c()}},n?u.createElement("img",{className:"icon-img",src:"/icons/arrow-right-white.svg"}):u.createElement("img",{className:"icon-img",src:"/icons/arrow-right.svg"})):null)),s?u.createElement("div",{className:"subtags-container "+(r?"":"hidden")},t.subTags.map(((e,t)=>u.createElement(be,{key:e.id+"-"+t,tag:e,tagQuery:a})))):null)},ve=e=>{const{destroy:t,tag:a}=e,n=i.exports.useRef(null),s=()=>{t()};return u.createElement(u.Fragment,null,u.createElement("div",{className:"dialog-header-container"},u.createElement("p",{className:"title-text"},u.createElement("span",{className:"icon-text"},"🏷️"),"标签重命名"),u.createElement("button",{className:"text-btn close-btn",onClick:s},u.createElement("img",{className:"icon-img",src:"/icons/close.svg"}))),u.createElement("div",{className:"dialog-content-container"},u.createElement("p",{className:"tag-text"},"旧：",a.text),u.createElement("input",{className:"text-input",type:"text",placeholder:"输入新标签",ref:n}),u.createElement("div",{className:"btns-container"},u.createElement("span",{className:"btn-text cancel-btn",onClick:s},"取消"),u.createElement("span",{className:"btn-text confirm-btn",onClick:()=>{var e;const s=null==(e=n.current)?void 0:e.value;s&&s!==a.text?s.length>36?_.error("标签太长啦，MAX=36"):D.updateTagText(a.id,s).then((()=>{D.clearMemos(),D.fetchAllMemos(),t()})).catch((()=>{})):t()}},"确定"))))};const we=12,Se=7,Me=()=>{const e=N.getTimeStampByDate(Date.now()),t=new Date(e).getDay()||7,a=(we-1)*Se+t,n=e-864e5*a,s=new Array(7-t).fill(0),r=()=>{const e=[];for(let t=1;t<=a;t++)e.push({timestamp:n+864e5*t,count:0});return e},{memoState:{memos:c}}=i.exports.useContext(E),[o,l]=i.exports.useState(r()),[m,d]=i.exports.useState(null),[p,g]=i.exports.useState(null),h=i.exports.useRef(null);i.exports.useEffect((()=>{if(!A.getState().user)return;const e=r();D.getMemosStat().then((t=>{for(const a of t){const t=(N.getTimeStampByDate(a.timestamp)-n)/864e5-1;t>=0&&(e[t].count=a.amount)}l([...e])})).catch((e=>{_.error(e.message)}))}),[c.length]);const f=i.exports.useCallback(((e,t)=>{if(d(t),h.current){const t=e.target;h.current.style.left=t.offsetLeft+"px",h.current.style.top=t.offsetTop+"px"}}),[]),y=i.exports.useCallback((()=>{d(null)}),[]),x=i.exports.useCallback((e=>{v.getState().query.from===e.timestamp?(v.setFromAndToQuery(0,0),g(null)):e.count>0&&(v.setFromAndToQuery(e.timestamp,e.timestamp+864e5),g(e))}),[]);return u.createElement("div",{className:"usage-heat-map-wrapper"},u.createElement("div",{className:"day-tip-text-container"},u.createElement("span",{className:"tip-text"},"Mon"),u.createElement("span",{className:"tip-text"}),u.createElement("span",{className:"tip-text"},"Wed"),u.createElement("span",{className:"tip-text"}),u.createElement("span",{className:"tip-text"},"Fri"),u.createElement("span",{className:"tip-text"}),u.createElement("span",{className:"tip-text"},"Sun")),u.createElement("div",{ref:h,className:"usage-detail-container pop-up "+(m?"":"hidden")},null==m?void 0:m.count," memos on ",u.createElement("span",{className:"date-text"},new Date(null==m?void 0:m.timestamp).toDateString())),u.createElement("div",{className:"usage-heat-map"},o.map(((e,t)=>{const a=e.count,n=a<=0?"":a<=2?"stat-day-L1-bg":a<=4?"stat-day-L2-bg":a<=6?"stat-day-L3-bg":"stat-day-L4-bg";return u.createElement("span",{className:"stat-container "+n+(p===e?" current":" "),key:t,onMouseEnter:t=>f(t,e),onMouseLeave:y,onClick:()=>x(e)})})),s.map(((e,t)=>u.createElement("span",{className:"stat-container null",key:t})))))};const ke=()=>{i.exports.useEffect((()=>{}),[]);const e=i.exports.useCallback((e=>{if("sidebar-wrapper"===e.target.className){const e=document.querySelector("div#page-container");null==e||e.classList.remove("mobile-show-sidebar")}}),[]);return u.createElement("div",{className:"sidebar-wrapper",onClick:e},u.createElement(Ne,null),u.createElement(Me,null),u.createElement(xe,null))},Te=/[\u3000\u3400-\u4DBF\u4E00-\u9FFF]/;function Ce(e,t){return void 0!==t.minLength&&e.length<t.minLength?{result:!1,reason:"长度过短"}:void 0!==t.maxLength&&e.length>t.maxLength?{result:!1,reason:"长度超出"}:t.noSpace&&e.includes(" ")?{result:!1,reason:"不应含有空格"}:t.noChinese&&Te.test(e)?{result:!1,reason:"不应含有中文字符"}:{result:!0}}const Ae={minLength:4,maxLength:24,noSpace:!0,noChinese:!0},De=({destroy:e})=>{const[t,a]=i.exports.useState(""),[n,s]=i.exports.useState(""),r=i.exports.useRef(null);i.exports.useEffect((()=>{const e=e=>{var t;"Enter"===e.key&&(null==(t=r.current)||t.click())};return document.body.addEventListener("keypress",e),()=>{document.body.removeEventListener("keypress",e)}}),[]);return u.createElement(u.Fragment,null,u.createElement("div",{className:"dialog-header-container"},u.createElement("p",{className:"title-text"},u.createElement("span",{className:"icon-text"},"👋")," 账号注册 / 登录")),u.createElement("div",{className:"dialog-content-container"},u.createElement("label",{className:"form-label input-form-label"},u.createElement("input",{type:"text",value:t,onChange:e=>{const t=e.target.value;a(t)}}),u.createElement("span",{className:"normal-text "+(""===t?"":"not-null")},"账号")),u.createElement("label",{className:"form-label input-form-label"},u.createElement("input",{type:"password",value:n,onChange:e=>{const t=e.target.value;s(t)}}),u.createElement("span",{className:"normal-text "+(""===n?"":"not-null")},"密码"))),u.createElement("div",{className:"dialog-footer-container"},u.createElement("div",{className:"btns-container"},u.createElement("a",{className:"btn-text",href:"https://github.com/login/oauth/authorize?client_id=187ba36888f152b06612&scope=read:user,gist"},"Login with GitHub")),u.createElement("div",{className:"btns-container"},u.createElement("button",{className:"text-btn signup-btn disabled",onClick:()=>_.info("注册已关闭")},"注册"),u.createElement("span",{className:"split-text"},"/"),u.createElement("button",{className:"text-btn signin-btn",ref:r,onClick:async()=>{const a=Ce(t,Ae);if(!a.result)return void _.error("用户名 "+a.reason);const s=Ce(n,Ae);if(s.result)try{const a=w.signin,{succeed:s,message:r}=await a(t,n);if(!s&&r)return void _.error("😟 "+r);await A.doSignIn()?(D.fetchMoreMemos().catch((()=>{})),e()):_.error("😟 不知道发生了什么错误")}catch(r){console.error(r),_.error("😟 "+r.message)}else _.error("密码 "+s.reason)}},"登录"))),u.createElement("p",{className:"tip-text"},"仅用于作品展示，注册暂时关闭；",u.createElement("br",null),"可输入 ",u.createElement("code",null,"guest, 123456")," 进行体验。",u.createElement("br",null),u.createElement("span",{className:"text-btn",onClick:()=>{ge()}},u.createElement("span",{className:"icon-text"},"😀"),"关于本站")))};String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return"[object regexp]"===Object.prototype.toString.call(e).toLowerCase()?this.replace(e,t):this.replace(new RegExp(e,"g"),t)});function Ie(){const{globalState:{showDarkMode:e}}=i.exports.useContext(E);return i.exports.useEffect((()=>{A.doSignIn().catch((()=>{})).finally((()=>{A.getState().user?D.fetchMoreMemos():Y({className:"signin-dialog",clickSpaceDestroy:!1},De)}));const e=e=>{if(!A.getState().user)return;const{ctrlKey:t,metaKey:a,code:n}=e;(t||a)&&"KeyP"===n&&(e.preventDefault(),fe())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[]),i.exports.useEffect((()=>{e?document.body.classList.add("dark"):document.body.classList.remove("dark")}),[e]),u.createElement(u.Fragment,null,u.createElement("div",{id:"page-container"},u.createElement(ke,null),u.createElement("div",{className:"content-wrapper"},u.createElement(I,null),u.createElement($,null),u.createElement(le,null))))}d.render(u.createElement(p,{store:g,context:E},u.createElement(Ie,null)),document.getElementById("root"));
